<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"compilationfail.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="orangejuice&#39;s blog">
<meta property="og:url" content="https://compilationfail.github.io/page/4/index.html">
<meta property="og:site_name" content="orangejuice&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="orangejuice">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://compilationfail.github.io/page/4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>orangejuice's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">orangejuice's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">挂了请务必叫我</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="orangejuice"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">orangejuice</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">257</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://twitter.com/ChenJerson" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;ChenJerson" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/3950662532/profile?rightmod=1&wvr=6&mod=personinfo" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;3950662532&#x2F;profile?rightmod&#x3D;1&amp;wvr&#x3D;6&amp;mod&#x3D;personinfo" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/CompilationFail" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CompilationFail" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/profiles/76561198969516062/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198969516062&#x2F;" rel="noopener me" target="_blank"><i class="fab fa-steam fa-fw"></i>Steam</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.last.fm/user/chasedeath" title="Lastfm → https:&#x2F;&#x2F;www.last.fm&#x2F;user&#x2F;chasedeath" rel="noopener me" target="_blank"><i class="fab fa-lastfm-square fa-fw"></i>Lastfm</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://open.spotify.com/user/mgxnlznf9dli6bm4k3sp0iuwz" title="Spotify → https:&#x2F;&#x2F;open.spotify.com&#x2F;user&#x2F;mgxnlznf9dli6bm4k3sp0iuwz" rel="noopener me" target="_blank"><i class="fab fa-spotify fa-fw"></i>Spotify</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%8CFJWC2020Day5-zzq%E3%80%8Dlg/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%8CFJWC2020Day5-zzq%E3%80%8Dlg/" class="post-title-link" itemprop="url">「FJWC2020Day5-zzq」lg</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-08-12 11:05:28 / Modified: 12:48:57" itemprop="dateCreated datePublished" datetime="2023-08-12T11:05:28+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/oi-solutions/" itemprop="url" rel="index"><span itemprop="name">oi-solutions</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="fjwc2020day5-zzqlg">「FJWC2020Day5-zzq」lg</h1>
<p>设模数为 <span class="math inline">\(P\)</span></p>
<p>考虑对于每一个 <span class="math inline">\(\gcd\)</span> 计算 <span
class="math inline">\(\text{lcm}\)</span> 之积 <span
class="math inline">\(F(m)\)</span></p>
<p>那么可以想到强制每个数都是 <span class="math inline">\(\gcd\)</span>
的倍数，问题转化为求 <span class="math inline">\(\lfloor
\frac{m}{gcd}\rfloor\)</span> 以内所有 <span
class="math inline">\(\text{lcm}\)</span> 的积 <span
class="math inline">\(G(m)\)</span></p>
<p>那么对于每个质因数依次考虑,则得到一个简单的式子</p>
<p><span class="math display">\[G(m)=\begin{aligned}\prod
p_i^{\sum_{j=1}m^n-(m-\lfloor \frac{m}{p_i^j}\rfloor )^n}
\end{aligned}\]</span></p>
<p>其中枚举的 <span class="math inline">\(j\)</span> 是 <span
class="math inline">\(p_i\)</span> 至少出现 <span
class="math inline">\(j\)</span> 次的方案数，枚举的 <span
class="math inline">\(j\)</span> 是 <span class="math inline">\(\log
m\)</span> 级别的</p>
<p>肯定是先求出指数 <span class="math inline">\(\mod \varphi(P)\)</span>
，可以线性预处理出所有的 <span class="math inline">\(i^n \mod
\varphi(P)\)</span></p>
<p>对于每个 <span class="math inline">\(p_i\)</span>
求出指数后还要快速幂，复杂度就是 <span class="math inline">\(O(|p_i|\log
P)=O(m)\)</span> ，实际带有一些常数</p>
<p>那么求 <span class="math inline">\(G(m)\)</span> 的复杂度上界是 <span
class="math inline">\(O(m\log m)\)</span> ，实际上 <span
class="math inline">\(\lfloor \frac{m}{i}\rfloor\)</span>
有很多重复，复杂度要低很多</p>
<p>得到的每个 <span class="math inline">\(\gcd\)</span>
的答案还要把强制取出的 <span class="math inline">\(\gcd\)</span>
补上，是 $^</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%8CGDOI2020%E6%A8%A1%E6%8B%9F%E8%B5%9Bday2%E3%80%8D%E6%88%91%E7%9A%84%E6%9C%8B%E5%8F%8B%E4%BB%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%8CGDOI2020%E6%A8%A1%E6%8B%9F%E8%B5%9Bday2%E3%80%8D%E6%88%91%E7%9A%84%E6%9C%8B%E5%8F%8B%E4%BB%AC/" class="post-title-link" itemprop="url">「GDOI2020模拟赛day2」我的朋友们</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-08-12 11:05:28 / Modified: 12:48:57" itemprop="dateCreated datePublished" datetime="2023-08-12T11:05:28+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/oi-solutions/" itemprop="url" rel="index"><span itemprop="name">oi-solutions</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1
id="gdoi2020模拟赛day2我的朋友们">「GDOI2020模拟赛day2」我的朋友们</h1>
<p>默认翻转了 <span class="math inline">\(a_i\)</span>
顺序，下文多项式省略 <span class="math inline">\((x)\)</span></p>
<p>设当前区间为 <span class="math inline">\((i-L,i]\)</span>
到最终结束的期望步数为 <span class="math inline">\(dp_i\)</span></p>
<p>令 <span class="math inline">\(A_i=a_ix+1-a_i\)</span></p>
<p>令 <span
class="math inline">\(P_i=\prod_{j\in(i-L,i]}A_j\)</span></p>
<p>令 <span class="math inline">\(F_i=\sum_{j=1}^i dp_jx^j\)</span></p>
<p>令 <span class="math inline">\(\displaystyle
G_i=F_{i-1}P_i,dp_i=\frac{[x^i]G_i}{coef_i}\)</span></p>
<p>其中常数 <span
class="math inline">\(coef_i=1-[x^0]P_i=1-\prod_{j\in(i-L,i]}(1-a_j)\)</span>
，容易预处理得到</p>
<p>用分治 <span class="math inline">\(\text{NTT}\)</span>
，过程中维护</p>
<p><span
class="math inline">\(P_{l,r}=\prod_{j\in(r-L,l]}A_j\)</span></p>
<p><span class="math inline">\(\displaystyle
G_{l,r}=F_{l-1}P_{l,r}\)</span></p>
<p>显然 <span class="math inline">\(G_{i,i}=G_i\)</span></p>
<p>分治转移如下：</p>
<p><span class="math inline">\(\displaystyle
G_{l,mid}=G_{l,r}\prod_{j\in (mid-L,min(l,r-L)]} A_j\)</span></p>
<p><span class="math inline">\(P_{l,mid}=P_{l,r}\prod_{j\in
(mid-L,min(l,r-L)]} A_j\)</span></p>
<p>先求出 <span class="math inline">\(G_{l,mid}\)</span></p>
<p><span class="math inline">\(P_{mid+1,r}=P_{l,r}\prod_{j\in
(max(r-L,l),mid+1]} A_j\)</span></p>
<p><span class="math inline">\(\displaystyle
G_{mid+1,r}=(G_{l,r}+(F_{mid}-F_{l-1})P_{l,r})\prod_{j\in
(max(r-L,l),mid+1]} A_j\)</span></p>
<p>归纳上述过程，发现实际上同步维护的部分只需要维护</p>
<p><span class="math inline">\(G_{l,r}\)</span> 的 <span
class="math inline">\([l-(r-l),r]\)</span> 项， <span
class="math inline">\(P_{l,r}\)</span> 的 <span
class="math inline">\([0,r-l]\)</span> 项</p>
<p>只需要实现</p>
<p>通过 <span class="math inline">\(G_{l,r}\)</span> 的 <span
class="math inline">\([l-(r-l),r]\)</span> 项得到 <span
class="math inline">\(G_{l,mid}\)</span> 的 <span
class="math inline">\([l-(mid-l),mid]\)</span> ，以及 <span
class="math inline">\(G_{mid+1,r}\)</span> 的 <span
class="math inline">\([l,r]\)</span></p>
<p>通过 <span class="math inline">\(P_{l,r}\)</span> 的 <span
class="math inline">\([0,r-l]\)</span> 得到 <span
class="math inline">\(P_{l,mid}\)</span> 的 <span
class="math inline">\([0,mid-l]\)</span> ， <span
class="math inline">\(P_{mid+1,r}\)</span> 的 <span
class="math inline">\([0,r-mid-1]\)</span></p>
<p>初始状态</p>
<p><span
class="math inline">\(P_{L,n}=\prod_{j\in(n-L,L]}A_j\)</span></p>
<p><span class="math inline">\(G_{L,n}=0\)</span></p>
<p>在分治过程中有非常多的 <span class="math inline">\(P_{l,r}\)</span>
都是空的。。</p>
<p>可以分治 <span class="math inline">\(\text{NTT}\)</span>
预处理出转移系数 <span class="math inline">\(\displaystyle \prod_{i=l}^r
A_i\)</span> ，或者用记忆化暴力求出，复杂度为 <span
class="math inline">\(O(n\log ^2n)\)</span></p>
<p>在转移过程中维护的部分长度与 <span class="math inline">\(r-l\)</span>
同阶，因此复杂度为 <span class="math inline">\(O(n\log^2 n)\)</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%8CTJOI%20%20HEOI2016%E3%80%8D%E6%B1%82%E5%92%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%8CTJOI%20%20HEOI2016%E3%80%8D%E6%B1%82%E5%92%8C/" class="post-title-link" itemprop="url">「TJOI / HEOI2016」求和</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-08-12 11:05:28 / Modified: 12:48:57" itemprop="dateCreated datePublished" datetime="2023-08-12T11:05:28+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/oi-solutions/" itemprop="url" rel="index"><span itemprop="name">oi-solutions</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="tjoi-heoi2016求和">「TJOI / HEOI2016」求和</h1>
<p>题目大意：</p>
<p>求 <span class="math inline">\(\displaystyle \sum_{i=0}^n\sum_{j=0}^i
\begin{Bmatrix}i\\ j\end{Bmatrix}2^j\cdot j!\)</span> 。</p>
<p>由于第二类斯特林数的生成函数 <span
class="math inline">\(S_m(x)=\cfrac{1}{m!}(e^x-1)^m\)</span> 。</p>
<p>所以求的东西就是 <span class="math inline">\(\displaystyle
F(x)=\sum_{i=0} (2e^x-2)^i=\frac{1}{3-2e^x}\)</span> 前 <span
class="math inline">\(n\)</span> 项系数。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/oi-solutions/%E3%80%8CTJOI%20%20HEOI2016%E3%80%8D%E6%B1%82%E5%92%8C/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%8C%E4%BD%99%E5%A7%9A%E4%B8%AD%E5%AD%A6%202019%20%E8%81%94%E6%B5%8B%20Day%204%E3%80%8D%E9%9A%8F%E6%9C%BA%E9%99%A4%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%8C%E4%BD%99%E5%A7%9A%E4%B8%AD%E5%AD%A6%202019%20%E8%81%94%E6%B5%8B%20Day%204%E3%80%8D%E9%9A%8F%E6%9C%BA%E9%99%A4%E6%B3%95/" class="post-title-link" itemprop="url">「余姚中学 2019 联测 Day 4」随机除法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-08-12 11:05:28 / Modified: 12:48:57" itemprop="dateCreated datePublished" datetime="2023-08-12T11:05:28+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/oi-solutions/" itemprop="url" rel="index"><span itemprop="name">oi-solutions</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="余姚中学-2019-联测-day-4随机除法">「余姚中学 2019 联测 Day
4」随机除法</h1>
<p>好题，难就难在转移的高位前缀和</p>
<p>首先是一个浅显的 <span class="math inline">\(\text{dp}\)</span>
状态，令 <span class="math inline">\(n=\Pi prime_i^{c_i}\)</span></p>
<p>则状态只跟 <span class="math inline">\(\{c_i\}\)</span>
有关，这是一个可重集合，强制定义 <span class="math inline">\(c_i\ge
c_{i-1}\)</span> 最小表示出所有不同状态</p>
<p>搜索一下 <span class="math inline">\(\text{dp}\)</span>
状态，发现只有 <span class="math inline">\(170000\)</span>
左右的状态数</p>
<p>直接枚举因数转移复杂度显然是升天的，直接枚举子集状态转移复杂度也很高，并且不好确定系数</p>
<p>所以用一个高位前缀和处理优化<strong>枚举因数的转移</strong></p>
<p>再说一遍，是高位前缀和<strong>枚举因数的转移</strong>，不同的因数可能对应同一个状态</p>
<p>常见的高位前缀和是 <span
class="math inline">\(dp_{i,S}=dp_{i-1,S}+dp_{i,S-\{S_i\}}\)</span></p>
<p>转移具有单调性，对于状态排序之后，定义辅助数组 <span
class="math inline">\(dp_{i,j}\)</span> 表示对于 <span
class="math inline">\(i\)</span> 这个状态</p>
<p>它的子集(注意这个子集是未排序的)中和它不同的最低位置 <span
class="math inline">\(\ge j\)</span> 的总和</p>
<p>计算高位前缀和时，每次转移只会对于一个位置改变</p>
<p>枚举状态时，取得位置是 <span class="math inline">\(j\)</span>
，调用时需要排序</p>
<p>而排完序之后 <span class="math inline">\(j\)</span>
可能会后移，所以需要定义成 <span class="math inline">\(\ge j\)</span>
的，否则会算多</p>
<p>比如转移 <span class="math inline">\((1,1,1)\leftarrow
(0,1,1),(1,0,1),(1,1,0)\)</span></p>
<p>如果定义成 <span class="math inline">\(\le j\)</span>
的状态，三种状态转移之后都变成 <span
class="math inline">\((1,1,0)\)</span></p>
<p>原先在这个状态里的三个位置编号是 <span
class="math inline">\((0,1,2)\)</span></p>
<p>如果都去 <span class="math inline">\((1,1,0)\)</span>
这个状态里转移过来，原先 <span class="math inline">\((0,1,2)\)</span>
对应的下标位置改变，变成</p>
<p><span class="math inline">\((1,2,0)\)</span></p>
<p><span class="math inline">\((0,2,1)\)</span></p>
<p><span class="math inline">\((0,1,2)\)</span></p>
<p>我们访问的时候访问的应该是子状态中不同位置 <span
class="math inline">\(\le j\)</span> 的总和</p>
<p>而从这个下标改变的状态里转移过来时，原先 <span
class="math inline">\(&gt;j\)</span> 的下标被移移动进 <span
class="math inline">\(\le j\)</span> 的范围</p>
<p>再转移就错了</p>
<p>所以正确定义状态之后就可以高位前缀和了</p>
<p>存储和访问状态可以用 <span
class="math inline">\(\text{Hash,Trie,int128}\)</span> 三种方法存储，
<span class="math inline">\(\text{int128}\)</span> 真香啊</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> __int128 Node;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">180000</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll k=P<span class="number">-2</span>)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(;k;k&gt;&gt;=<span class="number">1</span>,x=x*x%P) <span class="keyword">if</span>(k&amp;<span class="number">1</span>) res=res*x%P;</span><br><span class="line">	<span class="keyword">return</span> res; </span><br><span class="line">&#125;</span><br><span class="line">Node Max,st[N];</span><br><span class="line"><span class="type">int</span> m,a[<span class="number">100</span>],cnt,dp[N][<span class="number">20</span>],F[N],pri[]=&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">67</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">79</span>&#125;;</span><br><span class="line"><span class="type">char</span> str[<span class="number">30</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Find</span><span class="params">(Node s)</span></span>&#123; <span class="keyword">return</span> <span class="built_in">lower_bound</span>(st+<span class="number">1</span>,st+cnt+<span class="number">1</span>,s)-st; &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Load</span><span class="params">(Node s)</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">20</span>) a[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">20</span> &amp;&amp; s&gt;<span class="number">1</span>; ++i) <span class="keyword">while</span>(s%pri[i]==<span class="number">0</span>) s=s/pri[i],a[i]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> lst,Node s)</span> </span>&#123; </span><br><span class="line">	st[++cnt]=s;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,lst) &#123;</span><br><span class="line">		<span class="keyword">if</span>((s*=pri[p])&gt;Max) <span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">dfs</span>(p+<span class="number">1</span>,i,s);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;div.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;div.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	Max=<span class="number">1e12</span>,Max=Max*Max;</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">100</span>,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">fprintf</span>(stderr,<span class="string">&quot;States Number = %d\n&quot;</span>,cnt);</span><br><span class="line">	<span class="built_in">sort</span>(st+<span class="number">1</span>,st+cnt+<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">2</span>,cnt) &#123;</span><br><span class="line">		Node now; <span class="built_in">Load</span>(now=st[i]);</span><br><span class="line">		<span class="type">int</span> c=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">18</span>) c=<span class="number">1ll</span>*c*(a[i]+<span class="number">1</span>)%P;</span><br><span class="line">		<span class="built_in">drep</span>(j,<span class="number">18</span>,<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(!a[j]) dp[i][j]=dp[i][j+<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">int</span> k=j;</span><br><span class="line">				<span class="keyword">while</span>(k&gt;<span class="number">1</span> &amp;&amp; a[k<span class="number">-1</span>]==a[k]) --k;</span><br><span class="line">				<span class="type">int</span> p=<span class="built_in">Find</span>(now/pri[j]);</span><br><span class="line">				<span class="built_in">drep</span>(d,j,k) &#123;</span><br><span class="line">					dp[i][d]=dp[i][d+<span class="number">1</span>]+dp[p][d];</span><br><span class="line">					<span class="built_in">Mod1</span>(dp[i][d]);</span><br><span class="line">				&#125;</span><br><span class="line">				j=k;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		F[i]=(dp[i][<span class="number">1</span>]+c)*<span class="built_in">qpow</span>(c<span class="number">-1</span>)%P;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,<span class="number">18</span>) dp[i][j]+=F[i],<span class="built_in">Mod1</span>(dp[i][j]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>,str,&amp;m)) &#123;</span><br><span class="line">		Node n=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;str[i];++i) n=n*<span class="number">10</span>+(str[i]-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">			<span class="type">int</span> x;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x); a[i]=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span>(n%x==<span class="number">0</span>) n=n/x,a[i]++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">sort</span>(a+<span class="number">1</span>,a+m+<span class="number">1</span>,greater &lt;<span class="type">int</span>&gt; ());</span><br><span class="line">		n=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">rep</span>(j,<span class="number">1</span>,a[i]) n=n*pri[i];</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,F[<span class="built_in">Find</span>(n)]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%8Clych_cys%E6%A8%A1%E6%8B%9F%E9%A2%982018%E3%80%8D%E6%A9%98%E5%AD%90%E6%A0%91%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%8Clych_cys%E6%A8%A1%E6%8B%9F%E9%A2%982018%E3%80%8D%E6%A9%98%E5%AD%90%E6%A0%91%20/" class="post-title-link" itemprop="url">「lych_cys模拟题2018」橘子树</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-08-12 11:05:28 / Modified: 12:48:57" itemprop="dateCreated datePublished" datetime="2023-08-12T11:05:28+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/oi-solutions/" itemprop="url" rel="index"><span itemprop="name">oi-solutions</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="lych_cys模拟题2018橘子树">「lych_cys模拟题2018」橘子树</h1>
<p>你可能需要<a
target="_blank" rel="noopener" href="https://www.cnblogs.com/chasedeath/p/13092822.html">一点点简单知识</a></p>
<p>你可能需要<a
target="_blank" rel="noopener" href="https://www.cnblogs.com/chasedeath/p/13492548.html">一点点预先知识</a></p>
<p>设值域上限为 <span class="math inline">\(M=2\cdot 10^5,T=3\cdot
10^5\)</span></p>
<h3 id="求-fn">求 <span class="math inline">\(F(n)\)</span></h3>
<p>筛去 <span class="math inline">\(n^{\frac{1}{3}}\)</span>
以内的质因数，此时 <span class="math inline">\(n\)</span> 剩下的质因数
<span class="math inline">\(&gt;n^{\frac{1}{3}}\)</span></p>
<p>剩下的 <span class="math inline">\(n\)</span> 中，可能出现贡献的只有
<span class="math inline">\(n\)</span> 是完全平方数的情况， <span
class="math inline">\(O(1)\)</span> 判断即可</p>
<p>复杂度为 <span class="math inline">\(O(n^{\frac{1}{3}})\)</span></p>
<p><span class="math display">\[ \ \]</span></p>
<h3 id="求出-i-结点长了-t-时间的时候被收掉的答案">求出 <span
class="math inline">\(i\)</span> 结点长了 <span
class="math inline">\(t\)</span> 时间的时候被收掉的答案</h3>
<p>预处理 <span class="math inline">\(a_i,b_i\)</span> 的答案 <span
class="math inline">\(c_i=F(a_i),d_i=F(b_i)\)</span> ，复杂度为 <span
class="math inline">\(O(n\pi(M^{\frac{1}{3}}))\)</span></p>
<p>那么此时查询的权值就是 <span class="math inline">\(a_i\cdot
t\)</span> ，如果 <span class="math inline">\(&gt;b_i\)</span>
特判掉</p>
<p>否则，显然 <span class="math inline">\(c_i\)</span>
的贡献可以先分离掉考虑进答案</p>
<p>对于剩下的部分，不妨设 <span
class="math inline">\(x=\frac{a_i}{c_i}\)</span> ，显然 <span
class="math inline">\(x\)</span> 不包含平方因子</p>
<p>考虑 <span class="math inline">\(x\)</span> 与 <span
class="math inline">\(t\)</span> 的合并所产生的贡献，实际上就是 <span
class="math inline">\(\gcd(x,t)\)</span> (让 <span
class="math inline">\(x\)</span> 的单个因子与 <span
class="math inline">\(t\)</span> 匹配一下)</p>
<p>然后对于 <span class="math inline">\(t\)</span> 剩下的部分 <span
class="math inline">\(\frac{t}{\gcd(x,t)}\)</span> ，由于 <span
class="math inline">\(t\leq 3\cdot 10^5\)</span>
，可以预处理一下答案</p>
<p>综合一下上面的部分，那么一个点的答案就是 <span
class="math inline">\(c_i\gcd(x,t)^2 F(\frac{x}{\gcd(t,x)})\)</span></p>
<p>因此查询一个点的复杂度就是 <span class="math inline">\(\gcd\)</span>
的 <span class="math inline">\(O(\log T)\)</span></p>
<p><span class="math display">\[ \ \]</span></p>
<p>综合利用上面的方法，勉强可以拿到 <span class="math inline">\(nm\log
T\)</span> 的20分</p>
<p>剩下的部分，可以考虑把树树剖一下，然后每个查询可以化为在 <span
class="math inline">\(\text{dfs}\)</span> 序上的若干更新区间 <span
class="math inline">\(L_i,R_i,t_i\)</span></p>
<p>由于题目考虑的实际上是查询总和，因此可以对于每个点计算答案</p>
<p>不妨从 <span class="math inline">\(1-n\)</span> 扫描 <span
class="math inline">\(\text{dfs}\)</span> 序，对于每个区间在 <span
class="math inline">\(L_i\)</span> 插入 <span
class="math inline">\(t_i\)</span> ，在 <span
class="math inline">\(R_i+1\)</span> 删除 <span
class="math inline">\(t_i\)</span></p>
<p>用一个set来维护 <span class="math inline">\(t_i\)</span>
的顺序，复杂度为 <span class="math inline">\(O(n\log ^2n)\)</span></p>
<p>在插入/删除set元素的同时，维护每一个 <span
class="math inline">\(\Delta_i=t_i-t_{i-1}\)</span>
，也就是我们要查询的每个数</p>
<p>查询单点时，由于这样的 <span class="math inline">\(\sum \Delta_i\leq
T\)</span> ，所以最多包含 <span class="math inline">\(O(\sqrt
T)\)</span> 种不同的 <span class="math inline">\(\Delta_i\)</span></p>
<p>用另一个set之类的东西维护这些不同的位置，然后暴力查询，复杂度为 <span
class="math inline">\(O(n\sqrt T\log T)\)</span></p>
<p>总复杂度为 <span class="math inline">\(O(n\pi(M^{\frac{1}{3}})+n\sqrt
T\log T)\)</span> 左右</p>
<p><span class="math display">\[ \ \]</span></p>
<p><span class="math display">\[ \ \]</span></p>
<p><span class="math display">\[ \ \]</span></p>
<hr />
<p>后记</p>
<p>由于特(智)殊(力)的(缺)原(陷)因</p>
<p>我考场上写了一个树剖+分块+莫比乌斯反演的做法，而且还没调出来，代码是<a
target="_blank" rel="noopener" href="http://10.220.121.125/submission/70043">这个</a>，复杂度大概差不多
<span class="math inline">\(O(n\sqrt n
\log_n^{\frac{3}{2}})\)</span></p>
<p>不提了。。。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%8C2019%E4%BA%94%E6%A0%A1%E8%81%94%E8%80%83-%E9%9B%85%E7%A4%BC%E3%80%8D%E5%A4%A7%E5%87%AF%E7%9A%84%E7%96%91%E6%83%91%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%8C2019%E4%BA%94%E6%A0%A1%E8%81%94%E8%80%83-%E9%9B%85%E7%A4%BC%E3%80%8D%E5%A4%A7%E5%87%AF%E7%9A%84%E7%96%91%E6%83%91%20/" class="post-title-link" itemprop="url">「2019五校联考-雅礼」大凯的疑惑</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-08-12 11:05:28 / Modified: 12:48:57" itemprop="dateCreated datePublished" datetime="2023-08-12T11:05:28+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/oi-solutions/" itemprop="url" rel="index"><span itemprop="name">oi-solutions</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="五校联考-雅礼大凯的疑惑">「2019五校联考-雅礼」大凯的疑惑</h1>
<p>首先判断是否有无穷解，即判断 <span
class="math inline">\(\gcd(a,b)&gt;1\)</span> 时有无穷解</p>
<p>接下来我们由小凯的疑惑知道最大的无法表示的数是 <span
class="math inline">\(ab-a-b\)</span> ，这能确定一个上界</p>
<p>考虑计算 <span class="math inline">\([1,R](R&lt;ab)\)</span> 中能用
<span class="math inline">\(a,b\)</span> 表示出来的数</p>
<p>因为 <span class="math inline">\(\gcd(a,b)=1,R&lt;ab\)</span>
，所以每个数最多只有一种构成法，可以枚举其包含了几个 <span
class="math inline">\(b\)</span> ，剩下的部分直接任意放 <span
class="math inline">\(a\)</span></p>
<p>即得到计算能够被构成的个数的方法为 <span
class="math inline">\(\begin{aligned}\sum_{i=0}^{\lfloor
\frac{R}{a}\rfloor} \lfloor \frac{R-ib}{a}\rfloor+1
\end{aligned}\)</span></p>
<p>其中+1是计算了包含0个 <span class="math inline">\(a\)</span>
的情况</p>
<p>如果二分答案，复杂度为 <span class="math inline">\(O(a\log
(ab))\)</span> ，恐怕难以通过</p>
<p>优化：</p>
<p>我的思路是是先确定了 <span class="math inline">\(\lfloor
\frac{R}{a}\rfloor\)</span> ，那么此时确定了所有 <span
class="math inline">\(b\)</span> 的个数的贡献</p>
<p>那么考虑枚举，找到答案所属的 <span class="math inline">\(\lfloor
\frac{R}{a}\rfloor\)</span> 的区间，在这段区间里，判断一个数 <span
class="math inline">\(x\)</span> 是否可以被构成即:</p>
<p><span class="math inline">\(x\equiv ib\pmod a(i\leq \lfloor
\frac{R}{a}\rfloor)\)</span> ，即考虑了不同 <span
class="math inline">\(b\)</span> 的个数的贡献</p>
<p>用一个数组存下 <span class="math inline">\(ib\bmod a\)</span>
，那么可以 <span class="math inline">\(O(1)\)</span>
判断一个数是否合法，如果直接for过去是 <span
class="math inline">\(O(b)\)</span> 的</p>
<p>显然这在一段中，构成情况每 <span class="math inline">\(a\)</span>
个一循环，那么先快速跳循环即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2e7</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">ll a,b,k;</span><br><span class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll a,ll b)</span></span>&#123; <span class="keyword">return</span> b==<span class="number">0</span>?a:<span class="built_in">gcd</span>(b,a%b); &#125;</span><br><span class="line"><span class="type">bool</span> mk[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;math.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;math.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>,&amp;a,&amp;b,&amp;k);</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">gcd</span>(a,b)!=<span class="number">1</span> || a==<span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>),<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(a&gt;b) <span class="built_in">swap</span>(a,b);</span><br><span class="line">	<span class="keyword">if</span>(k==<span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,a*b-a-b),<span class="number">0</span>;</span><br><span class="line">	ll s=(a<span class="number">-1</span>)*(b<span class="number">-1</span>)/<span class="number">2</span>,c=<span class="number">0</span>; <span class="comment">// s为总的个数</span></span><br><span class="line">	<span class="keyword">if</span>(s&lt;k) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>),<span class="number">0</span>;</span><br><span class="line">	k=s-k+<span class="number">1</span>; <span class="comment">// 改为求第k小</span></span><br><span class="line">	<span class="type">int</span> p=mk[<span class="number">0</span>]=<span class="number">1</span>;  <span class="comment">// p为所属区间</span></span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,a<span class="number">-1</span>) &#123;</span><br><span class="line">		c+=i*b/a;</span><br><span class="line">		ll t=i*(b<span class="number">-1</span>)-c; <span class="comment">// t为这段区间内无法被表示的个数</span></span><br><span class="line">		<span class="keyword">if</span>(t&gt;=k)&#123; p=i; <span class="keyword">break</span>; &#125;</span><br><span class="line">		mk[i*b%a]=<span class="number">1</span>;  <span class="comment">// 把区间内的ib mod a 放进去</span></span><br><span class="line">	&#125;</span><br><span class="line">	k-=(p<span class="number">-1</span>)*(b<span class="number">-1</span>)-(c-p*b/a); <span class="comment">//还需要做的个数</span></span><br><span class="line">	ll l=(p<span class="number">-1</span>)*b+<span class="number">1</span>,d=l%a; <span class="comment">//l为区间开始位置</span></span><br><span class="line">	ll i=l+(k<span class="number">-1</span>)/(a-p)*a; <span class="comment">// 每个长度为a的循环中已经有p个位置被标记，可以被表示，因此还有a-p个位置无法表示</span></span><br><span class="line">	k-=(k<span class="number">-1</span>)/(a-p)*(a-p); <span class="comment">// 跳过循环</span></span><br><span class="line">	<span class="keyword">for</span>(;;++i,d++,d==a&amp;&amp;(d=<span class="number">0</span>)) <span class="keyword">if</span>(!mk[d] &amp;&amp; --k==<span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,i),<span class="number">0</span>; <span class="comment">// 暴力for最后a个</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/CurvyonRails%20TopCoder%20-%2012432/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/CurvyonRails%20TopCoder%20-%2012432/" class="post-title-link" itemprop="url">TopCoder SRM 570 Div1 CurvyonRails</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-08-12 11:05:28 / Modified: 12:48:57" itemprop="dateCreated datePublished" datetime="2023-08-12T11:05:28+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/oi-solutions/" itemprop="url" rel="index"><span itemprop="name">oi-solutions</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="topcoder-srm-570-div1-curvyonrails">TopCoder SRM 570 Div1
CurvyonRails</h1>
<p>题意: 一个 <span class="math inline">\(n\times m\)</span>
的网格图，其中有一些点需要建铁路，有一些点为关键点，在关键点上修直铁路会产生1的代价，求最小的代价</p>
<p>由于 <span class="math inline">\(n,m\leq 25\)</span> 显然不可以插头
<span class="math inline">\(\text{dp}\)</span> 。。。</p>
<p>考虑轨道联通实际上类似网络流的形式</p>
<p>考虑一个常见的思路: 网格图可以简化为二分图 然后 跑网络流</p>
<p>先不考虑代价的问题，判断是否存在合法方案</p>
<p>每个格子要有两条出边，因此可以让 <span
class="math inline">\(S\)</span> 向左侧点连边权为2的边，右侧点向 <span
class="math inline">\(T\)</span> 连边权为2的边</p>
<p>然后可以让每个左侧点向相邻的右侧点连边，即考虑了联通关系</p>
<p>下面考虑代价的计算，加入边的代价，即为费用流</p>
<p>连同向边会产生代价，因此考虑为每个节点新增两个节点，表示向上下/左右连边</p>
<p>对于让原节点对于新增的上下和左右节点 分别连两条代价为0和1的边</p>
<p>这样如果流了同向边，就会产生代价</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">25</span>*<span class="number">30</span>*<span class="number">3</span>,M=N&lt;&lt;<span class="number">3</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,k;</span><br><span class="line"><span class="type">int</span> a[<span class="number">30</span>][<span class="number">30</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Max Flow Min Cost</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> id[<span class="number">30</span>][<span class="number">30</span>][<span class="number">2</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> to,nxt,w,c;</span><br><span class="line">&#125;e[M];</span><br><span class="line"><span class="type">int</span> head[N],ecnt,S,T,V;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,V) head[i]=<span class="number">0</span>;</span><br><span class="line">	ecnt=<span class="number">1</span>,V=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">	e[++ecnt]=(Edge)&#123;v,head[u],w,c&#125;;</span><br><span class="line">	head[u]=ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c=<span class="number">0</span>)</span></span>&#123; <span class="built_in">AddEdge</span>(u,v,w,c),<span class="built_in">AddEdge</span>(v,u,<span class="number">0</span>,-c); &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> erep(u,i) for(int i=head[u],v=e[i].to,w=e[i].w,c=e[i].c;i;i=e[i].nxt,v=e[i].to,w=e[i].w,c=e[i].c)</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dis[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">SPFA</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> inq[N];</span><br><span class="line">	<span class="type">static</span> queue &lt;<span class="type">int</span>&gt; que;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,V) dis[i]=INF;</span><br><span class="line">	que.<span class="built_in">push</span>(S),dis[S]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> u=que.<span class="built_in">front</span>(); que.<span class="built_in">pop</span>();</span><br><span class="line">		inq[u]=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">erep</span>(u,i) <span class="keyword">if</span>(w &amp;&amp; dis[v]&gt;dis[u]+c) &#123;</span><br><span class="line">			dis[v]=dis[u]+c;</span><br><span class="line">			<span class="keyword">if</span>(!inq[v]) inq[v]=<span class="number">1</span>,que.<span class="built_in">push</span>(v);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dis[T]&lt;INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> in)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(u==T) <span class="keyword">return</span> in;</span><br><span class="line">	<span class="type">int</span> out=<span class="number">0</span>,t=dis[u]; dis[u]=INF;</span><br><span class="line">	<span class="built_in">erep</span>(u,i) <span class="keyword">if</span>(w &amp;&amp; dis[v]==t+c) &#123;</span><br><span class="line">		<span class="type">int</span> t=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(in-out,w));</span><br><span class="line">		e[i].w-=t,e[i^<span class="number">1</span>].w+=t,out+=t;</span><br><span class="line">		<span class="keyword">if</span>(in==out) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(out) dis[u]=t;</span><br><span class="line">	<span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Pii <span class="title">Dinic</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> flow=<span class="number">0</span>,cost=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">SPFA</span>()) </span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> t;(t=<span class="built_in">Dfs</span>(S,INF));) flow+=t,cost+=dis[T]*t;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">mp</span>(flow,cost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CurvyonRails</span> &#123;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="type">int</span> <span class="title">getmin</span><span class="params">(vector &lt;string&gt; field)</span> </span>&#123;</span><br><span class="line">			n=field.<span class="built_in">size</span>(),m=field[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="built_in">rep</span>(j,<span class="number">0</span>,m<span class="number">-1</span>) a[i+<span class="number">1</span>][j+<span class="number">1</span>]=field[i][j];</span><br><span class="line">			k=<span class="number">0</span>,<span class="built_in">Clear</span>();</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,m) <span class="keyword">if</span>(a[i][j]!=<span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">				k++;</span><br><span class="line">				<span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">1</span>) id[i][j][d]=++V;</span><br><span class="line">			&#125;</span><br><span class="line">			S=++V,T=++V;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,m) <span class="keyword">if</span>(a[i][j]!=<span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>((i+j)&amp;<span class="number">1</span>)&#123;</span><br><span class="line">					<span class="built_in">Link</span>(S,++V,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">1</span>) &#123;</span><br><span class="line">						<span class="built_in">Link</span>(V,id[i][j][d],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">						<span class="built_in">Link</span>(V,id[i][j][d],<span class="number">1</span>,a[i][j]==<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">						<span class="comment">// 如果两条走了同向，就会产生1的代价</span></span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span>(i&lt;n &amp;&amp; a[i+<span class="number">1</span>][j]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i][j][<span class="number">0</span>],id[i+<span class="number">1</span>][j][<span class="number">0</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="keyword">if</span>(j&lt;m &amp;&amp; a[i][j+<span class="number">1</span>]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i][j][<span class="number">1</span>],id[i][j+<span class="number">1</span>][<span class="number">1</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">Link</span>(++V,T,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">1</span>) &#123;</span><br><span class="line">						<span class="built_in">Link</span>(id[i][j][d],V,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">						<span class="built_in">Link</span>(id[i][j][d],V,<span class="number">1</span>,a[i][j]==<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">						<span class="comment">// 如果两条走了同向，就会产生1的代价</span></span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span>(i&lt;n &amp;&amp; a[i+<span class="number">1</span>][j]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i+<span class="number">1</span>][j][<span class="number">0</span>],id[i][j][<span class="number">0</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="keyword">if</span>(j&lt;m &amp;&amp; a[i][j+<span class="number">1</span>]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i][j+<span class="number">1</span>][<span class="number">1</span>],id[i][j][<span class="number">1</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			Pii ans=<span class="built_in">Dinic</span>();</span><br><span class="line">			<span class="keyword">if</span>(ans.first!=k) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">			<span class="keyword">return</span> ans.second;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Powered by KawigiEdit 2.1.4 (beta) modified by pivanof!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/DisjointSemicircles%20TopCoder%20-%2012365/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/DisjointSemicircles%20TopCoder%20-%2012365/" class="post-title-link" itemprop="url">Topcoder SRM568 Div1 DisjointSemicircles (二分图染色)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-08-12 11:05:28 / Modified: 12:48:57" itemprop="dateCreated datePublished" datetime="2023-08-12T11:05:28+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/oi-solutions/" itemprop="url" rel="index"><span itemprop="name">oi-solutions</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="topcoder-srm568-div1-disjointsemicircles-二分图染色">Topcoder
SRM568 Div1 DisjointSemicircles (二分图染色)</h1>
<p>题意: 给定数轴上排列的 <span class="math inline">\(2n\)</span>
个点，每个点需要找到另一个点和它匹配，并且以他们为直径两端，向上或者向下作一个半圆</p>
<p>有一些点已经匹配好了，要求判断是否存在一个合法的方案，满足所有的半圆不相交</p>
<p>###思路:</p>
<p>枚举已经确定的匹配半圆的方向(设有 <span
class="math inline">\(m\)</span> 对已匹配)，然后 <span
class="math inline">\(O(n)\)</span> 判断自由点是否存在合法方案</p>
<h3 id="判断合法方案的核心性质">判断合法方案的核心性质:</h3>
<p>定义一个<strong>点的方向</strong>为其所连接的<strong>半圆的方向</strong>(上为0，下为1)</p>
<p>则自由点存在合法方案的充要条件是:</p>
<p>整个序列上每种方向的点数为偶数，且所有已匹配的半圆所覆盖的区间下，和<strong>半圆同向的点</strong>个数为<strong>偶数</strong></p>
<p>必要性:</p>
<p>如果某个半圆下同向点个数为奇数，则必然有一个点与其同向并且不得不连到区间外，这显然不合法</p>
<p>充分性:</p>
<p>一种合法的构造方法是:</p>
<p>按照 <span class="math inline">\(L\)</span>
从左到右，遍历每个已匹配的半圆，如果包含同向子半圆优先解决同向的子半圆</p>
<p>剩下的点依然是偶数个，从左到右依次和上一个匹配即可</p>
<p><span class="math display">\[\  \]</span></p>
<h3 id="判断是否存在合法方案">判断是否存在合法方案</h3>
<p>那么问题转化为判断是否存在一种合法的定向方案，使得某一些区间里0/1的个数为偶数</p>
<p>考虑构建二分图染色，令点集 <span
class="math inline">\(V=\{0,1,\cdots,n,0&#39;,1&#39;,\cdots,n&#39;\}\)</span>
，则 <span class="math inline">\((u,v)\in E\)</span> 表示 <span
class="math inline">\(col(u)\ne col(v)\)</span></p>
<p>其中 <span class="math inline">\(i\)</span> 号节点表示 <span
class="math inline">\(1-i\)</span> 中所有未匹配节点方向的异或和， <span
class="math inline">\(i&#39;\)</span> 表示 <span
class="math inline">\(i\)</span> 的反点 <span
class="math inline">\((i,i&#39;)\in E\)</span></p>
<p>(到这里可以自己想一下怎么连边)</p>
<p>对于已匹配圆 <span class="math inline">\([L,R]\)</span> (注意不要忘了
<span class="math inline">\([1,n]\)</span> )</p>
<p>如果它方向为 <span class="math inline">\(1\)</span> ，显然只需要
<span class="math inline">\(col(L-1)=col(R)\)</span></p>
<p>如果方向为0，设 <span class="math inline">\([L,R]\)</span>
未染色个数为 <span class="math inline">\(k\)</span> ，则显然有 <span
class="math inline">\(col(L-1)=col(R)\oplus (k\mod 2)\)</span>
，即考虑反向的个数</p>
<p>同时对于已匹配点 <span class="math inline">\(i\)</span> ，显然有
<span class="math inline">\(col(i)=col(i-1)\)</span></p>
<p>由此，得到一个 <span class="math inline">\(O(n)\)</span>
点数边数的图</p>
<p>如果在 <span class="math inline">\(\text{dfs}\)</span>
枚举时同步加边和回撤，总复杂度就为 <span
class="math inline">\(O(2^m\cdot n)\)</span></p>
<p>由于不可能所有方案都合法，实际应该是一个比较松的上界</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">110</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">int</span> cnt[N];</span><br><span class="line"><span class="type">int</span> L[N],R[N],m,Cross[N][N];</span><br><span class="line"><span class="type">int</span> vec[<span class="number">2</span>][N],c[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> u,v,nxt;</span><br><span class="line">&#125;e[N*<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> head[N],ecnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	e[++ecnt]=(Edge)&#123;u,v,head[u]&#125;;</span><br><span class="line">	head[u]=ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span>&#123; </span><br><span class="line">	<span class="built_in">AddEdge</span>(u,v),<span class="built_in">AddEdge</span>(v,u); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Back</span><span class="params">()</span></span>&#123;</span><br><span class="line">	head[e[ecnt].u]=e[ecnt].nxt,ecnt--;</span><br><span class="line">	head[e[ecnt].u]=e[ecnt].nxt,ecnt--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ans,fl;</span><br><span class="line"><span class="type">int</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_col</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">	vis[u]=c;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=e[i].nxt)&#123;</span><br><span class="line">		<span class="type">int</span> v=e[i].v;</span><br><span class="line">		<span class="keyword">if</span>(!vis[v]) <span class="built_in">dfs_col</span>(v,<span class="number">3</span>-c);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(vis[v]==vis[u]) fl=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(ans) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span>(p&gt;m)&#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n*<span class="number">2</span>+<span class="number">1</span>) vis[i]=<span class="number">0</span>;</span><br><span class="line">		fl=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n*<span class="number">2</span>+<span class="number">1</span>) <span class="keyword">if</span>(!vis[i]) <span class="built_in">dfs_col</span>(i,<span class="number">1</span>);</span><br><span class="line">		ans|=fl;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="type">int</span> fl=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,c[i]) <span class="keyword">if</span>(R[vec[i][j]]&gt;L[p] &amp;&amp; R[vec[i][j]]&lt;R[p]) fl=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">		vec[i][++c[i]]=p;</span><br><span class="line">		<span class="keyword">if</span>(i || ~(cnt[R[p]]-cnt[L[p]])&amp;<span class="number">1</span>) <span class="built_in">Link</span>(L[p]+n+<span class="number">1</span>,R[p]<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">Link</span>(L[p],R[p]<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">dfs</span>(p+<span class="number">1</span>);</span><br><span class="line">		c[i]--,<span class="built_in">Back</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DisjointSemicircles</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">string <span class="title">getPossibility</span><span class="params">(vector &lt;<span class="type">int</span>&gt; labels)</span> </span>&#123;</span><br><span class="line">		n=labels.<span class="built_in">size</span>(),m=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) a[i]=labels[i<span class="number">-1</span>];</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">			cnt[i]=cnt[i<span class="number">-1</span>]+(a[i]==<span class="number">-1</span>);</span><br><span class="line">			<span class="keyword">if</span>(~a[i]) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,n) <span class="keyword">if</span>(a[j]==a[i]) L[++m]=i,R[m]=j;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!m) <span class="keyword">return</span> <span class="string">&quot;POSSIBLE&quot;</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,(n+<span class="number">1</span>)*<span class="number">2</span>) head[i]=ecnt=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(~a[i]) <span class="built_in">Link</span>(i+n+<span class="number">1</span>,i<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n) <span class="built_in">Link</span>(i,i+n+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">Link</span>(n+<span class="number">1</span>,n);</span><br><span class="line">		ans=<span class="number">0</span>,<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> ans?<span class="string">&quot;POSSIBLE&quot;</span>:<span class="string">&quot;IMPOSSIBLE&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/Equilateral%20Triangles/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/Equilateral%20Triangles/" class="post-title-link" itemprop="url">Equilateral Triangles</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-08-12 11:05:28 / Modified: 12:48:57" itemprop="dateCreated datePublished" datetime="2023-08-12T11:05:28+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/oi-solutions/" itemprop="url" rel="index"><span itemprop="name">oi-solutions</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="equilateral-triangles">Equilateral Triangles</h1>
<p>题意: 求所有三个点哈密顿距离相等的无序三元点对个数</p>
<p>推论1: 到平面中一点 <span class="math inline">\((x,y)\)</span>
哈密顿距离为 <span class="math inline">\(d\)</span> 的点，构成一个以
<span class="math inline">\((x,y)\)</span> 为中心， <span
class="math inline">\(d\)</span> 为半对角线长的菱形</p>
<p>菱形不好搞，转一下，令旋转后的点 <span
class="math inline">\(x&#39;=x+y,y&#39;=x-y\)</span>
，(也就是曼哈顿距离转切比雪夫距离)</p>
<p>这样得到的就是一个正方形了</p>
<p>推论2: 选出的三点中，一定存在两个点 <span
class="math inline">\(x\)</span> 或者 <span
class="math inline">\(y\)</span> 坐标相同</p>
<p>如果选出点 <span class="math inline">\(A,B\)</span>
不满足，由下图可以看到，可行的部分(就是相交部分 <span
class="math inline">\(C1,C2\)</span> )也必然满足</p>
<figure>
<img src="https://i.loli.net/2020/09/25/QgiP6kuB8JaH9to.png"
alt="te1.png" />
<figcaption aria-hidden="true">te1.png</figcaption>
</figure>
<p>接下来以 <span class="math inline">\(x\)</span> 相同为例，枚举点
<span class="math inline">\(A,B\)</span> ，设其距离为 <span
class="math inline">\(d\)</span></p>
<figure>
<img src="https://i.loli.net/2020/09/25/zAwO29WRSK5sXnL.png"
alt="te2.png" />
<figcaption aria-hidden="true">te2.png</figcaption>
</figure>
<p>可以看到比较显然就是两条红色的相交线段， <span
class="math inline">\(O(n^3)\)</span> 枚举 <span
class="math inline">\(A,B\)</span> 两点后，直接用前缀和维护即可</p>
<p>对于 <span class="math inline">\(x\)</span> 相同，对于 <span
class="math inline">\(y\)</span>
相同分别做一次即可，注意考虑的时候不要把 <span
class="math inline">\(x,y\)</span> 都有相同的算两次</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC optimize(2)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">610</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> A[N][N],B[N][N];</span><br><span class="line"><span class="type">int</span> S[N][N];</span><br><span class="line"><span class="type">int</span> D[N],C;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,A[i]+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,n) <span class="keyword">if</span>(A[i][j]==<span class="string">&#x27;*&#x27;</span>) B[i+j][i-j+n]=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) <span class="built_in">rep</span>(j,<span class="number">1</span>,n*<span class="number">2</span>) S[i][j]=S[i][j<span class="number">-1</span>]+B[i][j];</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) &#123;</span><br><span class="line">		C=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(x,<span class="number">1</span>,n*<span class="number">2</span>) <span class="keyword">if</span>(B[i][x]) D[++C]=x;</span><br><span class="line">		<span class="built_in">rep</span>(a,<span class="number">1</span>,C) <span class="built_in">rep</span>(b,a+<span class="number">1</span>,C) &#123;</span><br><span class="line">			<span class="type">int</span> d=D[b]-D[a];</span><br><span class="line">			i-d&gt;=<span class="number">1</span> &amp;&amp; (ans+=S[i-d][D[b]]-S[i-d][D[a]<span class="number">-1</span>]);</span><br><span class="line">			i+d&lt;=n*<span class="number">2</span> &amp;&amp; (ans+=S[i+d][D[b]]-S[i+d][D[a]<span class="number">-1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) <span class="built_in">rep</span>(j,<span class="number">1</span>,n*<span class="number">2</span>) S[i][j]=S[i][j<span class="number">-1</span>]+B[j][i];</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) &#123;</span><br><span class="line">		C=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(x,<span class="number">1</span>,n*<span class="number">2</span>) <span class="keyword">if</span>(B[x][i]) D[++C]=x;</span><br><span class="line">		<span class="built_in">rep</span>(a,<span class="number">1</span>,C) <span class="built_in">rep</span>(b,a+<span class="number">1</span>,C) &#123;</span><br><span class="line">			<span class="type">int</span> d=D[b]-D[a];</span><br><span class="line">			i-d&gt;=<span class="number">1</span> &amp;&amp; (ans+=S[i-d][D[b]<span class="number">-1</span>]-S[i-d][D[a]]);</span><br><span class="line">			i+d&lt;=n*<span class="number">2</span> &amp;&amp; (ans+=S[i+d][D[b]<span class="number">-1</span>]-S[i+d][D[a]]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/MapGuessing%20TopCoder%20-%2012152/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/MapGuessing%20TopCoder%20-%2012152/" class="post-title-link" itemprop="url"># [MapGuessing TopCoder - 12152](https://vjudge.net/problem/TopCoder-12152)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-08-12 11:05:28 / Modified: 12:48:57" itemprop="dateCreated datePublished" datetime="2023-08-12T11:05:28+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/oi-solutions/" itemprop="url" rel="index"><span itemprop="name">oi-solutions</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="mapguessing-topcoder---12152"><a
target="_blank" rel="noopener" href="https://vjudge.net/problem/TopCoder-12152">MapGuessing TopCoder -
12152</a></h2>
<p>做得我很迷</p>
<p>首先是可以把问题转化为，每次操作之后会让原序列的限制条件变为：不考虑某一些位置时合法</p>
<p>枚举每个开始位置，依次考虑每一个操作，如果有一个位置被改为不同，就是不合法的</p>
<p>对于每一个开始位置，能得到的的<strong>最优限制条件</strong>都是唯一的，因为只要是合法的，一定取最后一个合法的位置，才能尽可能多地覆盖一些位置</p>
<p>那么我们得到了 <span class="math inline">\(|goal|\)</span>
个这样的限制条件 <span class="math inline">\(S_i\)</span> ，设 <span
class="math inline">\(n=|goal|\)</span></p>
<p>直接计算肯定会算重，考虑一个简单的容斥</p>
<p><span class="math inline">\(\begin{aligned}Answer=\sum_{T\ne
\empty}(-1)^{|T|+1}2^{|S_{T_1}\cap \cdots \cap
S_{T_{|T|}}|}\end{aligned}\)</span></p>
<p>就是枚举选择一个限制的集合，求出他们的并集</p>
<p>直接枚举复杂度当然是 <span class="math inline">\(O(2^{|n|})\)</span>
，如果 <span class="math inline">\(\text{dfs}\)</span> 枚举，当前状态为
<span class="math inline">\(0\)</span> 时，可以直接返回答案</p>
<p>估计一下这个 <span class="math inline">\(\text{dfs}\)</span>
的复杂度</p>
<p>设操作过程中指针左右移动的距离是 <span
class="math inline">\(L\)</span> ，那么最多存在 <span
class="math inline">\(n-L\)</span> 个合法的开始位置，每个状态最多包含
<span class="math inline">\(L\)</span> 个 <span
class="math inline">\(1\)</span></p>
<p>很显然枚举的上限是 <span
class="math inline">\(\min\{2^{n-L},2^{L}\}\)</span>
，即受到<strong>开始位置的个数</strong>和<strong>可能出现的1个数</strong>的限制</p>
<p>当 <span class="math inline">\(n-L=L\)</span> 时，复杂度达到上限是
<span class="math inline">\(O(2^{\frac{n}{2}})\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line">set &lt;ll&gt; st;</span><br><span class="line">ll S[<span class="number">40</span>];</span><br><span class="line"><span class="type">int</span> now[<span class="number">40</span>],cnt;</span><br><span class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="type">int</span> p,ll State)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(p==cnt+<span class="number">1</span>) <span class="keyword">return</span> (<span class="number">1ll</span>&lt;&lt;__builtin_popcountll(State)); <span class="comment">// 枚举完毕</span></span><br><span class="line">	<span class="keyword">if</span>(State==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// 剪枝，注意因为是后面的所有1,-1相加，所以是return 0而不是1</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">dfs</span>(p+<span class="number">1</span>,State)-<span class="built_in">dfs</span>(p+<span class="number">1</span>,State&amp;S[p]);  <span class="comment">// 直接处理容斥系数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MapGuessing</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">countPatterns</span><span class="params">(string S, vector &lt;string&gt; code)</span> </span>&#123;</span><br><span class="line">		string C=<span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="keyword">for</span>(string t:code) C+=t;</span><br><span class="line">		<span class="type">int</span> n=S.<span class="built_in">size</span>();</span><br><span class="line">		st.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> p=i,f=<span class="number">1</span>;</span><br><span class="line">			ll lst=<span class="number">0</span>; <span class="comment">// 记录最后一个合法的即可</span></span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) now[i]=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">char</span> c:C) &#123;</span><br><span class="line">				<span class="keyword">if</span>(c==<span class="string">&#x27;&lt;&#x27;</span>) p--;</span><br><span class="line">				<span class="keyword">if</span>(c==<span class="string">&#x27;&gt;&#x27;</span>) p++;</span><br><span class="line">				<span class="keyword">if</span>(c==<span class="string">&#x27;0&#x27;</span>) now[p]=<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">if</span>(c==<span class="string">&#x27;1&#x27;</span>) now[p]=<span class="number">2</span>;</span><br><span class="line">				<span class="keyword">if</span>(p&lt;<span class="number">0</span> || p&gt;=n)&#123; f=<span class="number">0</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">				<span class="type">int</span> fl=<span class="number">1</span>;</span><br><span class="line">				ll T=<span class="number">0</span>;</span><br><span class="line">				<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">					<span class="keyword">if</span>(!now[i]) <span class="keyword">continue</span>;</span><br><span class="line">					<span class="keyword">if</span>(now[i]<span class="number">-1</span>!=S[i]-<span class="string">&#x27;0&#x27;</span>)&#123; fl=<span class="number">0</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">					<span class="keyword">else</span> T|=<span class="number">1ll</span>&lt;&lt;i;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">				lst=T;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(!f) <span class="keyword">continue</span>;</span><br><span class="line">			st.<span class="built_in">insert</span>(-lst);</span><br><span class="line">		&#125;</span><br><span class="line">		cnt=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(ll x:st) &#123;</span><br><span class="line">			ll y=-x;</span><br><span class="line">			<span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,cnt) <span class="keyword">if</span>((::S[i]&amp;y)==y)&#123; f=<span class="number">0</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">			<span class="keyword">if</span>(f) ::S[++cnt]=y;</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">//初始系数是-1</span></span><br><span class="line">		ll ans=(<span class="number">1ll</span>&lt;&lt;n)-<span class="built_in">dfs</span>(<span class="number">1</span>,(<span class="number">1ll</span>&lt;&lt;n)<span class="number">-1</span>); <span class="comment">// 注意枚举出来会把T=emptyset的情况算进去，要去掉</span></span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">orangejuice</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
