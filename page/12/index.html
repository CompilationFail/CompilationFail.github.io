<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"compilationfail.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="orangejuice&#39;s blog">
<meta property="og:url" content="https://compilationfail.github.io/page/12/index.html">
<meta property="og:site_name" content="orangejuice&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="orangejuice">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://compilationfail.github.io/page/12/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/12/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>orangejuice's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
  <script type="text/javascript">
    const bgc = 15;
    const bgu = "/images/bg";
    function getcookie() {
      // console.log("get", document.cookie);
      const s = document.cookie;
      return s.split('; ').find((row)=>row.startsWith("bgid="))?.split("=")[1];
    }
    function set_bg(index) {
      console.log("set", index);
      document.cookie = `bgid=${index}; path=/`;
      // console.log(document.cookie);
      url = `/images/bg${index}.jpg`;
      document.body.style=`background-image:url(${url});background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:fixed;`;
    }
    var index = parseInt(getcookie());
    if(isNaN(index) || index < 0 || index >= bgc) index = -1;
    window.onload = () => { set_bg(index) };
  </script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">orangejuice's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">挂了请务必叫我</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="orangejuice"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">orangejuice</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">268</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://twitter.com/ChenJerson" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;ChenJerson" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/3950662532/profile?rightmod=1&wvr=6&mod=personinfo" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;3950662532&#x2F;profile?rightmod&#x3D;1&amp;wvr&#x3D;6&amp;mod&#x3D;personinfo" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/CompilationFail" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CompilationFail" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/profiles/76561198969516062/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198969516062&#x2F;" rel="noopener me" target="_blank"><i class="fab fa-steam fa-fw"></i>Steam</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.last.fm/user/chasedeath" title="Lastfm → https:&#x2F;&#x2F;www.last.fm&#x2F;user&#x2F;chasedeath" rel="noopener me" target="_blank"><i class="fab fa-lastfm-square fa-fw"></i>Lastfm</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://open.spotify.com/user/mgxnlznf9dli6bm4k3sp0iuwz" title="Spotify → https:&#x2F;&#x2F;open.spotify.com&#x2F;user&#x2F;mgxnlznf9dli6bm4k3sp0iuwz" rel="noopener me" target="_blank"><i class="fab fa-spotify fa-fw"></i>Spotify</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/CodeForces/CF715E%20-%20Complete%20the%20Permutations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/CodeForces/CF715E%20-%20Complete%20the%20Permutations/" class="post-title-link" itemprop="url">CF715E - Complete the Permutations</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:28:48" itemprop="dateModified" datetime="2023-08-17T21:28:48+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="cf715e---complete-the-permutations">CF715E - Complete the
Permutations</h1>
<h3 id="题目大意">题目大意</h3>
<p>对于两个排列 <span class="math inline">\(p,q\)</span> ，令 <span
class="math inline">\(p\rightarrow q\)</span> 代价为通过交换使得 <span
class="math inline">\(p\)</span> 变成 <span
class="math inline">\(q\)</span> 的最小步数</p>
<p>现在部分给定了 <span class="math inline">\(p\)</span> 和 <span
class="math inline">\(q\)</span> ，求所有情况下， <span
class="math inline">\(p\rightarrow q=i,i\in[0,n-1]\)</span>
的排列组数目</p>
<p><br></p>
<h3 id="分析">分析</h3>
<p>排列变换显然要放到置换环上考虑，考虑两个排列之间的变换有多种等价的方式</p>
<p>不妨认为连的边就是 <span class="math inline">\(p_i\rightarrow
q_i\)</span> ，最终操作步数就是 <span class="math inline">\(n-\)</span>
置换环的个数</p>
<p>对于已经确定的部分，能够确定的边可以直接连，能够确定的链可以缩成点</p>
<p>那么最终，图上只剩下三种待定的边</p>
<p><span class="math inline">\(0\rightarrow 0,0\rightarrow
x,x\rightarrow 0\)</span> ，其中 <span
class="math inline">\(0\rightarrow x,x\rightarrow 0\)</span>
表示一条出现了一半的边</p>
<p>ps: 如果有 <span class="math inline">\(0\rightarrow x\rightarrow
0\)</span> ，那么直接缩成一个 <span class="math inline">\(0\rightarrow
0\)</span> 看待</p>
<p>不妨设这三种边个数分别为 <span class="math inline">\(A,B,C\)</span>
，已经确定的环可以数出是 <span class="math inline">\(D\)</span>
最后加入答案</p>
<p>由于一个 <span class="math inline">\(A\)</span>
由两边确定，实际上确定一个边组之后，排列 <span
class="math inline">\(0\rightarrow 0\)</span> 的位置得到 <span
class="math inline">\(A!\)</span> 种方案，也可以最后加入答案</p>
<p>考虑什么样的边可以接成环</p>
<p>仅A: <span class="math inline">\(0\rightarrow 0,0\rightarrow
0\cdots\)</span></p>
<p>仅B: <span class="math inline">\(0\rightarrow x,0\rightarrow
x\cdots\)</span></p>
<p>仅C: <span class="math inline">\(x\rightarrow 0,x\rightarrow
0,\cdots\)</span></p>
<p>A+B=A, <span class="math inline">\(0\rightarrow x+0\rightarrow
0=0\rightarrow 0\)</span></p>
<p>C+A=A, <span class="math inline">\(0\rightarrow 0+x\rightarrow
0=0\rightarrow 0\)</span></p>
<p>实际上，组合环的情况</p>
<p>B前面要么是B要么是A，最终将A后面跟着的小弟B都缩在一起看待</p>
<p>C后面要么是C要么是A，最终将A前面跟着的大哥C都缩在一起看待</p>
<p>实际上B,C计算类似，我们能够得到一个计算思路</p>
<p>将每个B,C加入组合环对于组合环缩点之后的点数无影响，那么可以将A,B,C分离计算</p>
<p>那么考虑一个B要么在单纯的B环上要么在组合环上</p>
<p>枚举有 <span class="math inline">\(i\)</span> 个 <span
class="math inline">\(B\)</span> 在单纯B环上，构成 <span
class="math inline">\(j\)</span> 个环的方案数（当然要先组合数将 <span
class="math inline">\(j\)</span> 个点选出）</p>
<p>这就是第一类斯特林数 <span
class="math inline">\(\begin{bmatrix}i\\j\end{bmatrix}\)</span> ，<a
target="_blank" rel="noopener" href="https://www.cnblogs.com/chasedeath/p/14049870.html">参考</a></p>
<p>剩下的加入组合环中，考虑依次加入每个B，每个B可以接在B后面也可以接在A后面</p>
<p>方案数即 <span class="math inline">\(A^{\overline{B-i}}\)</span>
，最终计算得到 <span class="math inline">\(G_i\)</span>
表示B构成了i个单纯B环的方案数，复杂度为 <span
class="math inline">\(O(n^2)\)</span></p>
<p><br></p>
<p>A的贡献不需要将组合环和单纯A环分开考虑，直接就是 <span
class="math inline">\(F_i=\begin{bmatrix}A\\i\end{bmatrix}\)</span></p>
<p>最后将三种点背包合并，加入前面提到的常量即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="keyword">enum</span>&#123;N=<span class="number">300</span>,P=<span class="number">998244353</span>&#125;;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> p[N],q[N],pre[N],nxt[N],A,B,E,D;</span><br><span class="line"><span class="type">int</span> F[N],G[N],H[N],V[N];</span><br><span class="line"><span class="type">int</span> S[N][N],T[N][N],C[N][N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) pre[i]=nxt[i]=<span class="number">-1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,**S=<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,i) S[i][j]=(S[i<span class="number">-1</span>][j<span class="number">-1</span>]+<span class="number">1ll</span>*(i<span class="number">-1</span>)*S[i<span class="number">-1</span>][j])%P;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n) <span class="built_in">rep</span>(j,*T[i]=<span class="number">1</span>,n) T[i][j]=<span class="number">1ll</span>*T[i][j<span class="number">-1</span>]*(i+j<span class="number">-1</span>)%P;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n) <span class="built_in">rep</span>(j,*C[i]=<span class="number">1</span>,i) C[i][j]=(C[i<span class="number">-1</span>][j]+C[i<span class="number">-1</span>][j<span class="number">-1</span>])%P;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,p+i);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,q+i);</span><br><span class="line">		<span class="keyword">if</span>(p[i] &amp;&amp; q[i]) nxt[p[i]]=q[i],pre[q[i]]=p[i];</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(p[i]) nxt[p[i]]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(q[i]) pre[q[i]]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(pre[i]&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">		<span class="type">int</span> j=i;</span><br><span class="line">		<span class="keyword">for</span>(;nxt[j]&gt;<span class="number">0</span>;j=nxt[j]) V[j]=<span class="number">1</span>;</span><br><span class="line">		V[j]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(pre[i]==nxt[j]) A+=pre[i]==<span class="number">-1</span>; <span class="comment">// ==0 || ==-1 ,but we can&#x27;t count 0 in </span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(~pre[i]) B++;</span><br><span class="line">		<span class="keyword">else</span> E++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(!V[i]) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j=i;!V[j];j=nxt[j]) V[j]=<span class="number">1</span>;</span><br><span class="line">		D++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> c=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,A) c=<span class="number">1ll</span>*c*i%P;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,A) F[i]=<span class="number">1ll</span>*c*S[A][i]%P;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,B) <span class="built_in">rep</span>(j,<span class="number">0</span>,i) G[j]=(G[j]+<span class="number">1ll</span>*S[i][j]*T[A][B-i]%P*C[B][i])%P;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,E) <span class="built_in">rep</span>(j,<span class="number">0</span>,i) H[j]=(H[j]+<span class="number">1ll</span>*S[i][j]*T[A][E-i]%P*C[E][i])%P;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n) V[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,A) <span class="built_in">rep</span>(j,<span class="number">0</span>,B) V[i+j+D]=(V[i+j+D]+<span class="number">1ll</span>*F[i]*G[j])%P;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n) F[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,A+B+D) <span class="built_in">rep</span>(j,<span class="number">0</span>,E) F[n-i-j]=(F[n-i-j]+<span class="number">1ll</span>*V[i]*H[j])%P;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,F[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="进一步的优化">进一步的优化？</h3>
<p><span class="math inline">\(F_i\)</span>
的计算时标准的第一类斯特林数行，用倍增法求上升幂即可</p>
<p><span class="math inline">\(\displaystyle G(x)=\sum_{i=0}^B
A^{\overline{B-i}}\binom{B}{i} x^{\overline{i}}\)</span></p>
<p>把系数拿出来，可以直接做一个上升幂多项式转普通多项式</p>
<p>复杂度为 <span class="math inline">\(O(n\log ^2n)\)</span></p>
<p>（听说可以 <span class="math inline">\(O(n\log n)\)</span>
<del>但是我没有脑子只会套板子哈哈哈哈</del>）</p>
<p><br></p>
<p>以下未上传！！！如果看到说明我在搞笑！！！看到叫我</p>
<p><span class="math inline">\(\displaystyle G_i=\sum_{j=i}^B
\binom{B}{j}A^{\overline{B-j}}\cdot
[x^j]\frac{1}{i!}(-1)^i\ln^i(1-x)\)</span></p>
<p><span class="math inline">\(\displaystyle G_i=\sum_{j=i}^B
\frac{B!}{j!(B-j)!}\frac{(A+B-j-1)!}{(A-1)!}\cdot
[x^j]\frac{1}{i!}(-1)^i\ln^i(1-x)\)</span></p>
<p><span class="math inline">\(\displaystyle
G_i=\frac{(-1)^iB!}{(A-1)!i!} \sum_{j=i}^B
\frac{(A+B-j-1)!}{j!(B-j)!}\cdot [x^j]\ln^i(1-x)\)</span></p>
<p>由于对于每个 <span class="math inline">\(i\)</span> ， <span
class="math inline">\(\displaystyle \sum_{j=i}^B
\frac{(A+B-j-1)!}{j!(B-j)!}\)</span> 是常量，设</p>
<p><span class="math inline">\(\displaystyle \varphi(x)=\sum_{j=0}^B
x^{-1-j} \frac{(A+B-j-1)!}{j!(B-j)!}\)</span> (为什么是是 <span
class="math inline">\(-1-j\)</span> 会在下面出现)</p>
<p><span class="math inline">\(\displaystyle
G_i=\frac{(-1)^iB!}{(A-1)!i!} [x^{-1}] \varphi(x)\ln^i(1-x)\)</span></p>
<p>对比扩展拉格朗日反演的形式</p>
<p><span class="math inline">\(\displaystyle
[x^n]H(G(x))=\frac{1}{n}[x^{-1}]H&#39;(x)(\frac{1}{F(x)})^n\)</span>
，其中 <span class="math inline">\(G(x)\)</span> 为 <span
class="math inline">\(F(x)\)</span> 的复合逆</p>
<p>得到 <span class="math inline">\(\displaystyle H(x)=\int
\varphi(x),F(x)=\frac{1}{\ln(1-x)}\)</span></p>
<p>从而得到 <span class="math inline">\(F(x)\)</span> 的复合逆为 <span
class="math inline">\(\displaystyle 1-e^{x^{-1}}\)</span></p>
<p>现在要算 <span
class="math inline">\(H(1-e^{x^{-1}})=\sum\)</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/LOJ/[LOJ6719]%20300iq%20contest2%20%E6%95%B0%E4%BB%99%E4%BA%BA%E6%8E%8C%20%E5%8A%A0%E5%BC%BA%E7%89%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/LOJ/%5BLOJ6719%5D%20300iq%20contest2%20%E6%95%B0%E4%BB%99%E4%BA%BA%E6%8E%8C%20%E5%8A%A0%E5%BC%BA%E7%89%88/" class="post-title-link" itemprop="url">LOJ 6719. 「300iq Contest 2」数仙人掌 加强版 (集合幂级数)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:28:48" itemprop="dateModified" datetime="2023-08-17T21:28:48+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="loj-6719.-300iq-contest-2数仙人掌-加强版-集合幂级数">LOJ 6719.
「300iq Contest 2」数仙人掌 加强版 (集合幂级数)</h1>
<p>前置知识：<a
target="_blank" rel="noopener" href="https://www.cnblogs.com/chasedeath/p/13891189.html">集合幂级数的
<span class="math inline">\(\ln ,\exp\)</span></a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a;i&lt;=b;++i)</span></span><br><span class="line"><span class="keyword">enum</span>&#123;N=<span class="number">20</span>,M=<span class="number">1</span>&lt;&lt;<span class="number">18</span>|<span class="number">10</span>,P=<span class="number">998244353</span>&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">U</span>&#123;</span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="built_in">U</span>()&#123;&#125; <span class="built_in">U</span>(<span class="type">int</span> x):<span class="built_in">x</span>(x)&#123;&#125;</span><br><span class="line">	<span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> += (<span class="type">const</span> U &amp;t)&#123; x+=t.x,x&gt;=P&amp;&amp;(x-=P); &#125;</span><br><span class="line">	<span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> -= (<span class="type">const</span> U &amp;t)&#123; x-=t.x,x&lt;<span class="number">0</span>&amp;&amp;(x+=P); &#125;</span><br><span class="line">	<span class="keyword">inline</span> U <span class="keyword">operator</span> * (<span class="type">const</span> U &amp;t)&#123; <span class="keyword">return</span> <span class="built_in">U</span>(<span class="built_in">static_cast</span>&lt;<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>&gt;(x)*t.x%P); &#125;</span><br><span class="line">&#125;I[N],F[M][N],H[M][N];</span><br><span class="line"><span class="type">int</span> n,m,G[N],C[M],B[M];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FWT</span><span class="params">(<span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;m;i&lt;&lt;=<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">0</span>;l&lt;m;l+=i*<span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=l;j&lt;l+i;++j) &#123;</span><br><span class="line">				<span class="keyword">if</span>(f==<span class="number">1</span>) <span class="built_in">rep</span>(d,<span class="number">1</span>,n) F[j+i][d]+=F[j][d];</span><br><span class="line">				<span class="keyword">else</span> <span class="built_in">rep</span>(d,<span class="number">1</span>,n) F[j+i][d]-=F[j][d];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Exp</span><span class="params">(U *a)</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> U b[N];</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) b[i]=a[i+<span class="number">1</span>]*(i+<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">		U t=b[i];</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,i) t+=a[j]*b[i-j];</span><br><span class="line">		a[i+<span class="number">1</span>]=t*I[i+<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">if</span>(n==<span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;1&quot;</span>),<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> x,y;m--;) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y),x--,y--,G[x]|=<span class="number">1</span>&lt;&lt;y,G[y]|=<span class="number">1</span>&lt;&lt;x;</span><br><span class="line">	I[<span class="number">0</span>]=I[<span class="number">1</span>]=<span class="number">1</span>,m=<span class="number">1</span>&lt;&lt;n;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) B[<span class="number">1</span>&lt;&lt;i]=i;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">2</span>,n) I[i]=<span class="built_in">U</span>(P-P/i)*I[P%i];</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m<span class="number">-1</span>) C[i]=C[i&amp;(i<span class="number">-1</span>)]+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(st,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">		H[<span class="number">1</span>&lt;&lt;st][st]=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(S,<span class="number">0</span>,m<span class="number">-1</span>) <span class="built_in">rep</span>(i,st,n<span class="number">-1</span>) <span class="keyword">if</span>(H[S][i].x) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> T=G[i]&amp;~S;T;T&amp;=T<span class="number">-1</span>) </span><br><span class="line">				H[S|(T&amp;-T)][B[T&amp;-T]]+=H[S][i];</span><br><span class="line">			<span class="keyword">if</span>(G[i]&amp;(<span class="number">1</span>&lt;&lt;st)) F[S][C[S]]+=H[S][i]*I[<span class="number">1</span>+(C[S]&gt;<span class="number">2</span>)];</span><br><span class="line">			H[S][i]=<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">FWT</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;m;i&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">0</span>;l&lt;m;l+=i*<span class="number">2</span>) <span class="keyword">for</span>(<span class="type">int</span> j=l;j&lt;l+i;++j) &#123;</span><br><span class="line">			<span class="built_in">rep</span>(k,<span class="number">1</span>,n) F[j+i][k]-=F[j][k];</span><br><span class="line">			<span class="built_in">Exp</span>(F[j+i]+<span class="number">1</span>);</span><br><span class="line">			<span class="built_in">rep</span>(k,<span class="number">1</span>,n) F[j+i][k]+=F[j][k];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">FWT</span>(<span class="number">-1</span>),<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,F[m<span class="number">-1</span>][n].x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/BoundedOptimization%20TopCoder%20-%2012294/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/BoundedOptimization%20TopCoder%20-%2012294/" class="post-title-link" itemprop="url">[BoundedOptimization TopCoder - 12294](https://vjudge.net/problem/TopCoder-12294)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:28:48" itemprop="dateModified" datetime="2023-08-17T21:28:48+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="boundedoptimization-topcoder---12294"><a
target="_blank" rel="noopener" href="https://vjudge.net/problem/TopCoder-12294">BoundedOptimization
TopCoder - 12294</a></h1>
<p>考虑在最优情况下，某一些数在 <span
class="math inline">\(\text{lowerbound}\)</span> ,某一些在 <span
class="math inline">\(\text{upperbound}\)</span></p>
<p>确定了这些数之后，对于那些处于 <span
class="math inline">\((\text{lowerbound,upperbound})\)</span>
之间的数，它们的值其实是在<strong>忽略了上下界的情况下能取到的最优情况</strong></p>
<p>否则只要上下移动一点就可能达到一个更优的情况</p>
<p>那么考虑枚举每个数的状态在 <span
class="math inline">\(\text{lowerbound,upperbound,(lowerbound,uppperbound)}\)</span></p>
<p>推论：在中间的数之间必然存在互相关系</p>
<p>假设存在两个数 <span class="math inline">\(x_i,x_j\)</span>
之间没有互相关系，令其他数不变，</p>
<p>则答案式子可以表示为 <span class="math inline">\(ax_i+bx_j+c\)</span>
的形式，改变两个数的值总能得到更优的情况</p>
<p><span class="math display">\[ \ \]</span></p>
<p>设处在中间位置的数为 <span
class="math inline">\(x_1,\cdots,x_m\)</span> ，其他数为 <span
class="math inline">\(y_1,\cdots ,y_k\)</span>
，每个数连到外面的权值总和为 <span
class="math inline">\(s_i\)</span></p>
<p>发现在最优情况下， <span class="math inline">\(\sum x_i+\sum y_i
=MaxSum\)</span> ，那么就确定了 <span class="math inline">\(\sum
x_i\)</span> 的值，设为 <span class="math inline">\(Sum\)</span></p>
<p>那么答案就可以表示为 <span
class="math inline">\(\begin{aligned}\frac{\sum_ix_i\cdot(Sum-x_i+2\cdot
s_i)}{2}\end{aligned}+c\)</span></p>
<p>其中常数 <span class="math inline">\(c\)</span>
是外面的数之间的总和</p>
<p>不考虑限制的情况下，最优情况是 <span
class="math inline">\(x_i=\frac{Sum+s_i}{2}\)</span></p>
<p>此时，若 <span class="math inline">\(\sum x_i\ne Sum\)</span>
，是不合法的，需要调整</p>
<p>而让每个数改变 <span class="math inline">\(d\)</span>
，减少的答案都是 <span class="math inline">\(d^2\)</span>
(因为原来是在二次函数的最高点)</p>
<p>所以每个数都改变 <span
class="math inline">\(\begin{aligned}\frac{\sum
\frac{Sum+x_i}{2}-Sum}{m}\end{aligned}\)</span> 是最优的</p>
<p>注意这里计算时都是<strong>忽略了</strong> <span
class="math inline">\(x_1,\cdots,x_m\)</span> 的 <span
class="math inline">\(\text{lowerbound,upperbound}\)</span>
，求出的值不一定合法</p>
<p>如果不合法说明至少有某个值该到上下界之后答案会更优，所以这次的答案不用考虑</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> db;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">30</span>;</span><br><span class="line"><span class="type">const</span> db eps=<span class="number">1e-7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> G[N][N];</span><br><span class="line"><span class="type">int</span> A[N],w[N];</span><br><span class="line">db val[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoundedOptimization</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">maxValue</span><span class="params">(vector &lt;string&gt; Expr, vector &lt;<span class="type">int</span>&gt; L, vector &lt;<span class="type">int</span>&gt; R, <span class="type">int</span> Max)</span> </span>&#123;</span><br><span class="line">		string E=<span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="keyword">for</span>(string t:Expr) E+=t;</span><br><span class="line">		<span class="built_in">memset</span>(G,<span class="number">0</span>,<span class="keyword">sizeof</span> G);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,E.<span class="built_in">size</span>()<span class="number">-1</span>) <span class="keyword">if</span>(<span class="built_in">isalpha</span>(E[i])) &#123;</span><br><span class="line">			G[E[i]-<span class="string">&#x27;a&#x27;</span>][E[i+<span class="number">1</span>]-<span class="string">&#x27;a&#x27;</span>]=G[E[i+<span class="number">1</span>]-<span class="string">&#x27;a&#x27;</span>][E[i]-<span class="string">&#x27;a&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> n=L.<span class="built_in">size</span>();</span><br><span class="line">		db ans=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(S,<span class="number">0</span>,<span class="built_in">pow</span>(<span class="number">3</span>,n)<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> T=S,m=<span class="number">0</span>;</span><br><span class="line">			db res=<span class="number">0</span>,sum=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">				w[i]=T%<span class="number">3</span>;</span><br><span class="line">				<span class="keyword">if</span>(!w[i]) A[++m]=i;</span><br><span class="line">				<span class="keyword">else</span> val[i]=(w[i]==<span class="number">1</span>?L[i]:R[i]),sum+=val[i];</span><br><span class="line">				T/=<span class="number">3</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="type">int</span> fl=sum&lt;=Max;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,m) <span class="keyword">if</span>(!G[A[i]][A[j]]) fl=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">			db left=Max-sum; </span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">				db c=left;</span><br><span class="line">				<span class="built_in">rep</span>(j,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(w[j] &amp;&amp; G[A[i]][j]) c+=val[j]*<span class="number">2</span>;</span><br><span class="line">				val[A[i]]=c/<span class="number">2</span>;</span><br><span class="line">				sum+=val[A[i]];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(m)&#123;</span><br><span class="line">				db t=(sum-Max)/m;</span><br><span class="line">				<span class="built_in">rep</span>(i,<span class="number">1</span>,m) val[A[i]]-=t;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(val[i]&lt;L[i]-eps || val[i]&gt;R[i]+eps) fl=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(G[i][j]) res+=val[i]*val[j];</span><br><span class="line">			<span class="built_in">cmax</span>(ans,res);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ans;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/CosmicBlocks%20TopCoder%20-%2012034/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/CosmicBlocks%20TopCoder%20-%2012034/" class="post-title-link" itemprop="url">[CosmicBlocks - TopCoder- 12034](https://vjudge.net/problem/TopCoder-12034) (网络流)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:28:48" itemprop="dateModified" datetime="2023-08-17T21:28:48+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="cosmicblocks---topcoder--12034-网络流"><a
target="_blank" rel="noopener" href="https://vjudge.net/problem/TopCoder-12034">CosmicBlocks -
TopCoder- 12034</a> (网络流)</h1>
<p>注意题目定义的同构是存在不同的颜色覆盖关系，而不是存在不同的排列顺序</p>
<p>所以先枚举每一层放了那些颜色，再枚举那些颜色之间有覆盖</p>
<p>每一层的颜色划分数很少，最多可能同时存在的覆盖关系是 <span
class="math inline">\(9\)</span> 种，枚举复杂度最多是 <span
class="math inline">\(2^9\)</span> ，然后可以 <span
class="math inline">\(2^n\cdot n\ \text{dp}\)</span>
出拓扑序列的个数</p>
<p>问题在于如何快速又方便地判断对于<strong>当前情况是否存在方案</strong></p>
<p>一种方法是<strong>上下界网络流</strong></p>
<p>按照层之间的关系，覆盖关系就连 <span
class="math inline">\([1,+\infty)\)</span> 的边，同时源点向 <span
class="math inline">\(1\)</span> 层的点连 <span
class="math inline">\([0,+\infty)\)</span> 的边，每个点都向汇点连 <span
class="math inline">\([0,\infty)\)</span> 的边</p>
<p>注意由于要限制流过每个点的流量，每个点要拆成两个点中间连 <span
class="math inline">\([num_i,num_i]\)</span> 的边</p>
<p>最后判断一下<strong>有源汇可行流</strong>即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> N=<span class="number">20</span>,INF=<span class="number">1e8</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> n,m,ans,L,R;</span><br><span class="line"><span class="type">int</span> cnt[N],id[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; G[N];</span><br><span class="line"><span class="type">int</span> GS[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; Layer[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Calc_DAG</span><span class="params">()</span> </span>&#123; <span class="comment">// 计算拓扑序列的个数</span></span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> dp[<span class="number">1</span>&lt;&lt;<span class="number">6</span>];</span><br><span class="line">	<span class="type">int</span> A=(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,A) dp[i]=<span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(S,<span class="number">0</span>,A<span class="number">-1</span>) <span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>((~S&amp;(<span class="number">1</span>&lt;&lt;i)) &amp;&amp; (S&amp;GS[i+<span class="number">1</span>])==GS[i+<span class="number">1</span>]) dp[S|(<span class="number">1</span>&lt;&lt;i)]+=dp[S];</span><br><span class="line">	<span class="keyword">return</span> dp[A];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ind[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Limited_Flow</span>&#123; <span class="comment">// 有源汇可行流</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> M=<span class="number">300</span>;</span><br><span class="line">	<span class="type">int</span> S,T;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">		<span class="type">int</span> to,nxt,w;</span><br><span class="line">	&#125; e[M];</span><br><span class="line">	<span class="type">int</span> head[N],ecnt;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>+<span class="number">4</span>) head[i]=<span class="number">0</span>;</span><br><span class="line">		ecnt=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> erep(u,i) for(int i=head[u];i;i=e[i].nxt)</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span> </span>&#123; e[ecnt]=(Edge)&#123;v,head[u],w&#125;,head[u]=ecnt++; &#125; </span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span>&#123; <span class="built_in">AddEdge</span>(u,v,w),<span class="built_in">AddEdge</span>(v,u,<span class="number">0</span>); &#125;</span><br><span class="line">	<span class="type">int</span> dis[N];</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">static</span> queue &lt;<span class="type">int</span>&gt; que;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,T) dis[i]=INF; dis[S]=<span class="number">0</span>,que.<span class="built_in">push</span>(S);</span><br><span class="line">		<span class="keyword">while</span>(!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">			<span class="type">int</span> u=que.<span class="built_in">front</span>(); que.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="built_in">erep</span>(u,i) &#123;</span><br><span class="line">				<span class="type">int</span> v=e[i].to,w=e[i].w;</span><br><span class="line">				<span class="keyword">if</span>(!w || dis[v]&lt;=dis[u]+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">				dis[v]=dis[u]+<span class="number">1</span>,que.<span class="built_in">push</span>(v);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> dis[T]&lt;INF;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> flowin)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(u==T) <span class="keyword">return</span> flowin;</span><br><span class="line">		<span class="type">int</span> flowout=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">erep</span>(u,i) &#123;</span><br><span class="line">			<span class="type">int</span> v=e[i].to,w=e[i].w;</span><br><span class="line">			<span class="keyword">if</span>(!w || dis[v]!=dis[u]+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="type">int</span> t=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(flowin-flowout,w));</span><br><span class="line">			e[i].w-=t,e[i^<span class="number">1</span>].w+=t,flowout+=t;</span><br><span class="line">			<span class="keyword">if</span>(flowin==flowout) <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!flowout) dis[u]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> flowout;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">Bfs</span>()) ans+=<span class="built_in">Dfs</span>(S,INF);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">erep</span>(S,i) <span class="keyword">if</span>(e[i].w) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">erep</span>(T,i) <span class="keyword">if</span>(e[i^<span class="number">1</span>].w) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; Flow;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Extend_Edge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> L,<span class="type">int</span> R)</span></span>&#123;</span><br><span class="line">	ind[u]-=L,ind[v]+=L;</span><br><span class="line">	Flow.<span class="built_in">Link</span>(u,v,R-L);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>+<span class="number">4</span>) ind[i]=<span class="number">0</span>;</span><br><span class="line">	Flow.<span class="built_in">clear</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">Extend_Edge</span>(i*<span class="number">2</span><span class="number">-1</span>,i*<span class="number">2</span>,cnt[i],cnt[i]);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(id[i]==<span class="number">1</span>) <span class="built_in">Extend_Edge</span>(n*<span class="number">2</span>+<span class="number">1</span>,i*<span class="number">2</span><span class="number">-1</span>,cnt[i],cnt[i]);</span><br><span class="line">	<span class="built_in">rep</span>(u,<span class="number">1</span>,n) <span class="keyword">for</span>(<span class="type">int</span> v:G[u]) <span class="built_in">Extend_Edge</span>(u*<span class="number">2</span>,v*<span class="number">2</span><span class="number">-1</span>,<span class="number">1</span>,INF);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">Extend_Edge</span>(i*<span class="number">2</span>,n*<span class="number">2</span>+<span class="number">2</span>,<span class="number">0</span>,INF);</span><br><span class="line">	<span class="built_in">Extend_Edge</span>(n*<span class="number">2</span>+<span class="number">2</span>,n*<span class="number">2</span>+<span class="number">1</span>,<span class="number">0</span>,INF);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>+<span class="number">2</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(ind[i]&gt;<span class="number">0</span>) Flow.<span class="built_in">Link</span>(n*<span class="number">2</span>+<span class="number">3</span>,i,ind[i]);</span><br><span class="line">		<span class="keyword">if</span>(ind[i]&lt;<span class="number">0</span>) Flow.<span class="built_in">Link</span>(i,n*<span class="number">2</span>+<span class="number">4</span>,-ind[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	Flow.S=n*<span class="number">2</span>+<span class="number">3</span>,Flow.T=n*<span class="number">2</span>+<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">	Flow.<span class="built_in">Dinic</span>();</span><br><span class="line">	<span class="keyword">return</span> Flow.<span class="built_in">Check</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dfs_GetDAG</span><span class="params">(<span class="type">int</span> p)</span> </span>&#123; <span class="comment">// dfs枚举覆盖关系</span></span><br><span class="line">	<span class="keyword">if</span>(p==n+<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> Ways=<span class="built_in">Calc_DAG</span>();</span><br><span class="line">		<span class="keyword">if</span>(Ways&lt;L || Ways&gt;R) <span class="keyword">return</span>;</span><br><span class="line">		ans+=<span class="built_in">Check</span>();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(id[p]==m) <span class="keyword">return</span> <span class="built_in">Dfs_GetDAG</span>(p+<span class="number">1</span>);</span><br><span class="line">	<span class="type">int</span> n=Layer[id[p]+<span class="number">1</span>].<span class="built_in">size</span>();</span><br><span class="line">	<span class="built_in">rep</span>(S,<span class="number">0</span>,(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(S&amp;(<span class="number">1</span>&lt;&lt;i)) G[p].<span class="built_in">pb</span>(Layer[id[p]+<span class="number">1</span>][i]),GS[p]|=<span class="number">1</span>&lt;&lt;(Layer[id[p]+<span class="number">1</span>][i]<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">Dfs_GetDAG</span>(p+<span class="number">1</span>);</span><br><span class="line">		G[p].<span class="built_in">clear</span>(),GS[p]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dfs_Getlayer</span><span class="params">(<span class="type">int</span> num,<span class="type">int</span> fir,<span class="type">int</span> chosennumber)</span></span>&#123; <span class="comment">// dfs枚举层的情况</span></span><br><span class="line">	<span class="keyword">if</span>(chosennumber==n) &#123;</span><br><span class="line">		m=num;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) Layer[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) Layer[id[i]].<span class="built_in">pb</span>(i);</span><br><span class="line">		<span class="built_in">Dfs_GetDAG</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,fir,n) <span class="keyword">if</span>(!id[i]) &#123;</span><br><span class="line">		id[i]=num;</span><br><span class="line">		<span class="built_in">Dfs_Getlayer</span>(num,i+<span class="number">1</span>,chosennumber+<span class="number">1</span>);</span><br><span class="line">		id[i]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(fir!=<span class="number">1</span>) <span class="built_in">Dfs_Getlayer</span>(num+<span class="number">1</span>,<span class="number">1</span>,chosennumber);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CosmicBlocks</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getNumOrders</span><span class="params">(vector &lt;<span class="type">int</span>&gt; a, <span class="type">int</span> Min, <span class="type">int</span> Max)</span> </span>&#123;</span><br><span class="line">		L=Min,R=Max;</span><br><span class="line">		n=a.<span class="built_in">size</span>(),ans=<span class="number">0</span>; <span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) cnt[i+<span class="number">1</span>]=a[i];</span><br><span class="line">		<span class="built_in">Dfs_Getlayer</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Powered by KawigiEdit 2.1.4 (beta) modified by pivanof!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/CurvyonRails%20TopCoder%20-%2012432/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/CurvyonRails%20TopCoder%20-%2012432/" class="post-title-link" itemprop="url">TopCoder SRM 570 Div1 CurvyonRails</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:28:48" itemprop="dateModified" datetime="2023-08-17T21:28:48+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="topcoder-srm-570-div1-curvyonrails">TopCoder SRM 570 Div1
CurvyonRails</h1>
<p>题意: 一个 <span class="math inline">\(n\times m\)</span>
的网格图，其中有一些点需要建铁路，有一些点为关键点，在关键点上修直铁路会产生1的代价，求最小的代价</p>
<p>由于 <span class="math inline">\(n,m\leq 25\)</span> 显然不可以插头
<span class="math inline">\(\text{dp}\)</span> 。。。</p>
<p>考虑轨道联通实际上类似网络流的形式</p>
<p>考虑一个常见的思路: 网格图可以简化为二分图 然后 跑网络流</p>
<p>先不考虑代价的问题，判断是否存在合法方案</p>
<p>每个格子要有两条出边，因此可以让 <span
class="math inline">\(S\)</span> 向左侧点连边权为2的边，右侧点向 <span
class="math inline">\(T\)</span> 连边权为2的边</p>
<p>然后可以让每个左侧点向相邻的右侧点连边，即考虑了联通关系</p>
<p>下面考虑代价的计算，加入边的代价，即为费用流</p>
<p>连同向边会产生代价，因此考虑为每个节点新增两个节点，表示向上下/左右连边</p>
<p>对于让原节点对于新增的上下和左右节点 分别连两条代价为0和1的边</p>
<p>这样如果流了同向边，就会产生代价</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">25</span>*<span class="number">30</span>*<span class="number">3</span>,M=N&lt;&lt;<span class="number">3</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,k;</span><br><span class="line"><span class="type">int</span> a[<span class="number">30</span>][<span class="number">30</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Max Flow Min Cost</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> id[<span class="number">30</span>][<span class="number">30</span>][<span class="number">2</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> to,nxt,w,c;</span><br><span class="line">&#125;e[M];</span><br><span class="line"><span class="type">int</span> head[N],ecnt,S,T,V;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,V) head[i]=<span class="number">0</span>;</span><br><span class="line">	ecnt=<span class="number">1</span>,V=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">	e[++ecnt]=(Edge)&#123;v,head[u],w,c&#125;;</span><br><span class="line">	head[u]=ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c=<span class="number">0</span>)</span></span>&#123; <span class="built_in">AddEdge</span>(u,v,w,c),<span class="built_in">AddEdge</span>(v,u,<span class="number">0</span>,-c); &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> erep(u,i) for(int i=head[u],v=e[i].to,w=e[i].w,c=e[i].c;i;i=e[i].nxt,v=e[i].to,w=e[i].w,c=e[i].c)</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dis[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">SPFA</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> inq[N];</span><br><span class="line">	<span class="type">static</span> queue &lt;<span class="type">int</span>&gt; que;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,V) dis[i]=INF;</span><br><span class="line">	que.<span class="built_in">push</span>(S),dis[S]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> u=que.<span class="built_in">front</span>(); que.<span class="built_in">pop</span>();</span><br><span class="line">		inq[u]=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">erep</span>(u,i) <span class="keyword">if</span>(w &amp;&amp; dis[v]&gt;dis[u]+c) &#123;</span><br><span class="line">			dis[v]=dis[u]+c;</span><br><span class="line">			<span class="keyword">if</span>(!inq[v]) inq[v]=<span class="number">1</span>,que.<span class="built_in">push</span>(v);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dis[T]&lt;INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> in)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(u==T) <span class="keyword">return</span> in;</span><br><span class="line">	<span class="type">int</span> out=<span class="number">0</span>,t=dis[u]; dis[u]=INF;</span><br><span class="line">	<span class="built_in">erep</span>(u,i) <span class="keyword">if</span>(w &amp;&amp; dis[v]==t+c) &#123;</span><br><span class="line">		<span class="type">int</span> t=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(in-out,w));</span><br><span class="line">		e[i].w-=t,e[i^<span class="number">1</span>].w+=t,out+=t;</span><br><span class="line">		<span class="keyword">if</span>(in==out) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(out) dis[u]=t;</span><br><span class="line">	<span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Pii <span class="title">Dinic</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> flow=<span class="number">0</span>,cost=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">SPFA</span>()) </span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> t;(t=<span class="built_in">Dfs</span>(S,INF));) flow+=t,cost+=dis[T]*t;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">mp</span>(flow,cost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CurvyonRails</span> &#123;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="type">int</span> <span class="title">getmin</span><span class="params">(vector &lt;string&gt; field)</span> </span>&#123;</span><br><span class="line">			n=field.<span class="built_in">size</span>(),m=field[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="built_in">rep</span>(j,<span class="number">0</span>,m<span class="number">-1</span>) a[i+<span class="number">1</span>][j+<span class="number">1</span>]=field[i][j];</span><br><span class="line">			k=<span class="number">0</span>,<span class="built_in">Clear</span>();</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,m) <span class="keyword">if</span>(a[i][j]!=<span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">				k++;</span><br><span class="line">				<span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">1</span>) id[i][j][d]=++V;</span><br><span class="line">			&#125;</span><br><span class="line">			S=++V,T=++V;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,m) <span class="keyword">if</span>(a[i][j]!=<span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>((i+j)&amp;<span class="number">1</span>)&#123;</span><br><span class="line">					<span class="built_in">Link</span>(S,++V,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">1</span>) &#123;</span><br><span class="line">						<span class="built_in">Link</span>(V,id[i][j][d],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">						<span class="built_in">Link</span>(V,id[i][j][d],<span class="number">1</span>,a[i][j]==<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">						<span class="comment">// 如果两条走了同向，就会产生1的代价</span></span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span>(i&lt;n &amp;&amp; a[i+<span class="number">1</span>][j]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i][j][<span class="number">0</span>],id[i+<span class="number">1</span>][j][<span class="number">0</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="keyword">if</span>(j&lt;m &amp;&amp; a[i][j+<span class="number">1</span>]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i][j][<span class="number">1</span>],id[i][j+<span class="number">1</span>][<span class="number">1</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">Link</span>(++V,T,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">1</span>) &#123;</span><br><span class="line">						<span class="built_in">Link</span>(id[i][j][d],V,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">						<span class="built_in">Link</span>(id[i][j][d],V,<span class="number">1</span>,a[i][j]==<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">						<span class="comment">// 如果两条走了同向，就会产生1的代价</span></span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span>(i&lt;n &amp;&amp; a[i+<span class="number">1</span>][j]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i+<span class="number">1</span>][j][<span class="number">0</span>],id[i][j][<span class="number">0</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="keyword">if</span>(j&lt;m &amp;&amp; a[i][j+<span class="number">1</span>]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i][j+<span class="number">1</span>][<span class="number">1</span>],id[i][j][<span class="number">1</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			Pii ans=<span class="built_in">Dinic</span>();</span><br><span class="line">			<span class="keyword">if</span>(ans.first!=k) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">			<span class="keyword">return</span> ans.second;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Powered by KawigiEdit 2.1.4 (beta) modified by pivanof!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/LOJ/[LOJ6729]%20%E7%82%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E7%94%9F%E6%88%90%E5%AD%90%E5%9B%BE%E8%AE%A1%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/LOJ/%5BLOJ6729%5D%20%E7%82%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E7%94%9F%E6%88%90%E5%AD%90%E5%9B%BE%E8%AE%A1%E6%95%B0/" class="post-title-link" itemprop="url">LOJ6729. 点双连通生成子图计数 (集合幂级数)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:28:48" itemprop="dateModified" datetime="2023-08-17T21:28:48+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="loj6729.-点双连通生成子图计数-集合幂级数">LOJ6729.
点双连通生成子图计数 (集合幂级数)</h1>
<p>基础： 由子图的集合幂级数取 <span class="math inline">\(\ln\)</span>
可以得到连通子图的集合幂级数，<a
target="_blank" rel="noopener" href="https://www.cnblogs.com/chasedeath/p/13891189.html">可以参考?</a></p>
<p>根据点双连通的定义，我们先求得连通子图的集合幂级数</p>
<p>然后考虑枚举每个节点 <span class="math inline">\(i\)</span>
，把所有删去 <span class="math inline">\(i\)</span>
之后不连通的方案去掉</p>
<p>具体实现上，可以把所有包含 <span class="math inline">\(i\)</span>
的项提出，删除 <span class="math inline">\(i\)</span> 之后取 <span
class="math inline">\(\ln\)</span> 得到连通的方案数，然后替换回去</p>
<p>每次取 <span class="math inline">\(\ln\)</span> 的复杂度为 <span
class="math inline">\(O(n^22^n)\)</span> ，因此总复杂度为 <span
class="math inline">\(O(n^32^n)\)</span></p>
<p>常数优化：每次实际上只会修改包含 <span
class="math inline">\(i\)</span>
的项，不需要每次都把多项式莫比乌斯反演回去</p>
<p>刚开始进行一次莫比乌斯变换之后</p>
<p>每次可以直接从前缀和的作差得到这一项 除了 <span
class="math inline">\(i\)</span> 以外的位置
累和之后的结果，然后直接对于形式幂级数取 <span
class="math inline">\(\ln\)</span> ，具体实现见代码</p>
<p>注意去掉 <span class="math inline">\(i\)</span> 后，占位数量 <span
class="math inline">\(-1\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a;i&lt;=b;++i)</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">20</span>,M=<span class="number">1</span>&lt;&lt;<span class="number">18</span>|<span class="number">3</span>,P=<span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">U</span>&#123;</span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="built_in">U</span>()&#123;&#125; <span class="built_in">U</span>(<span class="type">int</span> x):<span class="built_in">x</span>(x)&#123;&#125;</span><br><span class="line">	<span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> += (<span class="type">const</span> U &amp;t)&#123; x+=t.x,x&gt;=P&amp;&amp;(x-=P); &#125;</span><br><span class="line">	<span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> -= (<span class="type">const</span> U &amp;t)&#123; x-=t.x,x&lt;<span class="number">0</span>&amp;&amp;(x+=P); &#125;</span><br><span class="line">	<span class="keyword">inline</span> U <span class="keyword">operator</span> * (<span class="type">const</span> U &amp;t)&#123; <span class="keyword">return</span> <span class="built_in">U</span>(<span class="built_in">static_cast</span>&lt;<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>&gt;(x)*t.x%P); &#125;</span><br><span class="line">&#125; I[N],F[M][N],b[N];</span><br><span class="line"><span class="type">int</span> n,m,G[N],C[M],Pow[N*N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FWT</span><span class="params">(<span class="type">int</span> f)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;m;i&lt;&lt;=<span class="number">1</span>) <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">0</span>;l&lt;m;l+=i*<span class="number">2</span>) </span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j=l;j&lt;l+i;++j) <span class="keyword">if</span>(f==<span class="number">1</span>) <span class="built_in">rep</span>(d,<span class="number">1</span>,n) F[j+i][d]+=F[j][d];</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">rep</span>(d,<span class="number">1</span>,n) F[j+i][d]-=F[j][d];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Ln</span><span class="params">(U *a)</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">		U t=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">0</span>,i<span class="number">-1</span>) t+=b[j]*a[i-j];</span><br><span class="line">		b[i]=a[i+<span class="number">1</span>]*(i+<span class="number">1</span>),b[i]-=t;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) a[i]=b[i<span class="number">-1</span>]*I[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> u,v;m--;) <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;u,&amp;v),u--,v--,G[u]|=<span class="number">1</span>&lt;&lt;v,G[v]|=<span class="number">1</span>&lt;&lt;u;</span><br><span class="line">	m=<span class="number">1</span>&lt;&lt;n,I[<span class="number">0</span>]=I[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m<span class="number">-1</span>) C[i]=C[i&amp;(i<span class="number">-1</span>)]+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">2</span>,n) I[i]=<span class="built_in">U</span>(P-P/i)*I[P%i];</span><br><span class="line">	<span class="built_in">rep</span>(i,Pow[<span class="number">0</span>]=<span class="number">1</span>,N*N<span class="number">-1</span>) Pow[i]=Pow[i<span class="number">-1</span>]*<span class="number">2</span>%P;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> c=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(i&amp;(<span class="number">1</span>&lt;&lt;j)) c+=C[G[j]&amp;i];</span><br><span class="line">		F[i][C[i]]=Pow[c/<span class="number">2</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">FWT</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m<span class="number">-1</span>) <span class="built_in">Ln</span>(F[i]);</span><br><span class="line">    <span class="comment">// 先取一次ln得到连通子图的集合幂级数</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;m;i&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">0</span>;l&lt;m;l+=i*<span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=l;j&lt;l+i;++j) &#123;</span><br><span class="line">				<span class="built_in">rep</span>(k,<span class="number">1</span>,n) F[j+i][k]-=F[j][k]; <span class="comment">// 前缀和作差得到</span></span><br><span class="line">				<span class="built_in">Ln</span>(F[j+i]+<span class="number">1</span>); <span class="comment">// 取出自己后大小-1</span></span><br><span class="line">				<span class="built_in">rep</span>(k,<span class="number">1</span>,n) F[j+i][k]+=F[j][k];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">FWT</span>(<span class="number">-1</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,F[m<span class="number">-1</span>][n].x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/DisjointSemicircles%20TopCoder%20-%2012365/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/DisjointSemicircles%20TopCoder%20-%2012365/" class="post-title-link" itemprop="url">Topcoder SRM568 Div1 DisjointSemicircles (二分图染色)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:28:48" itemprop="dateModified" datetime="2023-08-17T21:28:48+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="topcoder-srm568-div1-disjointsemicircles-二分图染色">Topcoder
SRM568 Div1 DisjointSemicircles (二分图染色)</h1>
<p>题意: 给定数轴上排列的 <span class="math inline">\(2n\)</span>
个点，每个点需要找到另一个点和它匹配，并且以他们为直径两端，向上或者向下作一个半圆</p>
<p>有一些点已经匹配好了，要求判断是否存在一个合法的方案，满足所有的半圆不相交</p>
<p>###思路:</p>
<p>枚举已经确定的匹配半圆的方向(设有 <span
class="math inline">\(m\)</span> 对已匹配)，然后 <span
class="math inline">\(O(n)\)</span> 判断自由点是否存在合法方案</p>
<h3 id="判断合法方案的核心性质">判断合法方案的核心性质:</h3>
<p>定义一个<strong>点的方向</strong>为其所连接的<strong>半圆的方向</strong>(上为0，下为1)</p>
<p>则自由点存在合法方案的充要条件是:</p>
<p>整个序列上每种方向的点数为偶数，且所有已匹配的半圆所覆盖的区间下，和<strong>半圆同向的点</strong>个数为<strong>偶数</strong></p>
<p>必要性:</p>
<p>如果某个半圆下同向点个数为奇数，则必然有一个点与其同向并且不得不连到区间外，这显然不合法</p>
<p>充分性:</p>
<p>一种合法的构造方法是:</p>
<p>按照 <span class="math inline">\(L\)</span>
从左到右，遍历每个已匹配的半圆，如果包含同向子半圆优先解决同向的子半圆</p>
<p>剩下的点依然是偶数个，从左到右依次和上一个匹配即可</p>
<p><span class="math display">\[\  \]</span></p>
<h3 id="判断是否存在合法方案">判断是否存在合法方案</h3>
<p>那么问题转化为判断是否存在一种合法的定向方案，使得某一些区间里0/1的个数为偶数</p>
<p>考虑构建二分图染色，令点集 <span
class="math inline">\(V=\{0,1,\cdots,n,0&#39;,1&#39;,\cdots,n&#39;\}\)</span>
，则 <span class="math inline">\((u,v)\in E\)</span> 表示 <span
class="math inline">\(col(u)\ne col(v)\)</span></p>
<p>其中 <span class="math inline">\(i\)</span> 号节点表示 <span
class="math inline">\(1-i\)</span> 中所有未匹配节点方向的异或和， <span
class="math inline">\(i&#39;\)</span> 表示 <span
class="math inline">\(i\)</span> 的反点 <span
class="math inline">\((i,i&#39;)\in E\)</span></p>
<p>(到这里可以自己想一下怎么连边)</p>
<p>对于已匹配圆 <span class="math inline">\([L,R]\)</span> (注意不要忘了
<span class="math inline">\([1,n]\)</span> )</p>
<p>如果它方向为 <span class="math inline">\(1\)</span> ，显然只需要
<span class="math inline">\(col(L-1)=col(R)\)</span></p>
<p>如果方向为0，设 <span class="math inline">\([L,R]\)</span>
未染色个数为 <span class="math inline">\(k\)</span> ，则显然有 <span
class="math inline">\(col(L-1)=col(R)\oplus (k\mod 2)\)</span>
，即考虑反向的个数</p>
<p>同时对于已匹配点 <span class="math inline">\(i\)</span> ，显然有
<span class="math inline">\(col(i)=col(i-1)\)</span></p>
<p>由此，得到一个 <span class="math inline">\(O(n)\)</span>
点数边数的图</p>
<p>如果在 <span class="math inline">\(\text{dfs}\)</span>
枚举时同步加边和回撤，总复杂度就为 <span
class="math inline">\(O(2^m\cdot n)\)</span></p>
<p>由于不可能所有方案都合法，实际应该是一个比较松的上界</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">110</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">int</span> cnt[N];</span><br><span class="line"><span class="type">int</span> L[N],R[N],m,Cross[N][N];</span><br><span class="line"><span class="type">int</span> vec[<span class="number">2</span>][N],c[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> u,v,nxt;</span><br><span class="line">&#125;e[N*<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> head[N],ecnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	e[++ecnt]=(Edge)&#123;u,v,head[u]&#125;;</span><br><span class="line">	head[u]=ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span>&#123; </span><br><span class="line">	<span class="built_in">AddEdge</span>(u,v),<span class="built_in">AddEdge</span>(v,u); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Back</span><span class="params">()</span></span>&#123;</span><br><span class="line">	head[e[ecnt].u]=e[ecnt].nxt,ecnt--;</span><br><span class="line">	head[e[ecnt].u]=e[ecnt].nxt,ecnt--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ans,fl;</span><br><span class="line"><span class="type">int</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_col</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">	vis[u]=c;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=e[i].nxt)&#123;</span><br><span class="line">		<span class="type">int</span> v=e[i].v;</span><br><span class="line">		<span class="keyword">if</span>(!vis[v]) <span class="built_in">dfs_col</span>(v,<span class="number">3</span>-c);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(vis[v]==vis[u]) fl=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(ans) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span>(p&gt;m)&#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n*<span class="number">2</span>+<span class="number">1</span>) vis[i]=<span class="number">0</span>;</span><br><span class="line">		fl=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n*<span class="number">2</span>+<span class="number">1</span>) <span class="keyword">if</span>(!vis[i]) <span class="built_in">dfs_col</span>(i,<span class="number">1</span>);</span><br><span class="line">		ans|=fl;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="type">int</span> fl=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,c[i]) <span class="keyword">if</span>(R[vec[i][j]]&gt;L[p] &amp;&amp; R[vec[i][j]]&lt;R[p]) fl=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">		vec[i][++c[i]]=p;</span><br><span class="line">		<span class="keyword">if</span>(i || ~(cnt[R[p]]-cnt[L[p]])&amp;<span class="number">1</span>) <span class="built_in">Link</span>(L[p]+n+<span class="number">1</span>,R[p]<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">Link</span>(L[p],R[p]<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">dfs</span>(p+<span class="number">1</span>);</span><br><span class="line">		c[i]--,<span class="built_in">Back</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DisjointSemicircles</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">string <span class="title">getPossibility</span><span class="params">(vector &lt;<span class="type">int</span>&gt; labels)</span> </span>&#123;</span><br><span class="line">		n=labels.<span class="built_in">size</span>(),m=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) a[i]=labels[i<span class="number">-1</span>];</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">			cnt[i]=cnt[i<span class="number">-1</span>]+(a[i]==<span class="number">-1</span>);</span><br><span class="line">			<span class="keyword">if</span>(~a[i]) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,n) <span class="keyword">if</span>(a[j]==a[i]) L[++m]=i,R[m]=j;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!m) <span class="keyword">return</span> <span class="string">&quot;POSSIBLE&quot;</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,(n+<span class="number">1</span>)*<span class="number">2</span>) head[i]=ecnt=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(~a[i]) <span class="built_in">Link</span>(i+n+<span class="number">1</span>,i<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n) <span class="built_in">Link</span>(i,i+n+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">Link</span>(n+<span class="number">1</span>,n);</span><br><span class="line">		ans=<span class="number">0</span>,<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> ans?<span class="string">&quot;POSSIBLE&quot;</span>:<span class="string">&quot;IMPOSSIBLE&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/Equilateral%20Triangles/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/Equilateral%20Triangles/" class="post-title-link" itemprop="url">Equilateral Triangles</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:28:48" itemprop="dateModified" datetime="2023-08-17T21:28:48+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="equilateral-triangles">Equilateral Triangles</h1>
<p>题意: 求所有三个点哈密顿距离相等的无序三元点对个数</p>
<p>推论1: 到平面中一点 <span class="math inline">\((x,y)\)</span>
哈密顿距离为 <span class="math inline">\(d\)</span> 的点，构成一个以
<span class="math inline">\((x,y)\)</span> 为中心， <span
class="math inline">\(d\)</span> 为半对角线长的菱形</p>
<p>菱形不好搞，转一下，令旋转后的点 <span
class="math inline">\(x&#39;=x+y,y&#39;=x-y\)</span>
，(也就是曼哈顿距离转切比雪夫距离)</p>
<p>这样得到的就是一个正方形了</p>
<p>推论2: 选出的三点中，一定存在两个点 <span
class="math inline">\(x\)</span> 或者 <span
class="math inline">\(y\)</span> 坐标相同</p>
<p>如果选出点 <span class="math inline">\(A,B\)</span>
不满足，由下图可以看到，可行的部分(就是相交部分 <span
class="math inline">\(C1,C2\)</span> )也必然满足</p>
<figure>
<img src="https://i.loli.net/2020/09/25/QgiP6kuB8JaH9to.png"
alt="te1.png" />
<figcaption aria-hidden="true">te1.png</figcaption>
</figure>
<p>接下来以 <span class="math inline">\(x\)</span> 相同为例，枚举点
<span class="math inline">\(A,B\)</span> ，设其距离为 <span
class="math inline">\(d\)</span></p>
<figure>
<img src="https://i.loli.net/2020/09/25/zAwO29WRSK5sXnL.png"
alt="te2.png" />
<figcaption aria-hidden="true">te2.png</figcaption>
</figure>
<p>可以看到比较显然就是两条红色的相交线段， <span
class="math inline">\(O(n^3)\)</span> 枚举 <span
class="math inline">\(A,B\)</span> 两点后，直接用前缀和维护即可</p>
<p>对于 <span class="math inline">\(x\)</span> 相同，对于 <span
class="math inline">\(y\)</span>
相同分别做一次即可，注意考虑的时候不要把 <span
class="math inline">\(x,y\)</span> 都有相同的算两次</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC optimize(2)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">610</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> A[N][N],B[N][N];</span><br><span class="line"><span class="type">int</span> S[N][N];</span><br><span class="line"><span class="type">int</span> D[N],C;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,A[i]+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,n) <span class="keyword">if</span>(A[i][j]==<span class="string">&#x27;*&#x27;</span>) B[i+j][i-j+n]=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) <span class="built_in">rep</span>(j,<span class="number">1</span>,n*<span class="number">2</span>) S[i][j]=S[i][j<span class="number">-1</span>]+B[i][j];</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) &#123;</span><br><span class="line">		C=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(x,<span class="number">1</span>,n*<span class="number">2</span>) <span class="keyword">if</span>(B[i][x]) D[++C]=x;</span><br><span class="line">		<span class="built_in">rep</span>(a,<span class="number">1</span>,C) <span class="built_in">rep</span>(b,a+<span class="number">1</span>,C) &#123;</span><br><span class="line">			<span class="type">int</span> d=D[b]-D[a];</span><br><span class="line">			i-d&gt;=<span class="number">1</span> &amp;&amp; (ans+=S[i-d][D[b]]-S[i-d][D[a]<span class="number">-1</span>]);</span><br><span class="line">			i+d&lt;=n*<span class="number">2</span> &amp;&amp; (ans+=S[i+d][D[b]]-S[i+d][D[a]<span class="number">-1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) <span class="built_in">rep</span>(j,<span class="number">1</span>,n*<span class="number">2</span>) S[i][j]=S[i][j<span class="number">-1</span>]+B[j][i];</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) &#123;</span><br><span class="line">		C=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(x,<span class="number">1</span>,n*<span class="number">2</span>) <span class="keyword">if</span>(B[x][i]) D[++C]=x;</span><br><span class="line">		<span class="built_in">rep</span>(a,<span class="number">1</span>,C) <span class="built_in">rep</span>(b,a+<span class="number">1</span>,C) &#123;</span><br><span class="line">			<span class="type">int</span> d=D[b]-D[a];</span><br><span class="line">			i-d&gt;=<span class="number">1</span> &amp;&amp; (ans+=S[i-d][D[b]<span class="number">-1</span>]-S[i-d][D[a]]);</span><br><span class="line">			i+d&lt;=n*<span class="number">2</span> &amp;&amp; (ans+=S[i+d][D[b]<span class="number">-1</span>]-S[i+d][D[a]]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/MegaFactorial%20TopCoder%20-%2012389/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/MegaFactorial%20TopCoder%20-%2012389/" class="post-title-link" itemprop="url">Topcoder SRM 569 Div1 - MegaFactorial (矩阵)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:28:48" itemprop="dateModified" datetime="2023-08-17T21:28:48+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="topcoder-srm-569-div1---megafactorial-矩阵">Topcoder SRM 569
Div1 - MegaFactorial (矩阵)</h1>
<p>首先是对于末尾0个数的处理，设最后得到的数中包含 <span
class="math inline">\(i\)</span> 的指数为 <span
class="math inline">\(F(i)\)</span></p>
<p>对于 <span class="math inline">\(B=2,3,5,7\)</span>
的情况，可以直接计算答案 <span
class="math inline">\(\sum_{i=1}\sum_{j=1}F(j\cdot B^i)\)</span></p>
<p>对于 <span class="math inline">\(B\)</span> 为质因子组合的情况，即
<span class="math inline">\(B=6(2\times 3),10(2\times 5)\)</span> ，因为
<span class="math inline">\(F(i)\)</span>
实际有单调性，可以直接取较大的质因子</p>
<p>对于 <span class="math inline">\(B\)</span> 为质因子次方的情况，即
<span class="math inline">\(B=2^2,2^3,3^2\)</span> 的情况，设 <span
class="math inline">\(B=p^k\)</span> 则答案可以表示为</p>
<p><span class="math inline">\(\begin{aligned} \lfloor
\frac{\sum_{i=1}\sum_{j=1}F(j\cdot p^i)}{k}\rfloor
\end{aligned}\)</span></p>
<p>由于要取模，实际上要做一点魔改，设模数为 <span
class="math inline">\(m\)</span> ，答案可以表示为 <span
class="math inline">\(c=ak+b\)</span> 的形式，这个式子求出的是 <span
class="math inline">\(a\)</span></p>
<p>则 <span class="math inline">\(\lfloor \frac{(ak+b)\mod km
}{k}\rfloor =a+\lfloor \frac{(b\mod km)}{k}\rfloor =a\)</span></p>
<p>由于 <span class="math inline">\(k\leq 3\)</span>
，扩大模数后可以用unsigned int 存</p>
<p>下面考虑用矩阵求解上式</p>
<p><span class="math inline">\(nk!\)</span> (下面用 <span
class="math inline">\(f(n,k)\)</span> 表示)这个东西可以看作从 <span
class="math inline">\(n\)</span> 向下的一个递推式</p>
<p>因此考虑以 <span class="math inline">\(k\)</span>
为矩阵元素，求出每个 <span class="math inline">\(f(n,k)\)</span>
被调用的次数</p>
<p>注意这样递推就是反向的了</p>
<p>递推的转移式子是 <span class="math inline">\(f(n,k)\rightarrow
f(n,k-1),f(n-1,k)\)</span> ，其中 <span
class="math inline">\(f(n,k-1)\)</span> 的转移需要在层内完成</p>
<p>据此构造矩阵即可，注意 <span class="math inline">\(f(n,0)\)</span>
不能向 <span class="math inline">\(f(n-1,0)\)</span> 转移</p>
<p>考虑对于 <span class="math inline">\(\sum_{i=1}\sum_{j=1}F(j\cdot
B^i)\)</span> 的每个 <span class="math inline">\(i\)</span> 求解，一共有
<span class="math inline">\(\frac{n}{B^i}\)</span> 个 <span
class="math inline">\(j\)</span> ，每个 <span
class="math inline">\(j\)</span> 出现的递推层数为等差数列</p>
<p>即 <span class="math inline">\(n\mod B^i,n\mod B^i+B^i,n\mod B^i +2
\cdot B^i\cdots\)</span></p>
<p>我们要求的其实是每一层的 <span class="math inline">\(f(i,0)\)</span>
，所以考虑求出每次 <span class="math inline">\(B^i\)</span>
层的转移矩阵</p>
<p>然后是依次累和，把矩阵的转移中 <span
class="math inline">\(0\rightarrow 0\)</span> 的转移赋为1即可做到</p>
<p>tips:首项是 <span class="math inline">\(n\mod B^i\)</span></p>
<p>一共有 <span class="math inline">\(\log _Bn\)</span> 种不同的 <span
class="math inline">\(i\)</span> ，因此复杂度为 <span
class="math inline">\(O(\log_Bn\log_2 n\cdot k^3)\)</span></p>
<p><del>当然更优的做法，咕咕咕</del></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span> U;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(reg int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(reg int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,d;</span><br><span class="line">U P=<span class="number">1e9</span>+<span class="number">9</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Mat</span>&#123;</span><br><span class="line">	U a[N][N];</span><br><span class="line">	<span class="built_in">Mat</span>()&#123; <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span> a);&#125; </span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">One</span><span class="params">()</span></span>&#123; <span class="built_in">rep</span>(i,<span class="number">0</span>,d) a[i][i]=<span class="number">1</span>; &#125;</span><br><span class="line">	U* <span class="keyword">operator</span> [] (<span class="type">int</span> x)&#123; <span class="keyword">return</span> a[x]; &#125;</span><br><span class="line">	Mat <span class="keyword">operator</span> * (<span class="type">const</span> Mat &amp;x) <span class="type">const</span> &#123;</span><br><span class="line">		Mat res;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,d) <span class="built_in">rep</span>(j,<span class="number">0</span>,d) <span class="built_in">rep</span>(k,<span class="number">0</span>,d) res.a[i][k]=(res.a[i][k]+<span class="number">1ll</span>*a[i][j]*x.a[j][k])%P;</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,d) &#123; <span class="built_in">rep</span>(j,<span class="number">0</span>,d) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,a[i][j]); <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>); &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; A,B,C;</span><br><span class="line"></span><br><span class="line"><span class="function">Mat <span class="title">qpow</span><span class="params">(Mat x,<span class="type">int</span> k)</span></span>&#123;</span><br><span class="line">	Mat res; res.<span class="built_in">One</span>();</span><br><span class="line">	<span class="keyword">for</span>(;k;k&gt;&gt;=<span class="number">1</span>,x=x*x) <span class="keyword">if</span>(k&amp;<span class="number">1</span>) res=res*x;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Factor</span><span class="params">(<span class="type">int</span> &amp;x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> p=<span class="number">-1</span>,c=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">2</span>,x) <span class="keyword">if</span>(x%i==<span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">while</span>(x%i==<span class="number">0</span>) c++,x/=i;</span><br><span class="line">		p=i;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> x=p,c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MegaFactorial</span> &#123;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="type">int</span> <span class="title">countTrailingZeros</span><span class="params">(<span class="type">int</span> N, <span class="type">int</span> K, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">			A=<span class="built_in">Mat</span>(),n=N,d=K;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(b==<span class="number">10</span>) b=<span class="number">5</span>;</span><br><span class="line">			<span class="keyword">if</span>(b==<span class="number">6</span>) b=<span class="number">3</span>;</span><br><span class="line">			<span class="type">int</span> t=<span class="built_in">Factor</span>(b);</span><br><span class="line">			P*=t;</span><br><span class="line"></span><br><span class="line">			<span class="built_in">drep</span>(i,d,<span class="number">0</span>) &#123;</span><br><span class="line">				A[i][i]=<span class="number">1</span>;</span><br><span class="line">				<span class="built_in">rep</span>(j,<span class="number">0</span>,d) A[j][i]+=A[j][i+<span class="number">1</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			A[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">			ll ans=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(ll i=b;i&lt;=n;i*=b) &#123;</span><br><span class="line">				B=<span class="built_in">qpow</span>(A,i); B[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">				Mat res=<span class="built_in">qpow</span>(A,n%i)*<span class="built_in">qpow</span>(B,n/i<span class="number">-1</span>);</span><br><span class="line">				<span class="built_in">rep</span>(i,<span class="number">0</span>,d) (ans+=res[i][<span class="number">0</span>])%=P;</span><br><span class="line">			&#125;</span><br><span class="line">			P/=t,ans/=t;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> ans;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/Orienteering%20TopCoder%20-%2012305/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/Orienteering%20TopCoder%20-%2012305/" class="post-title-link" itemprop="url">TopCoder SRM 561 Orienteering 树形dp</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:28:48" itemprop="dateModified" datetime="2023-08-17T21:28:48+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="topcoder-srm-561-orienteering-树形dp">TopCoder SRM 561
Orienteering 树形dp</h1>
<p>题意: 给定了一棵树，以及树上一些节点为关键点，求出随机选出 <span
class="math inline">\(k\)</span> 个关键点后遍历它们的最短路径的期望</p>
<p>遍历关键点相当于要遍历一棵树，考虑遍历一棵树的最优决策</p>
<p>假设我们确定了一个根 <span class="math inline">\(u\)</span>
，递归考虑每棵子树的问题</p>
<p>发现除了最后留在的那个点对应的路径 <span
class="math inline">\((u,v)\)</span> 以外，所有的边都要被遍历两次</p>
<p>即答案 <span class="math inline">\(\sum _{e\in E} 2\cdot
w(e)-dis(u,v)\)</span></p>
<p>所以改变根就会发现，答案就是总长*2-直径长度</p>
<p>设总点数为 <span class="math inline">\(n\)</span>
，包含的总关键点数为 <span class="math inline">\(m\)</span> ，要选出
<span class="math inline">\(k\)</span> 个点</p>
<h2 id="part1-总长计算">Part1 总长计算</h2>
<p>考虑对于每一条边计算产生的树跨过它的概率</p>
<p>设这条边两边的关键点的个数分别为 <span
class="math inline">\(a,b(a+b=m)\)</span></p>
<p>显然，这条边被跨过的概率就是</p>
<p><span class="math inline">\(\begin{aligned}
1-\frac{C(a,k)}{C(m,k)}-\frac{C(b,k)}{C(m,k)}\end{aligned}\)</span>
(即减去所有选出的关键点都在两边的概率)</p>
<p>设 <span class="math inline">\(\begin{aligned}
f(i)=\frac{C(i,k)}{C(m,k)}=\frac{i!(m-k)!}{m!(i-k)!}\end{aligned}\)</span></p>
<p>因为这个题目要计算double，所以求阶乘的精度会比较有问题</p>
<p>考虑递推求出 <span class="math inline">\(f(i)\)</span> ，则有</p>
<p><span class="math inline">\(f(i)=\left\{\begin{aligned}1 &amp;&amp;
i=m \\ \frac{f(i+1)(i+1-k)}{i+1} &amp;&amp;
i&lt;m\end{aligned}\right.\)</span></p>
<p>这样递推就能比好得保证精度，然后直接对于每条边计算即可，复杂度为
<span class="math inline">\(O(n)\)</span></p>
<p><span class="math display">\[ \ \]</span></p>
<h2 id="part2-直径长度计算">Part2 直径长度计算</h2>
<p>直径似乎是一个很难在树形 <span
class="math inline">\(\mathrm{dp}\)</span>
中确定的东西，因此考虑直接先枚举直径的两个端点</p>
<p>定义一棵树的直径两端点为最小的二元组 <span
class="math inline">\((A,B)\)</span> 满足</p>
<p><span class="math inline">\(\begin{aligned}
A&lt;B，dis(A,B)=\max_{u,v\in V} \{dis(u,v)\}\end{aligned}\)</span></p>
<p>因为 <span class="math inline">\(k&gt;1\)</span>
，所以两端点一定不同，不妨设两个端点分别为 <span
class="math inline">\(A,B(A&lt;B)\)</span></p>
<p>则一个点 <span class="math inline">\(C\)</span>
可以出现在树上的充要条件是</p>
<p><span class="math inline">\((dis(A,C)&gt;dis(A,B) \or
dis(A,C)=dis(A,B)\and C \ge B)\)</span></p>
<p><span class="math inline">\(\and (dis(B,C)&gt;dis(A,B) \or
dis(B,C)=dis(A,B)\and C \ge A)\)</span></p>
<p>数出所有可以出现在树上的点个数 <span class="math inline">\(i\)</span>
，则 <span class="math inline">\((A,B)\)</span> 为直径的概率应为 <span
class="math inline">\(\frac{C(i-2,k-2)}{C(m,k)}\)</span></p>
<p>即强制选取了 <span class="math inline">\((A,B)\)</span> 两个点</p>
<p>依然考虑递推求出</p>
<p><span class="math inline">\(\begin{aligned}
f(i)=\frac{C(i-2,k-2)}{C(m,k)}=\frac{(i-2)!k(k-1)(m-k)!}{m!(i-k)!}\end{aligned}\)</span></p>
<p>类似地，得到其递推式为</p>
<p><span
class="math inline">\(f(i)=\left\{\begin{aligned}\frac{k(k-1)}{m(m-1)}
&amp;&amp; i=m \\ \frac{f(i+1)(i+1-k)}{i-1} &amp;&amp;
i&lt;m\end{aligned}\right.\)</span></p>
<p>这一部分复杂度为 <span class="math inline">\(O(m^3)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> db;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(reg int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(reg int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">51</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,k;</span><br><span class="line"><span class="type">int</span> id[N][N],mk[<span class="number">2510</span>],sz[<span class="number">2510</span>],p[<span class="number">310</span>];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; G[<span class="number">2520</span>];</span><br><span class="line">db dp[<span class="number">2510</span>],ans;</span><br><span class="line"><span class="type">int</span> dis[<span class="number">2500</span>][<span class="number">2500</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">	sz[u]=mk[u]&gt;<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> v:G[u]) <span class="keyword">if</span>(v!=f) &#123;</span><br><span class="line">		<span class="built_in">Dfs</span>(v,u),sz[u]+=sz[v];</span><br><span class="line">		ans+=<span class="number">1</span>-dp[sz[v]]-dp[m-sz[v]];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dfs_Getdis</span><span class="params">(<span class="type">int</span> rt,<span class="type">int</span> u,<span class="type">int</span> f)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> v:G[u]) <span class="keyword">if</span>(v!=f) </span><br><span class="line">		dis[rt][v]=dis[rt][u]+<span class="number">1</span>,<span class="built_in">Dfs_Getdis</span>(rt,v,u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> A,B;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">(<span class="type">int</span> u)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(dis[A][u]&gt;dis[A][B]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(dis[A][u]==dis[A][B] &amp;&amp; u&lt;B) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(dis[B][u]&gt;dis[A][B]) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(dis[B][u]==dis[A][B] &amp;&amp; u&lt;A) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Orienteering</span> &#123;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="type">double</span> <span class="title">expectedLength</span><span class="params">(vector &lt;string&gt; field, <span class="type">int</span> K)</span> </span>&#123;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,n) G[i].<span class="built_in">clear</span>(); <span class="built_in">memset</span>(id,<span class="number">0</span>,<span class="keyword">sizeof</span> id),<span class="built_in">memset</span>(mk,<span class="number">0</span>,<span class="keyword">sizeof</span> mk);</span><br><span class="line">			n=m=<span class="number">0</span>,k=K;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,field.<span class="built_in">size</span>()<span class="number">-1</span>) <span class="built_in">rep</span>(j,<span class="number">0</span>,field[i].<span class="built_in">size</span>()<span class="number">-1</span>) <span class="keyword">if</span>(field[i][j]!=<span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">				id[i][j]=++n;</span><br><span class="line">				<span class="keyword">if</span>(field[i][j]==<span class="string">&#x27;*&#x27;</span>) p[mk[n]=++m]=n;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,field.<span class="built_in">size</span>()<span class="number">-1</span>) <span class="built_in">rep</span>(j,<span class="number">0</span>,field[i].<span class="built_in">size</span>()<span class="number">-1</span>) <span class="keyword">if</span>(id[i][j]) &#123;</span><br><span class="line">				<span class="keyword">if</span>(i&lt;iend &amp;&amp; id[i+<span class="number">1</span>][j]) G[id[i][j]].<span class="built_in">pb</span>(id[i+<span class="number">1</span>][j]),G[id[i+<span class="number">1</span>][j]].<span class="built_in">pb</span>(id[i][j]);</span><br><span class="line">				<span class="keyword">if</span>(j&lt;jend &amp;&amp; id[i][j+<span class="number">1</span>]) G[id[i][j]].<span class="built_in">pb</span>(id[i][j+<span class="number">1</span>]),G[id[i][j+<span class="number">1</span>]].<span class="built_in">pb</span>(id[i][j]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,m) dp[i]=<span class="number">0</span>;</span><br><span class="line">			dp[m]=<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">drep</span>(i,m<span class="number">-1</span>,k) dp[i]=dp[i+<span class="number">1</span>]/(i+<span class="number">1</span>)*(i+<span class="number">1</span>-k);</span><br><span class="line">			ans=<span class="number">0</span>,<span class="built_in">Dfs</span>(<span class="number">1</span>,<span class="number">0</span>),ans*=<span class="number">2</span>; <span class="comment">// 期望总长</span></span><br><span class="line">			<span class="comment">// 下面求期望直径长度</span></span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(mk[i]) <span class="built_in">Dfs_Getdis</span>(i,i,dis[i][i]=<span class="number">0</span>);</span><br><span class="line">			</span><br><span class="line">			dp[m]=<span class="number">1.0</span>*k*(k<span class="number">-1</span>)/m/(m<span class="number">-1</span>);</span><br><span class="line">			<span class="built_in">drep</span>(i,m<span class="number">-1</span>,k) dp[i]=dp[i+<span class="number">1</span>]/(i<span class="number">-1</span>)*(i+<span class="number">1</span>-k);</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,m) &#123;</span><br><span class="line">				<span class="type">int</span> c=<span class="number">0</span>; A=p[i],B=p[j];</span><br><span class="line">				<span class="built_in">rep</span>(k,<span class="number">1</span>,m) c+=<span class="built_in">Check</span>(p[k]);</span><br><span class="line">				<span class="keyword">if</span>(c&gt;=k) ans-=dis[A][B]*dp[c];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> ans;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(\begin{aligned} \frac{\begin{aligned}
\sum_{i=0}^{min(k,sz[u]) } C(sz[u],i)\cdot C(m-sz[u],k-i)\end{aligned}
}{C(m,k)}\end{aligned}\)</span></p>
<p><span class="math inline">\(\begin{aligned} \frac{\begin{aligned}
\sum_{i=0}^{min(k,sz[u]) } sz[u]!(m-sz[u])!k!(m-k)!\cdot \end{aligned}
}{m!i!(sz[u]-i)!(k-i)!(m-sz[u]-k+i)!}\end{aligned}\)</span></p>
<p><span class="math inline">\(\begin{aligned}
1-\frac{C(sz[u],k)}{C(m,k)}-\frac{C(m-sz[u],k)}{C(m,k)}\end{aligned}\)</span></p>
<p><span
class="math inline">\(\frac{C(i,k)}{C(m,k)}=\frac{i!(m-k)!}{m!(i-k)!}\)</span></p>
<p>i从m for 到 k</p>
<p>f(i)=f(i+1)/i(k-i+1)</p>
<p><span
class="math inline">\(\frac{C(i-2,k-2)}{C(m,k)}=\frac{(i-2)!k(k-1)(m-k)!}{m!(i-k)!}\)</span></p>
<p>i=m时， <span
class="math inline">\(f(m)=\frac{k(k-1)}{m(m-1)}\)</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/13/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">orangejuice</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
