<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"compilationfail.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="orangejuice&#39;s blog">
<meta property="og:url" content="https://compilationfail.github.io/page/6/index.html">
<meta property="og:site_name" content="orangejuice&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="orangejuice">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://compilationfail.github.io/page/6/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/6/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>orangejuice's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">orangejuice's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">挂了请务必叫我</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="orangejuice"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">orangejuice</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">256</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://twitter.com/ChenJerson" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;ChenJerson" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/3950662532/profile?rightmod=1&wvr=6&mod=personinfo" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;3950662532&#x2F;profile?rightmod&#x3D;1&amp;wvr&#x3D;6&amp;mod&#x3D;personinfo" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/CompilationFail" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CompilationFail" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/profiles/76561198969516062/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198969516062&#x2F;" rel="noopener me" target="_blank"><i class="fab fa-steam fa-fw"></i>Steam</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.last.fm/user/chasedeath" title="Lastfm → https:&#x2F;&#x2F;www.last.fm&#x2F;user&#x2F;chasedeath" rel="noopener me" target="_blank"><i class="fab fa-lastfm-square fa-fw"></i>Lastfm</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://open.spotify.com/user/mgxnlznf9dli6bm4k3sp0iuwz" title="Spotify → https:&#x2F;&#x2F;open.spotify.com&#x2F;user&#x2F;mgxnlznf9dli6bm4k3sp0iuwz" rel="noopener me" target="_blank"><i class="fab fa-spotify fa-fw"></i>Spotify</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%8C2019%E4%BA%94%E6%A0%A1%E8%81%94%E8%80%83-%E9%9B%85%E7%A4%BC%E3%80%8D%E5%A4%A7%E5%87%AF%E7%9A%84%E7%96%91%E6%83%91%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%8C2019%E4%BA%94%E6%A0%A1%E8%81%94%E8%80%83-%E9%9B%85%E7%A4%BC%E3%80%8D%E5%A4%A7%E5%87%AF%E7%9A%84%E7%96%91%E6%83%91%20/" class="post-title-link" itemprop="url">「2019五校联考-雅礼」大凯的疑惑</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 12:34:15" itemprop="dateCreated datePublished" datetime="2023-08-12T12:34:15+08:00">2023-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="五校联考-雅礼大凯的疑惑">「2019五校联考-雅礼」大凯的疑惑</h1>
<p>首先判断是否有无穷解，即判断 <span
class="math inline">\(\gcd(a,b)&gt;1\)</span> 时有无穷解</p>
<p>接下来我们由小凯的疑惑知道最大的无法表示的数是 <span
class="math inline">\(ab-a-b\)</span> ，这能确定一个上界</p>
<p>考虑计算 <span class="math inline">\([1,R](R&lt;ab)\)</span> 中能用
<span class="math inline">\(a,b\)</span> 表示出来的数</p>
<p>因为 <span class="math inline">\(\gcd(a,b)=1,R&lt;ab\)</span>
，所以每个数最多只有一种构成法，可以枚举其包含了几个 <span
class="math inline">\(b\)</span> ，剩下的部分直接任意放 <span
class="math inline">\(a\)</span></p>
<p>即得到计算能够被构成的个数的方法为 <span
class="math inline">\(\begin{aligned}\sum_{i=0}^{\lfloor
\frac{R}{a}\rfloor} \lfloor \frac{R-ib}{a}\rfloor+1
\end{aligned}\)</span></p>
<p>其中+1是计算了包含0个 <span class="math inline">\(a\)</span>
的情况</p>
<p>如果二分答案，复杂度为 <span class="math inline">\(O(a\log
(ab))\)</span> ，恐怕难以通过</p>
<p>优化：</p>
<p>我的思路是是先确定了 <span class="math inline">\(\lfloor
\frac{R}{a}\rfloor\)</span> ，那么此时确定了所有 <span
class="math inline">\(b\)</span> 的个数的贡献</p>
<p>那么考虑枚举，找到答案所属的 <span class="math inline">\(\lfloor
\frac{R}{a}\rfloor\)</span> 的区间，在这段区间里，判断一个数 <span
class="math inline">\(x\)</span> 是否可以被构成即:</p>
<p><span class="math inline">\(x\equiv ib\pmod a(i\leq \lfloor
\frac{R}{a}\rfloor)\)</span> ，即考虑了不同 <span
class="math inline">\(b\)</span> 的个数的贡献</p>
<p>用一个数组存下 <span class="math inline">\(ib\bmod a\)</span>
，那么可以 <span class="math inline">\(O(1)\)</span>
判断一个数是否合法，如果直接for过去是 <span
class="math inline">\(O(b)\)</span> 的</p>
<p>显然这在一段中，构成情况每 <span class="math inline">\(a\)</span>
个一循环，那么先快速跳循环即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2e7</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">ll a,b,k;</span><br><span class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll a,ll b)</span></span>&#123; <span class="keyword">return</span> b==<span class="number">0</span>?a:<span class="built_in">gcd</span>(b,a%b); &#125;</span><br><span class="line"><span class="type">bool</span> mk[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;math.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;math.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>,&amp;a,&amp;b,&amp;k);</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">gcd</span>(a,b)!=<span class="number">1</span> || a==<span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>),<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(a&gt;b) <span class="built_in">swap</span>(a,b);</span><br><span class="line">	<span class="keyword">if</span>(k==<span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,a*b-a-b),<span class="number">0</span>;</span><br><span class="line">	ll s=(a<span class="number">-1</span>)*(b<span class="number">-1</span>)/<span class="number">2</span>,c=<span class="number">0</span>; <span class="comment">// s为总的个数</span></span><br><span class="line">	<span class="keyword">if</span>(s&lt;k) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>),<span class="number">0</span>;</span><br><span class="line">	k=s-k+<span class="number">1</span>; <span class="comment">// 改为求第k小</span></span><br><span class="line">	<span class="type">int</span> p=mk[<span class="number">0</span>]=<span class="number">1</span>;  <span class="comment">// p为所属区间</span></span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,a<span class="number">-1</span>) &#123;</span><br><span class="line">		c+=i*b/a;</span><br><span class="line">		ll t=i*(b<span class="number">-1</span>)-c; <span class="comment">// t为这段区间内无法被表示的个数</span></span><br><span class="line">		<span class="keyword">if</span>(t&gt;=k)&#123; p=i; <span class="keyword">break</span>; &#125;</span><br><span class="line">		mk[i*b%a]=<span class="number">1</span>;  <span class="comment">// 把区间内的ib mod a 放进去</span></span><br><span class="line">	&#125;</span><br><span class="line">	k-=(p<span class="number">-1</span>)*(b<span class="number">-1</span>)-(c-p*b/a); <span class="comment">//还需要做的个数</span></span><br><span class="line">	ll l=(p<span class="number">-1</span>)*b+<span class="number">1</span>,d=l%a; <span class="comment">//l为区间开始位置</span></span><br><span class="line">	ll i=l+(k<span class="number">-1</span>)/(a-p)*a; <span class="comment">// 每个长度为a的循环中已经有p个位置被标记，可以被表示，因此还有a-p个位置无法表示</span></span><br><span class="line">	k-=(k<span class="number">-1</span>)/(a-p)*(a-p); <span class="comment">// 跳过循环</span></span><br><span class="line">	<span class="keyword">for</span>(;;++i,d++,d==a&amp;&amp;(d=<span class="number">0</span>)) <span class="keyword">if</span>(!mk[d] &amp;&amp; --k==<span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,i),<span class="number">0</span>; <span class="comment">// 暴力for最后a个</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%8CCodePlus%202017%2011%20%E6%9C%88%E8%B5%9B%E3%80%8DYazid%20%E7%9A%84%E6%96%B0%E7%94%9F%E8%88%9E%E4%BC%9A%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%8CCodePlus%202017%2011%20%E6%9C%88%E8%B5%9B%E3%80%8DYazid%20%E7%9A%84%E6%96%B0%E7%94%9F%E8%88%9E%E4%BC%9A%20/" class="post-title-link" itemprop="url">「CodePlus 2017 11 月赛」Yazid 的新生舞会</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 12:34:15" itemprop="dateCreated datePublished" datetime="2023-08-12T12:34:15+08:00">2023-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="codeplus-2017-11-月赛yazid-的新生舞会">「CodePlus 2017 11
月赛」Yazid 的新生舞会</h1>
<p>最基本的分析这里只保留： <span
class="math inline">\(cnt&gt;\frac{len}{2}\Rightarrow
2cnt&gt;len\)</span></p>
<p>对于每一个合法的区间，合法的众数显然只有一个</p>
<p>考虑对于每一个众数计算答案，把 <span class="math inline">\(x\)</span>
出现的位置拿出来成一个序列 <span class="math inline">\(A_i\)</span></p>
<p>如果选择的区间恰好包含 <span class="math inline">\(A_i,A_{i+1},\cdots
,A_j\)</span> ，那么合法的情况就是 <span
class="math inline">\(2(j-i+1)&gt;R-L+1,L\in[A_{i-1}+1,A_i],R\in[A_{j},A_{j},A_{j+1}-1]\)</span></p>
<p>参数分离得到 <span class="math inline">\(2j-R&gt;2i-L\)</span></p>
<p>如果对于每一个 <span class="math inline">\(L\)</span>
更新答案，那么更新的是一段区间，不妨设其为 <span
class="math inline">\(UL,UR\)</span></p>
<p>对于每个 <span class="math inline">\(R\)</span> 查询则是一段前缀 和
的区间</p>
<p>我们知道树状数组维护区间修改区间查询需要做一次差分，而这次是区间前缀和</p>
<p>也就是说是再高一维。。</p>
<p>不妨在 <span class="math inline">\(UL\)</span> 上加, <span
class="math inline">\(UR\)</span> 上减，那么在 <span
class="math inline">\(p\)</span> 处的更新对于在 <span
class="math inline">\(k\)</span> 处的查询的贡献是</p>
<p><span
class="math inline">\(\cfrac{(k-p+1)(k-p+2)}{2}=\cfrac{k^2+p^2-2pk+3k-3p+2}{2}\)</span></p>
<p>那么直接处理这个式子即可，需要维护 <span
class="math inline">\(updval,p\cdot updval,p^2\cdot updval\)</span></p>
<p>查询时加入 <span class="math inline">\(k\)</span> 的贡献</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll=<span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>; <span class="type">char</span> c;</span><br><span class="line">	<span class="keyword">while</span>(c=<span class="built_in">getchar</span>(),c&lt;<span class="number">48</span>);</span><br><span class="line">	<span class="keyword">do</span> s=s*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">	<span class="keyword">while</span>(c=<span class="built_in">getchar</span>(),c&gt;<span class="number">47</span>);</span><br><span class="line">	<span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span>&#123;N=<span class="number">1000010</span>&#125;;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; A[N];</span><br><span class="line">ll ans,s1[N],s2[N],s3[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> p,ll x)</span> </span>&#123;</span><br><span class="line">	p--; ll a=x,b=x*p,c=x*p*p;</span><br><span class="line">	<span class="keyword">for</span>(p+=n+<span class="number">1</span>;p&lt;=n*<span class="number">2</span>;p+=p&amp;-p) s1[p]+=a,s2[p]+=b,s3[p]+=c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span> </span>&#123; <span class="built_in">Add</span>(l,x),<span class="built_in">Add</span>(r+<span class="number">1</span>,-x); &#125;</span><br><span class="line"><span class="function">ll <span class="title">Que</span><span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	ll r1=<span class="number">0</span>,r2=<span class="number">0</span>,r3=<span class="number">0</span>,tp=p;</span><br><span class="line">	<span class="keyword">for</span>(p+=n;p;p-=p&amp;-p) r1+=s1[p],r2+=s2[p],r3+=s3[p];</span><br><span class="line">	<span class="keyword">return</span> ((tp*tp+tp)*r1-(<span class="number">2</span>*tp+<span class="number">1</span>)*r2+r3)/<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Que</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Que</span>(r)-<span class="built_in">Que</span>(l<span class="number">-1</span>); &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123; </span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;party.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),n=<span class="built_in">rd</span>(),<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) A[<span class="built_in">rd</span>()].<span class="built_in">push_back</span>(i);</span><br><span class="line">	<span class="built_in">rep</span>(k,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(A[k].<span class="built_in">size</span>()) &#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,A[k].<span class="built_in">size</span>()<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> p=A[k][i],l=i?A[k][i<span class="number">-1</span>]:<span class="number">0</span>,r=i&lt;(<span class="type">int</span>)A[k].<span class="built_in">size</span>()<span class="number">-1</span>?A[k][i+<span class="number">1</span>]:n+<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">Add</span>(<span class="number">2</span>*i-p+<span class="number">1</span>,<span class="number">2</span>*i-l,<span class="number">1</span>);</span><br><span class="line">			ans+=<span class="built_in">Que</span>(<span class="number">2</span>*(i+<span class="number">1</span>)-r,<span class="number">2</span>*(i+<span class="number">1</span>)-p<span class="number">-1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,A[k].<span class="built_in">size</span>()<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> p=A[k][i],l=i?A[k][i<span class="number">-1</span>]:<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">Add</span>(<span class="number">2</span>*i-p+<span class="number">1</span>,<span class="number">2</span>*i-l,<span class="number">-1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">fprintf</span>(<span class="built_in">fopen</span>(<span class="string">&quot;party.out&quot;</span>,<span class="string">&quot;w&quot;</span>),<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%8C%E4%BD%99%E5%A7%9A%E4%B8%AD%E5%AD%A6%202019%20%E8%81%94%E6%B5%8B%20Day%204%E3%80%8D%E9%9A%8F%E6%9C%BA%E9%99%A4%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%8C%E4%BD%99%E5%A7%9A%E4%B8%AD%E5%AD%A6%202019%20%E8%81%94%E6%B5%8B%20Day%204%E3%80%8D%E9%9A%8F%E6%9C%BA%E9%99%A4%E6%B3%95/" class="post-title-link" itemprop="url">「余姚中学 2019 联测 Day 4」随机除法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 12:34:15" itemprop="dateCreated datePublished" datetime="2023-08-12T12:34:15+08:00">2023-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="余姚中学-2019-联测-day-4随机除法">「余姚中学 2019 联测 Day
4」随机除法</h1>
<p>好题，难就难在转移的高位前缀和</p>
<p>首先是一个浅显的 <span class="math inline">\(\text{dp}\)</span>
状态，令 <span class="math inline">\(n=\Pi prime_i^{c_i}\)</span></p>
<p>则状态只跟 <span class="math inline">\(\{c_i\}\)</span>
有关，这是一个可重集合，强制定义 <span class="math inline">\(c_i\ge
c_{i-1}\)</span> 最小表示出所有不同状态</p>
<p>搜索一下 <span class="math inline">\(\text{dp}\)</span>
状态，发现只有 <span class="math inline">\(170000\)</span>
左右的状态数</p>
<p>直接枚举因数转移复杂度显然是升天的，直接枚举子集状态转移复杂度也很高，并且不好确定系数</p>
<p>所以用一个高位前缀和处理优化<strong>枚举因数的转移</strong></p>
<p>再说一遍，是高位前缀和<strong>枚举因数的转移</strong>，不同的因数可能对应同一个状态</p>
<p>常见的高位前缀和是 <span
class="math inline">\(dp_{i,S}=dp_{i-1,S}+dp_{i,S-\{S_i\}}\)</span></p>
<p>转移具有单调性，对于状态排序之后，定义辅助数组 <span
class="math inline">\(dp_{i,j}\)</span> 表示对于 <span
class="math inline">\(i\)</span> 这个状态</p>
<p>它的子集(注意这个子集是未排序的)中和它不同的最低位置 <span
class="math inline">\(\ge j\)</span> 的总和</p>
<p>计算高位前缀和时，每次转移只会对于一个位置改变</p>
<p>枚举状态时，取得位置是 <span class="math inline">\(j\)</span>
，调用时需要排序</p>
<p>而排完序之后 <span class="math inline">\(j\)</span>
可能会后移，所以需要定义成 <span class="math inline">\(\ge j\)</span>
的，否则会算多</p>
<p>比如转移 <span class="math inline">\((1,1,1)\leftarrow
(0,1,1),(1,0,1),(1,1,0)\)</span></p>
<p>如果定义成 <span class="math inline">\(\le j\)</span>
的状态，三种状态转移之后都变成 <span
class="math inline">\((1,1,0)\)</span></p>
<p>原先在这个状态里的三个位置编号是 <span
class="math inline">\((0,1,2)\)</span></p>
<p>如果都去 <span class="math inline">\((1,1,0)\)</span>
这个状态里转移过来，原先 <span class="math inline">\((0,1,2)\)</span>
对应的下标位置改变，变成</p>
<p><span class="math inline">\((1,2,0)\)</span></p>
<p><span class="math inline">\((0,2,1)\)</span></p>
<p><span class="math inline">\((0,1,2)\)</span></p>
<p>我们访问的时候访问的应该是子状态中不同位置 <span
class="math inline">\(\le j\)</span> 的总和</p>
<p>而从这个下标改变的状态里转移过来时，原先 <span
class="math inline">\(&gt;j\)</span> 的下标被移移动进 <span
class="math inline">\(\le j\)</span> 的范围</p>
<p>再转移就错了</p>
<p>所以正确定义状态之后就可以高位前缀和了</p>
<p>存储和访问状态可以用 <span
class="math inline">\(\text{Hash,Trie,int128}\)</span> 三种方法存储，
<span class="math inline">\(\text{int128}\)</span> 真香啊</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> __int128 Node;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">180000</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll k=P<span class="number">-2</span>)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(;k;k&gt;&gt;=<span class="number">1</span>,x=x*x%P) <span class="keyword">if</span>(k&amp;<span class="number">1</span>) res=res*x%P;</span><br><span class="line">	<span class="keyword">return</span> res; </span><br><span class="line">&#125;</span><br><span class="line">Node Max,st[N];</span><br><span class="line"><span class="type">int</span> m,a[<span class="number">100</span>],cnt,dp[N][<span class="number">20</span>],F[N],pri[]=&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">67</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">79</span>&#125;;</span><br><span class="line"><span class="type">char</span> str[<span class="number">30</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Find</span><span class="params">(Node s)</span></span>&#123; <span class="keyword">return</span> <span class="built_in">lower_bound</span>(st+<span class="number">1</span>,st+cnt+<span class="number">1</span>,s)-st; &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Load</span><span class="params">(Node s)</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">20</span>) a[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">20</span> &amp;&amp; s&gt;<span class="number">1</span>; ++i) <span class="keyword">while</span>(s%pri[i]==<span class="number">0</span>) s=s/pri[i],a[i]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> lst,Node s)</span> </span>&#123; </span><br><span class="line">	st[++cnt]=s;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,lst) &#123;</span><br><span class="line">		<span class="keyword">if</span>((s*=pri[p])&gt;Max) <span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">dfs</span>(p+<span class="number">1</span>,i,s);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;div.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;div.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	Max=<span class="number">1e12</span>,Max=Max*Max;</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">100</span>,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">fprintf</span>(stderr,<span class="string">&quot;States Number = %d\n&quot;</span>,cnt);</span><br><span class="line">	<span class="built_in">sort</span>(st+<span class="number">1</span>,st+cnt+<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">2</span>,cnt) &#123;</span><br><span class="line">		Node now; <span class="built_in">Load</span>(now=st[i]);</span><br><span class="line">		<span class="type">int</span> c=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">18</span>) c=<span class="number">1ll</span>*c*(a[i]+<span class="number">1</span>)%P;</span><br><span class="line">		<span class="built_in">drep</span>(j,<span class="number">18</span>,<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(!a[j]) dp[i][j]=dp[i][j+<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">int</span> k=j;</span><br><span class="line">				<span class="keyword">while</span>(k&gt;<span class="number">1</span> &amp;&amp; a[k<span class="number">-1</span>]==a[k]) --k;</span><br><span class="line">				<span class="type">int</span> p=<span class="built_in">Find</span>(now/pri[j]);</span><br><span class="line">				<span class="built_in">drep</span>(d,j,k) &#123;</span><br><span class="line">					dp[i][d]=dp[i][d+<span class="number">1</span>]+dp[p][d];</span><br><span class="line">					<span class="built_in">Mod1</span>(dp[i][d]);</span><br><span class="line">				&#125;</span><br><span class="line">				j=k;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		F[i]=(dp[i][<span class="number">1</span>]+c)*<span class="built_in">qpow</span>(c<span class="number">-1</span>)%P;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,<span class="number">18</span>) dp[i][j]+=F[i],<span class="built_in">Mod1</span>(dp[i][j]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>,str,&amp;m)) &#123;</span><br><span class="line">		Node n=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;str[i];++i) n=n*<span class="number">10</span>+(str[i]-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">			<span class="type">int</span> x;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x); a[i]=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span>(n%x==<span class="number">0</span>) n=n/x,a[i]++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">sort</span>(a+<span class="number">1</span>,a+m+<span class="number">1</span>,greater &lt;<span class="type">int</span>&gt; ());</span><br><span class="line">		n=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">rep</span>(j,<span class="number">1</span>,a[i]) n=n*pri[i];</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,F[<span class="built_in">Find</span>(n)]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%8C%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD%202017%E3%80%8D%E5%B0%8F%20Y%20%E5%92%8C%E6%81%90%E6%80%96%E7%9A%84%E5%A5%B4%E9%9A%B6%E4%B8%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%8C%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD%202017%E3%80%8D%E5%B0%8F%20Y%20%E5%92%8C%E6%81%90%E6%80%96%E7%9A%84%E5%A5%B4%E9%9A%B6%E4%B8%BB/" class="post-title-link" itemprop="url">「清华集训 2017」小 Y 和恐怖的奴隶主</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 12:34:15" itemprop="dateCreated datePublished" datetime="2023-08-12T12:34:15+08:00">2023-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="清华集训-2017小-y-和恐怖的奴隶主">「清华集训 2017」小 Y
和恐怖的奴隶主</h1>
<p><del>是不是这题太水了都没人写啊</del></p>
<p><strong>本题官方题解提供的做法实际上复杂度非常高</strong></p>
<h2 id="part1">Part1</h2>
<p>很显然本题的 <span class="math inline">\(\text{dp}\)</span>
是存储每种血量的随从数量</p>
<p>设状态数量的上限是 <span class="math inline">\(S\)</span></p>
<p>当 <span class="math inline">\(m=3,k=8\)</span> 时，这样的状态一共有
<span class="math inline">\(S=165+1\)</span> 种</p>
<p>如果直接 <span class="math inline">\(dp\)</span> ，每次转移是 <span
class="math inline">\(O(1)\)</span> 的，可以做到 <span
class="math inline">\(O(n\cdot S)\)</span> ，显然无法处理 <span
class="math inline">\(n\)</span> 较大的情况</p>
<p>用矩阵优化 <span class="math inline">\(\text{dp}\)</span>
转移，朴素的实现可以做到 <span class="math inline">\(O(T\cdot \log
n\cdot S^3)\)</span></p>
<p>如果预处理出转移矩阵的幂次，每次查询时只有列向量与方阵的乘法，所以复杂度是
<span class="math inline">\(O(\log n\cdot S^3+T\log n\cdot
S^2)\)</span></p>
<p>实际极限的复杂度预估在 <span class="math inline">\(60\cdot
166^3+500\cdot 60\cdot 166^2\approx 11\cdot 10^8\)</span></p>
<p>官方题解提供的做法就是在在这个算法上进行常数优化，这<del>wtm</del></p>
<p><span class="math display">\[ \ \]</span></p>
<h2 id="part2">Part2</h2>
<p>对于已知 <span class="math inline">\(m,k\)</span> 来说，设每个 <span
class="math inline">\(n\)</span> 构成的答案数列为 <span
class="math inline">\(a_n\)</span></p>
<p>预先处理一部分的答案 <span class="math inline">\(a_1\cdots
a_n\)</span> ，使用 <span class="math inline">\(\text{Berlekamp-Massey
}\)</span> 算法求出序列的最短线性递推</p>
<p>发现总是在 <span class="math inline">\(O(S)\)</span>
的长度以后，递推序列不再改变，即总能得到一个长度为 <span
class="math inline">\(O(S)\)</span> 的全局线性递推</p>
<p>即总可以在 <span class="math inline">\(O(S^2)\)</span>
的时间内求出答案序列 <span class="math inline">\(a_n\)</span>
的<strong>线性递推式</strong></p>
<p>那么对于求得的线性递推式，问题转化为对于每个查询的 <span
class="math inline">\(n\)</span> ，求常系数线性递推数列的第 <span
class="math inline">\(n\)</span> 项答案</p>
<p>用<strong>特征多项式</strong>的做法，可以做到单组查询 <span
class="math inline">\(O(S\log n\log S)\)</span> 的之间求出</p>
<p>那么总复杂度就是 <span class="math inline">\(O(S^2+T\cdot S \log
S\log n)\)</span></p>
<p>理论上来说，复杂度上限应该只有 <span
class="math inline">\(166^2+500\cdot 166\cdot 10\cdot 60\approx 0.5\cdot
10^8\)</span></p>
<p>理论上来说，这个复杂度无论是不是渐进意义下都比矩阵快</p>
<p>但是实际实践中，由于多项式运算的大常数，不优秀的实现下甚至可能超时</p>
<p>考虑到本题多查询的性质，我改变了倍增的基数 <span
class="math inline">\(D\)</span> ，并且预处理出倍增用到的 <span
class="math inline">\(x^i\mod \lambda\)</span></p>
<p>预处理部分的复杂度是 <span class="math inline">\(O(\log_D^n \cdot
(D-1)\cdot S\log S)\)</span></p>
<p>查询部分的复杂度是 <span class="math inline">\(O(\log _D^n S\log
S)\)</span></p>
<p><del>由于我的多项式模板不够成熟</del></p>
<p>在LOJ上，经过这样的魔改，已经能跑得比矩阵块</p>
<p>但是在UOJ上，我同样的代码竟然慢了四倍，而<a
target="_blank" rel="noopener" href="https://loj.ac/submission/108525">这份代码</a>在UOJ上的运行时间还略有提高</p>
<p>表示很是绝望。。</p>
<p>事实上，这种做法在 <span class="math inline">\(m,k\)</span>
较大时同样可行，在 <span class="math inline">\(S\)</span> 较大， <span
class="math inline">\(T\)</span>
较小的情况下，实际运行总能有更好的表现</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/%E3%80%90UER%20#9%E3%80%91%E7%9F%A5%E8%AF%86%E7%BD%91%E7%BB%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/%E3%80%90UER%20#9%E3%80%91%E7%9F%A5%E8%AF%86%E7%BD%91%E7%BB%9C/" class="post-title-link" itemprop="url">【UER #9】知识网络</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 12:34:15" itemprop="dateCreated datePublished" datetime="2023-08-12T12:34:15+08:00">2023-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="uer-9知识网络">【UER #9】知识网络</h1>
<p>bitset写错没调出来。。。</p>
<hr />
<h3 id="onnm"><span class="math inline">\(O(n(n+m))\)</span></h3>
<p>暴力枚举起点，建立转移虚点，得到一个边权为 <span
class="math inline">\(0/1\)</span> ，点数 <span
class="math inline">\(n+k\)</span> ，边数为 <span
class="math inline">\(O(n+m)\)</span> 的图</p>
<p>然后广搜双端队列维护即可</p>
<p><span class="math display">\[ \ \]</span></p>
<h3 id="oknmfracnnmw"><span
class="math inline">\(O(k(n+m)+\frac{n(n+m)}{w})\)</span></h3>
<p>考虑枚举颜色 <span class="math inline">\(k\)</span>
，对于所有这种颜色的点，假设一开始 <span
class="math inline">\(dis_u\)</span> 均为 <span
class="math inline">\(2\)</span></p>
<p>并由此广搜预处理一个最短路图，复杂度为 <span
class="math inline">\(O(k(n+m))\)</span></p>
<p>由于图上有0边无0环，因此最短路图是拓扑图</p>
<p>那么选定其中一个点为起点，会将这个点的 <span
class="math inline">\(dis\rightarrow dis-1\)</span> ，其他同色点 <span
class="math inline">\(dis\)</span> 不变</p>
<p>同时，这个点在最短路图上的所有后记节点 <span
class="math inline">\(dis\rightarrow dis-1\)</span></p>
<p>那么对于最短路图上所有点，统计有多少个起点能够到达它，就能够知道以这种颜色点为起点时，这个点不同的
<span class="math inline">\(dis\)</span> 出现次数</p>
<p>这是一个拓扑图 <span class="math inline">\(dp\)</span>
问题，不好处理，因此考虑用 <span
class="math inline">\(\text{bitset}\)</span>
暴力存储所有能够转移的状态</p>
<p>由于需要维护的起点总数为 <span class="math inline">\(n\)</span>
，单次只维护一个集合，因此无法直接用 <span
class="math inline">\(\text{std::bitset}\)</span></p>
<p>复杂度为 <span class="math inline">\(O(\frac{nm}{w})\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ull;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> db;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>=<span class="type">int</span>&gt; T <span class="built_in">rd</span>()&#123;</span><br><span class="line">	T s=<span class="number">0</span>; <span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) f|=IO==<span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">51000</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,k;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> to,nxt,w;</span><br><span class="line">&#125; e[N*<span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> head[N],ecnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w=<span class="number">1</span>)</span></span>&#123;</span><br><span class="line">	e[++ecnt]=(Edge)&#123;v,head[u],w&#125;;</span><br><span class="line">	head[u]=ecnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> Q[N*<span class="number">4</span>],D[N*<span class="number">4</span>],L,R,dis[N];</span><br><span class="line"><span class="type">unsigned</span> Ans[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; G[<span class="number">200</span>];</span><br><span class="line"><span class="type">int</span> len;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BITSET</span>&#123;</span><br><span class="line">	ull a[N/<span class="number">128</span>];</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">count</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">int</span> c=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,len) c+=__builtin_popcountll(a[i]);</span><br><span class="line">		<span class="keyword">return</span> c;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">int</span> x)</span></span>&#123; a[x&gt;&gt;<span class="number">6</span>]|=<span class="number">1ull</span>&lt;&lt;x; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123; <span class="built_in">memset</span>(a,<span class="number">0</span>,(len+<span class="number">1</span>)&lt;&lt;<span class="number">3</span>); &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">copy</span><span class="params">(<span class="type">const</span> BITSET &amp;t)</span></span>&#123; <span class="built_in">memcpy</span>(a,t.a,(len+<span class="number">1</span>)&lt;&lt;<span class="number">3</span>); &#125;</span><br><span class="line">	<span class="type">void</span> <span class="keyword">operator</span> |= (<span class="type">const</span> BITSET &amp;t) &#123; <span class="built_in">rep</span>(i,<span class="number">0</span>,len) a[i]|=t.a[i]; &#125;</span><br><span class="line">&#125; BS[N];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt,vis[N],ind[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Topo</span><span class="params">(<span class="type">int</span> sz)</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n+k) ind[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(u,<span class="number">1</span>,n+k) <span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=e[i].nxt) <span class="keyword">if</span>(dis[e[i].to]==dis[u]+e[i].w) ind[e[i].to]++;</span><br><span class="line">	L=<span class="number">1</span>,R=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n+k) <span class="keyword">if</span>(dis[i]&lt;<span class="number">1e6</span> &amp;&amp; !ind[i]) Q[++R]=i;</span><br><span class="line">	<span class="keyword">while</span>(L&lt;=R)&#123;</span><br><span class="line">		<span class="type">int</span> u=Q[L++];</span><br><span class="line">		<span class="keyword">if</span>(u&lt;=n) &#123;</span><br><span class="line">			<span class="type">int</span> t=BS[u].<span class="built_in">count</span>();</span><br><span class="line">			Ans[dis[u]]+=sz-t;</span><br><span class="line">			Ans[dis[u]<span class="number">-1</span>]+=t;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=e[i].nxt) <span class="keyword">if</span>(dis[e[i].to]==dis[u]+e[i].w) &#123;</span><br><span class="line">			BS[e[i].to]|=BS[u];</span><br><span class="line">			<span class="keyword">if</span>(--ind[e[i].to]==<span class="number">0</span>) Q[++R]=e[i].to;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Bfs</span><span class="params">(<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!G[c].<span class="built_in">size</span>()) <span class="keyword">return</span>;</span><br><span class="line">	<span class="built_in">memset</span>(dis,<span class="number">63</span>,(n+k+<span class="number">2</span>)&lt;&lt;<span class="number">2</span>);</span><br><span class="line">	L=<span class="number">2</span>*(n+k),R=<span class="number">2</span>*(n+k)<span class="number">-1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,G[c].<span class="built_in">size</span>()<span class="number">-1</span>) Q[++R]=G[c][i],D[R]=dis[G[c][i]]=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">while</span>(L&lt;=R)&#123;</span><br><span class="line">		<span class="type">int</span> u=Q[L++];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(reg <span class="type">int</span> i=head[u];i;i=e[i].nxt)&#123;</span><br><span class="line">			reg <span class="type">int</span> v=e[i].to,w=e[i].w;</span><br><span class="line">			<span class="keyword">if</span>(dis[v]&lt;=dis[u]+w) <span class="keyword">continue</span>;</span><br><span class="line">			dis[v]=dis[u]+w;</span><br><span class="line">			<span class="keyword">if</span>(!w) Q[--L]=v,D[L]=dis[v];</span><br><span class="line">			<span class="keyword">else</span> Q[++R]=v,D[R]=dis[v];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	len=G[c].<span class="built_in">size</span>()/<span class="number">64</span>;</span><br><span class="line">	<span class="keyword">if</span>(len&gt;=N/<span class="number">128</span>)&#123;</span><br><span class="line">		len=N/<span class="number">128</span><span class="number">-1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n+k) BS[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,G[c].<span class="built_in">size</span>()<span class="number">-1</span>) <span class="keyword">if</span>(i&lt;len*<span class="number">64</span>) BS[G[c][i]].<span class="built_in">set</span>(i);</span><br><span class="line">		<span class="built_in">Topo</span>(len*<span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">		<span class="type">int</span> tmp=len*<span class="number">64</span>;</span><br><span class="line">		len=(G[c].<span class="built_in">size</span>()-tmp)/<span class="number">64</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n+k) BS[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,G[c].<span class="built_in">size</span>()<span class="number">-1</span>) <span class="keyword">if</span>(i&gt;=tmp) BS[G[c][i]].<span class="built_in">set</span>(i-tmp);</span><br><span class="line">		<span class="built_in">Topo</span>(G[c].<span class="built_in">size</span>()-tmp);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n+k) BS[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,G[c].<span class="built_in">size</span>()<span class="number">-1</span>) BS[G[c][i]].<span class="built_in">set</span>(i);</span><br><span class="line">		<span class="built_in">Topo</span>(G[c].<span class="built_in">size</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> col[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	n=<span class="built_in">rd</span>(),m=<span class="built_in">rd</span>(),k=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="type">int</span> x=col[i]=<span class="built_in">rd</span>();</span><br><span class="line">		<span class="built_in">AddEdge</span>(n+x,i,<span class="number">0</span>),<span class="built_in">AddEdge</span>(i,n+x);</span><br><span class="line">		G[x].<span class="built_in">pb</span>(i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">		<span class="type">int</span> u=<span class="built_in">rd</span>(),v=<span class="built_in">rd</span>();</span><br><span class="line">		<span class="keyword">if</span>(col[u]==col[v]) <span class="keyword">continue</span>;</span><br><span class="line">		ind[u]++,ind[v]++;</span><br><span class="line">		<span class="built_in">AddEdge</span>(u,v),<span class="built_in">AddEdge</span>(v,u);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,k) <span class="built_in">Bfs</span>(i);</span><br><span class="line">	Ans[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">2</span>,k*<span class="number">2</span>) Ans[i]/=<span class="number">2</span>;</span><br><span class="line">	Ans[k*<span class="number">2</span>+<span class="number">1</span>]=<span class="number">1ll</span>*n*(n<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,k*<span class="number">2</span>+<span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">&quot;%u &quot;</span>,Ans[i]),Ans[k*<span class="number">2</span>+<span class="number">1</span>]-=Ans[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/EZEC10%20-%20D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/EZEC10%20-%20D/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 12:34:15" itemprop="dateCreated datePublished" datetime="2023-08-12T12:34:15+08:00">2023-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>设 <span class="math inline">\(\displaystyle C(x)=\sum_{i=0}^{\infty}
C_i\)</span></p>
<p>易知 <span class="math inline">\(xC^2=C-1\)</span></p>
<p>设 <span
class="math inline">\(F_{n,m}=[x^m](C-1)^n,F_n(x)=(C-1)^n\)</span></p>
<p>知 <span class="math inline">\(F_n(x)=(C-1)^n=xC^2 (C-1)^{n-1}=x
((C-1)^{n+1}+2(C-1)^n+(C-1)^{n-1})\)</span></p>
<p>即 <span
class="math inline">\(F_{n,m}=F_{n+1,m-1}+2F_{n,m-1}+F_{n-1m-1}\)</span></p>
<p>即 <span
class="math inline">\(F_{n,m}=F_{n-1,m+1}-2F_{n-1,m}-F_{n-2,m}\)</span></p>
<p>进一步规约，得到答案的表达式</p>
<p><span class="math inline">\(\displaystyle Ans_i=[x^n] (C(x)-1)^i
[y^i] e^{\varphi}\)</span></p>
<p>其中 <span class="math inline">\(\displaystyle \varphi=\sum _{i\ge
1}2(i+1) \cdot (C(x)-1) y^i\)</span></p>
<p><span class="math inline">\(\displaystyle \varphi=\sum _{i\ge
1}2(i+1) \cdot (C(x)-1) y^i\)</span></p>
<p><span class="math inline">\(\displaystyle \int \varphi\ dy
=\sum_{i\ge 1} 2(C(x)-1) y^{i+1}=\sum_{i\ge 2} 2(C(x)-1)
y^i\)</span></p>
<p><span class="math inline">\(\displaystyle \int \varphi\ dy =
2(C(x)-1) \frac{y^2}{1-y}\)</span></p>
<p><span class="math inline">\(\displaystyle \varphi=2(C(x)-1)
(\frac{y^2}{1-y})&#39;=2(C(x)-1) \frac{2y-y^2}{(1-y)^2}\)</span></p>
<p><span class="math inline">\(G_{n,m}\)</span> 为 <span
class="math inline">\(n\)</span> 个白格， <span
class="math inline">\(m\)</span> 为总格数的权值</p>
<p><span class="math inline">\(\displaystyle G_{n}(x)=(\sum_{i\ge 2} 2i
x^i)^n\)</span></p>
<p>设 <span class="math inline">\(\displaystyle \varphi(x)=\sum_{i\ge 2}
2i x^i\)</span></p>
<p><span class="math inline">\(\displaystyle \varphi(x)=2x(\sum_{i\ge 2}
x^i)&#39;=2x^2 \frac{2-x}{1-x}\)</span></p>
<p><span class="math inline">\(G_n(x)=\varphi^n(x)\)</span></p>
<p><span class="math inline">\(Ans_i\)</span> 表示有 <span
class="math inline">\(i\)</span> 个白格的答案</p>
<p><span class="math inline">\(Ans_i=\displaystyle \sum_j G_{i,j}
F_{j,n}\)</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CCEOI2020%E3%80%8D%E6%98%9F%E9%99%85%E8%BF%B7%E8%88%AA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CCEOI2020%E3%80%8D%E6%98%9F%E9%99%85%E8%BF%B7%E8%88%AA/" class="post-title-link" itemprop="url">「CEOI2020」星际迷航</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 12:34:15" itemprop="dateCreated datePublished" datetime="2023-08-12T12:34:15+08:00">2023-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ceoi2020星际迷航">「CEOI2020」星际迷航</h1>
<p>首先是最简单的判断是否必胜的 <span class="math inline">\(dp\)</span>
转移 <span class="math inline">\(\displaystyle dp_u=\bigcup_{v\in son_u}
\text{not  } dp_{v}\)</span></p>
<p>考虑第 <span class="math inline">\(i+1\)</span> 层对于第 <span
class="math inline">\(i\)</span> 层的贡献，实际上只和 <span
class="math inline">\(i+1\)</span> 层有多少个点 <span
class="math inline">\(dp\)</span> 值为0/1有关</p>
<p>下面称 <span class="math inline">\(dp\)</span> 值为0/1的点为 败/胜
点</p>
<p>考虑对于确定第 <span class="math inline">\(i\)</span>
层的根为某一节点 <span class="math inline">\(root\)</span> 之后</p>
<p>在某一个点下面接一个胜点，或者在一个胜点下面接一个点，对于胜败情况没有影响</p>
<p>在一个败点下面接一个败点，可能会导致一段连续祖先段的胜败翻转</p>
<p>考虑对于每个 <span class="math inline">\(u\)</span> 作为根求出：</p>
<p>1.没有接上下一层时的胜败情况 ： <span
class="math inline">\(dp_u\)</span></p>
<p>2.有多少个节点接上一个败点之后，会导致根的胜败情况翻转： <span
class="math inline">\(R_u\)</span></p>
<p>这是一个换根 <span class="math inline">\(dp\)</span> 问题</p>
<p>具体来说， <span class="math inline">\(R_u\)</span>
的值，根据子节点中败点的个数可以得到转移：</p>
<p>1.没有败点，那么就是所有子节点 <span class="math inline">\(R\)</span>
之和+自己</p>
<p>2.恰好有一个败点，那么就是败点的 <span
class="math inline">\(R\)</span></p>
<p>对此，每个点维护子节点中败点的个数，然后换根 <span
class="math inline">\(dp\)</span> 即可</p>
<p>求出每个 <span class="math inline">\(root\)</span>
的1，2后，可以用一个矩阵维护每层的转移，就不再赘述</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">    <span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line">ll m;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Mat</span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123; <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span> a); &#125;</span><br><span class="line">    Mat <span class="keyword">operator</span> * (<span class="type">const</span> Mat x) <span class="type">const</span> &#123;</span><br><span class="line">        Mat res; res.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>) <span class="built_in">rep</span>(j,<span class="number">0</span>,<span class="number">1</span>) <span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) res.a[i][k]=(res.a[i][k]+<span class="number">1ll</span>*a[i][j]*x.a[j][k])%P;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; Res,X;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> F[N],FC[N],FR[N],son[N][<span class="number">2</span>],SR[N];</span><br><span class="line"><span class="comment">// F子树胜败，FC子节点败点个数，FR子树翻转点个数，son存储两个儿子中的败点，SR存储儿子中的FR之和</span></span><br><span class="line"><span class="type">int</span> G[N],GC[N],GR[N];</span><br><span class="line"><span class="comment">// F,GC,GR是子树外的</span></span><br><span class="line"><span class="type">int</span> dp[N],R[N],fa[N];</span><br><span class="line"><span class="comment">// dp,R即上文所述</span></span><br><span class="line"></span><br><span class="line">vector &lt;<span class="type">int</span>&gt; E[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 子树处理</span></span><br><span class="line">    fa[u]=f;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> v:E[u]) <span class="keyword">if</span>(v!=f) &#123;</span><br><span class="line">        <span class="built_in">dfs1</span>(v,u);</span><br><span class="line">        FC[u]+=!F[v];</span><br><span class="line">        <span class="keyword">if</span>(!F[v]) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!son[u][<span class="number">0</span>]) son[u][<span class="number">0</span>]=v;</span><br><span class="line">            <span class="keyword">else</span> son[u][<span class="number">1</span>]=v;</span><br><span class="line">        &#125;</span><br><span class="line">        SR[u]+=FR[v];</span><br><span class="line">    &#125;</span><br><span class="line">    F[u]=FC[u]&gt;<span class="number">0</span>;</span><br><span class="line">    FR[u]=!F[u];</span><br><span class="line">    <span class="keyword">if</span>(FC[u]&lt;=<span class="number">1</span>) <span class="keyword">for</span>(<span class="type">int</span> v:E[u]) <span class="keyword">if</span>(v!=f &amp;&amp; F[u]!=F[v]) FR[u]+=FR[v];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//换根dp</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(f) GC[u]=G[u]=!G[f],GR[u]=GR[f]+!G[u];</span><br><span class="line">    <span class="keyword">else</span> GC[u]=G[u]=<span class="number">0</span>,GR[u]=<span class="number">1</span>;</span><br><span class="line">    dp[u]=F[u]|G[u];</span><br><span class="line">    <span class="keyword">if</span>(!dp[u]) R[u]=FR[u]+GR[u]<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(FC[u]+G[u]==<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(G[u]) R[u]=GR[u];</span><br><span class="line">        <span class="keyword">else</span> R[u]=FR[u];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> v:E[u]) <span class="keyword">if</span>(v!=f) &#123;</span><br><span class="line">        GC[u]=FC[u]-!F[v]+(f?!G[f]:<span class="number">0</span>);</span><br><span class="line">        G[u]=GC[u]&gt;<span class="number">0</span>;</span><br><span class="line">        GR[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(!G[u]) GR[u]=GR[f]+SR[u]-FR[v]+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(GC[u]==<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(son[u][<span class="number">0</span>] &amp;&amp; son[u][<span class="number">0</span>]!=v) GR[u]=FR[son[u][<span class="number">0</span>]];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(son[u][<span class="number">1</span>] &amp;&amp; son[u][<span class="number">1</span>]!=v) GR[u]=FR[son[u][<span class="number">1</span>]];</span><br><span class="line">            <span class="keyword">else</span> GR[u]=GR[f];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dfs2</span>(v,u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt[<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    n=<span class="built_in">rd</span>(),<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>,&amp;m);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">2</span>,n) &#123;</span><br><span class="line">        <span class="type">int</span> u=<span class="built_in">rd</span>(),v=<span class="built_in">rd</span>();</span><br><span class="line">        E[u].<span class="built_in">pb</span>(v),E[v].<span class="built_in">pb</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">0</span>),<span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 矩阵处理</span></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">        cnt[dp[i]]++;</span><br><span class="line">        X.a[<span class="number">1</span>][dp[i]]=(X.a[<span class="number">1</span>][dp[i]]+n)%P;</span><br><span class="line">        X.a[<span class="number">0</span>][!dp[i]]=(X.a[<span class="number">0</span>][!dp[i]]+R[i])%P;</span><br><span class="line">        X.a[<span class="number">0</span>][dp[i]]=(X.a[<span class="number">0</span>][dp[i]]+n-R[i])%P;</span><br><span class="line">    &#125;</span><br><span class="line">    m--,Res.a[<span class="number">0</span>][<span class="number">0</span>]=Res.a[<span class="number">1</span>][<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(m) &#123;</span><br><span class="line">        <span class="keyword">if</span>(m&amp;<span class="number">1</span>) Res=Res*X;</span><br><span class="line">        X=X*X;</span><br><span class="line">        m&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> x=(<span class="number">1ll</span>*Res.a[<span class="number">0</span>][<span class="number">0</span>]*cnt[<span class="number">0</span>]+<span class="number">1ll</span>*Res.a[<span class="number">1</span>][<span class="number">0</span>]*cnt[<span class="number">1</span>])%P;</span><br><span class="line">    <span class="type">int</span> y=(<span class="number">1ll</span>*Res.a[<span class="number">0</span>][<span class="number">1</span>]*cnt[<span class="number">0</span>]+<span class="number">1ll</span>*Res.a[<span class="number">1</span>][<span class="number">1</span>]*cnt[<span class="number">1</span>])%P;</span><br><span class="line">    <span class="comment">// 得到第一层败/胜 的个数，与第0层合并</span></span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(!dp[<span class="number">1</span>]) ans=<span class="number">1ll</span>*x*R[<span class="number">1</span>]%P;</span><br><span class="line">    <span class="keyword">else</span> ans=(<span class="number">1ll</span>*x*(n-R[<span class="number">1</span>])+<span class="number">1ll</span>*n*y)%P;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CROI%202016%20Day1%E3%80%8D%E4%BA%BA%E7%83%9F%E4%B9%8B%E5%B1%B1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CROI%202016%20Day1%E3%80%8D%E4%BA%BA%E7%83%9F%E4%B9%8B%E5%B1%B1/" class="post-title-link" itemprop="url">「ROI 2016 Day1」人烟之山</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 12:34:15" itemprop="dateCreated datePublished" datetime="2023-08-12T12:34:15+08:00">2023-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="roi-2016-day1人烟之山">「ROI 2016 Day1」人烟之山</h1>
<p>题目大意：</p>
<p>有 <span class="math inline">\(n\)</span> 段折线， <span
class="math inline">\(m\)</span> 个查询点 <span
class="math inline">\(A\)</span> （在折线以上），设折线拐点为 <span
class="math inline">\(X_i\)</span></p>
<p>求折线上在查询点投影两边最近的位置 <span
class="math inline">\(B\)</span> ，且直线 <span
class="math inline">\(AB\)</span> 与折线有非边缘的交点 (即从 <span
class="math inline">\(A\)</span> 点看过来会被折线遮住)</p>
<p>题目分析：</p>
<p><span class="math inline">\(B,C\)</span> 点满足的条件就是其旁边的直线
<span class="math inline">\(L\)</span> 在 <span
class="math inline">\(x_A\)</span> 处的值 <span
class="math inline">\(&gt;y_A\)</span></p>
<figure>
<img src="https://i.loli.net/2021/02/20/rguOJLKFG89Ipt2.png"
alt="Snipaste_2021-02-20_13-43-59.png" />
<figcaption
aria-hidden="true">Snipaste_2021-02-20_13-43-59.png</figcaption>
</figure>
<p>即找到最近的红色直线</p>
<h2 id="solution1-onlog-2n">Solution1 <span
class="math inline">\(O(n\log ^2n)\)</span></h2>
<p>以求左边为例</p>
<p>考虑二分答案，求出拐点为 <span class="math inline">\(X_i,i\ge
mid\)</span> 的直线中是否存在红色直线</p>
<p>也就是求最大值是否 <span class="math inline">\(&gt;y_A\)</span>
，维护直线最大值，并且区间查询，可以暴力可持久化李超树来解决</p>
<p>因为是求左边的，所以每条直线更新的范围 <span
class="math inline">\(&gt;X_i\)</span> ，李超树区间更新复杂度为 <span
class="math inline">\(O(\log ^2n)\)</span></p>
<p>李超树查询复杂度为 <span class="math inline">\(O(\log n)\)</span>
,加上二分，查询为 <span class="math inline">\(O(\log ^2n)\)</span></p>
<p><span class="math display">\[ \ \]</span></p>
<h3 id="solution2-onlog-n">Solution2 <span class="math inline">\(O(n\log
n)\)</span></h3>
<p>依然考虑二分，但是这次考虑在线段树上二分</p>
<p>对于所有的 <span class="math inline">\(X_i\)</span> 建立线段树，区间
<span class="math inline">\([L,R]\)</span> 内维护一个 <span
class="math inline">\(X_i,i\in [L,R]\)</span>
的上凸包，静态维护最大值</p>
<p>凸包可以归并子节点来建立，预处理复杂度为 <span
class="math inline">\(O(n\log n)\)</span></p>
<p>如果查询直接在凸包上二分，复杂度会增加一个 <span
class="math inline">\(\log n\)</span></p>
<p>解决方法是：将所有查询的 <span class="math inline">\(x_A\)</span>
排序，然后在凸包上查询时就可以做到线性</p>
<p>因此复杂度为 <span class="math inline">\(O(n\log n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> db;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="type">char</span> buf[<span class="number">200000</span>],*p1,*p2;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> getchar() (((p1==p2)&amp;&amp;(p2=(p1=buf)+fread(buf,1,200000,stdin))),*p1++)</span></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>; <span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) f|=IO==<span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">4e5</span>+<span class="number">10</span>,U=<span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,K[N],X[N],L[N],R[N];</span><br><span class="line">ll Y[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Que</span>&#123;</span><br><span class="line">	<span class="type">int</span> x,y,id;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Que __) <span class="type">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> x&lt;__.x;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; Q[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">	<span class="type">int</span> k; ll b;</span><br><span class="line">	ll <span class="keyword">operator</span> [] (<span class="type">const</span> ll x) <span class="type">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1ll</span>*k*x+b;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">friend</span> db <span class="title">Cross</span><span class="params">(Node x,Node y)</span></span>&#123; <span class="keyword">return</span> <span class="number">1.0</span>*(y.b-x.b)/(x.k-y.k); &#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Node __) <span class="type">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> k&lt;__.k||(k==__.k &amp;&amp; b&lt;__.b);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;; </span><br><span class="line">vector &lt;Node&gt; H[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">vector &lt;Node&gt; ::iterator P[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Build</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l==r) <span class="keyword">return</span> H[p].<span class="built_in">pb</span>((Node)&#123;K[l],Y[l]<span class="number">-1ll</span>*K[l]*X[l]&#125;),P[p]=H[p].<span class="built_in">begin</span>(),<span class="built_in">void</span>();</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">Build</span>(p&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">Build</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">	<span class="type">int</span> p1=<span class="number">0</span>,s1=H[p&lt;&lt;<span class="number">1</span>].<span class="built_in">size</span>(),p2=<span class="number">0</span>,s2=H[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].<span class="built_in">size</span>(),R=<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">auto</span> Ins=[&amp;](Node L) &#123;</span><br><span class="line">		<span class="keyword">while</span>(~R &amp;&amp; H[p][R].b&lt;=L.b) R--,H[p].<span class="built_in">pop_back</span>();</span><br><span class="line">		<span class="keyword">while</span>(R&gt;<span class="number">0</span> &amp;&amp; <span class="built_in">Cross</span>(H[p][R],H[p][R<span class="number">-1</span>])&gt;=<span class="built_in">Cross</span>(H[p][R],L)<span class="number">-1e-8</span>) R--,H[p].<span class="built_in">pop_back</span>();</span><br><span class="line">		H[p].<span class="built_in">pb</span>(L),R++;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">while</span>(p1&lt;s1 || p2&lt;s2) &#123;</span><br><span class="line">		<span class="keyword">if</span>(p1&lt;s1 &amp;&amp; (p2==s2 || H[p&lt;&lt;<span class="number">1</span>][p1]&lt;H[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][p2])) <span class="built_in">Ins</span>(H[p&lt;&lt;<span class="number">1</span>][p1++]);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">Ins</span>(H[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][p2++]);</span><br><span class="line">	&#125;</span><br><span class="line">	P[p]=H[p].<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Que</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(P[p]+<span class="number">1</span>!=H[p].<span class="built_in">end</span>() &amp;&amp; (*(P[p]+<span class="number">1</span>))[x]&gt;=(*P[p])[x]) P[p]++;</span><br><span class="line">	<span class="keyword">return</span> (*P[p])[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">QueL</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x,<span class="type">int</span> qx,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x&lt;l || <span class="built_in">Que</span>(p,qx)&lt;=y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(l==r) <span class="keyword">return</span> l;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,t;</span><br><span class="line">	<span class="keyword">if</span>(x&gt;mid &amp;&amp; (t=<span class="built_in">QueL</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,x,qx,y))) <span class="keyword">return</span> t;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">QueL</span>(p&lt;&lt;<span class="number">1</span>,l,mid,x,qx,y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">QueR</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x,<span class="type">int</span> qx,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x&gt;r || <span class="built_in">Que</span>(p,qx)&lt;=y) <span class="keyword">return</span> n+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(l==r) <span class="keyword">return</span> l;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,t;</span><br><span class="line">	<span class="keyword">if</span>(x&lt;=mid &amp;&amp; (t=<span class="built_in">QueR</span>(p&lt;&lt;<span class="number">1</span>,l,mid,x,qx,y))&lt;=n) <span class="keyword">return</span> t;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">QueR</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,x,qx,y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	n=<span class="built_in">rd</span>(),m=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		X[i]=X[i<span class="number">-1</span>]+<span class="built_in">rd</span>(),K[i]=<span class="built_in">rd</span>();</span><br><span class="line">		Y[i]=Y[i<span class="number">-1</span>]+<span class="number">1ll</span>*(X[i]-X[i<span class="number">-1</span>])*K[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) Q[i].x=<span class="built_in">rd</span>(),Q[i].y=<span class="built_in">rd</span>(),Q[i].id=i;</span><br><span class="line">	<span class="built_in">sort</span>(Q+<span class="number">1</span>,Q+m+<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">Build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">	<span class="type">int</span> p=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">		<span class="keyword">while</span>(p&lt;=n &amp;&amp; X[p]&lt;Q[i].x) p++;</span><br><span class="line">		L[Q[i].id]=<span class="built_in">QueL</span>(<span class="number">1</span>,<span class="number">1</span>,n,p<span class="number">-1</span>,Q[i].x,Q[i].y);</span><br><span class="line">		R[Q[i].id]=<span class="built_in">QueR</span>(<span class="number">1</span>,<span class="number">1</span>,n,p+(X[p]==Q[i].x),Q[i].x,Q[i].y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,X[L[i]],X[R[i]<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CROI%202016%20Day2%E3%80%8D%E4%BA%8C%E6%8C%87%E7%A6%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CROI%202016%20Day2%E3%80%8D%E4%BA%8C%E6%8C%87%E7%A6%85/" class="post-title-link" itemprop="url">「ROI 2016 Day2」二指禅</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 12:34:15" itemprop="dateCreated datePublished" datetime="2023-08-12T12:34:15+08:00">2023-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="roi-2016-day2二指禅">「ROI 2016 Day2」二指禅</h1>
<p>考虑对于每个点，有前缀和后缀两种转移</p>
<p>对于两种转移分别建立 <span class="math inline">\(\text{trie}\)</span>
树，并且维护最小权值，对于 <span class="math inline">\(dp_i\)</span>
，可以匹配一段后缀从 <span class="math inline">\(j&lt;i\)</span>
得到</p>
<p>也可以匹配一段前缀更新 <span class="math inline">\(j&gt;i\)</span>
，分别 <span class="math inline">\(O(n)\)</span>
枚举在两棵树上匹配即可完成转移</p>
<p>暴力转移复杂度为 <span class="math inline">\(O(n^2)\)</span></p>
<p>考虑优化转移效率，以 <span class="math inline">\(dp_i\)</span>
匹配某一段前缀向 <span class="math inline">\(dp_j(j&gt;i)\)</span>
转移为例</p>
<h3 id="part1-考虑求出最大的-j">Part1 考虑求出最大的 <span
class="math inline">\(j\)</span></h3>
<p>这个问题实际上就是求出每一个后缀的最大前缀匹配，也就是一个 <span
class="math inline">\(\text{exkmp}\)</span> 问题</p>
<p>而且这题是一个多模板串版本，并不能用 <span
class="math inline">\(\text{exkmp}\)</span> 解决</p>
<h4 id="solution-1">Solution 1</h4>
<p>是把所有前缀hash值取出来，放到 <span
class="math inline">\(\text{hash_table}\)</span> 里，然后二分长度+ <span
class="math inline">\(\text{hash_table}\)</span> 查询，复杂度为 <span
class="math inline">\(O(\log L)\)</span></p>
<h4 id="solution-2">Solution 2</h4>
<p>树剖+hash</p>
<p>对于 <span class="math inline">\(\text{trie}\)</span>
树树剖并且预处理hash值，重链上二分hash匹配，轻儿子暴力走，复杂度为 <span
class="math inline">\(O(\log ^2L)\)</span></p>
<p>如果使用全局平衡二叉树，可以做到单次查询复杂度为 <span
class="math inline">\(O(\log L)\)</span> ，常数应该远小于 <span
class="math inline">\(\text{hash_table}\)</span></p>
<p><span class="math display">\[ \ \]</span></p>
<p><span class="math display">\[ \ \]</span></p>
<h3 id="part2-在-j_max-基础上转移">Part2 在 <span
class="math inline">\(j_{max}\)</span> 基础上转移</h3>
<p>考虑先求出最大的 <span class="math inline">\(j\)</span>
之后，得到其对应的 <span class="math inline">\(\text{trie}\)</span>
树节点 <span class="math inline">\(u\)</span> ，在的祖先 <span
class="math inline">\(u\)</span> 中，每一种不同的权值更新一次</p>
<p>显然每一个祖先长度不同，因此最多只有 <span
class="math inline">\(O(\sqrt L)\)</span> 中不同的权值</p>
<p>因此可以for过去更新每一种权值，每次更新是一段区间，可以用树状数组维护</p>
<p>但是实际上极限情况下段极短，可以暴力枚举区间，所以并不是真的 <span
class="math inline">\(O(\sqrt L\log L)\)</span></p>
<p>比较容易说明复杂度的优化方法是：</p>
<p>采用分块 <span class="math inline">\(O(1)\)</span> 更新， <span
class="math inline">\(O(\sqrt L)\)</span> 查询</p>
<p>这样可以做到稳定 <span class="math inline">\(O(\sqrt L)\)</span>
完成转移</p>
<p><span class="math display">\[\ \]</span></p>
<p>因此预处理复杂度为 <span class="math inline">\(O(m\log L-m\log
^2L)\)</span> ，转移复杂度为 <span class="math inline">\(O(m\sqrt
L-m\sqrt L\log L)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">3e5</span>+<span class="number">10</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>,D=<span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="type">char</span> T[N];</span><br><span class="line"><span class="type">int</span> Pow1[N],Pow2[N];</span><br><span class="line"><span class="type">int</span> S[N];</span><br><span class="line"><span class="type">const</span> ll K1=<span class="number">19260817</span>,P1=<span class="number">114514</span>;</span><br><span class="line"><span class="type">const</span> ll K2=<span class="number">1e9</span>+<span class="number">13</span>,P2=<span class="number">1919810</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Solver</span>&#123;</span><br><span class="line">    <span class="type">int</span> S[N];</span><br><span class="line">    <span class="type">int</span> trie[N][<span class="number">2</span>],s[N],cnt,H1[N],H2[N];</span><br><span class="line">    <span class="type">int</span> fa[N],top[N],sz[N],h1[N],h2[N],son[N],lst[N],bot[N],L[N],id[N],dfn,dep[N];</span><br><span class="line">    <span class="comment">// lst[i] 记录祖先中第一个s[f]!=s[i]的节点</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span>&#123;</span><br><span class="line">        sz[u]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(s[u]==s[fa[u]]) lst[u]=lst[fa[u]];</span><br><span class="line">        <span class="keyword">else</span> lst[u]=fa[u];</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> v=trie[u][i];</span><br><span class="line">            <span class="keyword">if</span>(!v) <span class="keyword">continue</span>;</span><br><span class="line">            fa[v]=u,dep[v]=dep[u]+<span class="number">1</span>;</span><br><span class="line">            h1[v]=(h1[u]*K1+i+<span class="number">1</span>)%P1;</span><br><span class="line">            h2[v]=(h2[u]*K2+i+<span class="number">1</span>)%P2;</span><br><span class="line">            <span class="built_in">dfs</span>(v);</span><br><span class="line">            sz[u]+=sz[v];</span><br><span class="line">            <span class="keyword">if</span>(son[u]==<span class="number">0</span> || sz[v]&gt;sz[son[u]]) son[u]=v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> t)</span></span>&#123;</span><br><span class="line">        id[L[u]=++dfn]=u;</span><br><span class="line">        bot[top[u]=t]=u; <span class="keyword">if</span>(son[u]) <span class="built_in">dfs</span>(son[u],t);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> v:trie[u]) <span class="keyword">if</span>(v&amp;&amp;v!=son[u]) <span class="built_in">dfs</span>(v,v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Ins</span><span class="params">(<span class="type">char</span> *T,<span class="type">int</span> l,<span class="type">int</span> w)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> now=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,l) &#123;</span><br><span class="line">            <span class="type">int</span> c=T[i]-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(!trie[now][c]) s[trie[now][c]=++cnt]=<span class="number">2e9</span>;</span><br><span class="line">            <span class="built_in">cmin</span>(s[now=trie[now][c]],w);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">            H1[i]=(H1[i<span class="number">-1</span>]*K1+S[i]+<span class="number">1</span>)%P1;</span><br><span class="line">            H2[i]=(H2[i<span class="number">-1</span>]*K2+S[i]+<span class="number">1</span>)%P2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">0</span>),<span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">Que</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 求i 的最长匹配位置</span></span><br><span class="line">        <span class="type">int</span> u=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&lt;=n) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!trie[u][S[i]]) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span>(trie[u][S[i]]!=son[u])&#123; u=trie[u][S[i++]]; <span class="keyword">continue</span>; &#125;</span><br><span class="line">            <span class="type">int</span> l=<span class="number">1</span>,r=<span class="built_in">min</span>(n-i+<span class="number">1</span>,dep[bot[top[u]]]-dep[u]),res=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">                <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>( (H1[i+mid<span class="number">-1</span>]<span class="number">-1ll</span>*H1[i<span class="number">-1</span>]*Pow1[mid]%P1+P1)%P1 ==  (h1[id[L[u]+mid]]<span class="number">-1ll</span>*h1[u]*Pow1[mid]%P1+P1)%P1 &amp;&amp;</span><br><span class="line">                        (H2[i+mid<span class="number">-1</span>]<span class="number">-1ll</span>*H2[i<span class="number">-1</span>]*Pow2[mid]%P2+P2)%P2 == (h2[id[L[u]+mid]]<span class="number">-1ll</span>*h2[u]*Pow2[mid]%P2+P2)%P2)</span><br><span class="line">                    l=mid+<span class="number">1</span>,res=mid;</span><br><span class="line">                <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            i+=res,u=id[L[u]+res];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; X,Y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BIT</span>&#123;</span><br><span class="line">    ll s[N];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(s,<span class="number">127</span>,<span class="keyword">sizeof</span> s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> p,ll x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(p) <span class="built_in">cmin</span>(s[p],x),p-=p&amp;-p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">Que</span><span class="params">(<span class="type">int</span> p)</span></span>&#123;</span><br><span class="line">        ll res=<span class="number">1e18</span>;</span><br><span class="line">        <span class="keyword">while</span>(p&lt;=n) <span class="built_in">cmin</span>(res,s[p]),p+=p&amp;-p;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; TX,TY;</span><br><span class="line">ll dp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">rep</span>(i,Pow1[<span class="number">0</span>]=Pow2[<span class="number">0</span>]=<span class="number">1</span>,N<span class="number">-1</span>) &#123;</span><br><span class="line">        Pow1[i]=Pow1[i<span class="number">-1</span>]*K1%P1;</span><br><span class="line">        Pow2[i]=Pow2[i<span class="number">-1</span>]*K2%P2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%*d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">scanf</span>(<span class="string">&quot;%1d&quot;</span>,S+i),X.S[i]=Y.S[n-i+<span class="number">1</span>]=S[i];</span><br><span class="line">    <span class="built_in">rep</span>(t,<span class="number">1</span>,m) &#123;</span><br><span class="line">        <span class="type">int</span> w,l; <span class="built_in">scanf</span>(<span class="string">&quot;%d%s&quot;</span>,&amp;w,T+<span class="number">1</span>),l=<span class="built_in">strlen</span>(T+<span class="number">1</span>);</span><br><span class="line">        X.<span class="built_in">Ins</span>(T,l,w),<span class="built_in">reverse</span>(T+<span class="number">1</span>,T+l+<span class="number">1</span>),Y.<span class="built_in">Ins</span>(T,l,w);</span><br><span class="line">    &#125;</span><br><span class="line">    X.<span class="built_in">Init</span>(),Y.<span class="built_in">Init</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n) dp[i]=<span class="number">1e18</span>;</span><br><span class="line">    TX.<span class="built_in">Init</span>(),TY.<span class="built_in">Init</span>();</span><br><span class="line">    TY.<span class="built_in">Add</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">0</span>,n) &#123;</span><br><span class="line">        <span class="comment">// 暴力维护转移</span></span><br><span class="line">        <span class="keyword">if</span>(i) &#123;</span><br><span class="line">            <span class="built_in">cmin</span>(dp[i],TX.<span class="built_in">Que</span>(i));</span><br><span class="line">            <span class="type">int</span> u=Y.<span class="built_in">Que</span>(n-i+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">while</span>(u) &#123;</span><br><span class="line">                <span class="type">int</span> l=Y.dep[Y.lst[u]]+<span class="number">1</span>,r=Y.dep[u];</span><br><span class="line">                <span class="keyword">if</span>(r-l+<span class="number">1</span>&lt;=D) <span class="built_in">rep</span>(j,l,r) <span class="built_in">cmin</span>(dp[i],dp[i-j]+Y.s[u]);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">cmin</span>(dp[i],TY.<span class="built_in">Que</span>(i-r+<span class="number">1</span>)+Y.s[u]);</span><br><span class="line">                u=Y.lst[u];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        TY.<span class="built_in">Add</span>(i+<span class="number">1</span>,dp[i]);</span><br><span class="line">        <span class="keyword">if</span>(i==n||dp[i]==<span class="number">1e18</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="type">int</span> u=X.<span class="built_in">Que</span>(i+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(u) &#123;</span><br><span class="line">            <span class="type">int</span> l=X.dep[X.lst[u]]+<span class="number">1</span>,r=X.dep[u];</span><br><span class="line">            <span class="keyword">if</span>(r-l+<span class="number">1</span>&lt;=D) <span class="built_in">rep</span>(j,l,r) <span class="built_in">cmin</span>(dp[i+j],dp[i]+X.s[u]);</span><br><span class="line">            <span class="keyword">else</span> TX.<span class="built_in">Add</span>(i+r,dp[i]+X.s[u]);</span><br><span class="line">            u=X.lst[u];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,dp[n]&lt;<span class="number">1e18</span>?dp[n]:<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021.1%20Platinum%E3%80%8DSum%20of%20Distances/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021.1%20Platinum%E3%80%8DSum%20of%20Distances/" class="post-title-link" itemprop="url">「USACO 2021.1 Platinum」Sum of Distances</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 12:34:15" itemprop="dateCreated datePublished" datetime="2023-08-12T12:34:15+08:00">2023-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="usaco-2021.1-platinumsum-of-distances">「USACO 2021.1
Platinum」Sum of Distances</h1>
<p>设在 <span class="math inline">\(G_i\)</span> 中 <span
class="math inline">\(j_i\)</span> 点可行的距离集合为 <span
class="math inline">\(D_{j_i}\)</span></p>
<p>注意到一个点的 <span
class="math inline">\((j_1,j_2,\ldots,j_k)\)</span> 的 <span
class="math inline">\(dis\)</span> 可以用如下方式确定</p>
<p><span class="math inline">\(\displaystyle
dis(j_1,j_2,\ldots,j_k)=\min\{\bigcap D_{j_i}\}\)</span></p>
<p>而 <span class="math inline">\(D_{j_i}\)</span>
有一个简单的描述方法：</p>
<p>求出奇数和偶数的最小值，然后再最小值往上+ <span
class="math inline">\(2k\)</span> 的部分均存在（不停来回）</p>
<p>这样我们用两个值 <span
class="math inline">\(odd_{j_i},even_{j_i}\)</span> 描述了 <span
class="math inline">\(D_{j_i}\)</span></p>
<p>同时也容易得到 <span class="math inline">\(\displaystyle
dis(j_1,j_2,\ldots,j_k)=\min\{\max\{odd_{j_i}\},\max\{even_{j_i}\}\}\)</span></p>
<p>也就是说要在奇偶的 <span class="math inline">\(\max\)</span> 之间取
<span class="math inline">\(\min\)</span></p>
<p>考虑 <span class="math inline">\(odd_{j_i},even_{j_i}\)</span> 是
<span class="math inline">\(O(N_i)\)</span>
级别的，可以暴力合并，但是无法处理外层的 <span
class="math inline">\(\min\)</span> ，因此考虑用一个简单的 <span
class="math inline">\(\text{minmax}\)</span> 容斥解决</p>
<p><span class="math inline">\(\min\{a,b\}=a+b-\max\{a,b\}\)</span></p>
<p>这样就只有 <span class="math inline">\(\max\)</span>
要计算了，用简单的前缀和优化取 <span class="math inline">\(\max\)</span>
操作</p>
<p>注意要按照 <span class="math inline">\(N_i\)</span>
排序之后依次合并每一个 <span class="math inline">\(G_i\)</span>
保证复杂度</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> C[N],R[N],D[N][<span class="number">2</span>],I[N],M[N],S[N*<span class="number">2</span>];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; G[N];</span><br><span class="line"><span class="type">int</span> dis[N][<span class="number">2</span>],U,F[N],H[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Solve</span><span class="params">(<span class="type">int</span> S)</span></span>&#123;</span><br><span class="line">	F[U=<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(k,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="type">int</span> i=I[k];</span><br><span class="line">		<span class="built_in">rep</span>(j,U+<span class="number">1</span>,M[i]) F[j]=F[j<span class="number">-1</span>];</span><br><span class="line">		<span class="built_in">cmax</span>(U,M[i]);</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">0</span>,U) H[j]=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(j,R[i<span class="number">-1</span>]+<span class="number">1</span>,R[i]) &#123;</span><br><span class="line">			<span class="type">int</span> d=<span class="number">-1</span>;</span><br><span class="line">			<span class="keyword">if</span>(S&amp;<span class="number">1</span>) <span class="built_in">cmax</span>(d,D[j][<span class="number">0</span>]);</span><br><span class="line">			<span class="keyword">if</span>(S&amp;<span class="number">2</span>) <span class="built_in">cmax</span>(d,D[j][<span class="number">1</span>]);</span><br><span class="line">			<span class="keyword">if</span>(d==P) <span class="keyword">continue</span>;</span><br><span class="line">			H[d]++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,U) H[j]+=H[j<span class="number">-1</span>];</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">0</span>,U) F[j]=<span class="number">1ll</span>*F[j]*H[j]%P;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">drep</span>(j,U,<span class="number">1</span>) F[j]-=F[j<span class="number">-1</span>],<span class="built_in">Mod2</span>(F[j]);</span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(j,<span class="number">0</span>,U) ans=(ans+<span class="number">1ll</span>*j*F[j])%P;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	n=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		I[i]=i,C[i]=<span class="built_in">rd</span>(),R[i]=R[i<span class="number">-1</span>]+C[i];</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,C[i]) G[j].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,<span class="built_in">rd</span>())&#123;</span><br><span class="line">			<span class="type">int</span> u=<span class="built_in">rd</span>(),v=<span class="built_in">rd</span>();</span><br><span class="line">			G[u].<span class="built_in">pb</span>(v),G[v].<span class="built_in">pb</span>(u);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,C[i]) dis[j][<span class="number">0</span>]=dis[j][<span class="number">1</span>]=P;</span><br><span class="line">		dis[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">		<span class="type">static</span> queue &lt;Pii&gt; que; que.<span class="built_in">push</span>(<span class="built_in">mp</span>(<span class="number">1</span>,<span class="number">0</span>));</span><br><span class="line">		<span class="keyword">while</span>(!que.<span class="built_in">empty</span>())&#123;</span><br><span class="line">			<span class="type">int</span> u=que.<span class="built_in">front</span>().first,d=que.<span class="built_in">front</span>().second; que.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="built_in">cmax</span>(M[i],dis[u][d]);</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> v:G[u]) <span class="keyword">if</span>(dis[v][!d]&gt;dis[u][d]+<span class="number">1</span>) dis[v][!d]=dis[u][d]+<span class="number">1</span>,que.<span class="built_in">push</span>(<span class="built_in">mp</span>(v,!d));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,C[i]) &#123;</span><br><span class="line">			<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) &#123;</span><br><span class="line">				D[R[i<span class="number">-1</span>]+j][k]=dis[j][k];</span><br><span class="line">				<span class="keyword">if</span>(dis[j][k]!=P) <span class="built_in">cmax</span>(M[i],dis[j][k]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(I+<span class="number">1</span>,I+n+<span class="number">1</span>,[&amp;](<span class="type">int</span> x,<span class="type">int</span> y)&#123; <span class="keyword">return</span> C[x]&lt;C[y]; &#125;);</span><br><span class="line">	<span class="type">int</span> ans=((<span class="built_in">Solve</span>(<span class="number">1</span>)+<span class="built_in">Solve</span>(<span class="number">2</span>)-<span class="built_in">Solve</span>(<span class="number">3</span>))%P+P)%P;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">orangejuice</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
