<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"compilationfail.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="orangejuice&#39;s blog">
<meta property="og:url" content="https://compilationfail.github.io/page/21/index.html">
<meta property="og:site_name" content="orangejuice&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="orangejuice">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://compilationfail.github.io/page/21/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/21/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>orangejuice's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
  <script type="text/javascript">
    const bgc = 15;
    const bgu = "/images/bg";
    function getcookie() {
      // console.log("get", document.cookie);
      const s = document.cookie;
      return s.split('; ').find((row)=>row.startsWith("bgid="))?.split("=")[1];
    }
    function set_bg(index) {
      console.log("set", index);
      document.cookie = `bgid=${index}; path=/`;
      // console.log(document.cookie);
      url = `/images/bg${index}.jpg`;
      document.body.style=`background-image:url(${url});background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:fixed;`;
    }
    var index = parseInt(getcookie());
    if(isNaN(index) || index < 0 || index >= bgc) index = -1;
    window.onload = () => { set_bg(index) };
  </script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">orangejuice's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">挂了请务必叫我</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="orangejuice"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">orangejuice</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">269</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://twitter.com/ChenJerson" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;ChenJerson" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/3950662532/profile?rightmod=1&wvr=6&mod=personinfo" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;3950662532&#x2F;profile?rightmod&#x3D;1&amp;wvr&#x3D;6&amp;mod&#x3D;personinfo" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/CompilationFail" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CompilationFail" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/profiles/76561198969516062/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198969516062&#x2F;" rel="noopener me" target="_blank"><i class="fab fa-steam fa-fw"></i>Steam</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.last.fm/user/chasedeath" title="Lastfm → https:&#x2F;&#x2F;www.last.fm&#x2F;user&#x2F;chasedeath" rel="noopener me" target="_blank"><i class="fab fa-lastfm-square fa-fw"></i>Lastfm</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://open.spotify.com/user/mgxnlznf9dli6bm4k3sp0iuwz" title="Spotify → https:&#x2F;&#x2F;open.spotify.com&#x2F;user&#x2F;mgxnlznf9dli6bm4k3sp0iuwz" rel="noopener me" target="_blank"><i class="fab fa-spotify fa-fw"></i>Spotify</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/others/%E3%80%8C%E4%BD%99%E5%A7%9A%E4%B8%AD%E5%AD%A6%202019%20%E8%81%94%E6%B5%8B%20Day%204%E3%80%8D%E9%9A%8F%E6%9C%BA%E9%99%A4%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/others/%E3%80%8C%E4%BD%99%E5%A7%9A%E4%B8%AD%E5%AD%A6%202019%20%E8%81%94%E6%B5%8B%20Day%204%E3%80%8D%E9%9A%8F%E6%9C%BA%E9%99%A4%E6%B3%95/" class="post-title-link" itemprop="url">「余姚中学 2019 联测 Day 4」随机除法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="余姚中学-2019-联测-day-4随机除法">「余姚中学 2019 联测 Day
4」随机除法</h1>
<p>好题，难就难在转移的高位前缀和</p>
<p>首先是一个浅显的 <span class="math inline">\(\text{dp}\)</span>
状态，令 <span class="math inline">\(n=\Pi prime_i^{c_i}\)</span></p>
<p>则状态只跟 <span class="math inline">\(\{c_i\}\)</span>
有关，这是一个可重集合，强制定义 <span class="math inline">\(c_i\ge
c_{i-1}\)</span> 最小表示出所有不同状态</p>
<p>搜索一下 <span class="math inline">\(\text{dp}\)</span>
状态，发现只有 <span class="math inline">\(170000\)</span>
左右的状态数</p>
<p>直接枚举因数转移复杂度显然是升天的，直接枚举子集状态转移复杂度也很高，并且不好确定系数</p>
<p>所以用一个高位前缀和处理优化<strong>枚举因数的转移</strong></p>
<p>再说一遍，是高位前缀和<strong>枚举因数的转移</strong>，不同的因数可能对应同一个状态</p>
<p>常见的高位前缀和是 <span
class="math inline">\(dp_{i,S}=dp_{i-1,S}+dp_{i,S-\{S_i\}}\)</span></p>
<p>转移具有单调性，对于状态排序之后，定义辅助数组 <span
class="math inline">\(dp_{i,j}\)</span> 表示对于 <span
class="math inline">\(i\)</span> 这个状态</p>
<p>它的子集(注意这个子集是未排序的)中和它不同的最低位置 <span
class="math inline">\(\ge j\)</span> 的总和</p>
<p>计算高位前缀和时，每次转移只会对于一个位置改变</p>
<p>枚举状态时，取得位置是 <span class="math inline">\(j\)</span>
，调用时需要排序</p>
<p>而排完序之后 <span class="math inline">\(j\)</span>
可能会后移，所以需要定义成 <span class="math inline">\(\ge j\)</span>
的，否则会算多</p>
<p>比如转移 <span class="math inline">\((1,1,1)\leftarrow
(0,1,1),(1,0,1),(1,1,0)\)</span></p>
<p>如果定义成 <span class="math inline">\(\le j\)</span>
的状态，三种状态转移之后都变成 <span
class="math inline">\((1,1,0)\)</span></p>
<p>原先在这个状态里的三个位置编号是 <span
class="math inline">\((0,1,2)\)</span></p>
<p>如果都去 <span class="math inline">\((1,1,0)\)</span>
这个状态里转移过来，原先 <span class="math inline">\((0,1,2)\)</span>
对应的下标位置改变，变成</p>
<p><span class="math inline">\((1,2,0)\)</span></p>
<p><span class="math inline">\((0,2,1)\)</span></p>
<p><span class="math inline">\((0,1,2)\)</span></p>
<p>我们访问的时候访问的应该是子状态中不同位置 <span
class="math inline">\(\le j\)</span> 的总和</p>
<p>而从这个下标改变的状态里转移过来时，原先 <span
class="math inline">\(&gt;j\)</span> 的下标被移移动进 <span
class="math inline">\(\le j\)</span> 的范围</p>
<p>再转移就错了</p>
<p>所以正确定义状态之后就可以高位前缀和了</p>
<p>存储和访问状态可以用 <span
class="math inline">\(\text{Hash,Trie,int128}\)</span> 三种方法存储，
<span class="math inline">\(\text{int128}\)</span> 真香啊</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> __int128 Node;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">180000</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll k=P<span class="number">-2</span>)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(;k;k&gt;&gt;=<span class="number">1</span>,x=x*x%P) <span class="keyword">if</span>(k&amp;<span class="number">1</span>) res=res*x%P;</span><br><span class="line">	<span class="keyword">return</span> res; </span><br><span class="line">&#125;</span><br><span class="line">Node Max,st[N];</span><br><span class="line"><span class="type">int</span> m,a[<span class="number">100</span>],cnt,dp[N][<span class="number">20</span>],F[N],pri[]=&#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">67</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">79</span>&#125;;</span><br><span class="line"><span class="type">char</span> str[<span class="number">30</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Find</span><span class="params">(Node s)</span></span>&#123; <span class="keyword">return</span> <span class="built_in">lower_bound</span>(st+<span class="number">1</span>,st+cnt+<span class="number">1</span>,s)-st; &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Load</span><span class="params">(Node s)</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">20</span>) a[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">20</span> &amp;&amp; s&gt;<span class="number">1</span>; ++i) <span class="keyword">while</span>(s%pri[i]==<span class="number">0</span>) s=s/pri[i],a[i]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> lst,Node s)</span> </span>&#123; </span><br><span class="line">	st[++cnt]=s;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,lst) &#123;</span><br><span class="line">		<span class="keyword">if</span>((s*=pri[p])&gt;Max) <span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">dfs</span>(p+<span class="number">1</span>,i,s);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;div.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;div.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	Max=<span class="number">1e12</span>,Max=Max*Max;</span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">100</span>,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">fprintf</span>(stderr,<span class="string">&quot;States Number = %d\n&quot;</span>,cnt);</span><br><span class="line">	<span class="built_in">sort</span>(st+<span class="number">1</span>,st+cnt+<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">2</span>,cnt) &#123;</span><br><span class="line">		Node now; <span class="built_in">Load</span>(now=st[i]);</span><br><span class="line">		<span class="type">int</span> c=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,<span class="number">18</span>) c=<span class="number">1ll</span>*c*(a[i]+<span class="number">1</span>)%P;</span><br><span class="line">		<span class="built_in">drep</span>(j,<span class="number">18</span>,<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(!a[j]) dp[i][j]=dp[i][j+<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">int</span> k=j;</span><br><span class="line">				<span class="keyword">while</span>(k&gt;<span class="number">1</span> &amp;&amp; a[k<span class="number">-1</span>]==a[k]) --k;</span><br><span class="line">				<span class="type">int</span> p=<span class="built_in">Find</span>(now/pri[j]);</span><br><span class="line">				<span class="built_in">drep</span>(d,j,k) &#123;</span><br><span class="line">					dp[i][d]=dp[i][d+<span class="number">1</span>]+dp[p][d];</span><br><span class="line">					<span class="built_in">Mod1</span>(dp[i][d]);</span><br><span class="line">				&#125;</span><br><span class="line">				j=k;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		F[i]=(dp[i][<span class="number">1</span>]+c)*<span class="built_in">qpow</span>(c<span class="number">-1</span>)%P;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,<span class="number">18</span>) dp[i][j]+=F[i],<span class="built_in">Mod1</span>(dp[i][j]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>,str,&amp;m)) &#123;</span><br><span class="line">		Node n=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;str[i];++i) n=n*<span class="number">10</span>+(str[i]-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">			<span class="type">int</span> x;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x); a[i]=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span>(n%x==<span class="number">0</span>) n=n/x,a[i]++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">sort</span>(a+<span class="number">1</span>,a+m+<span class="number">1</span>,greater &lt;<span class="type">int</span>&gt; ());</span><br><span class="line">		n=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">rep</span>(j,<span class="number">1</span>,a[i]) n=n*pri[i];</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,F[<span class="built_in">Find</span>(n)]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/others/%E3%80%8C%E4%BD%99%E5%A7%9A%E4%B8%AD%E5%AD%A6%202019%20%E8%81%94%E6%B5%8B%20Day%206%E3%80%8D%E8%A7%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/others/%E3%80%8C%E4%BD%99%E5%A7%9A%E4%B8%AD%E5%AD%A6%202019%20%E8%81%94%E6%B5%8B%20Day%206%E3%80%8D%E8%A7%A3%E7%A0%81/" class="post-title-link" itemprop="url">「余姚中学 2019 联测 Day 6」解码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="余姚中学-2019-联测-day-6解码">「余姚中学 2019 联测 Day
6」解码</h1>
<p>先不考虑求 <span class="math inline">\(p,q\)</span></p>
<p>根据人人都知道的欧拉定理 <span class="math inline">\(x^c\equiv
x^{c\mod \varphi(n)} (\mod n)\)</span></p>
<p>那么 <span class="math inline">\(\varphi(n)=(p-1)(q-1)\)</span> ，而
<span class="math inline">\((c,\varphi(n))=1\)</span></p>
<p>所以求出 <span class="math inline">\(\frac{1}{c} \pmod
{\varphi(n)}\)</span></p>
<p>带入原来的式子 <span class="math inline">\((x^c)^{\frac{1}{c}\pmod
{\varphi(n)}}\equiv x^1\pmod n\)</span></p>
<p>即 <span class="math inline">\(x=m^{\frac{1}{c}\pmod
{\varphi(n)}}\pmod n\)</span></p>
<p>求逆最好用扩展欧几里得算法，复杂度为 <span
class="math inline">\(O(\log n)\)</span></p>
<p>那么直接快速幂即可，但是如果快速幂套快速乘复杂度为 <span
class="math inline">\(O(\log ^2)\)</span>
，实际常数极大，很有可能超时(如果用long double O(1)快速乘另谈。。。)</p>
<p>由于知道 <span class="math inline">\(p,q\)</span> 可以分别求出 <span
class="math inline">\(m^{\frac{1}{c}\pmod {\varphi(n)}}\pmod p\)</span>
， <span class="math inline">\(m^{\frac{1}{c}\pmod {\varphi(n)}}\pmod
q\)</span></p>
<p>然后中国剩余定理合并，即 <span class="math inline">\(O(\log
n)\)</span></p>
<hr />
<p>现在问题是求 <span class="math inline">\(p,q\)</span></p>
<p>对于前3档分，由于素数密度是 <span class="math inline">\(O(\log
n)\)</span> 的，所以 <span class="math inline">\(\sqrt n -p\)</span>
期望只有 <span class="math inline">\(\log n\)</span></p>
<p>而对于最后一档分，考虑更好表示，枚举 <span
class="math inline">\(p+q\)</span> 解出答案，发现</p>
<p><span class="math inline">\(4n\leq (p+q)^2= (q-p)^2+4pq\leq
\lambda^2+4n\)</span></p>
<p>即 <span class="math inline">\(2\sqrt{n}\leq (p+q)\le
\sqrt{\lambda^2+4n}\)</span></p>
<p>由于 <span class="math inline">\(n\ge p^2\ge 10^{18},\lambda \leq
3\cdot 10^5\)</span> ，这个范围实际非常非常非常非常小，大概只有 <span
class="math inline">\(22\)</span></p>
<p>tips:实际上 <span class="math inline">\(4n\)</span> 可能爆long
long</p>
<p>枚举 <span class="math inline">\(p+q\)</span> 之后， <span
class="math inline">\(O(1)\)</span> 解出 <span
class="math inline">\(p,q\)</span> 即可</p>
<p>竟然有人问怎么解 <span class="math inline">\(p,q\)</span>
，我震惊了</p>
<p><span class="math inline">\(q-p=\sqrt{(p+q)^2-4n}\)</span>
，然后判一下是不是整数就好了</p>
<p>写的时候害怕sqrt炸精度，很多奇怪的语句请忽略</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ull;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; <span class="keyword">if</span>(a&gt;b) a=b; &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; <span class="keyword">if</span>(a&lt;b) a=b; &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T</span>=<span class="type">int</span>&gt; <span class="function">T <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	T s=<span class="number">0</span>; <span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">3e5</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">ll n,m,c;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qmul</span><span class="params">(ll x,ll k,ll P)</span></span>&#123;</span><br><span class="line">	k=(k%P+P)%P;</span><br><span class="line">	ll res=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(;k;k&gt;&gt;=<span class="number">1</span>,x=(x+x)%P) <span class="keyword">if</span>(k&amp;<span class="number">1</span>) res=(res+x)%P;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll k,ll P)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(;k;k&gt;&gt;=<span class="number">1</span>,x=x*x%P) <span class="keyword">if</span>(k&amp;<span class="number">1</span>) res=res*x%P;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Exgcd</span><span class="params">(ll a,ll b,ll &amp;x,ll &amp;y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(b==<span class="number">0</span>) x=<span class="number">1</span>,y=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">Exgcd</span>(b,a%b,y,x),y-=a/b*x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Inv</span><span class="params">(ll a,ll P)</span></span>&#123;</span><br><span class="line">	ll x,y;</span><br><span class="line">	<span class="built_in">Exgcd</span>(a,P,x,y);</span><br><span class="line">	<span class="keyword">return</span> (x%P+P)%P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;rsa.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;rsa.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">rep</span>(kase,<span class="number">1</span>,<span class="built_in">rd</span>()) &#123;</span><br><span class="line">		n=<span class="built_in">rd</span>&lt;ll&gt;(),m=<span class="built_in">rd</span>&lt;ll&gt;(),c=<span class="built_in">rd</span>&lt;ll&gt;();</span><br><span class="line">		ll T=<span class="built_in">sqrt</span>(n),p=<span class="number">-1</span>,q;</span><br><span class="line">		<span class="keyword">for</span>(ll i=T;i&gt;=T<span class="number">-100</span>;--i) <span class="keyword">if</span>(n%i==<span class="number">0</span>) &#123;</span><br><span class="line">			p=i,q=n/i;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(p==<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="comment">// 2*sqrt(n) &lt;= p+q &lt;= sqrt(4*n+lambda * lambda)</span></span><br><span class="line">			<span class="comment">//ll R=ceil(sqrt((long double)4*n+9e10)+1);</span></span><br><span class="line">			ll L=<span class="built_in">ceil</span>(<span class="built_in">sqrt</span>(n+<span class="number">0.5</span>));</span><br><span class="line">			<span class="keyword">if</span>((L<span class="number">-1</span>)*(L<span class="number">-1</span>)&gt;=n) L--;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span>(ll x=<span class="number">2</span>*L;;++x) &#123;</span><br><span class="line">				ull y=x*x<span class="number">-4</span>*(ull)n; </span><br><span class="line">				<span class="comment">// x=p+q</span></span><br><span class="line">				<span class="comment">// t=q-p</span></span><br><span class="line">				ull t=<span class="built_in">sqrt</span>(y);</span><br><span class="line">				<span class="keyword">if</span>((t+<span class="number">1</span>)*(t+<span class="number">1</span>)==y) t++;</span><br><span class="line">				<span class="keyword">if</span>((t<span class="number">-1</span>)*(t<span class="number">-1</span>)==y) t--;</span><br><span class="line">				<span class="keyword">if</span>(t*t==y) &#123;</span><br><span class="line">					p=(x-t)/<span class="number">2</span>;</span><br><span class="line">					q=(x+t)/<span class="number">2</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ll t=<span class="built_in">Inv</span>(c,(p<span class="number">-1</span>)*(q<span class="number">-1</span>));</span><br><span class="line">		<span class="comment">// t= 1/c (mod phi(n))</span></span><br><span class="line">		 </span><br><span class="line">		ll k1=p,b1=<span class="built_in">qpow</span>(m%p,t,p);</span><br><span class="line">		ll k2=q,b2=<span class="built_in">qpow</span>(m%q,t,q);</span><br><span class="line">		<span class="comment">// k1 x + b1 = k2 y + b2</span></span><br><span class="line">		<span class="comment">// k1 x = b2-b1 (mod k2)</span></span><br><span class="line">		<span class="comment">// x= (b2-b1)/k1;</span></span><br><span class="line">		<span class="comment">// x&#x27; = (b2-b1)/k1 (mod k2) * k1 + b1</span></span><br><span class="line">		ll inv=<span class="built_in">qpow</span>(k1,k2<span class="number">-2</span>,k2);</span><br><span class="line">		b1=(b2-b1)%k2*inv%k2  * k1+b1;</span><br><span class="line">		k1*=k2;</span><br><span class="line">		b1=(b1%k1+k1)%k1;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,b1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/others/%E3%80%8C%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD%202017%E3%80%8D%E5%B0%8F%20Y%20%E5%92%8C%E4%BA%8C%E5%8F%89%E6%A0%91%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/others/%E3%80%8C%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD%202017%E3%80%8D%E5%B0%8F%20Y%20%E5%92%8C%E4%BA%8C%E5%8F%89%E6%A0%91%20/" class="post-title-link" itemprop="url">「清华集训 2017」小 Y 和二叉树</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="清华集训-2017小-y-和二叉树">「清华集训 2017」小 Y 和二叉树</h1>
<p>原题数据好像没有卡这个情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">1 2</span><br><span class="line">2 1 3</span><br><span class="line">3 2 4 5</span><br><span class="line">1 3</span><br><span class="line">1 3</span><br></pre></td></tr></table></figure>
<p>输出是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 3 4 5</span><br></pre></td></tr></table></figure>
<p>首先考虑一个 <span class="math inline">\(O(n^2)\)</span> 的暴力：</p>
<p>枚举一个点为根，向下展开树，此时只需要决策左儿子和右儿子的顺序</p>
<p>当两个子树都存在时，由于两个子树包含的元素不同，所以可以直接把
<strong>两个子树序列首较小</strong> (显然不会出现相同的情况)
的一个放在前面即可</p>
<p>实际上我们可以发现，这样得到的序列第一个元素必然是
<strong>编号最小的</strong> 、<strong>不同时包含左右儿子</strong>
的结点</p>
<p>不妨称固定根之后，这样的结点为叶子</p>
<p><span class="math display">\[ \ \]</span></p>
<p>显然的性质：任何一个度数 <span class="math inline">\(\leq 2\)</span>
的点可以作为答案序列的第一个点</p>
<p>设原树上最小的 <span class="math inline">\(\leq 2\)</span> 的点为
<span class="math inline">\(root\)</span> ，接下来对于 <span
class="math inline">\(root\)</span> 的不同情况讨论，要在强制 <span
class="math inline">\(root\)</span> 为序列首的情况下，求得最小的序列</p>
<p>不妨先预处理出结点 <span class="math inline">\(u\)</span>
子树里最小的叶子 <span class="math inline">\(mi_u\)</span></p>
<p>1.没有相邻结点，结束</p>
<p>2.有两个相邻结点，此时要使自己为序列首，必然有一个结点是自己的父亲，有一个结点是自己的右儿子</p>
<p>右儿子会被先遍历到，所以可以直接考虑比较两个相邻结点 作为
右儿子时谁的序列首 较小</p>
<p>即比较两个子树中最小的叶子即可</p>
<p>3.只有一个相邻结点，设其为 <span class="math inline">\(v\)</span></p>
<p>此时要使得自己为序列第一个，只有两种可能，此时同样可以考虑比较序列首元素</p>
<p>3-1.让相邻结点作为自己的父亲，此时下一个元素一定是 <span
class="math inline">\(v\)</span></p>
<p>3-2.让相邻结点作为自己的右儿子，此时下一个元素一定是 <span
class="math inline">\(mi_v\)</span></p>
<p>如果 <span class="math inline">\(v\ne mi_v\)</span> ，显然好决策</p>
<p>当 <span class="math inline">\(v=mi_v\)</span> 时，必然满足 <span
class="math inline">\(v\)</span> 是一个叶子，此时如果将 <span
class="math inline">\(v\)</span> 放在父亲上， <span
class="math inline">\(v\)</span> 的另一个相邻结点(如果存在)</p>
<p>可以放在 <span class="math inline">\(v\)</span> 的父亲或者是 <span
class="math inline">\(v\)</span> 的右子树，如果放在 <span
class="math inline">\(v\)</span> 的右子树，那么这种情况与 <span
class="math inline">\(v\)</span> 被放在 <span
class="math inline">\(u\)</span> 的子树等价</p>
<p>也就是说，把 <span class="math inline">\(v\)</span>
放在父亲可以决策出的序列情况，包含了把 <span
class="math inline">\(v\)</span> 放在右儿子的情况</p>
<p>所以这种情况也应当把 <span class="math inline">\(v\)</span>
放在父亲上</p>
<p>实现上，不妨用两个 <span class="math inline">\(dfs\)</span>
处理最后的决策，一个强制当前结点 <span class="math inline">\(u\)</span>
为序列首，一个求出 <span class="math inline">\(u\)</span>
子树的最优方案</p>
<p>在代码里就是 <span class="math inline">\(Solve,dfs\_get\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>,f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> c[N],s[N][<span class="number">3</span>];</span><br><span class="line"><span class="type">int</span> mi[N];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> rt=<span class="number">1e9</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">	mi[u]=<span class="number">1e9</span>;</span><br><span class="line">	<span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,c[u]<span class="number">-1</span>) <span class="keyword">if</span>(s[u][i]!=f) &#123;</span><br><span class="line">		<span class="type">int</span> v=s[u][i]; cnt++;</span><br><span class="line">		<span class="built_in">dfs</span>(v,u),<span class="built_in">cmin</span>(mi[u],mi[v]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(cnt&lt;=<span class="number">1</span>) <span class="built_in">cmin</span>(mi[u],u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_get</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">	vis[u]=<span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> a=<span class="number">-1</span>,b=<span class="number">-1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,c[u]<span class="number">-1</span>) <span class="keyword">if</span>(!vis[s[u][i]]) &#123;</span><br><span class="line">		<span class="type">int</span> v=s[u][i];</span><br><span class="line">		<span class="keyword">if</span>(~a) b=v;</span><br><span class="line">		<span class="keyword">else</span> a=v;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(a==<span class="number">-1</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,u);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(b==<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(mi[a]&lt;u) <span class="built_in">dfs_get</span>(a),<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,u);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,u),<span class="built_in">dfs_get</span>(a);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span>(mi[a]&gt;mi[b]) <span class="built_in">swap</span>(a,b);</span><br><span class="line">		<span class="built_in">dfs_get</span>(a),<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,u),<span class="built_in">dfs_get</span>(b);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Solve</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,c[u]<span class="number">-1</span>) <span class="keyword">if</span>(!vis[s[u][i]]) cnt++;</span><br><span class="line">	vis[u]=<span class="number">1</span>,<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,u);</span><br><span class="line">	<span class="keyword">if</span>(cnt==<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,c[u]<span class="number">-1</span>) <span class="keyword">if</span>(!vis[s[u][i]]) &#123;</span><br><span class="line">			<span class="type">int</span> v=s[u][i];</span><br><span class="line">			<span class="keyword">if</span>(v&gt;mi[v]) <span class="built_in">dfs_get</span>(s[u][i]);</span><br><span class="line">			<span class="keyword">else</span> <span class="built_in">Solve</span>(v);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span>(cnt==<span class="number">2</span>) &#123;</span><br><span class="line">		<span class="type">int</span> a=<span class="number">-1</span>,b=<span class="number">-1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,c[u]<span class="number">-1</span>) <span class="keyword">if</span>(!vis[s[u][i]]) &#123;</span><br><span class="line">			<span class="type">int</span> v=s[u][i];</span><br><span class="line">			<span class="keyword">if</span>(~a) b=v;</span><br><span class="line">			<span class="keyword">else</span> a=v;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(mi[a]&gt;mi[b]) <span class="built_in">swap</span>(a,b);</span><br><span class="line">		<span class="built_in">dfs_get</span>(a),<span class="built_in">Solve</span>(b);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;binary.in&quot;,&quot;r&quot;,stdin),freopen(&quot;binary.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">	n=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="keyword">if</span>(n==<span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;1&quot;</span>),<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		c[i]=<span class="built_in">rd</span>();</span><br><span class="line">		<span class="keyword">if</span>(c[i]&lt;=<span class="number">2</span>) <span class="built_in">cmin</span>(rt,i);</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">0</span>,c[i]<span class="number">-1</span>) s[i][j]=<span class="built_in">rd</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(rt,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">Solve</span>(rt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/others/%E3%80%8C%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD%202017%E3%80%8D%E5%B0%8F%20Y%20%E5%92%8C%E6%81%90%E6%80%96%E7%9A%84%E5%A5%B4%E9%9A%B6%E4%B8%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/others/%E3%80%8C%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD%202017%E3%80%8D%E5%B0%8F%20Y%20%E5%92%8C%E6%81%90%E6%80%96%E7%9A%84%E5%A5%B4%E9%9A%B6%E4%B8%BB/" class="post-title-link" itemprop="url">「清华集训 2017」小 Y 和恐怖的奴隶主</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="清华集训-2017小-y-和恐怖的奴隶主">「清华集训 2017」小 Y
和恐怖的奴隶主</h1>
<p><del>是不是这题太水了都没人写啊</del></p>
<p><strong>本题官方题解提供的做法实际上复杂度非常高</strong></p>
<h2 id="part1">Part1</h2>
<p>很显然本题的 <span class="math inline">\(\text{dp}\)</span>
是存储每种血量的随从数量</p>
<p>设状态数量的上限是 <span class="math inline">\(S\)</span></p>
<p>当 <span class="math inline">\(m=3,k=8\)</span> 时，这样的状态一共有
<span class="math inline">\(S=165+1\)</span> 种</p>
<p>如果直接 <span class="math inline">\(dp\)</span> ，每次转移是 <span
class="math inline">\(O(1)\)</span> 的，可以做到 <span
class="math inline">\(O(n\cdot S)\)</span> ，显然无法处理 <span
class="math inline">\(n\)</span> 较大的情况</p>
<p>用矩阵优化 <span class="math inline">\(\text{dp}\)</span>
转移，朴素的实现可以做到 <span class="math inline">\(O(T\cdot \log
n\cdot S^3)\)</span></p>
<p>如果预处理出转移矩阵的幂次，每次查询时只有列向量与方阵的乘法，所以复杂度是
<span class="math inline">\(O(\log n\cdot S^3+T\log n\cdot
S^2)\)</span></p>
<p>实际极限的复杂度预估在 <span class="math inline">\(60\cdot
166^3+500\cdot 60\cdot 166^2\approx 11\cdot 10^8\)</span></p>
<p>官方题解提供的做法就是在在这个算法上进行常数优化，这<del>wtm</del></p>
<p><span class="math display">\[ \ \]</span></p>
<h2 id="part2">Part2</h2>
<p>对于已知 <span class="math inline">\(m,k\)</span> 来说，设每个 <span
class="math inline">\(n\)</span> 构成的答案数列为 <span
class="math inline">\(a_n\)</span></p>
<p>预先处理一部分的答案 <span class="math inline">\(a_1\cdots
a_n\)</span> ，使用 <span class="math inline">\(\text{Berlekamp-Massey
}\)</span> 算法求出序列的最短线性递推</p>
<p>发现总是在 <span class="math inline">\(O(S)\)</span>
的长度以后，递推序列不再改变，即总能得到一个长度为 <span
class="math inline">\(O(S)\)</span> 的全局线性递推</p>
<p>即总可以在 <span class="math inline">\(O(S^2)\)</span>
的时间内求出答案序列 <span class="math inline">\(a_n\)</span>
的<strong>线性递推式</strong></p>
<p>那么对于求得的线性递推式，问题转化为对于每个查询的 <span
class="math inline">\(n\)</span> ，求常系数线性递推数列的第 <span
class="math inline">\(n\)</span> 项答案</p>
<p>用<strong>特征多项式</strong>的做法，可以做到单组查询 <span
class="math inline">\(O(S\log n\log S)\)</span> 的之间求出</p>
<p>那么总复杂度就是 <span class="math inline">\(O(S^2+T\cdot S \log
S\log n)\)</span></p>
<p>理论上来说，复杂度上限应该只有 <span
class="math inline">\(166^2+500\cdot 166\cdot 10\cdot 60\approx 0.5\cdot
10^8\)</span></p>
<p>理论上来说，这个复杂度无论是不是渐进意义下都比矩阵快</p>
<p>但是实际实践中，由于多项式运算的大常数，不优秀的实现下甚至可能超时</p>
<p>考虑到本题多查询的性质，我改变了倍增的基数 <span
class="math inline">\(D\)</span> ，并且预处理出倍增用到的 <span
class="math inline">\(x^i\mod \lambda\)</span></p>
<p>预处理部分的复杂度是 <span class="math inline">\(O(\log_D^n \cdot
(D-1)\cdot S\log S)\)</span></p>
<p>查询部分的复杂度是 <span class="math inline">\(O(\log _D^n S\log
S)\)</span></p>
<p><del>由于我的多项式模板不够成熟</del></p>
<p>在LOJ上，经过这样的魔改，已经能跑得比矩阵块</p>
<p>但是在UOJ上，我同样的代码竟然慢了四倍，而<a
target="_blank" rel="noopener" href="https://loj.ac/submission/108525">这份代码</a>在UOJ上的运行时间还略有提高</p>
<p>表示很是绝望。。</p>
<p>事实上，这种做法在 <span class="math inline">\(m,k\)</span>
较大时同样可行，在 <span class="math inline">\(S\)</span> 较大， <span
class="math inline">\(T\)</span>
较小的情况下，实际运行总能有更好的表现</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/others/%E3%80%8C%E9%9B%85%E7%A4%BC%E9%9B%86%E8%AE%AD%202018%20Day4%E3%80%8DMagic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/others/%E3%80%8C%E9%9B%85%E7%A4%BC%E9%9B%86%E8%AE%AD%202018%20Day4%E3%80%8DMagic/" class="post-title-link" itemprop="url">「雅礼集训 2018 Day4」Magic(分治NTT)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="雅礼集训-2018-day4magic分治ntt">「雅礼集训 2018
Day4」Magic(分治NTT)</h1>
<p>题目的条件简直无法计算恰好为 <span class="math inline">\(k\)</span>
的方案数，所以考虑计算 <span class="math inline">\(\ge k\)</span>
的方案数</p>
<p>所以可以强制有 <span class="math inline">\(k\)</span>
个相邻位置相同，但是不确定相同的是那些颜色</p>
<p>对每个颜色 <span class="math inline">\(a_i\)</span> 考虑，设把 <span
class="math inline">\(a_i\)</span> 这个颜色分成了 <span
class="math inline">\(b_i\)</span> 个联通块(即强制了 <span
class="math inline">\(a_i-b_i\)</span> 个相邻位置相同)</p>
<p>那方案数就是 <span class="math inline">\(C(a_i-1,b_i-1)\)</span>
(是一个简单的插板问题)</p>
<p>得到每种颜色的联通块个数 <span class="math inline">\(b_i\)</span>
，那么这些联通块之间排列的方案数就是 <span
class="math inline">\(\frac{(\sum b_i)!}{b_i!}\)</span></p>
<p>容易得到 <span class="math inline">\(a_i\rightarrow b_i\)</span>
的方案数，直接合并 <span class="math inline">\(b_i\)</span>
的方案数，是一个背包问题，所以考虑用分治 <span
class="math inline">\(NTT\)</span> 快速合并</p>
<p>那么得到了 <span class="math inline">\(\sum b_i=n-k\)</span>
的所有方案，复杂度 <span class="math inline">\(O(n\log n\log
m)\)</span></p>
<p>最后的容斥比较明显的是一个二项式反演的形式，可以 <span
class="math inline">\(O(n)\)</span> 计算</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1</span>&lt;&lt;<span class="number">17</span>,P=<span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,k;</span><br><span class="line"><span class="type">int</span> Inv[N+<span class="number">1</span>],Fac[N+<span class="number">1</span>],FInv[N+<span class="number">1</span>];</span><br><span class="line"><span class="function">ll <span class="title">C</span><span class="params">(<span class="type">int</span> n,<span class="type">int</span> m)</span></span>&#123; <span class="keyword">return</span> n&lt;<span class="number">0</span>||m&lt;<span class="number">0</span>||n&lt;m? <span class="number">0</span> : <span class="number">1ll</span>*Fac[n]*FInv[m]%P*FInv[n-m]%P; &#125;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll k=P<span class="number">-2</span>)</span></span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(;k;k&gt;&gt;=<span class="number">1</span>,x=x*x%P) <span class="keyword">if</span>(k&amp;<span class="number">1</span>) res=res*x%P;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> vector &lt;<span class="type">int</span>&gt; Poly;</span><br><span class="line"><span class="type">int</span> w[N|<span class="number">10</span>],rev[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Inv[<span class="number">0</span>]=Inv[<span class="number">1</span>]=Fac[<span class="number">0</span>]=Fac[<span class="number">1</span>]=FInv[<span class="number">0</span>]=FInv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">2</span>,N)&#123;</span><br><span class="line">		Fac[i]=<span class="number">1ll</span>*Fac[i<span class="number">-1</span>]*i%P;</span><br><span class="line">		Inv[i]=<span class="number">1ll</span>*(P-P/i)*Inv[P%i]%P;</span><br><span class="line">		FInv[i]=<span class="number">1ll</span>*FInv[i<span class="number">-1</span>]*Inv[i]%P;</span><br><span class="line">	&#125;</span><br><span class="line">	w[N&gt;&gt;<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">	ll t=<span class="built_in">qpow</span>(<span class="number">3</span>,(P<span class="number">-1</span>)/N);</span><br><span class="line">	<span class="built_in">rep</span>(i,(N&gt;&gt;<span class="number">1</span>)+<span class="number">1</span>,N<span class="number">-1</span>) w[i]=w[i<span class="number">-1</span>]*t%P;</span><br><span class="line">	<span class="built_in">drep</span>(i,(N&gt;&gt;<span class="number">1</span>)<span class="number">-1</span>,<span class="number">1</span>) w[i]=w[i&lt;&lt;<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Init</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> R=<span class="number">1</span>,cc=<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">while</span>(R&lt;n) R&lt;&lt;=<span class="number">1</span>,cc++;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,R<span class="number">-1</span>) rev[i]=(rev[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;cc);</span><br><span class="line">	<span class="keyword">return</span> R;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NTT</span><span class="params">(<span class="type">int</span> n,Poly &amp;a,<span class="type">int</span> f)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>((<span class="type">int</span>)a.<span class="built_in">size</span>()&lt;n) a.<span class="built_in">resize</span>(n);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(i&lt;rev[i]) <span class="built_in">swap</span>(a[i],a[rev[i]]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="type">int</span> *e=w+i;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">0</span>;l&lt;n;l+=i*<span class="number">2</span>)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=l;j&lt;l+i;++j) &#123;</span><br><span class="line">				<span class="type">int</span> t=<span class="number">1ll</span>*a[j+i]*e[j-l]%P;</span><br><span class="line">				a[j+i]=a[j]-t; <span class="built_in">Mod2</span>(a[j+i]);</span><br><span class="line">				a[j]+=t; <span class="built_in">Mod1</span>(a[j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(f==<span class="number">-1</span>)&#123;</span><br><span class="line">		<span class="built_in">reverse</span>(a.<span class="built_in">begin</span>()+<span class="number">1</span>,a.<span class="built_in">end</span>());</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) a[i]=<span class="number">1ll</span>*a[i]*Inv[n]%P;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Poly <span class="keyword">operator</span> * (Poly a,Poly b)&#123;</span><br><span class="line">	<span class="type">int</span> n=a.<span class="built_in">size</span>()+b.<span class="built_in">size</span>()<span class="number">-1</span>,R=<span class="built_in">Init</span>(n);</span><br><span class="line">	<span class="built_in">NTT</span>(R,a,<span class="number">1</span>),<span class="built_in">NTT</span>(R,b,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,R<span class="number">-1</span>) a[i]=<span class="number">1ll</span>*a[i]*b[i]%P;</span><br><span class="line">	<span class="built_in">NTT</span>(R,a,<span class="number">-1</span>),a.<span class="built_in">resize</span>(n);</span><br><span class="line">	<span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Poly <span class="title">Solve</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">		<span class="type">int</span> x=<span class="built_in">rd</span>();</span><br><span class="line">		<span class="function">Poly <span class="title">F</span><span class="params">(x+<span class="number">1</span>)</span></span>;</span><br><span class="line">		<span class="built_in">rep</span>(y,<span class="number">1</span>,x) F[y]=<span class="built_in">C</span>(x<span class="number">-1</span>,y<span class="number">-1</span>)*FInv[y]%P;</span><br><span class="line">		<span class="keyword">return</span> F;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Solve</span>(l,mid)*<span class="built_in">Solve</span>(mid+<span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;magic.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;magic.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">Init</span>(),n=<span class="built_in">rd</span>(),m=<span class="built_in">rd</span>(),k=<span class="built_in">rd</span>();</span><br><span class="line">	Poly dp=<span class="built_in">Solve</span>(<span class="number">1</span>,n);</span><br><span class="line">	<span class="built_in">rep</span>(i,n,m) dp[i]=<span class="number">1ll</span>*dp[i]*Fac[i]%P;</span><br><span class="line">	<span class="type">int</span> i=m-k;</span><br><span class="line">	<span class="built_in">rep</span>(j,n,i<span class="number">-1</span>) dp[i]=(dp[i]+(((i-j)&amp;<span class="number">1</span>)?<span class="number">-1</span>:<span class="number">1</span>)*dp[j]*<span class="built_in">C</span>(m-j,m-i)%P+P)%P;</span><br><span class="line">	ll ans=(dp[i]%P+P)%P;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/others/%E3%80%8C%E9%9B%85%E7%A4%BC%E9%9B%86%E8%AE%AD%202018%20Day8%E3%80%8DB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/others/%E3%80%8C%E9%9B%85%E7%A4%BC%E9%9B%86%E8%AE%AD%202018%20Day8%E3%80%8DB/" class="post-title-link" itemprop="url">「雅礼集训 2018 Day8」B</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="雅礼集训-2018-day8b">「雅礼集训 2018 Day8」B</h1>
<h3 id="solution1">Solution1</h3>
<p>设到达一个点的时间为 <span class="math inline">\(T_u\)</span>
，从这个点出去的时间为 <span class="math inline">\(T_u&#39;\)</span></p>
<p>那么显然满足 <span class="math inline">\(T_u\leq T_u&#39;\leq
T_u+t_u\)</span> ，答案就是 <span class="math inline">\(\sum
(t_u-(T&#39;_u-T_u))\cdot c_u\)</span></p>
<p>对于一条边满足 <span class="math inline">\(T_v\ge T&#39;_u\)</span>
，二分答案之后，容易发现这是一个线性规划问题</p>
<p>可以暴力单纯形解决掉(当然是水的，但是好像还挺快。。)</p>
<p><a target="_blank" rel="noopener" href="https://loj.ac/s/1096230">Loj Submission</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> db;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>=<span class="type">int</span>&gt; T <span class="built_in">rd</span>()&#123;</span><br><span class="line">	T s=<span class="number">0</span>; <span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) f|=IO==<span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">630</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">const</span> db eps=<span class="number">1e-9</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,W,t[N],c[N];</span><br><span class="line"><span class="type">int</span> U[N],V[N];</span><br><span class="line">db A[N][N];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">db <span class="title">Simplex</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="literal">NULL</span>));</span><br><span class="line">	<span class="keyword">auto</span> Pivot=[&amp;](<span class="type">int</span> x,<span class="type">int</span> y) &#123;</span><br><span class="line">		<span class="type">static</span> <span class="type">int</span> P[N],C;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n) A[y][i]=-A[x][i]/A[x][y];</span><br><span class="line">		A[y][x]=<span class="number">1</span>/A[x][y],A[y][y]=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n) A[x][i]=<span class="number">0</span>;</span><br><span class="line">		C=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n) <span class="keyword">if</span>(<span class="built_in">abs</span>(A[y][i])&gt;eps) P[++C]=i;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n) <span class="keyword">if</span>(<span class="built_in">abs</span>(A[i][y])&gt;eps) &#123;</span><br><span class="line">			db t=A[i][y]; A[i][y]=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">rep</span>(j,<span class="number">1</span>,C) A[i][P[j]]+=t*A[y][P[j]];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	vector &lt;<span class="type">int</span>&gt; V;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) V.<span class="built_in">pb</span>(i);</span><br><span class="line">	<span class="comment">//random_shuffle(V.begin(),V.end());</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> u=<span class="number">0</span>,v=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i:V) <span class="keyword">if</span>(!u || A[i][<span class="number">0</span>]&lt;A[u][<span class="number">0</span>]) u=i;</span><br><span class="line">		<span class="keyword">if</span>(A[u][<span class="number">0</span>]&gt;-eps) <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i:V) <span class="keyword">if</span>(A[u][i]&gt;eps) v=i;</span><br><span class="line">		<span class="keyword">if</span>(!v) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Infeasible&quot;</span>),<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">Pivot</span>(u,v);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> u=<span class="number">0</span>,v=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i:V) <span class="keyword">if</span>(!v || A[<span class="number">0</span>][i]&gt;A[<span class="number">0</span>][v]) v=i;</span><br><span class="line">		<span class="keyword">if</span>(A[<span class="number">0</span>][v]&lt;eps) <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i:V) <span class="keyword">if</span>(A[i][v]&lt;-eps) <span class="keyword">if</span>(!u || (A[i][<span class="number">0</span>]/A[i][v] &gt; A[u][<span class="number">0</span>]/A[u][v])) u=i;</span><br><span class="line">		<span class="keyword">if</span>(!u) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Unbounded&quot;</span>),<span class="number">0</span>; </span><br><span class="line">		<span class="built_in">Pivot</span>(u,v); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> A[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> outd[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">(<span class="type">int</span> lim)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(A,<span class="number">0</span>,<span class="keyword">sizeof</span> A);</span><br><span class="line">	<span class="type">int</span> cnt=n*<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) A[<span class="number">0</span>][i+n]=c[i],A[<span class="number">0</span>][i]=-c[i],A[<span class="number">0</span>][<span class="number">0</span>]-=t[i]*c[i];</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		A[++cnt][i]=<span class="number">-1</span>; A[cnt][i+n]=<span class="number">1</span>;</span><br><span class="line">		A[++cnt][i]=<span class="number">1</span>; A[cnt][i+n]=<span class="number">-1</span>; A[cnt][<span class="number">0</span>]=t[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) A[++cnt][U[i]+n]=<span class="number">-1</span>,A[cnt][V[i]]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(!outd[i]) A[++cnt][<span class="number">0</span>]=lim,A[cnt][i+n]=<span class="number">-1</span>;</span><br><span class="line">	db res=-<span class="built_in">Simplex</span>(cnt);</span><br><span class="line">	<span class="keyword">return</span> res&lt;=W+eps;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;soft.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;soft.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	n=<span class="built_in">rd</span>(),m=<span class="built_in">rd</span>(),W=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="type">int</span> l=<span class="number">0</span>,r=<span class="number">0</span>,res=<span class="number">-1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) t[i]=<span class="built_in">rd</span>(),r+=t[i];</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) c[i]=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) U[i]=<span class="built_in">rd</span>(),V[i]=<span class="built_in">rd</span>(),outd[U[i]]++;</span><br><span class="line">	<span class="keyword">while</span>(l&lt;=r) &#123;</span><br><span class="line">		<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">Check</span>(mid)) r=mid<span class="number">-1</span>,res=mid;</span><br><span class="line">		<span class="keyword">else</span> l=mid+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[ \ \]</span></p>
<h3 id="solution2">Solution2</h3>
<p>二分答案 <span class="math inline">\(\text{lim}\)</span>
，问题转化为求最小花费</p>
<p>设每个点减少了 <span class="math inline">\(x_i\)</span></p>
<p>考虑限制有两种，一种是路径长度的限制，一种是每个点大小的限制</p>
<p><span class="math inline">\(\text{minimize:} \sum x_i\cdot
c_i\)</span></p>
<p><span class="math inline">\(\displaystyle \forall p\in paths , \sum
x_{p_i}\ge \sum t_{p_i}-\text{lim}\)</span></p>
<p><span class="math inline">\(-x_i\ge -t_i\)</span></p>
<p>对偶一下，设对于路径 <span class="math inline">\(p\)</span> ， <span
class="math inline">\(\sum x_{p_i}\)</span> 的对偶变量为 <span
class="math inline">\(y_p\)</span> ， <span
class="math inline">\(-x_i\)</span> 的对偶变量为 <span
class="math inline">\(z_i\)</span></p>
<p><span class="math inline">\(\text{maximize}:\sum y_p\cdot (\sum
t_{p_i}-\text{lim})-z_i\cdot t_i\)</span></p>
<p><span class="math inline">\(\displaystyle \forall i\in[1,n],
\sum_{p\in paths,i\in p} y_p-z_i\leq c\)</span></p>
<p>考虑对偶变量 <span class="math inline">\(y_p\)</span> 和 <span
class="math inline">\(z_i\)</span> 有什么意义</p>
<p>此时，选择一条路径 <span class="math inline">\(y_p\)</span> ，会使得
关于路径上的点的限制+1 ， 使得答案增加 <span class="math inline">\(\sum
t_{p_i}-\text{lim}\)</span></p>
<p><span class="math inline">\(z_i\)</span> 是关于每个单点的变量，可以用
<span class="math inline">\(t_i\)</span> 代价使得每个 <span
class="math inline">\(i\)</span> 的限制-1</p>
<p>那么可以考虑转化为一个路径覆盖问题，选择一条路径覆盖路径上的点，且得到
<span class="math inline">\(\sum t_{p_i}-\text{lim}\)</span> 的价值</p>
<p>限制式子转化为：每个点被覆盖次数大于 <span
class="math inline">\(c\)</span> 时，再选择就要付出 <span
class="math inline">\(t_i\)</span> 的代价令 <span
class="math inline">\(z_i\)</span> 加一</p>
<p>带权的路径覆盖容易转化为费用流模型，可以把每个点拆成入点出点，每个点被覆盖前
<span class="math inline">\(c_i\)</span> 次，价值为 <span
class="math inline">\(t_i\)</span> ，之后就为0</p>
<p>因此每个点的入点向出点连 <span
class="math inline">\((c_i,t_i),(\infty,0)\)</span> 两条边即可，路径的
<span class="math inline">\(\text{-lim}\)</span> 可以在源点前加入</p>
<p>求一次最大费用可行流，最终得到的答案是原问题的最小代价</p>
<p><a target="_blank" rel="noopener" href="https://loj.ac/s/1096314"><del>是我EK写得太丑的说</del>: Loj
Submission</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>=<span class="type">int</span>&gt; T <span class="built_in">rd</span>()&#123;</span><br><span class="line">	T s=<span class="number">0</span>; <span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) f|=IO==<span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span>&#123;N=<span class="number">10101</span>,INF=<span class="number">1</span>&lt;&lt;<span class="number">30</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,W;</span><br><span class="line"><span class="type">int</span> c[N],t[N],X[N],Y[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> to,nxt,w,c;</span><br><span class="line">&#125; e[N];</span><br><span class="line"><span class="type">int</span> head[N],ecnt=<span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> V,S,T;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span></span>&#123; e[++ecnt]=(Edge)&#123;v,head[u],w,c&#125;,head[u]=ecnt; &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span></span>&#123; <span class="built_in">AddEdge</span>(u,v,w,c),<span class="built_in">AddEdge</span>(v,u,<span class="number">0</span>,-c); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> pre[N],dis[N],inq[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">SPFA</span><span class="params">(<span class="type">int</span> lim)</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,V) dis[i]=-INF;</span><br><span class="line">	<span class="type">static</span> queue &lt;<span class="type">int</span>&gt; que;</span><br><span class="line">	dis[S]=-lim,que.<span class="built_in">push</span>(S);</span><br><span class="line">	<span class="keyword">while</span>(!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> u=que.<span class="built_in">front</span>(); que.<span class="built_in">pop</span>(),inq[u]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=e[i].nxt) &#123;</span><br><span class="line">			<span class="type">int</span> v=e[i].to;</span><br><span class="line">			<span class="keyword">if</span>(!e[i].w || dis[v]&gt;=dis[u]+e[i].c) <span class="keyword">continue</span>;</span><br><span class="line">			dis[v]=dis[u]+e[i].c,pre[v]=i;</span><br><span class="line">			<span class="keyword">if</span>(!inq[v]) que.<span class="built_in">push</span>(v),inq[v]=<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dis[T]&gt;<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">(<span class="type">int</span> lim)</span></span>&#123;</span><br><span class="line">	S=++V,T=++V;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="built_in">Link</span>(S,++V,INF,<span class="number">0</span>);</span><br><span class="line">		<span class="built_in">Link</span>(V,V+<span class="number">1</span>,c[i],t[i]);</span><br><span class="line">		<span class="built_in">Link</span>(V,V+<span class="number">1</span>,INF,<span class="number">0</span>);</span><br><span class="line">		<span class="built_in">Link</span>(++V,T,INF,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">Link</span>(X[i]*<span class="number">2</span>+<span class="number">2</span>,Y[i]*<span class="number">2</span>+<span class="number">1</span>,INF,<span class="number">0</span>);</span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">SPFA</span>(lim))&#123;</span><br><span class="line">		<span class="type">int</span> w=INF;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=T;i!=S;i=e[pre[i]^<span class="number">1</span>].to) <span class="built_in">cmin</span>(w,e[pre[i]].w);</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=T;i!=S;i=e[pre[i]^<span class="number">1</span>].to) e[pre[i]].w-=w,e[pre[i]^<span class="number">1</span>].w+=w;</span><br><span class="line">		ans+=dis[T]*w;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,V) head[i]=<span class="number">0</span>;</span><br><span class="line">	ecnt=<span class="number">1</span>,V=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> ans&lt;=W;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;soft.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;soft.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	n=<span class="built_in">rd</span>(),m=<span class="built_in">rd</span>(),W=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="type">int</span> l=<span class="number">0</span>,r=<span class="number">0</span>,res=<span class="number">-1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) r+=t[i]=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) c[i]=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) X[i]=<span class="built_in">rd</span>(),Y[i]=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> mid;l&lt;=r;) <span class="built_in">Check</span>(mid=(l+r)&gt;&gt;<span class="number">1</span>)?r=mid<span class="number">-1</span>,res=mid:l=mid+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/CosmicBlocks%20TopCoder%20-%2012034/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/CosmicBlocks%20TopCoder%20-%2012034/" class="post-title-link" itemprop="url">[CosmicBlocks - TopCoder- 12034](https://vjudge.net/problem/TopCoder-12034) (网络流)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="cosmicblocks---topcoder--12034-网络流"><a
target="_blank" rel="noopener" href="https://vjudge.net/problem/TopCoder-12034">CosmicBlocks -
TopCoder- 12034</a> (网络流)</h1>
<p>注意题目定义的同构是存在不同的颜色覆盖关系，而不是存在不同的排列顺序</p>
<p>所以先枚举每一层放了那些颜色，再枚举那些颜色之间有覆盖</p>
<p>每一层的颜色划分数很少，最多可能同时存在的覆盖关系是 <span
class="math inline">\(9\)</span> 种，枚举复杂度最多是 <span
class="math inline">\(2^9\)</span> ，然后可以 <span
class="math inline">\(2^n\cdot n\ \text{dp}\)</span>
出拓扑序列的个数</p>
<p>问题在于如何快速又方便地判断对于<strong>当前情况是否存在方案</strong></p>
<p>一种方法是<strong>上下界网络流</strong></p>
<p>按照层之间的关系，覆盖关系就连 <span
class="math inline">\([1,+\infty)\)</span> 的边，同时源点向 <span
class="math inline">\(1\)</span> 层的点连 <span
class="math inline">\([0,+\infty)\)</span> 的边，每个点都向汇点连 <span
class="math inline">\([0,\infty)\)</span> 的边</p>
<p>注意由于要限制流过每个点的流量，每个点要拆成两个点中间连 <span
class="math inline">\([num_i,num_i]\)</span> 的边</p>
<p>最后判断一下<strong>有源汇可行流</strong>即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> N=<span class="number">20</span>,INF=<span class="number">1e8</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> n,m,ans,L,R;</span><br><span class="line"><span class="type">int</span> cnt[N],id[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; G[N];</span><br><span class="line"><span class="type">int</span> GS[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; Layer[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Calc_DAG</span><span class="params">()</span> </span>&#123; <span class="comment">// 计算拓扑序列的个数</span></span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> dp[<span class="number">1</span>&lt;&lt;<span class="number">6</span>];</span><br><span class="line">	<span class="type">int</span> A=(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,A) dp[i]=<span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(S,<span class="number">0</span>,A<span class="number">-1</span>) <span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>((~S&amp;(<span class="number">1</span>&lt;&lt;i)) &amp;&amp; (S&amp;GS[i+<span class="number">1</span>])==GS[i+<span class="number">1</span>]) dp[S|(<span class="number">1</span>&lt;&lt;i)]+=dp[S];</span><br><span class="line">	<span class="keyword">return</span> dp[A];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ind[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Limited_Flow</span>&#123; <span class="comment">// 有源汇可行流</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> M=<span class="number">300</span>;</span><br><span class="line">	<span class="type">int</span> S,T;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">		<span class="type">int</span> to,nxt,w;</span><br><span class="line">	&#125; e[M];</span><br><span class="line">	<span class="type">int</span> head[N],ecnt;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>+<span class="number">4</span>) head[i]=<span class="number">0</span>;</span><br><span class="line">		ecnt=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> erep(u,i) for(int i=head[u];i;i=e[i].nxt)</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span> </span>&#123; e[ecnt]=(Edge)&#123;v,head[u],w&#125;,head[u]=ecnt++; &#125; </span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span>&#123; <span class="built_in">AddEdge</span>(u,v,w),<span class="built_in">AddEdge</span>(v,u,<span class="number">0</span>); &#125;</span><br><span class="line">	<span class="type">int</span> dis[N];</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">static</span> queue &lt;<span class="type">int</span>&gt; que;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,T) dis[i]=INF; dis[S]=<span class="number">0</span>,que.<span class="built_in">push</span>(S);</span><br><span class="line">		<span class="keyword">while</span>(!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">			<span class="type">int</span> u=que.<span class="built_in">front</span>(); que.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="built_in">erep</span>(u,i) &#123;</span><br><span class="line">				<span class="type">int</span> v=e[i].to,w=e[i].w;</span><br><span class="line">				<span class="keyword">if</span>(!w || dis[v]&lt;=dis[u]+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">				dis[v]=dis[u]+<span class="number">1</span>,que.<span class="built_in">push</span>(v);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> dis[T]&lt;INF;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> flowin)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(u==T) <span class="keyword">return</span> flowin;</span><br><span class="line">		<span class="type">int</span> flowout=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">erep</span>(u,i) &#123;</span><br><span class="line">			<span class="type">int</span> v=e[i].to,w=e[i].w;</span><br><span class="line">			<span class="keyword">if</span>(!w || dis[v]!=dis[u]+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="type">int</span> t=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(flowin-flowout,w));</span><br><span class="line">			e[i].w-=t,e[i^<span class="number">1</span>].w+=t,flowout+=t;</span><br><span class="line">			<span class="keyword">if</span>(flowin==flowout) <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!flowout) dis[u]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> flowout;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">Bfs</span>()) ans+=<span class="built_in">Dfs</span>(S,INF);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">erep</span>(S,i) <span class="keyword">if</span>(e[i].w) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">erep</span>(T,i) <span class="keyword">if</span>(e[i^<span class="number">1</span>].w) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; Flow;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Extend_Edge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> L,<span class="type">int</span> R)</span></span>&#123;</span><br><span class="line">	ind[u]-=L,ind[v]+=L;</span><br><span class="line">	Flow.<span class="built_in">Link</span>(u,v,R-L);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>+<span class="number">4</span>) ind[i]=<span class="number">0</span>;</span><br><span class="line">	Flow.<span class="built_in">clear</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">Extend_Edge</span>(i*<span class="number">2</span><span class="number">-1</span>,i*<span class="number">2</span>,cnt[i],cnt[i]);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(id[i]==<span class="number">1</span>) <span class="built_in">Extend_Edge</span>(n*<span class="number">2</span>+<span class="number">1</span>,i*<span class="number">2</span><span class="number">-1</span>,cnt[i],cnt[i]);</span><br><span class="line">	<span class="built_in">rep</span>(u,<span class="number">1</span>,n) <span class="keyword">for</span>(<span class="type">int</span> v:G[u]) <span class="built_in">Extend_Edge</span>(u*<span class="number">2</span>,v*<span class="number">2</span><span class="number">-1</span>,<span class="number">1</span>,INF);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">Extend_Edge</span>(i*<span class="number">2</span>,n*<span class="number">2</span>+<span class="number">2</span>,<span class="number">0</span>,INF);</span><br><span class="line">	<span class="built_in">Extend_Edge</span>(n*<span class="number">2</span>+<span class="number">2</span>,n*<span class="number">2</span>+<span class="number">1</span>,<span class="number">0</span>,INF);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>+<span class="number">2</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(ind[i]&gt;<span class="number">0</span>) Flow.<span class="built_in">Link</span>(n*<span class="number">2</span>+<span class="number">3</span>,i,ind[i]);</span><br><span class="line">		<span class="keyword">if</span>(ind[i]&lt;<span class="number">0</span>) Flow.<span class="built_in">Link</span>(i,n*<span class="number">2</span>+<span class="number">4</span>,-ind[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	Flow.S=n*<span class="number">2</span>+<span class="number">3</span>,Flow.T=n*<span class="number">2</span>+<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">	Flow.<span class="built_in">Dinic</span>();</span><br><span class="line">	<span class="keyword">return</span> Flow.<span class="built_in">Check</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dfs_GetDAG</span><span class="params">(<span class="type">int</span> p)</span> </span>&#123; <span class="comment">// dfs枚举覆盖关系</span></span><br><span class="line">	<span class="keyword">if</span>(p==n+<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> Ways=<span class="built_in">Calc_DAG</span>();</span><br><span class="line">		<span class="keyword">if</span>(Ways&lt;L || Ways&gt;R) <span class="keyword">return</span>;</span><br><span class="line">		ans+=<span class="built_in">Check</span>();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(id[p]==m) <span class="keyword">return</span> <span class="built_in">Dfs_GetDAG</span>(p+<span class="number">1</span>);</span><br><span class="line">	<span class="type">int</span> n=Layer[id[p]+<span class="number">1</span>].<span class="built_in">size</span>();</span><br><span class="line">	<span class="built_in">rep</span>(S,<span class="number">0</span>,(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(S&amp;(<span class="number">1</span>&lt;&lt;i)) G[p].<span class="built_in">pb</span>(Layer[id[p]+<span class="number">1</span>][i]),GS[p]|=<span class="number">1</span>&lt;&lt;(Layer[id[p]+<span class="number">1</span>][i]<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">Dfs_GetDAG</span>(p+<span class="number">1</span>);</span><br><span class="line">		G[p].<span class="built_in">clear</span>(),GS[p]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dfs_Getlayer</span><span class="params">(<span class="type">int</span> num,<span class="type">int</span> fir,<span class="type">int</span> chosennumber)</span></span>&#123; <span class="comment">// dfs枚举层的情况</span></span><br><span class="line">	<span class="keyword">if</span>(chosennumber==n) &#123;</span><br><span class="line">		m=num;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) Layer[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) Layer[id[i]].<span class="built_in">pb</span>(i);</span><br><span class="line">		<span class="built_in">Dfs_GetDAG</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,fir,n) <span class="keyword">if</span>(!id[i]) &#123;</span><br><span class="line">		id[i]=num;</span><br><span class="line">		<span class="built_in">Dfs_Getlayer</span>(num,i+<span class="number">1</span>,chosennumber+<span class="number">1</span>);</span><br><span class="line">		id[i]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(fir!=<span class="number">1</span>) <span class="built_in">Dfs_Getlayer</span>(num+<span class="number">1</span>,<span class="number">1</span>,chosennumber);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CosmicBlocks</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getNumOrders</span><span class="params">(vector &lt;<span class="type">int</span>&gt; a, <span class="type">int</span> Min, <span class="type">int</span> Max)</span> </span>&#123;</span><br><span class="line">		L=Min,R=Max;</span><br><span class="line">		n=a.<span class="built_in">size</span>(),ans=<span class="number">0</span>; <span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) cnt[i+<span class="number">1</span>]=a[i];</span><br><span class="line">		<span class="built_in">Dfs_Getlayer</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Powered by KawigiEdit 2.1.4 (beta) modified by pivanof!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/others/[BJ%20United%20Round%20#3]%20%E6%8A%BC%E9%9F%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/others/%5BBJ%20United%20Round%20#3%5D%20%E6%8A%BC%E9%9F%B5/" class="post-title-link" itemprop="url">[BJ United Round #3] 押韵</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="bj-united-round-3-押韵">[BJ United Round #3] 押韵</h1>
<p>先%%%%%%%%%%%%%%%%% EI</p>
<p><span class="math display">\[ \ \]</span></p>
<p><span class="math display">\[ \ \]</span></p>
<p>下文默认模数为 <span class="math inline">\(P\)</span></p>
<p>简要题意：求：用 <span class="math inline">\(k\)</span>
种元素，每种元素使用 <span class="math inline">\(d\)</span>
的倍数次，排成一个长度为 <span class="math inline">\(nd\)</span> 的序列
的方案数</p>
<p>这个题目的设定就让人想到两个离不开的元素 ：
<del>(模数暗示了？)</del></p>
<p>指数型生成函数 + 单位根反演</p>
<p>显然可以得到每一种元素的指数型生成函数为</p>
<p><span class="math inline">\(\begin{aligned}
\text{EGF(Element)}=F(x)=\sum_{d|i}
\frac{x^i}{i!}\end{aligned}\)</span></p>
<p>带入单位根反演 <span class="math inline">\(\begin{aligned}\
[d|n]=\frac{\sum_0^{d-1} \omega_d^{in}}{d}\end{aligned}\)</span></p>
<p>即 <span class="math inline">\(F(x)=\begin{aligned}\frac{1}{d}\cdot
\sum_{i=0}^{d-1}e^{\omega_d^ix}\end{aligned}\)</span></p>
<p>而总的生成函数就是 <span
class="math inline">\(G(x)=F^k(x)\)</span></p>
<p>即 <span class="math inline">\(\begin{aligned}
G(x)=\frac{1}{d^k}\cdot
(\sum_{i=0}^{d-1}e^{\omega_d^ix})^k\end{aligned}\)</span></p>
<p>其中的和式幂次展开会得到一个 <span class="math inline">\(k^d\)</span>
项的多项式，我们要求 <span class="math inline">\([x^n]G(x)\)</span>
，就需要展开得到每一项的幂系数</p>
<p>所以显然我们需要先合并同类项一下。。。</p>
<p>而幂系数是一个单位根之和的形式，这就需要我们寻找单位根之间的关系</p>
<p>这里得到一个思路：用 <span class="math inline">\(d\)</span>
次单位根中的 <span class="math inline">\(\varphi(d)\)</span>
个作为基底，以简单的 有理数/整系数 表示出所有的 <span
class="math inline">\(\omega_d^i\)</span></p>
<p><span class="math display">\[ \ \]</span></p>
<p>对于 <span class="math inline">\(d=4\)</span> 的情况比较简单， <span
class="math inline">\(\varphi(d)=2\)</span> ，可以得到四个单位根分别为
<span class="math inline">\(1,\omega,-1,-\omega\)</span></p>
<p>可以枚举得到的和为 <span class="math inline">\(x+y\omega\)</span>
，然后求系数</p>
<p>优先考虑组合意义，可以发现就是在平面上每次可以走四个方向， <span
class="math inline">\(k\)</span> 步之后最终到达 <span
class="math inline">\((x,y)\)</span> 的方案数</p>
<p>两个维度分立的情况，还需要枚举每个维度走了几步，所以用一种巧妙的转化两个维度联系在一起</p>
<p>将平面旋转 <span class="math inline">\(\frac{\pi}{8}\)</span>
，并且扩大 <span class="math inline">\(\sqrt 2\)</span>
倍，得到新的坐标为 <span class="math inline">\((x-y,x+y)\)</span>
，新的行走方向是 <span
class="math inline">\((+1,+1),(-1,-1),(-1,+1),(+1,-1)\)</span></p>
<p>这样以来，每次每个维度都有行走，可以确定每个维度 <span
class="math inline">\(+1\)</span> 和 <span
class="math inline">\(-1\)</span> 的次数，直接组合数排列即可得到答案</p>
<p><span class="math display">\[ \ \]</span></p>
<p><span class="math display">\[ \ \]</span></p>
<p>对于 <span class="math inline">\(d=6\)</span>
，甚至是更一般的情况的情况</p>
<p>只在代数层面来看单位根似乎十分抽象，不如从复平面单位根上找一找灵感</p>
<p>下面是 <span class="math inline">\(d=6\)</span> 的情形</p>
<figure>
<img src="https://i.loli.net/2021/01/30/Bb3vJq1TGPgtfs2.png"
alt="planeomega.png" />
<figcaption aria-hidden="true">planeomega.png</figcaption>
</figure>
<p><span class="math inline">\(\varphi(6)=2\)</span> ，假设以 <span
class="math inline">\(\overrightarrow{OA},\overrightarrow{OB}\)</span>
作为基底，可以直观地得到基底表达</p>
<table>
<colgroup>
<col style="width: 38%" />
<col style="width: 27%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><span class="math inline">\(\overrightarrow{OA}=1\)</span></th>
<th><span class="math inline">\(\overrightarrow{OB}=\omega\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span
class="math inline">\(\overrightarrow{OA}=\omega_6^0\)</span></td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td><span
class="math inline">\(\overrightarrow{OB}=\omega_6^1\)</span></td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td><span
class="math inline">\(\overrightarrow{OC}=\omega_6^2\)</span></td>
<td>-1</td>
<td>1</td>
</tr>
<tr class="even">
<td><span
class="math inline">\(\overrightarrow{OD}=\omega_6^3\)</span></td>
<td>-1</td>
<td>0</td>
</tr>
<tr class="odd">
<td><span
class="math inline">\(\overrightarrow{OE}=\omega_6^4\)</span></td>
<td>0</td>
<td>-1</td>
</tr>
<tr class="even">
<td><span
class="math inline">\(\overrightarrow{OF}=\omega_6^5\)</span></td>
<td>1</td>
<td>-1</td>
</tr>
</tbody>
</table>
<p>由此我们得到了一个 <span class="math inline">\(\varphi(d)\)</span>
维数的表达方法</p>
<p>把每一维看做不同元，也就是说，得到了一个 <span
class="math inline">\(\varphi(d)\)</span> 维， <span
class="math inline">\(O(1)\)</span>
次的多项式，需要我们求高维多项式幂次</p>
<p>令 <span class="math inline">\(N=k^{\varphi(d)}\)</span></p>
<p>直接压位暴力多项式复杂度为 <span class="math inline">\(O(N\log
N-N\log^2N)\)</span> ，而且面临着模数难以处理，常数大的问题</p>
<p>所以 <span class="math inline">\(\text{EI}\)</span>
又用出了一个巧妙的暴力方法解决这个问题，以 <span
class="math inline">\(d=6\)</span>
为例，先做一下处理，得到要求的多项式</p>
<p><del>似乎每次 <span class="math inline">\(k\)</span>
次幂总是求导+递推？</del></p>
<p><span
class="math inline">\(f(x,y)=x^2y+xy^2+y^2+y+x+x^2,g(x,y)=f^k(x,y)\)</span></p>
<p><span class="math inline">\(g(x,y)\)</span> 对于 <span
class="math inline">\(x\)</span> 求偏导，得到 <span
class="math inline">\(g&#39;(x,y)=kf^{k-1}(x,y)f&#39;(x,y)\)</span></p>
<p>即 <span
class="math inline">\(g&#39;(x,y)f(x,y)=kg(x,y)f&#39;(x,y)\)</span></p>
<p><span class="math inline">\(f&#39;(x,y)=2xy+2x+y^2+1\)</span></p>
<p>然后我们要解这个方程，考虑乘积为 <span
class="math inline">\([x^ny^m]\)</span> 一项两边的系数</p>
<p>左边 <span
class="math inline">\(=[x^{n-2}y^{m-1}]+[x^{n-1}y^{m-2}]+[x^{n}y^{m-2}]+[x^{n}y^{m-1}]+[x^{n-1}y^{m}]+[x^{n-2}y^{m}]\)</span></p>
<p>换成 <span class="math inline">\(g(x,y)\)</span> 的系数应该是</p>
<p>左边 <span
class="math inline">\(=(n-1)[x^{n-1}y^{m-1}]+n[x^{n}y^{m-2}]+(n+1)[x^{n+1}y^{m-2}]+(n+1)[x^{n+1}y^{m-1}]+n[x^{n}y^{m}]+(n-1)[x^{n-1}y^{m}]\)</span></p>
<p>右边 <span
class="math inline">\(=2k[x^{n-1}y^{m-1}]+2k[x^{n-1}y^m]+k[x^ny^{m-2}]+k[x^ny^m]\)</span></p>
<p>其中 <span class="math inline">\([x^{n+1}y^{m-1}]\)</span>
只出现了一次，按照先 <span class="math inline">\(n\)</span> 递增再 <span
class="math inline">\(m\)</span> 递增的顺序进行递推，即</p>
<p><span class="math inline">\(\begin{aligned}\
[x^ny^m]=\frac{2k[x^{n-2}y^{m}]+2k[x^{n-2}y^{m+1}]+k[x^{n-1}y^{m-1}]+k[x^{n-1}y^{m+1}]}{n}\end{aligned}\)</span></p>
<p><span
class="math inline">\(\begin{aligned}-\frac{(n-2)[x^{n-2}y^{m}]+(n-1)[x^{n-1}y^{m-1}]+n[x^{n}y^{m-1}]+(n-1)[x^{n-1}y^{m+1}]+(n-2)[x^{n-2}y^{m+1}]}{n}\end{aligned}\)</span></p>
<p>边界条件是 <span class="math inline">\(\begin{aligned}\
[x^i]=[y^i](i\ge k)=\binom{k}{i-k}\end{aligned}\)</span> (由系数 <span
class="math inline">\(x,x^2\)</span> 或 <span
class="math inline">\(y,y^2\)</span> 得到)</p>
<p>由此带入递推即可</p>
<p>综上，得到的每项的系数的复杂度为 <span class="math inline">\(O(d\cdot
k^{\varphi(d)})\)</span> ，其中 <span class="math inline">\(d\)</span>
为递推每项需要的时间</p>
<p>由系数得到答案仍然需要一次快速幂，因此依然带一个 <span
class="math inline">\(\log P\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ull;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> db;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; a=<span class="built_in">min</span>(a,b); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; a=<span class="built_in">max</span>(a,b); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> s=<span class="number">0</span>,f=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">    <span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2e3</span>+<span class="number">10</span>,P=<span class="number">1049874433</span>,G=<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,k,d;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll k=P<span class="number">-2</span>)</span> </span>&#123;</span><br><span class="line">    k%=P<span class="number">-1</span>;</span><br><span class="line">    ll res=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(;k;k&gt;&gt;=<span class="number">1</span>,x=x*x%P) <span class="keyword">if</span>(k&amp;<span class="number">1</span>) res=res*x%P;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> w[<span class="number">100</span>],C[N][N],I[N*<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    n=<span class="built_in">rd</span>(),k=<span class="built_in">rd</span>(),d=<span class="built_in">rd</span>();</span><br><span class="line">    w[<span class="number">0</span>]=<span class="number">1</span>,w[<span class="number">1</span>]=<span class="built_in">qpow</span>(G,(P<span class="number">-1</span>)/d);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">2</span>,<span class="number">90</span>) w[i]=<span class="number">1ll</span>*w[i<span class="number">-1</span>]*w[<span class="number">1</span>]%P;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">0</span>,k) <span class="built_in">rep</span>(j,C[i][<span class="number">0</span>]=<span class="number">1</span>,i) C[i][j]=C[i<span class="number">-1</span>][j]+C[i<span class="number">-1</span>][j<span class="number">-1</span>],<span class="built_in">Mod1</span>(C[i][j]);</span><br><span class="line">    I[<span class="number">0</span>]=I[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">2</span>,k*<span class="number">2</span>) I[i]=<span class="number">1ll</span>*(P-P/i)*I[P%i]%P;</span><br><span class="line">    <span class="keyword">if</span>(d==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="type">int</span> ans=<span class="built_in">qpow</span>(k,<span class="number">1ll</span>*d*n);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(d==<span class="number">2</span>) &#123;</span><br><span class="line">        <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">0</span>,k) ans=(ans+<span class="built_in">qpow</span>((<span class="number">1ll</span>*w[<span class="number">0</span>]*i+<span class="number">1ll</span>*w[<span class="number">1</span>]*(k-i))%P,<span class="number">1ll</span>*d*n)*C[k][i])%P;</span><br><span class="line">        ans=ans*<span class="built_in">qpow</span>(<span class="built_in">qpow</span>(d,k))%P;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(d==<span class="number">3</span>) &#123;</span><br><span class="line">        <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">0</span>,k) <span class="built_in">rep</span>(j,<span class="number">0</span>,k-i) </span><br><span class="line">            ans=(ans+<span class="built_in">qpow</span>((<span class="number">1ll</span>*w[<span class="number">0</span>]*i+<span class="number">1ll</span>*w[<span class="number">1</span>]*j+<span class="number">1ll</span>*w[<span class="number">2</span>]*(k-i-j))%P,<span class="number">1ll</span>*d*n)*C[i+j][i]%P*C[k][i+j])%P;</span><br><span class="line">        ans=ans*<span class="built_in">qpow</span>(<span class="built_in">qpow</span>(d,k))%P;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(d==<span class="number">4</span>) &#123;</span><br><span class="line">        <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i,-k,k) <span class="built_in">rep</span>(j,-k,k) <span class="keyword">if</span>(<span class="built_in">abs</span>(i)+<span class="built_in">abs</span>(j)&lt;=k &amp;&amp; (k-i-j)%<span class="number">2</span>==<span class="number">0</span>) &#123;</span><br><span class="line">            ll x=<span class="built_in">qpow</span>((<span class="number">1ll</span>*w[<span class="number">0</span>]*i+<span class="number">1ll</span>*w[<span class="number">1</span>]*j)%P,<span class="number">1ll</span>*d*n);</span><br><span class="line">            ll y=<span class="number">1ll</span>*C[k][(<span class="built_in">abs</span>(i-j)+k)/<span class="number">2</span>]*C[k][(k+<span class="built_in">abs</span>(i+j))/<span class="number">2</span>]%P;</span><br><span class="line">            ans=(ans+x*y)%P;</span><br><span class="line">        &#125;</span><br><span class="line">        ans=(ans+P)*<span class="built_in">qpow</span>(<span class="built_in">qpow</span>(d,k))%P;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> F[N*<span class="number">2</span>][N*<span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i,<span class="number">0</span>,k*<span class="number">2</span>) <span class="built_in">rep</span>(j,<span class="built_in">max</span>(k-i,<span class="number">0</span>),<span class="built_in">min</span>(<span class="number">2</span>*k,<span class="number">3</span>*k-i)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>) F[i][j]=C[k][j-k];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(j==<span class="number">0</span>) F[i][j]=C[k][i-k];</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> s=(<span class="number">2ll</span>*k*(i&gt;<span class="number">1</span>?F[i<span class="number">-2</span>][j]+F[i<span class="number">-2</span>][j+<span class="number">1</span>]:<span class="number">0</span>)+<span class="number">1ll</span>*k*(F[i<span class="number">-1</span>][j<span class="number">-1</span>]+F[i<span class="number">-1</span>][j+<span class="number">1</span>]))%P;</span><br><span class="line">                <span class="type">int</span> t=((i&gt;<span class="number">1</span>?<span class="number">1ll</span>*(i<span class="number">-2</span>)*(F[i<span class="number">-2</span>][j]+F[i<span class="number">-2</span>][j+<span class="number">1</span>]):<span class="number">0</span>)+</span><br><span class="line">                    <span class="number">1ll</span>*(i<span class="number">-1</span>)*F[i<span class="number">-1</span>][j<span class="number">-1</span>]+<span class="number">1ll</span>*i*F[i][j<span class="number">-1</span>]+<span class="number">1ll</span>*(i<span class="number">-1</span>)*F[i<span class="number">-1</span>][j+<span class="number">1</span>])%P;</span><br><span class="line">                F[i][j]=<span class="number">1ll</span>*(s-t+P)*I[i]%P;</span><br><span class="line">            &#125;</span><br><span class="line">            ans=(ans+<span class="built_in">qpow</span>((<span class="number">1ll</span>*w[<span class="number">0</span>]*(i-k)+<span class="number">1ll</span>*w[<span class="number">1</span>]*(j-k))%P,<span class="number">1ll</span>*d*n)*F[i][j])%P;</span><br><span class="line">        &#125;</span><br><span class="line">        ans=(ans+P)*<span class="built_in">qpow</span>(<span class="built_in">qpow</span>(d,k))%P;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/DisjointSemicircles%20TopCoder%20-%2012365/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/DisjointSemicircles%20TopCoder%20-%2012365/" class="post-title-link" itemprop="url">Topcoder SRM568 Div1 DisjointSemicircles (二分图染色)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="topcoder-srm568-div1-disjointsemicircles-二分图染色">Topcoder
SRM568 Div1 DisjointSemicircles (二分图染色)</h1>
<p>题意: 给定数轴上排列的 <span class="math inline">\(2n\)</span>
个点，每个点需要找到另一个点和它匹配，并且以他们为直径两端，向上或者向下作一个半圆</p>
<p>有一些点已经匹配好了，要求判断是否存在一个合法的方案，满足所有的半圆不相交</p>
<p>###思路:</p>
<p>枚举已经确定的匹配半圆的方向(设有 <span
class="math inline">\(m\)</span> 对已匹配)，然后 <span
class="math inline">\(O(n)\)</span> 判断自由点是否存在合法方案</p>
<h3 id="判断合法方案的核心性质">判断合法方案的核心性质:</h3>
<p>定义一个<strong>点的方向</strong>为其所连接的<strong>半圆的方向</strong>(上为0，下为1)</p>
<p>则自由点存在合法方案的充要条件是:</p>
<p>整个序列上每种方向的点数为偶数，且所有已匹配的半圆所覆盖的区间下，和<strong>半圆同向的点</strong>个数为<strong>偶数</strong></p>
<p>必要性:</p>
<p>如果某个半圆下同向点个数为奇数，则必然有一个点与其同向并且不得不连到区间外，这显然不合法</p>
<p>充分性:</p>
<p>一种合法的构造方法是:</p>
<p>按照 <span class="math inline">\(L\)</span>
从左到右，遍历每个已匹配的半圆，如果包含同向子半圆优先解决同向的子半圆</p>
<p>剩下的点依然是偶数个，从左到右依次和上一个匹配即可</p>
<p><span class="math display">\[\  \]</span></p>
<h3 id="判断是否存在合法方案">判断是否存在合法方案</h3>
<p>那么问题转化为判断是否存在一种合法的定向方案，使得某一些区间里0/1的个数为偶数</p>
<p>考虑构建二分图染色，令点集 <span
class="math inline">\(V=\{0,1,\cdots,n,0&#39;,1&#39;,\cdots,n&#39;\}\)</span>
，则 <span class="math inline">\((u,v)\in E\)</span> 表示 <span
class="math inline">\(col(u)\ne col(v)\)</span></p>
<p>其中 <span class="math inline">\(i\)</span> 号节点表示 <span
class="math inline">\(1-i\)</span> 中所有未匹配节点方向的异或和， <span
class="math inline">\(i&#39;\)</span> 表示 <span
class="math inline">\(i\)</span> 的反点 <span
class="math inline">\((i,i&#39;)\in E\)</span></p>
<p>(到这里可以自己想一下怎么连边)</p>
<p>对于已匹配圆 <span class="math inline">\([L,R]\)</span> (注意不要忘了
<span class="math inline">\([1,n]\)</span> )</p>
<p>如果它方向为 <span class="math inline">\(1\)</span> ，显然只需要
<span class="math inline">\(col(L-1)=col(R)\)</span></p>
<p>如果方向为0，设 <span class="math inline">\([L,R]\)</span>
未染色个数为 <span class="math inline">\(k\)</span> ，则显然有 <span
class="math inline">\(col(L-1)=col(R)\oplus (k\mod 2)\)</span>
，即考虑反向的个数</p>
<p>同时对于已匹配点 <span class="math inline">\(i\)</span> ，显然有
<span class="math inline">\(col(i)=col(i-1)\)</span></p>
<p>由此，得到一个 <span class="math inline">\(O(n)\)</span>
点数边数的图</p>
<p>如果在 <span class="math inline">\(\text{dfs}\)</span>
枚举时同步加边和回撤，总复杂度就为 <span
class="math inline">\(O(2^m\cdot n)\)</span></p>
<p>由于不可能所有方案都合法，实际应该是一个比较松的上界</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">110</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">int</span> cnt[N];</span><br><span class="line"><span class="type">int</span> L[N],R[N],m,Cross[N][N];</span><br><span class="line"><span class="type">int</span> vec[<span class="number">2</span>][N],c[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> u,v,nxt;</span><br><span class="line">&#125;e[N*<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> head[N],ecnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	e[++ecnt]=(Edge)&#123;u,v,head[u]&#125;;</span><br><span class="line">	head[u]=ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span>&#123; </span><br><span class="line">	<span class="built_in">AddEdge</span>(u,v),<span class="built_in">AddEdge</span>(v,u); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Back</span><span class="params">()</span></span>&#123;</span><br><span class="line">	head[e[ecnt].u]=e[ecnt].nxt,ecnt--;</span><br><span class="line">	head[e[ecnt].u]=e[ecnt].nxt,ecnt--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ans,fl;</span><br><span class="line"><span class="type">int</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_col</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">	vis[u]=c;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=e[i].nxt)&#123;</span><br><span class="line">		<span class="type">int</span> v=e[i].v;</span><br><span class="line">		<span class="keyword">if</span>(!vis[v]) <span class="built_in">dfs_col</span>(v,<span class="number">3</span>-c);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(vis[v]==vis[u]) fl=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(ans) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span>(p&gt;m)&#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n*<span class="number">2</span>+<span class="number">1</span>) vis[i]=<span class="number">0</span>;</span><br><span class="line">		fl=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n*<span class="number">2</span>+<span class="number">1</span>) <span class="keyword">if</span>(!vis[i]) <span class="built_in">dfs_col</span>(i,<span class="number">1</span>);</span><br><span class="line">		ans|=fl;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="type">int</span> fl=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,c[i]) <span class="keyword">if</span>(R[vec[i][j]]&gt;L[p] &amp;&amp; R[vec[i][j]]&lt;R[p]) fl=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">		vec[i][++c[i]]=p;</span><br><span class="line">		<span class="keyword">if</span>(i || ~(cnt[R[p]]-cnt[L[p]])&amp;<span class="number">1</span>) <span class="built_in">Link</span>(L[p]+n+<span class="number">1</span>,R[p]<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">Link</span>(L[p],R[p]<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">dfs</span>(p+<span class="number">1</span>);</span><br><span class="line">		c[i]--,<span class="built_in">Back</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DisjointSemicircles</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">string <span class="title">getPossibility</span><span class="params">(vector &lt;<span class="type">int</span>&gt; labels)</span> </span>&#123;</span><br><span class="line">		n=labels.<span class="built_in">size</span>(),m=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) a[i]=labels[i<span class="number">-1</span>];</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">			cnt[i]=cnt[i<span class="number">-1</span>]+(a[i]==<span class="number">-1</span>);</span><br><span class="line">			<span class="keyword">if</span>(~a[i]) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,n) <span class="keyword">if</span>(a[j]==a[i]) L[++m]=i,R[m]=j;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!m) <span class="keyword">return</span> <span class="string">&quot;POSSIBLE&quot;</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,(n+<span class="number">1</span>)*<span class="number">2</span>) head[i]=ecnt=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(~a[i]) <span class="built_in">Link</span>(i+n+<span class="number">1</span>,i<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n) <span class="built_in">Link</span>(i,i+n+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">Link</span>(n+<span class="number">1</span>,n);</span><br><span class="line">		ans=<span class="number">0</span>,<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> ans?<span class="string">&quot;POSSIBLE&quot;</span>:<span class="string">&quot;IMPOSSIBLE&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/BoundedOptimization%20TopCoder%20-%2012294/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/BoundedOptimization%20TopCoder%20-%2012294/" class="post-title-link" itemprop="url">[BoundedOptimization TopCoder - 12294](https://vjudge.net/problem/TopCoder-12294)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="boundedoptimization-topcoder---12294"><a
target="_blank" rel="noopener" href="https://vjudge.net/problem/TopCoder-12294">BoundedOptimization
TopCoder - 12294</a></h1>
<p>考虑在最优情况下，某一些数在 <span
class="math inline">\(\text{lowerbound}\)</span> ,某一些在 <span
class="math inline">\(\text{upperbound}\)</span></p>
<p>确定了这些数之后，对于那些处于 <span
class="math inline">\((\text{lowerbound,upperbound})\)</span>
之间的数，它们的值其实是在<strong>忽略了上下界的情况下能取到的最优情况</strong></p>
<p>否则只要上下移动一点就可能达到一个更优的情况</p>
<p>那么考虑枚举每个数的状态在 <span
class="math inline">\(\text{lowerbound,upperbound,(lowerbound,uppperbound)}\)</span></p>
<p>推论：在中间的数之间必然存在互相关系</p>
<p>假设存在两个数 <span class="math inline">\(x_i,x_j\)</span>
之间没有互相关系，令其他数不变，</p>
<p>则答案式子可以表示为 <span class="math inline">\(ax_i+bx_j+c\)</span>
的形式，改变两个数的值总能得到更优的情况</p>
<p><span class="math display">\[ \ \]</span></p>
<p>设处在中间位置的数为 <span
class="math inline">\(x_1,\cdots,x_m\)</span> ，其他数为 <span
class="math inline">\(y_1,\cdots ,y_k\)</span>
，每个数连到外面的权值总和为 <span
class="math inline">\(s_i\)</span></p>
<p>发现在最优情况下， <span class="math inline">\(\sum x_i+\sum y_i
=MaxSum\)</span> ，那么就确定了 <span class="math inline">\(\sum
x_i\)</span> 的值，设为 <span class="math inline">\(Sum\)</span></p>
<p>那么答案就可以表示为 <span
class="math inline">\(\begin{aligned}\frac{\sum_ix_i\cdot(Sum-x_i+2\cdot
s_i)}{2}\end{aligned}+c\)</span></p>
<p>其中常数 <span class="math inline">\(c\)</span>
是外面的数之间的总和</p>
<p>不考虑限制的情况下，最优情况是 <span
class="math inline">\(x_i=\frac{Sum+s_i}{2}\)</span></p>
<p>此时，若 <span class="math inline">\(\sum x_i\ne Sum\)</span>
，是不合法的，需要调整</p>
<p>而让每个数改变 <span class="math inline">\(d\)</span>
，减少的答案都是 <span class="math inline">\(d^2\)</span>
(因为原来是在二次函数的最高点)</p>
<p>所以每个数都改变 <span
class="math inline">\(\begin{aligned}\frac{\sum
\frac{Sum+x_i}{2}-Sum}{m}\end{aligned}\)</span> 是最优的</p>
<p>注意这里计算时都是<strong>忽略了</strong> <span
class="math inline">\(x_1,\cdots,x_m\)</span> 的 <span
class="math inline">\(\text{lowerbound,upperbound}\)</span>
，求出的值不一定合法</p>
<p>如果不合法说明至少有某个值该到上下界之后答案会更优，所以这次的答案不用考虑</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> db;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">30</span>;</span><br><span class="line"><span class="type">const</span> db eps=<span class="number">1e-7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> G[N][N];</span><br><span class="line"><span class="type">int</span> A[N],w[N];</span><br><span class="line">db val[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoundedOptimization</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">maxValue</span><span class="params">(vector &lt;string&gt; Expr, vector &lt;<span class="type">int</span>&gt; L, vector &lt;<span class="type">int</span>&gt; R, <span class="type">int</span> Max)</span> </span>&#123;</span><br><span class="line">		string E=<span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="keyword">for</span>(string t:Expr) E+=t;</span><br><span class="line">		<span class="built_in">memset</span>(G,<span class="number">0</span>,<span class="keyword">sizeof</span> G);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,E.<span class="built_in">size</span>()<span class="number">-1</span>) <span class="keyword">if</span>(<span class="built_in">isalpha</span>(E[i])) &#123;</span><br><span class="line">			G[E[i]-<span class="string">&#x27;a&#x27;</span>][E[i+<span class="number">1</span>]-<span class="string">&#x27;a&#x27;</span>]=G[E[i+<span class="number">1</span>]-<span class="string">&#x27;a&#x27;</span>][E[i]-<span class="string">&#x27;a&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> n=L.<span class="built_in">size</span>();</span><br><span class="line">		db ans=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(S,<span class="number">0</span>,<span class="built_in">pow</span>(<span class="number">3</span>,n)<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> T=S,m=<span class="number">0</span>;</span><br><span class="line">			db res=<span class="number">0</span>,sum=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">				w[i]=T%<span class="number">3</span>;</span><br><span class="line">				<span class="keyword">if</span>(!w[i]) A[++m]=i;</span><br><span class="line">				<span class="keyword">else</span> val[i]=(w[i]==<span class="number">1</span>?L[i]:R[i]),sum+=val[i];</span><br><span class="line">				T/=<span class="number">3</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="type">int</span> fl=sum&lt;=Max;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,m) <span class="keyword">if</span>(!G[A[i]][A[j]]) fl=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">			db left=Max-sum; </span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">				db c=left;</span><br><span class="line">				<span class="built_in">rep</span>(j,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(w[j] &amp;&amp; G[A[i]][j]) c+=val[j]*<span class="number">2</span>;</span><br><span class="line">				val[A[i]]=c/<span class="number">2</span>;</span><br><span class="line">				sum+=val[A[i]];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(m)&#123;</span><br><span class="line">				db t=(sum-Max)/m;</span><br><span class="line">				<span class="built_in">rep</span>(i,<span class="number">1</span>,m) val[A[i]]-=t;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(val[i]&lt;L[i]-eps || val[i]&gt;R[i]+eps) fl=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(G[i][j]) res+=val[i]*val[j];</span><br><span class="line">			<span class="built_in">cmax</span>(ans,res);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ans;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/20/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/22/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">orangejuice</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
