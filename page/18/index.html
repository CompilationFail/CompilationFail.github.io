<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"compilationfail.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="orangejuice&#39;s blog">
<meta property="og:url" content="https://compilationfail.github.io/page/18/index.html">
<meta property="og:site_name" content="orangejuice&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="orangejuice">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://compilationfail.github.io/page/18/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/18/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>orangejuice's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
  <script type="text/javascript">
    const bgc = 15;
    const bgu = "/images/bg";
    function getcookie() {
      // console.log("get", document.cookie);
      const s = document.cookie;
      return s.split('; ').find((row)=>row.startsWith("bgid="))?.split("=")[1];
    }
    function set_bg(index) {
      console.log("set", index);
      document.cookie = `bgid=${index}; path=/`;
      // console.log(document.cookie);
      url = `/images/bg${index}.jpg`;
      document.body.style=`background-image:url(${url});background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:fixed;`;
    }
    var index = parseInt(getcookie());
    if(isNaN(index) || index < 0 || index >= bgc) index = -1;
    window.onload = () => { set_bg(index) };
  </script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">orangejuice's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">挂了请务必叫我</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="orangejuice"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">orangejuice</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">269</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://twitter.com/ChenJerson" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;ChenJerson" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/3950662532/profile?rightmod=1&wvr=6&mod=personinfo" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;3950662532&#x2F;profile?rightmod&#x3D;1&amp;wvr&#x3D;6&amp;mod&#x3D;personinfo" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/CompilationFail" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CompilationFail" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/profiles/76561198969516062/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198969516062&#x2F;" rel="noopener me" target="_blank"><i class="fab fa-steam fa-fw"></i>Steam</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.last.fm/user/chasedeath" title="Lastfm → https:&#x2F;&#x2F;www.last.fm&#x2F;user&#x2F;chasedeath" rel="noopener me" target="_blank"><i class="fab fa-lastfm-square fa-fw"></i>Lastfm</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://open.spotify.com/user/mgxnlznf9dli6bm4k3sp0iuwz" title="Spotify → https:&#x2F;&#x2F;open.spotify.com&#x2F;user&#x2F;mgxnlznf9dli6bm4k3sp0iuwz" rel="noopener me" target="_blank"><i class="fab fa-spotify fa-fw"></i>Spotify</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CROI%202017%20Day%201%E3%80%8D%E8%99%8E%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CROI%202017%20Day%201%E3%80%8D%E8%99%8E%20/" class="post-title-link" itemprop="url">「ROI 2017 Day 1」虎   (计算几何)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="roi-2017-day-1虎-计算几何">「ROI 2017 Day 1」虎 (计算几何)</h1>
<p>题意：（交互题）</p>
<p>已知 <span class="math inline">\(n\)</span> 个点， <span
class="math inline">\(m\)</span>
次询问，每次询问交互器随机生成一个位置的关键点，要求在 <span
class="math inline">\(k\)</span> 次查询中给出一个合法解</p>
<p>查询：一个凸包，返回关键点是否在凸包中</p>
<p>解：一个凸包，包含关键点，且不包含其它点，保证有界</p>
<p>对关键点的包含是包括了边界线的，其它点的包含不包括边界线，凸包均要按照顺时针给出</p>
<h3 id="solution-1-未完全实现">Solution 1 <del>（未完全实现）</del></h3>
<p>先将给定点分层转化为若干凸包，容易通过二分得到关键点所在的层</p>
<p>如果关键点以内不再有凸包，显然得到一个解</p>
<p>否则，一个合法的解一定是在两层凸包中某一层选取两个点，另一层选取一个点得到的三角形</p>
<p>先考虑内层选两个点的情况，令二分边界为内层凸包上点的编号， <span
class="math inline">\(l,r\)</span></p>
<p>考虑实现一个操作，对于 <span class="math inline">\(l,r\)</span>
，找到其连接的直线在顺时针方向上在外层凸包上切到的段</p>
<p>由此得到一个凸包进行查询，即可进行二分，最终 <span
class="math inline">\(l+1=r\)</span>
时，再进行一次上述操作得到一组解（不一定合法）</p>
<p>如果不合法，同理再在外层上二分一次</p>
<p>最终写道第一种情况弃掉了。。。</p>
<p><span class="math display">\[ \ \]</span></p>
<p><span class="math display">\[ \ \]</span></p>
<h3 id="solution2-随机分裂">Solution2 随机分裂</h3>
<p>良好的随机分裂可以跑到max query times&lt;=33的好成绩</p>
<p>考虑一个非常简单的剖开 <span class="math inline">\(n\)</span>
个点的方法：</p>
<p>1.找到这些点的<strong>凸包</strong>，从点集中删掉</p>
<p>2.从剩余点中选择一个作为<strong>中心</strong>，分别与凸包上的点连边，将平面分开</p>
<p>3.确定每个三角形中包含的点，加上三个顶点，继续进行剖分</p>
<p>最终当凸包以外不再有点时，结束</p>
<p><span class="math display">\[ \ \]</span></p>
<p>查询也是比较显然的：</p>
<p>对于当前凸包及其中心，二分找到关键点对应的位置，然后继续进行，直到不存在中心</p>
<p>二分方法：</p>
<p>凸包构成一圈，取一个点为 <span class="math inline">\(l\)</span>
，顺时针180以内的范围最大角度的点为 <span
class="math inline">\(r\)</span> ，每次将中心和 <span
class="math inline">\(l,mid\)</span> 这连续一段查询判断是否包含</p>
<p>这样存在的问题是：可能不在 <span class="math inline">\(l\)</span>
的180范围内，需要在开始二分前判断一下</p>
<p>十分朴素的实现也可以获得90分的好成绩</p>
<p>优化：</p>
<p>每次选取中心时，多随机几次，估价找到一个最优剖分即可</p>
<p><a target="_blank" rel="noopener" href="https://loj.ac/s/1052555">Loj Submission
-包含大量调试语句和内嵌的交互部分</a></p>
<p><a target="_blank" rel="noopener" href="https://loj.ac/s/1053342">Loj Submission</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ull;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> db;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T&amp; a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T&amp; a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>,f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> Mbe;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">5010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,q;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算几何部分</span></span><br><span class="line"><span class="keyword">namespace</span> Geometry&#123;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">	ll x,y;</span><br><span class="line">	<span class="built_in">Node</span>()&#123;&#125;</span><br><span class="line">	<span class="built_in">Node</span>(ll x,ll y):<span class="built_in">x</span>(x),<span class="built_in">y</span>(y)&#123;&#125;</span><br><span class="line">	Node <span class="keyword">operator</span> - (<span class="type">const</span> Node __) <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Node</span>(x-__.x,y-__.y); &#125;</span><br><span class="line">	Node <span class="keyword">operator</span> + (<span class="type">const</span> Node __) <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Node</span>(x+__.x,y+__.y); &#125;</span><br><span class="line">	ll <span class="keyword">operator</span> ^ (<span class="type">const</span> Node __) <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="number">1ll</span>*x*__.y<span class="number">-1ll</span>*y*__.x; &#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> == (<span class="type">const</span> Node __) <span class="type">const</span> &#123; <span class="keyword">return</span> x==__.x &amp;&amp; y==__.y; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Read</span><span class="params">()</span></span>&#123; x=<span class="built_in">rd</span>(),y=<span class="built_in">rd</span>(); &#125;</span><br><span class="line">&#125; A[N],QuePoint;</span><br><span class="line"><span class="keyword">typedef</span> vector &lt;<span class="type">int</span>&gt; V;</span><br><span class="line"><span class="comment">// check close wise</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chk</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> j,<span class="type">int</span> k,<span class="type">int</span> bound=<span class="number">0</span>)</span></span>&#123; <span class="keyword">return</span> ((A[k]-A[i])^(A[j]-A[i]))&gt;=bound; &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">chk</span><span class="params">(Node i,<span class="type">int</span> j,<span class="type">int</span> k,<span class="type">int</span> bound=<span class="number">0</span>)</span></span>&#123; <span class="keyword">return</span> ((A[k]-i)^(A[j]-i))&gt;=bound; &#125;</span><br><span class="line"><span class="comment">// this is clockwise</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CheckConvex</span><span class="params">(<span class="type">const</span> V &amp;P)</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> n=P.<span class="built_in">size</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> j=(i+<span class="number">1</span>)%n,k=(j+<span class="number">1</span>)%n;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="built_in">chk</span>(P[j],P[k],P[i])) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// this is clock-wise</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CheckIn</span><span class="params">(<span class="type">const</span> V&amp;P,Node X,<span class="type">int</span> bound=<span class="number">0</span>)</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,P.<span class="built_in">size</span>()<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> j=(i+<span class="number">1</span>)%P.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">chk</span>(X,P[i],P[j],bound)) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">(V P)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(P.<span class="built_in">size</span>()&lt;=<span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;? %llu &quot;</span>,P.<span class="built_in">size</span>());</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i:P) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i); </span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	<span class="built_in">fflush</span>(stdout);</span><br><span class="line">	<span class="type">static</span> <span class="type">char</span> s[<span class="number">5</span>]; <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s);</span><br><span class="line">	<span class="keyword">return</span> *s==<span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Output</span><span class="params">(V P)</span></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;! %llu &quot;</span>,P.<span class="built_in">size</span>());</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i:P) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	<span class="built_in">fflush</span>(stdout);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">V <span class="title">Convex</span><span class="params">(V P)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(P.<span class="built_in">size</span>()&lt;=<span class="number">2</span>) <span class="keyword">return</span> P;</span><br><span class="line">	V Ans;</span><br><span class="line">	<span class="type">int</span> n=P.<span class="built_in">size</span>();</span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> I[N],mk[N],S[N],T;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) mk[I[P[i]]=i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">sort</span>(P.<span class="built_in">begin</span>(),P.<span class="built_in">end</span>(),[&amp;](<span class="type">int</span> x,<span class="type">int</span> y)&#123; <span class="keyword">return</span> A[x].x&lt;A[y].x || (A[x].x==A[y].x &amp;&amp; A[x].y&gt;A[y].y); &#125;);</span><br><span class="line">	T=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="keyword">while</span>(T&gt;<span class="number">1</span> &amp;&amp; ((A[P[i]]-A[S[T]])^(A[S[T<span class="number">-1</span>]]-A[S[T]]))&gt;<span class="number">0</span> ) T--;</span><br><span class="line">		S[++T]=P[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,T) Ans.<span class="built_in">pb</span>(S[i]),mk[I[S[i]]]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">sort</span>(P.<span class="built_in">begin</span>(),P.<span class="built_in">end</span>(),[&amp;](<span class="type">int</span> x,<span class="type">int</span> y)&#123; <span class="keyword">return</span> A[x].x&lt;A[y].x || (A[x].x==A[y].x &amp;&amp; A[x].y&lt;A[y].y); &#125;);</span><br><span class="line">	T=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="keyword">while</span>(T&gt;<span class="number">1</span> &amp;&amp; ((A[P[i]]-A[S[T]])^(A[S[T<span class="number">-1</span>]]-A[S[T]]))&lt;<span class="number">0</span> ) T--;</span><br><span class="line">		S[++T]=P[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">drep</span>(i,T,<span class="number">1</span>) <span class="keyword">if</span>(!mk[I[S[i]]]) Ans.<span class="built_in">pb</span>(S[i]);</span><br><span class="line">	<span class="keyword">return</span> Ans;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Geometry;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">V C[M],S[M];</span><br><span class="line"><span class="type">int</span> K[M],D[M],E[M],rt,m,mk[M];</span><br><span class="line"><span class="comment">// 剖分</span></span><br><span class="line"><span class="comment">// C凸包，S子节点</span></span><br><span class="line"><span class="comment">// K中心，D凸包上0号点对应的180范围内的最大点，E凸包上D号点对应180范围内的最大点</span></span><br><span class="line"><span class="comment">// m个数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Build</span><span class="params">(<span class="type">int</span> &amp;u,V P)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">sort</span>(P.<span class="built_in">begin</span>(),P.<span class="built_in">end</span>());</span><br><span class="line">	<span class="type">int</span> n=P.<span class="built_in">size</span>();</span><br><span class="line">	C[u=++m]=<span class="built_in">Convex</span>(P);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) mk[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(C[u].<span class="built_in">size</span>()==P.<span class="built_in">size</span>()) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i:C[u]) mk[<span class="built_in">lower_bound</span>(P.<span class="built_in">begin</span>(),P.<span class="built_in">end</span>(),i)-P.<span class="built_in">begin</span>()]=<span class="number">1</span>;</span><br><span class="line">	V T; <span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(!mk[i]) T.<span class="built_in">pb</span>(P[i]);</span><br><span class="line">	n=C[u].<span class="built_in">size</span>();</span><br><span class="line">    <span class="comment">// 获取剖分结果</span></span><br><span class="line">	<span class="keyword">auto</span> Get=[&amp;]() &#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">rand</span>()&amp;<span class="number">1</span>) K[u]=T[(T.<span class="built_in">size</span>()/(<span class="built_in">rand</span>()%<span class="number">3</span>+<span class="number">2</span>)+<span class="built_in">rand</span>()%<span class="number">8</span>)%T.<span class="built_in">size</span>()];</span><br><span class="line">		<span class="keyword">else</span> K[u]=T[<span class="built_in">rand</span>()%T.<span class="built_in">size</span>()];</span><br><span class="line">		V P=T; P.<span class="built_in">erase</span>(<span class="built_in">lower_bound</span>(P.<span class="built_in">begin</span>(),P.<span class="built_in">end</span>(),K[u]));</span><br><span class="line">		D[u]=E[u]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(D[u]&lt;n<span class="number">-1</span> &amp;&amp; <span class="built_in">chk</span>(K[u],C[u][<span class="number">0</span>],C[u][D[u]+<span class="number">1</span>])) D[u]++;</span><br><span class="line">		E[u]=D[u];</span><br><span class="line">		<span class="keyword">while</span>(E[u]&lt;n<span class="number">-1</span> &amp;&amp; <span class="built_in">chk</span>(K[u],C[u][D[u]],C[u][E[u]+<span class="number">1</span>])) E[u]++;</span><br><span class="line">		vector &lt;V&gt; <span class="built_in">ST</span>(n);</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> x:P) &#123;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>(<span class="built_in">chk</span>(K[u],C[u][i],x) &amp;&amp; <span class="built_in">chk</span>(K[u],x,C[u][(i+<span class="number">1</span>)%n])) &#123;</span><br><span class="line">					ST[i].<span class="built_in">pb</span>(x);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) ST[i].<span class="built_in">pb</span>(K[u]),ST[i].<span class="built_in">pb</span>(C[u][i]),ST[i].<span class="built_in">pb</span>(C[u][(i+<span class="number">1</span>)%n]);</span><br><span class="line">		<span class="keyword">return</span> ST;</span><br><span class="line">	&#125;;</span><br><span class="line">	vector &lt;V&gt; st;</span><br><span class="line">	<span class="type">int</span> mi=<span class="number">1e9</span>;</span><br><span class="line">	<span class="built_in">rep</span>(kase,<span class="number">1</span>,<span class="number">5</span>) &#123;</span><br><span class="line">		<span class="type">int</span> d=D[u],e=E[u],k=K[u];</span><br><span class="line">		<span class="keyword">auto</span> ST=<span class="built_in">Get</span>();</span><br><span class="line">		<span class="type">int</span> now=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(V j:ST) <span class="built_in">cmax</span>(now,(<span class="type">int</span>)j.<span class="built_in">size</span>());</span><br><span class="line">		<span class="keyword">if</span>(now&gt;mi)&#123; D[u]=d,E[u]=e,K[u]=k; <span class="keyword">continue</span>; &#125;</span><br><span class="line">		st=ST,mi=now;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> x; <span class="built_in">Build</span>(x,st[i]);</span><br><span class="line">		S[u].<span class="built_in">pb</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function">V <span class="title">T</span><span class="params">(n)</span></span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) T[i]=i+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">Build</span>(rt,T);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Find</span><span class="params">(<span class="type">int</span> u=rt)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!S[u].<span class="built_in">size</span>()) <span class="keyword">return</span> <span class="built_in">Output</span>(C[u]);</span><br><span class="line">	<span class="type">int</span> n=C[u].<span class="built_in">size</span>();</span><br><span class="line">	<span class="type">int</span> l,r;</span><br><span class="line">	<span class="keyword">auto</span> Get=[&amp;](<span class="type">int</span> l,<span class="type">int</span> r) &#123;</span><br><span class="line">		V T; T.<span class="built_in">pb</span>(K[u]);</span><br><span class="line">		l%=n,r%=n;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=l;;i=(i+<span class="number">1</span>)%n) &#123;</span><br><span class="line">			T.<span class="built_in">pb</span>(C[u][i]);</span><br><span class="line">			<span class="keyword">if</span>(i==r) <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Check</span>(T);</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">Get</span>(<span class="number">0</span>,D[u])) l=<span class="number">0</span>,r=D[u];</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">Get</span>(D[u],E[u])) l=D[u],r=E[u];</span><br><span class="line">	<span class="keyword">else</span> l=E[u],r=n;</span><br><span class="line">	<span class="keyword">while</span>(l+<span class="number">1</span>&lt;r) &#123;</span><br><span class="line">		<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">Get</span>(l,mid)) r=mid;</span><br><span class="line">		<span class="keyword">else</span> l=mid;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">Find</span>(S[u][l]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123; </span><br><span class="line">	n=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) A[i].<span class="built_in">Read</span>();</span><br><span class="line">	<span class="built_in">Init</span>();</span><br><span class="line">	q=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(_,<span class="number">1</span>,q) <span class="built_in">Find</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CROI%202019%20Day1%E3%80%8D%E8%BF%90%E8%BE%93%202019/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CROI%202019%20Day1%E3%80%8D%E8%BF%90%E8%BE%93%202019/" class="post-title-link" itemprop="url">「ROI 2019 Day1」运输 20/19</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="roi-2019-day1运输-2019">「ROI 2019 Day1」运输 20/19</h1>
<p>题目大意：</p>
<p>给定一个带权 <span class="math inline">\(DAG\)</span> ， <span
class="math inline">\(1\)</span> 为起始点，给定小常数 <span
class="math inline">\(p\)</span></p>
<p>每次查询一个点 <span class="math inline">\(u\)</span> ，一个权值
<span class="math inline">\(r\)</span> ，问是否存在一条路径 <span
class="math inline">\(1\ldots u\)</span> ，其长度 <span
class="math inline">\(x\)</span> 满足 <span class="math inline">\(r\leq
x\leq \frac{p}{p-1}\cdot r\)</span></p>
<p>转换一下， <span class="math inline">\(dp\)</span> 每个点是否存在
<span class="math inline">\(r\)</span> ，那么对于路径的权值 <span
class="math inline">\(x\)</span> ，合法的 <span
class="math inline">\(r\)</span> 即为 <span
class="math inline">\([\frac{p-1}{p}\cdot x,x]\)</span></p>
<p>对于任意两个区间，如果其相交，则可以合并，并且用两个区间中最小和最大的
<span class="math inline">\(x\)</span> 来表示这个区间</p>
<p>而不相交的区间最多只有 <span
class="math inline">\(\log_{\frac{p}{p-1}} w\)</span> 段，大概 <span
class="math inline">\(700\)</span> 段</p>
<p>任意时刻，每个点的 <span class="math inline">\(dp\)</span> 情况可以用
<span class="math inline">\(700\)</span>
段不交的区间表示，转移可以归并数组进行</p>
<p>因此维护 <span class="math inline">\(dp\)</span> 复杂度为 <span
class="math inline">\(O(m\log_{\frac{p}{p-1}} w)\)</span>
常数极小，单次查询复杂度为 <span class="math inline">\(O(\log
\log_{\frac{p}{p-1}} w)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>=<span class="type">int</span>&gt; T <span class="built_in">rd</span>()&#123;</span><br><span class="line">	T s=<span class="number">0</span>; <span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,q,p;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Interval</span>&#123;</span><br><span class="line">	ll l,r,x,y;</span><br><span class="line">	<span class="built_in">Interval</span>(ll a,ll b)&#123; </span><br><span class="line">		x=a,y=b;</span><br><span class="line">		l=(x*(p<span class="number">-1</span>)+p<span class="number">-1</span>)/p,r=y;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Add</span><span class="params">(ll c)</span></span>&#123;</span><br><span class="line">		x+=c,y+=c;</span><br><span class="line">		l=(x*(p<span class="number">-1</span>)+p<span class="number">-1</span>)/p,r=y;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> &amp; (<span class="type">const</span> Interval &amp;__) <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">min</span>(r,__.r)&gt;=<span class="built_in">max</span>(l,__.l)<span class="number">-1</span>; &#125;</span><br><span class="line">	Interval <span class="keyword">operator</span> + (<span class="type">const</span> Interval &amp;__) <span class="type">const</span> &#123; <span class="keyword">return</span> <span class="built_in">Interval</span>(<span class="built_in">min</span>(x,__.x),<span class="built_in">max</span>(y,__.y)); &#125;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> ll &amp;x) <span class="type">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> r&lt;x;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">vector &lt;Interval&gt; dp[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> to,nxt; ll w;</span><br><span class="line">&#125; e[N];</span><br><span class="line"><span class="type">int</span> head[N],ecnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,ll w)</span></span>&#123;</span><br><span class="line">	e[++ecnt]=(Edge)&#123;v,head[u],w&#125;;</span><br><span class="line">	head[u]=ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Trans</span><span class="params">(vector &lt;Interval&gt; &amp;x,vector &lt;Interval&gt; y,ll c)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> &amp;i:y) i.<span class="built_in">Add</span>(c);</span><br><span class="line">	vector &lt;Interval&gt; res;</span><br><span class="line">	<span class="type">int</span> p1=<span class="number">0</span>,p2=<span class="number">0</span>,s1=x.<span class="built_in">size</span>(),s2=y.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">while</span>(p1&lt;s1 || p2&lt;s2) &#123;</span><br><span class="line">		<span class="keyword">if</span>(p1&lt;s1 &amp;&amp; (p2==s2 || x[p1].l&lt;=y[p2].l)) &#123;</span><br><span class="line">			<span class="keyword">if</span>(res.<span class="built_in">size</span>() &amp;&amp; *res.<span class="built_in">rbegin</span>()&amp;x[p1]) res[res.<span class="built_in">size</span>()<span class="number">-1</span>]=*res.<span class="built_in">rbegin</span>()+x[p1++];</span><br><span class="line">			<span class="keyword">else</span> res.<span class="built_in">pb</span>(x[p1++]);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(res.<span class="built_in">size</span>() &amp;&amp; *res.<span class="built_in">rbegin</span>()&amp;y[p2]) res[res.<span class="built_in">size</span>()<span class="number">-1</span>]=*res.<span class="built_in">rbegin</span>()+y[p2++];</span><br><span class="line">			<span class="keyword">else</span> res.<span class="built_in">pb</span>(y[p2++]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	x=res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(kase,<span class="number">1</span>,<span class="built_in">rd</span>()) &#123;</span><br><span class="line">		n=<span class="built_in">rd</span>(),m=<span class="built_in">rd</span>(),q=<span class="built_in">rd</span>(),p=<span class="built_in">rd</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) head[i]=ecnt=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m)&#123;</span><br><span class="line">			<span class="type">int</span> u=<span class="built_in">rd</span>(),v=<span class="built_in">rd</span>(); ll w=<span class="built_in">rd</span>&lt;ll&gt;();</span><br><span class="line">			<span class="built_in">AddEdge</span>(u,v,w);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) dp[i].<span class="built_in">clear</span>();</span><br><span class="line">		dp[<span class="number">1</span>].<span class="built_in">pb</span>(<span class="built_in">Interval</span>(<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">		<span class="built_in">rep</span>(u,<span class="number">1</span>,n) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=e[i].nxt) &#123;</span><br><span class="line">				<span class="built_in">Trans</span>(dp[e[i].to],dp[u],e[i].w);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span>(q--)&#123;</span><br><span class="line">			<span class="type">int</span> x=<span class="built_in">rd</span>(); ll y=<span class="built_in">rd</span>&lt;ll&gt;();</span><br><span class="line">			<span class="keyword">auto</span> p=<span class="built_in">lower_bound</span>(dp[x].<span class="built_in">begin</span>(),dp[x].<span class="built_in">end</span>(),y);</span><br><span class="line">			<span class="keyword">if</span>(p!=dp[x].<span class="built_in">end</span>() &amp;&amp; p-&gt;l&lt;=y) <span class="built_in">putchar</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">			<span class="keyword">else</span> <span class="built_in">putchar</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202020.12%20Platinum%E3%80%8DSleeping%20Cows/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202020.12%20Platinum%E3%80%8DSleeping%20Cows/" class="post-title-link" itemprop="url">「USACO 2020.12 Platinum」Sleeping Cows</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="usaco-2020.12-platinumsleeping-cows">「USACO 2020.12
Platinum」Sleeping Cows</h1>
<p>写容斥就输了。。</p>
<p>为每个牛棚考虑牛，从大到小，考虑每一个牛棚是否匹配</p>
<p><span class="math inline">\(dp_{i,j,f}\)</span> 表示后 <span
class="math inline">\(i\)</span> 个牛棚中有 <span
class="math inline">\(j\)</span> 个钦定要匹配但是还未匹配的牛棚， <span
class="math inline">\(f=0/1\)</span> 表示是否存在一个牛棚未选</p>
<p>每次移动 <span class="math inline">\(i\)</span>
，会有一部分牛不能继续匹配</p>
<p>如果 <span class="math inline">\(f=1\)</span>
，那么这部分牛必须被全部后面的 <span class="math inline">\(j\)</span>
个牛棚中某一些匹配，否则不合法</p>
<p>如果 <span class="math inline">\(f=0\)</span>
，这一部分可以随便匹配一定数量的牛</p>
<p>用组合数维护转移权值即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">3010</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> dp[N][N][<span class="number">2</span>],I[N],J[N],C[N][N];</span><br><span class="line"><span class="type">int</span> A[N],B[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> &amp;u,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">	u+=x,<span class="built_in">Mod1</span>(u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">qpow</span><span class="params">(ll x,ll k=P<span class="number">-2</span>)</span> </span>&#123;</span><br><span class="line">	ll res=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(;k;k&gt;&gt;=<span class="number">1</span>,x=x*x%P) <span class="keyword">if</span>(k&amp;<span class="number">1</span>) res=res*x%P;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;cow.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;cow.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	n=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) B[i]=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) A[i]=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">sort</span>(A+<span class="number">1</span>,A+n+<span class="number">1</span>),<span class="built_in">sort</span>(B+<span class="number">1</span>,B+n+<span class="number">1</span>);</span><br><span class="line">	<span class="type">int</span> p=n;</span><br><span class="line">	dp[n+<span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,n) <span class="built_in">rep</span>(j,C[i][<span class="number">0</span>]=<span class="number">1</span>,i) C[i][j]=(C[i<span class="number">-1</span>][j]+C[i<span class="number">-1</span>][j<span class="number">-1</span>])%P;</span><br><span class="line">	<span class="built_in">rep</span>(i,J[<span class="number">0</span>]=<span class="number">1</span>,n) J[i]=<span class="number">1ll</span>*J[i<span class="number">-1</span>]*i%P;</span><br><span class="line">	I[n]=<span class="built_in">qpow</span>(J[n]);</span><br><span class="line">	<span class="built_in">drep</span>(i,n,<span class="number">1</span>) I[i<span class="number">-1</span>]=<span class="number">1ll</span>*I[i]*i%P;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">drep</span>(i,n,<span class="number">0</span>) &#123;</span><br><span class="line">		<span class="type">int</span> c=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(p &amp;&amp; B[p]&gt;A[i]) c++,p--;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">0</span>,n-i) &#123;</span><br><span class="line">			<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="built_in">min</span>(j,c)) &#123;</span><br><span class="line">				<span class="type">int</span> t=<span class="number">1ll</span>*dp[i+<span class="number">1</span>][j][<span class="number">0</span>]*C[c][k]%P*C[j][k]%P*J[k]%P;</span><br><span class="line">				<span class="built_in">Add</span>(dp[i][j-k][<span class="number">1</span>],t),<span class="built_in">Add</span>(dp[i][j-k+<span class="number">1</span>][<span class="number">0</span>],t);</span><br><span class="line">				<span class="keyword">if</span>(k==c) &#123;</span><br><span class="line">					t=<span class="number">1ll</span>*dp[i+<span class="number">1</span>][j][<span class="number">1</span>]*C[j][k]%P*J[k]%P;</span><br><span class="line">					<span class="built_in">Add</span>(dp[i][j-k][<span class="number">1</span>],t),<span class="built_in">Add</span>(dp[i][j-k+<span class="number">1</span>][<span class="number">1</span>],t);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> ans=(dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]+dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">1</span>])%P;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CROI%202019%20Day2%E3%80%8D%E6%A8%A1%E5%BC%8F%E4%B8%B2%E6%9F%A5%E6%89%BE%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CROI%202019%20Day2%E3%80%8D%E6%A8%A1%E5%BC%8F%E4%B8%B2%E6%9F%A5%E6%89%BE%20/" class="post-title-link" itemprop="url">「ROI 2019 Day2」模式串查找 (口胡)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="roi-2019-day2模式串查找-口胡">「ROI 2019 Day2」模式串查找
(口胡)</h1>
<p>设 <span class="math inline">\(S=\sum |w_i|\)</span></p>
<p>显然我们需要一个树形数据结构来维护题目中添加字符的操作</p>
<p>归纳一下，需要实现的操作就是：</p>
<p>1.添加一个新串</p>
<p>2.在当前串中分裂一段区间 <span
class="math inline">\([L,R]\)</span></p>
<p>3.将一个串复制 <span class="math inline">\(k\)</span> 次</p>
<p>将每一个单字符视为一个节点，考虑用一个可持久化的平衡树来维护上述操作，比如可持久化非旋
<span class="math inline">\(\text{Treap}\)</span></p>
<p>题解中给出的2-3-Tree不知道效果怎么样</p>
<p>2,3操作增加的数量为 <span class="math inline">\(\log\)</span>
级别，最终的节点总数为 <span class="math inline">\(O(S+n\log
S)\)</span></p>
<p>接下来需要实现的操作是合并两个子串的信息，显然在合并时计算跨过两个节点的串匹配模板串的次数</p>
<p>容易想到记录后缀匹配的 <span class="math inline">\(kmp\)</span>
指针，但是这样的指针难以完成合并操作</p>
<p>为了计算这个，我们需要维护这个串的前缀/后缀 在
原串上最长的匹配子段</p>
<p>此时一个节点的信息可以用 <span
class="math inline">\((l1,r1),(l2,r2),k\)</span> 来表示，其中 <span
class="math inline">\(k\)</span> 标记了这个串是否整个出现在模板串中</p>
<p>合并子串 <span class="math inline">\(A,B\)</span> 信息：</p>
<p>1.求出前缀/后缀匹配，以前缀为例：</p>
<p>1-1.如果 <span class="math inline">\(A\)</span>
无法完全匹配，则匹配前缀为 <span class="math inline">\(A\)</span>
的匹配前缀</p>
<p>1-2. <span class="math inline">\(A\)</span> 能够完全匹配，设 <span
class="math inline">\(A\)</span> 在原串对应 <span
class="math inline">\(L,R\)</span> ， <span
class="math inline">\(B\)</span> 的最长匹配前缀在模板串匹配起始位置为
<span class="math inline">\(P\)</span></p>
<p>我们需要在 <span class="math inline">\([L,R]\)</span> 之后借上 <span
class="math inline">\(P\)</span> 开始的一段后缀，而 <span
class="math inline">\([L,R]\)</span>
出现在模板串中的位置对应着后缀数组上一段 <span
class="math inline">\(rank\)</span> 区间</p>
<p>取模板串反向后缀数组，求出与 <span class="math inline">\(R\)</span>
匹配长度超过 <span class="math inline">\(R-L+1\)</span> 的 <span
class="math inline">\(rank\)</span> 区间 <span
class="math inline">\([l,r]\)</span></p>
<p>则我们需要找到 <span class="math inline">\([l,r]\)</span> 中 <span
class="math inline">\(sa[i]+1\)</span> 与 <span
class="math inline">\(P\)</span> 最长的 <span
class="math inline">\(LCP\)</span> ，显然是一个求临近 <span
class="math inline">\(rank\)</span> 的问题，可以在线主席树二分解决</p>
<p>由此得到最长前缀为 <span class="math inline">\(A\)</span>
串再加上额外匹配得到的部分</p>
<p><span class="math inline">\(O(\log m)\)</span> 完成</p>
<p><span class="math display">\[ \ \]</span></p>
<p>2.求出跨过两个串的完美匹配个数</p>
<p>容易得到前串后缀对应的 <span
class="math inline">\(\text{kmp}\)</span> 指针，后串前缀对应反向的 <span
class="math inline">\(\text{kmp}\)</span> 指针</p>
<p>实际上就是求出这两个指针不断失配时相加恰好完全匹配的个数</p>
<p>注意到，实际上这个询问是完全可以<strong>离线</strong>的</p>
<p>可以通过在线得到的匹配情况，离线得到询问得到询问答案，再从叶子开始重新计算每个节点的答案</p>
<p>比较暴力的做法是：</p>
<p>建立两棵 <span class="math inline">\(\text{kmp}\)</span>
树，在第一棵树上 <span class="math inline">\(\text{dfs}\)</span>
，加入祖先对应的位置，然后再第二棵树上查询祖先匹配的个数</p>
<p>可以用 <span class="math inline">\(\text{dfs}\)</span>
序+差分树状数组维护，复杂度为 <span class="math inline">\(O(\log
m)\)</span></p>
<p><span class="math display">\[  \ \]</span></p>
<p>因此总体复杂度为 <span class="math inline">\(O((S+n\log S)\log
m)\)</span> <del>实际上常数非常大？</del></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021%20US%20Open%20Platinum%E3%80%8DRouting%20Schemes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021%20US%20Open%20Platinum%E3%80%8DRouting%20Schemes/" class="post-title-link" itemprop="url">「USACO 2021 US Open Platinum」Routing Schemes</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="usaco-2021-us-open-platinumrouting-schemes">「USACO 2021 US Open
Platinum」Routing Schemes</h1>
<h2 id="k0"><span class="math inline">\(K=0\)</span></h2>
<p>此时，我们只需要求合法的匹配路径数量，并且一个路径是从小到大的</p>
<p>由于题目保证一定存在合法路径，从 <span
class="math inline">\(1\)</span> 到 <span
class="math inline">\(n\)</span> 考虑每一条 <span
class="math inline">\((u,v),(v&gt;u)\)</span></p>
<p>我们可以看成是很多个 <span class="math inline">\(S\)</span>
在路径上被从 <span class="math inline">\(1-n\)</span> 不断地推过去</p>
<p>设一个点的入度为</p>
<p><span class="math inline">\(ind_v=\sum_{(u,v)} 1+[v为S]\)</span></p>
<p><span class="math inline">\(outd_u=\sum_{(u,v)} 1+[u为R]\)</span></p>
<p>每次到达一个点，必然有其 <span
class="math inline">\(ind_u=outd_u\)</span> ，即推进来的 <span
class="math inline">\(S\)</span> 个数恰好等于出边个数</p>
<p>此时合法的分配这 <span class="math inline">\(outd_u\)</span> 个 <span
class="math inline">\(S\)</span> 的方案数就是 <span
class="math inline">\(outd_u!\)</span></p>
<p>直接求 <span class="math inline">\(\prod outd_i!\)</span> 即可</p>
<p><br></p>
<h2 id="k1"><span class="math inline">\(K=1\)</span></h2>
<p>存在反边的图看起来十分难处理，不妨直接把反边断掉</p>
<p>假设断掉前包含环的路径为 <span class="math inline">\(S_1\rightarrow
a\rightarrow b\rightarrow R_1 (a&gt;b)\)</span></p>
<p>则断掉后的路径变成 <span class="math inline">\(S_1\rightarrow
a\)</span> ， <span class="math inline">\(b\rightarrow R\)</span></p>
<p>不妨将在 <span class="math inline">\(a\)</span> 上额外添加一个 <span
class="math inline">\(R\)</span> ，在 <span
class="math inline">\(b\)</span> 上额外添加一个 <span
class="math inline">\(S\)</span></p>
<p>此时，新的问题又只包含 <span
class="math inline">\((u,v)(u&lt;v)\)</span> ，同 <span
class="math inline">\(K=0\)</span> 求解</p>
<p>理想情况下，新问题中的所有方案均可以通过将 <span
class="math inline">\(a,b\)</span> 相接还原</p>
<p>但是显然如果最终方案上 <span class="math inline">\(b\rightarrow
a\)</span> 相接就会成环</p>
<p>所以需要额外 <span class="math inline">\(dp\)</span> 出包含 <span
class="math inline">\(b\rightarrow a\)</span> 的非法方案</p>
<p>考虑用类似 <span class="math inline">\(K=0\)</span>
的办法，我们扫描每个 <span class="math inline">\(i\)</span> 将 <span
class="math inline">\(S\)</span> 向后推</p>
<p>令 <span class="math inline">\(dp_i\)</span> 表示当前 <span
class="math inline">\(dp\)</span> 的路径最后一个点是 <span
class="math inline">\(i\)</span> 的方案数</p>
<p>我们希望结束点是 <span class="math inline">\(a\)</span> ，开始点是
<span class="math inline">\(b\)</span></p>
<p>此时依次推过去 <span class="math inline">\(i\)</span> ，此时只有
<span class="math inline">\(dp_{j},j\ge i\)</span> 的情况是合法的</p>
<p>考虑 <span class="math inline">\(j=i\)</span> 时，需要为 <span
class="math inline">\(j\)</span> 找一个归宿 <span
class="math inline">\(k\)</span> ，或者判定 <span
class="math inline">\(j=a\)</span> 时结束路径</p>
<p>此时，相当于在原图上使 <span class="math inline">\(outd_i\)</span>
减少了 <span class="math inline">\(1\)</span></p>
<p>得到转移 <span class="math inline">\(dp_k\leftarrow dp_j\cdot
(outd_i-1)!\)</span></p>
<p>当 <span class="math inline">\(j&gt;i\)</span> 时，不需要考虑 <span
class="math inline">\(j\)</span> 的变化</p>
<p>得到转移 <span class="math inline">\(dp_j\leftarrow dp_j\cdot
outd_i!\)</span></p>
<p><br></p>
<h2 id="k2"><span class="math inline">\(K=2\)</span></h2>
<p>有了 <span class="math inline">\(K=1\)</span>
的铺垫，想必这里十分简单</p>
<p>设反边为 <span class="math inline">\((a,b),(c,d)\)</span>
，显然加入两组 <span class="math inline">\(S,R\)</span></p>
<p>考虑新图上什么样的情况是不合法的</p>
<ol type="1">
<li><p><span class="math inline">\(b\rightarrow a\)</span></p></li>
<li><p><span class="math inline">\(d\rightarrow c\)</span></p></li>
</ol>
<p>注意1,2是有交的</p>
<ol start="3" type="1">
<li><span class="math inline">\(b\rightarrow c\rightarrow d\rightarrow
a\)</span></li>
</ol>
<p>环交错扭在一起，这种情况比较容易漏掉</p>
<p>稍微容斥一下即可</p>
<p>复杂度分析：</p>
<p>扫描每个 <span class="math inline">\(i\)</span> 时， <span
class="math inline">\(dp_{x,y}\)</span> 中满足 <span
class="math inline">\(x=i\)</span> 或 <span
class="math inline">\(y=i\)</span> 的有 <span
class="math inline">\(O(n)\)</span> 个，转移每个需要 <span
class="math inline">\(O(n)\)</span> 时间</p>
<p>扫描每个 <span class="math inline">\(i\)</span> 时， <span
class="math inline">\(dp_{x,y}\)</span> 中满足 <span
class="math inline">\(x=i\)</span> 且 <span
class="math inline">\(y=i\)</span> 的有 <span
class="math inline">\(O(1)\)</span> 个，转移每个需要 <span
class="math inline">\(O(n^2)\)</span> 时间</p>
<p>因此复杂度为 <span class="math inline">\(O(n^3)\)</span>
，常数不算太大</p>
<p><br></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">110</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,k,J[N];</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> G[N][N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> pt1&#123;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">int</span> ans=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) ans=<span class="number">1ll</span>*ans*J[deg[i]]%P;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> deg[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Calc1</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> dp[N];</span><br><span class="line">	<span class="comment">// calculate stategies that contain b-&gt;a</span></span><br><span class="line">	<span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span> dp);</span><br><span class="line">	dp[b]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="built_in">drep</span>(j,n+<span class="number">1</span>,i) <span class="keyword">if</span>(dp[j]) &#123;</span><br><span class="line">			<span class="keyword">if</span>(j==i) &#123;</span><br><span class="line">				<span class="keyword">if</span>(i==a) dp[n+<span class="number">1</span>]=(dp[n+<span class="number">1</span>]+<span class="number">1ll</span>*J[deg[i]<span class="number">-1</span>]*dp[j])%P;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">rep</span>(k,i+<span class="number">1</span>,n) <span class="keyword">if</span>(G[i][k]) dp[k]=(dp[k]+<span class="number">1ll</span>*J[deg[i]<span class="number">-1</span>]*dp[j])%P;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> dp[j]=<span class="number">1ll</span>*dp[j]*J[deg[i]]%P;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dp[n+<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Calc2</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c,<span class="type">int</span> d)</span></span>&#123;</span><br><span class="line">	<span class="comment">// calculate strategies that contain both b-&gt;a,d-&gt;c</span></span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> dp[N][N];</span><br><span class="line">	<span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span> dp),dp[b][d]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="built_in">drep</span>(x,n+<span class="number">1</span>,i) <span class="built_in">drep</span>(y,n+<span class="number">1</span>,i) <span class="keyword">if</span>(dp[x][y]) &#123;</span><br><span class="line">			<span class="type">int</span> t=<span class="number">1ll</span>*dp[x][y]*J[deg[i]-(x==i)-(y==i)]%P;</span><br><span class="line">			<span class="keyword">if</span>(x!=i &amp;&amp; y!=i) &#123; dp[x][y]=t; <span class="keyword">continue</span>; &#125;</span><br><span class="line">			<span class="keyword">if</span>(x!=i) &#123;</span><br><span class="line">				<span class="keyword">if</span>(y==c) dp[x][n+<span class="number">1</span>]+=t,<span class="built_in">Mod1</span>(dp[x][n+<span class="number">1</span>]);</span><br><span class="line">				<span class="keyword">else</span> <span class="built_in">rep</span>(j,i+<span class="number">1</span>,n) <span class="keyword">if</span>(G[i][j]) dp[x][j]+=t,<span class="built_in">Mod1</span>(dp[x][j]);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(y!=i) &#123;</span><br><span class="line">				<span class="keyword">if</span>(x==a) dp[n+<span class="number">1</span>][y]+=t,<span class="built_in">Mod1</span>(dp[n+<span class="number">1</span>][y]);</span><br><span class="line">				<span class="keyword">else</span> <span class="built_in">rep</span>(j,i+<span class="number">1</span>,n) <span class="keyword">if</span>(G[i][j]) dp[j][y]+=t,<span class="built_in">Mod1</span>(dp[j][y]);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(x==a) &#123;</span><br><span class="line">				<span class="keyword">if</span>(y==c) dp[n+<span class="number">1</span>][n+<span class="number">1</span>]+=t,<span class="built_in">Mod1</span>(dp[n+<span class="number">1</span>][n+<span class="number">1</span>]);</span><br><span class="line">				<span class="keyword">else</span> <span class="built_in">rep</span>(j,i+<span class="number">1</span>,n) <span class="keyword">if</span>(G[i][j]) dp[n+<span class="number">1</span>][j]+=t,<span class="built_in">Mod1</span>(dp[n+<span class="number">1</span>][j]);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(y==c) &#123;</span><br><span class="line">				<span class="built_in">rep</span>(j,i+<span class="number">1</span>,n) <span class="keyword">if</span>(G[i][j]) dp[j][n+<span class="number">1</span>]+=t,<span class="built_in">Mod1</span>(dp[j][n+<span class="number">1</span>]);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">rep</span>(j,i+<span class="number">1</span>,n) <span class="keyword">if</span>(G[i][j]) <span class="built_in">rep</span>(k,i+<span class="number">1</span>,n) <span class="keyword">if</span>(G[i][k] &amp;&amp; j!=k) dp[j][k]+=t,<span class="built_in">Mod1</span>(dp[j][k]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dp[n+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> pt2&#123;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">int</span> a=<span class="number">-1</span>,b=<span class="number">-1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,i<span class="number">-1</span>) <span class="keyword">if</span>(G[i][j]) a=i,b=j;</span><br><span class="line">		<span class="type">int</span> ans=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) ans=<span class="number">1ll</span>*ans*J[deg[i]]%P;</span><br><span class="line">		ans-=<span class="built_in">Calc1</span>(a,b),<span class="built_in">Mod2</span>(ans);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> pt3&#123;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">int</span> a=<span class="number">-1</span>,b=<span class="number">-1</span>,c=<span class="number">-1</span>,d=<span class="number">-1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,i<span class="number">-1</span>) <span class="keyword">if</span>(G[i][j]) &#123;</span><br><span class="line">			<span class="keyword">if</span>(a==<span class="number">-1</span>) a=i,b=j;</span><br><span class="line">			<span class="keyword">else</span> c=i,d=j;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> ans=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) ans=<span class="number">1ll</span>*ans*J[deg[i]]%P;</span><br><span class="line">		ans-=<span class="built_in">Calc1</span>(a,b),<span class="built_in">Mod2</span>(ans);</span><br><span class="line">		ans-=<span class="built_in">Calc1</span>(c,d),<span class="built_in">Mod2</span>(ans);</span><br><span class="line">		ans+=<span class="built_in">Calc2</span>(a,b,c,d),<span class="built_in">Mod1</span>(ans);</span><br><span class="line">		ans-=<span class="built_in">Calc2</span>(c,b,a,d),<span class="built_in">Mod2</span>(ans);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,*J=<span class="number">1</span>,N<span class="number">-1</span>) J[i]=<span class="number">1ll</span>*J[i<span class="number">-1</span>]*i%P;</span><br><span class="line">	<span class="built_in">rep</span>(_,<span class="number">1</span>,<span class="built_in">rd</span>()) &#123;</span><br><span class="line">		n=<span class="built_in">rd</span>(),k=<span class="built_in">rd</span>(),<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,n) <span class="built_in">scanf</span>(<span class="string">&quot;%1d&quot;</span>,G[i]+j);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">			deg[i]=s[i]==<span class="string">&#x27;R&#x27;</span>;</span><br><span class="line">			<span class="built_in">rep</span>(j,<span class="number">1</span>,n) deg[i]+=G[i][j];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(k==<span class="number">0</span>) pt1::<span class="built_in">Solve</span>();</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(k==<span class="number">1</span>) pt2::<span class="built_in">Solve</span>();</span><br><span class="line">		<span class="keyword">else</span> pt3::<span class="built_in">Solve</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021%20US%20Open%20Platinum%E3%80%8DBalanced%20Subsets/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021%20US%20Open%20Platinum%E3%80%8DBalanced%20Subsets/" class="post-title-link" itemprop="url">「USACO 2021 US Open Platinum」Balanced Subsets</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="usaco-2021-us-open-platinumbalanced-subsets">「USACO 2021 US
Open Platinum」Balanced Subsets</h1>
<p>考虑题目给出的定义对应怎样的图形，显然是一个凸的封闭图形</p>
<p>不妨通过左右边线描述，从上到下</p>
<p>1.左边线先左移再右移</p>
<p>2.右边线先右移再左移</p>
<p>不妨直接令 <span class="math inline">\(dp_{i,l,r,f1,f2}\)</span>
表示当前第 <span class="math inline">\(i\)</span> 行，当前左右边线为
<span class="math inline">\(l,r(l\leq r,\forall
j\in[l,r],a_{i,j}=G)\)</span></p>
<p><span class="math inline">\(f1,f2\)</span>
表示当前左右边线处于左移还是右移状态</p>
<p>以左边线为例，定义右移开始的时刻为第一个 <span
class="math inline">\(l&gt;l&#39;\)</span> 的时刻</p>
<p>容易得到转移，是一个前/后缀和的形式</p>
<p>那么对于 <span class="math inline">\([l,r]\)</span>
两维分别做前缀和，然后 <span class="math inline">\(O(n^3)\)</span>
转移即可</p>
<p>注意转移过程中要确保 <span
class="math inline">\([l&#39;,r&#39;],[l,r]\)</span> 有交</p>
<p><del>以下是暴力二维前缀和+手艹9种转移的代码</del><img
src="https://i.loli.net/2021/05/06/zQSNb6mCwdJqFs3.jpg"
alt="QQ图片20210506190147.jpg" /></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">170</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> c[N];</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> dp[N][N][<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> F[N][N][<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">S</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> x1,<span class="type">int</span> x2,<span class="type">int</span> y1,<span class="type">int</span> y2)</span></span>&#123;</span><br><span class="line">	x1--,y1--;</span><br><span class="line">	<span class="keyword">return</span> (<span class="number">0ll</span>+F[x2][y2][a][b]-F[x1][y2][a][b]-F[x2][y1][a][b]+F[x1][y1][a][b])%P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	n=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,n) c[j]=c[j<span class="number">-1</span>]+(s[j]==<span class="string">&#x27;G&#x27;</span>);</span><br><span class="line">		<span class="built_in">memset</span>(F,<span class="number">0</span>,<span class="keyword">sizeof</span> F);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,n) <span class="built_in">rep</span>(a,<span class="number">0</span>,<span class="number">1</span>) <span class="built_in">rep</span>(b,<span class="number">0</span>,<span class="number">1</span>) &#123;</span><br><span class="line">			F[i][j][a][b]=(<span class="number">0ll</span>+F[i<span class="number">-1</span>][j][a][b]+F[i][j<span class="number">-1</span>][a][b]-F[i<span class="number">-1</span>][j<span class="number">-1</span>][a][b]+dp[i][j][a][b])%P;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span> dp);</span><br><span class="line">		<span class="built_in">rep</span>(l,<span class="number">1</span>,n) <span class="built_in">rep</span>(r,l,n) <span class="keyword">if</span>(c[r]-c[l<span class="number">-1</span>]==r-l+<span class="number">1</span>) &#123;</span><br><span class="line">			(dp[l][r][<span class="number">0</span>][<span class="number">0</span>]+=<span class="built_in">S</span>(<span class="number">0</span>,<span class="number">0</span>,l,r,l,r))%=P;</span><br><span class="line">			(dp[l][r][<span class="number">1</span>][<span class="number">0</span>]+=<span class="built_in">S</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,l<span class="number">-1</span>,l,r))%=P;</span><br><span class="line">			(dp[l][r][<span class="number">0</span>][<span class="number">1</span>]+=<span class="built_in">S</span>(<span class="number">0</span>,<span class="number">0</span>,l,r,r+<span class="number">1</span>,n))%=P;</span><br><span class="line">			(dp[l][r][<span class="number">1</span>][<span class="number">1</span>]+=<span class="built_in">S</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,l<span class="number">-1</span>,r+<span class="number">1</span>,n))%=P;</span><br><span class="line">	</span><br><span class="line">			(dp[l][r][<span class="number">0</span>][<span class="number">1</span>]+=<span class="built_in">S</span>(<span class="number">0</span>,<span class="number">1</span>,l,r,r,n))%=P;</span><br><span class="line">			(dp[l][r][<span class="number">1</span>][<span class="number">1</span>]+=<span class="built_in">S</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,l<span class="number">-1</span>,r,n))%=P;</span><br><span class="line">			</span><br><span class="line">			(dp[l][r][<span class="number">1</span>][<span class="number">0</span>]+=<span class="built_in">S</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,l,l,r))%=P;</span><br><span class="line">			(dp[l][r][<span class="number">1</span>][<span class="number">1</span>]+=<span class="built_in">S</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,l,r+<span class="number">1</span>,n))%=P;</span><br><span class="line">			</span><br><span class="line">			(dp[l][r][<span class="number">1</span>][<span class="number">1</span>]+=<span class="built_in">S</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,l,r,n))%=P;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(l,<span class="number">1</span>,n) <span class="built_in">rep</span>(r,l,n) <span class="keyword">if</span>(c[r]-c[l<span class="number">-1</span>]==r-l+<span class="number">1</span>) dp[l][r][<span class="number">0</span>][<span class="number">0</span>]++;</span><br><span class="line">		<span class="built_in">rep</span>(l,<span class="number">1</span>,n) <span class="built_in">rep</span>(r,l,n) <span class="built_in">rep</span>(a,<span class="number">0</span>,<span class="number">1</span>) <span class="built_in">rep</span>(b,<span class="number">0</span>,<span class="number">1</span>) <span class="keyword">if</span>(dp[l][r][a][b]) </span><br><span class="line">			ans=(ans+dp[l][r][a][b])%P;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">Mod2</span>(ans),<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202020.12%20Platinum%E3%80%8DSpaceship/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202020.12%20Platinum%E3%80%8DSpaceship/" class="post-title-link" itemprop="url">「USACO 2020.12 Platinum」Spaceship</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="usaco-2020.12-platinumspaceship">「USACO 2020.12
Platinum」Spaceship</h1>
<p>看到题目第一个想到的是：按照路径长度可以确定按钮次数和路径次数</p>
<p>然而路径长度是 <span class="math inline">\(2^k\)</span>
级别的。。</p>
<p>下文认为 <span class="math inline">\(n,q,k\)</span> 同阶</p>
<p>既然无法考虑长度，那么就直接在 <span
class="math inline">\(dp\)</span> 时将路径作为状态压入</p>
<p>令 <span class="math inline">\(dp_{i,s,t}\)</span> 表示前面 <span
class="math inline">\(i\)</span> 个按钮未按过，从 <span
class="math inline">\(s\)</span> 走到 <span
class="math inline">\(t\)</span> 的路径数</p>
<p>显然 <span class="math inline">\(dp_{i}\)</span>
可以看做一个类似矩阵的转移，设邻接矩阵为 <span
class="math inline">\(E\)</span></p>
<p>那么得到 <span class="math inline">\(dp_{i}=dp_{i-1}+dp_{i-1}\cdot
E\cdot dp_{i-1}\)</span></p>
<p>( <span class="math inline">\(dp_i\)</span> 不一定按了 <span
class="math inline">\(i\)</span> 这个按钮，所以考虑按或者不按)</p>
<p>那么对于 <span class="math inline">\(b_s,b_t\)</span>
的情况，考虑把操作序列分成两段</p>
<p>显然操作序列有唯一一个按过恰好一次的最大的按钮 <span
class="math inline">\(max\)</span> ，可以在这里将操作序列分成两段</p>
<p>处理出 <span class="math inline">\(b_s\)</span> 到 <span
class="math inline">\(max\)</span> 和 <span
class="math inline">\(max\)</span> 到 <span
class="math inline">\(b_t\)</span> 的两部分方案数合并即可</p>
<p>以处理 <span class="math inline">\(b_s\rightarrow max\)</span>
为例</p>
<p>类似上面的操作，令 <span class="math inline">\(F_{i,j}\)</span>
表示最大按钮为 <span class="math inline">\(i\)</span> ，且按过 <span
class="math inline">\(i\)</span> 之后没有按过其他按钮，停留在 <span
class="math inline">\(j\)</span> 的方案数 ( <span
class="math inline">\(F_i\)</span> 是一个向量)</p>
<p>初始显然有 <span class="math inline">\(F_{b_s,s}=1\)</span></p>
<p><span class="math inline">\(\displaystyle
i&gt;b_s,F_{i}=\sum_{j&lt;i} F_{j}\cdot dp_{j-1}\cdot E\)</span> (按过
<span class="math inline">\(j\)</span> 之后可以继续按 <span
class="math inline">\([1,j-1]\)</span> )</p>
<p>前缀和即可，复杂度为 <span class="math inline">\(O(n^3)\)</span></p>
<p>同理处理出 <span class="math inline">\(max\rightarrow b_t\)</span>
的权值合并即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">62</span>,P=<span class="number">1e9</span>+<span class="number">7</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,q;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Mat</span>&#123;</span><br><span class="line">	<span class="type">int</span> a[N][N];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123; <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span> a); &#125;</span><br><span class="line">	Mat <span class="keyword">operator</span> * (<span class="type">const</span> Mat &amp;x) <span class="type">const</span> &#123;</span><br><span class="line">		Mat res; res.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,n) <span class="keyword">if</span>(a[i][j]) <span class="built_in">rep</span>(k,<span class="number">1</span>,n) res.a[i][k]=(res.a[i][k]+<span class="number">1ll</span>*a[i][j]*x.a[j][k])%P;</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">	Mat <span class="keyword">operator</span> + (<span class="type">const</span> Mat &amp;x) <span class="type">const</span> &#123;</span><br><span class="line">		Mat res;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,n) res.a[i][j]=a[i][j]+x.a[i][j],<span class="built_in">Mod1</span>(res.a[i][j]);</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; I,E,dp[N];</span><br><span class="line"><span class="type">int</span> F[N][N],G[N][N];</span><br><span class="line"><span class="type">int</span> S[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;spaceship.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;spaceship.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;q);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) I.a[i][i]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,n) <span class="built_in">scanf</span>(<span class="string">&quot;%1d&quot;</span>,&amp;E.a[i][j]);</span><br><span class="line">	dp[<span class="number">0</span>]=I;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) dp[i]=dp[i<span class="number">-1</span>]+dp[i<span class="number">-1</span>]*E*dp[i<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">while</span>(q--) &#123;</span><br><span class="line">		<span class="type">int</span> bs,s,bt,t; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>,&amp;bs,&amp;s,&amp;bt,&amp;t);</span><br><span class="line">		<span class="built_in">memset</span>(F,<span class="number">0</span>,<span class="keyword">sizeof</span> F),<span class="built_in">memset</span>(G,<span class="number">0</span>,<span class="keyword">sizeof</span> G);</span><br><span class="line">		<span class="built_in">memset</span>(S,<span class="number">0</span>,<span class="keyword">sizeof</span> S);</span><br><span class="line">		F[bs][s]=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) S[bs][i]=dp[bs<span class="number">-1</span>].a[s][i];</span><br><span class="line">		<span class="built_in">rep</span>(i,bs+<span class="number">1</span>,m) &#123;</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) <span class="keyword">if</span>(S[i<span class="number">-1</span>][a]) <span class="built_in">rep</span>(b,<span class="number">1</span>,n) F[i][b]=(F[i][b]+<span class="number">1ll</span>*S[i<span class="number">-1</span>][a]*E.a[a][b])%P;</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) S[i][a]=S[i<span class="number">-1</span>][a];</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) <span class="keyword">if</span>(F[i][a]) <span class="built_in">rep</span>(b,<span class="number">1</span>,n) S[i][b]=(S[i][b]+<span class="number">1ll</span>*F[i][a]*dp[i<span class="number">-1</span>].a[a][b])%P;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">memset</span>(S,<span class="number">0</span>,<span class="keyword">sizeof</span> S);</span><br><span class="line">		G[bt][t]=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) S[bt][i]=dp[bt<span class="number">-1</span>].a[i][t];</span><br><span class="line">		<span class="built_in">rep</span>(i,bt+<span class="number">1</span>,m) &#123;</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) <span class="built_in">rep</span>(b,<span class="number">1</span>,n) G[i][a]=(G[i][a]+<span class="number">1ll</span>*S[i<span class="number">-1</span>][b]*E.a[a][b])%P;</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) S[i][a]=S[i<span class="number">-1</span>][a];</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) <span class="built_in">rep</span>(b,<span class="number">1</span>,n) S[i][a]=(S[i][a]+<span class="number">1ll</span>*G[i][b]*dp[i<span class="number">-1</span>].a[a][b])%P;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">rep</span>(j,<span class="number">1</span>,n) ans=(ans+<span class="number">1ll</span>*F[i][j]*G[i][j])%P;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202020.12%20Platinum%E3%80%8DCowmistry/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202020.12%20Platinum%E3%80%8DCowmistry/" class="post-title-link" itemprop="url">「USACO 2020.12 Platinum」Cowmistry</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="usaco-2020.12-platinumcowmistry">「USACO 2020.12
Platinum」Cowmistry</h1>
<p>看到样例解释突然就有了思路.jpg</p>
<p>令 <span class="math inline">\(m=\min\{2^t|2^t&gt;k\}\)</span>
，也就是 <span class="math inline">\(k\)</span> 最高位+1</p>
<p>对于数轴，按照 <span class="math inline">\([im,(i+1)m)\)</span>
分组，显然跨过分组的数之间异或 <span class="math inline">\(\ge
m&gt;k\)</span> ，不合法，扔掉</p>
<p>对于每组，直接看做是 <span class="math inline">\([0,m-1]\)</span>
，此时令 <span class="math inline">\(d=\frac{m}{2}\)</span></p>
<p>将 <span class="math inline">\([0,m-1]\)</span> 分为 <span
class="math inline">\([0,d-1],[d,m-1]\)</span>
，显然两段之内的数相互异或的结果 <span
class="math inline">\(&lt;d\)</span> ，一定合法</p>
<p>也就是说，长度为 <span class="math inline">\(d\)</span>
的段内随意选3个都合法</p>
<p>下面考虑跨过 <span class="math inline">\(d\)</span>
的贡献，显然是一边选一个，一边选两个，此时这些数之间的异或和 <span
class="math inline">\(\ge d\)</span></p>
<p>以左边选一个为例，令 <span
class="math inline">\(k&#39;=k-d\)</span></p>
<h3 id="oklog-k"><span class="math inline">\(O(k\log k)\)</span></h3>
<p>考虑异或和中一定有 <span class="math inline">\(d\)</span>
这一位，下面只需要对于 <span class="math inline">\(i\in[0,d-1]\)</span>
暴力统计出 <span class="math inline">\([d,m]\)</span> 中有多少个数 <span
class="math inline">\(j\)</span> 满足 <span
class="math inline">\(i\oplus j\leq k&#39;\)</span></p>
<p>可以前缀和之后 <span class="math inline">\(\log k\)</span>
做到，从高到低依次考虑 <span class="math inline">\(k\)</span>
每一个为1的二进制位 <span class="math inline">\(i\)</span>
，如果查询的数这一位和 <span class="math inline">\(x\)</span>
相同，那么下面可以任意选择</p>
<p>否则将 <span class="math inline">\(x\rightarrow x\oplus
2^i\)</span></p>
<p>实现如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Que</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> *A,<span class="type">int</span> k)</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">drep</span>(i,<span class="number">19</span>,<span class="number">0</span>) <span class="keyword">if</span>(k&amp;(<span class="number">1</span>&lt;&lt;i)) &#123;</span><br><span class="line">		<span class="type">int</span> l=x&amp;(~((<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>)),r=l+(<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>;</span><br><span class="line">		ans+=A[r]-A[l<span class="number">-1</span>];</span><br><span class="line">		x^=<span class="number">1</span>&lt;&lt;i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans+A[x]-A[x<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到个数 <span class="math inline">\(c\)</span> 之后，接下来就是为
<span class="math inline">\(x\)</span> 在 <span
class="math inline">\(c\)</span> 里选择两个匹配，就是 <span
class="math inline">\(\sum \frac{c(c-1)}{2}\)</span></p>
<p>由此得到一个 <span class="math inline">\(O(k\log k)\)</span>
做法，可以通过前三档数据</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> part_klogk&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> N=<span class="number">1</span>&lt;&lt;<span class="number">20</span>|<span class="number">10</span>;</span><br><span class="line">	<span class="type">int</span> m,A[N],B[N],ans;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Que</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> *A,<span class="type">int</span> k)</span></span>&#123;</span><br><span class="line">		<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">drep</span>(i,<span class="number">19</span>,<span class="number">0</span>) <span class="keyword">if</span>(k&amp;(<span class="number">1</span>&lt;&lt;i)) &#123;</span><br><span class="line">			<span class="type">int</span> l=x&amp;(~((<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>)),r=l+(<span class="number">1</span>&lt;&lt;i)<span class="number">-1</span>;</span><br><span class="line">			ans+=A[r]-A[l<span class="number">-1</span>];</span><br><span class="line">			x^=<span class="number">1</span>&lt;&lt;i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ans+A[x]-A[x<span class="number">-1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Solve</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> c1=<span class="number">0</span>,c2=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,l,mid) c1+=A[i];</span><br><span class="line">		<span class="built_in">rep</span>(i,mid+<span class="number">1</span>,r) c2+=A[i];</span><br><span class="line">		ans=(ans+<span class="built_in">D3</span>(c1))%P,ans=(ans+<span class="built_in">D3</span>(c2))%P;</span><br><span class="line">		<span class="built_in">rep</span>(i,l,mid) <span class="keyword">if</span>(A[i]) &#123;</span><br><span class="line">			<span class="type">int</span> c=<span class="built_in">Que</span>(i-l,B+mid+<span class="number">2</span>,k-(m/<span class="number">2</span>));</span><br><span class="line">			ans=(ans+<span class="number">1ll</span>*c*(c<span class="number">-1</span>)/<span class="number">2</span>)%P;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(i,mid+<span class="number">1</span>,r) <span class="keyword">if</span>(A[i]) &#123;</span><br><span class="line">			<span class="type">int</span> c=<span class="built_in">Que</span>(i-mid<span class="number">-1</span>,B+l+<span class="number">1</span>,k-(m/<span class="number">2</span>));</span><br><span class="line">			ans=(ans+<span class="number">1ll</span>*c*(c<span class="number">-1</span>)/<span class="number">2</span>)%P;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(m=<span class="number">1</span>;m&lt;=k;) m&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,L[i],R[i]) A[j]++;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,N<span class="number">-1</span>) B[i]=B[i<span class="number">-1</span>]+A[i<span class="number">-1</span>];</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,R[n]/m) <span class="built_in">Solve</span>(i*m,(i+<span class="number">1</span>)*m<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[\ \]</span></p>
<h3 id="onlog-k-nlog-2-k"><span class="math inline">\(O(n\log k-n\log ^2
k)\)</span></h3>
<p>考虑对于 <span class="math inline">\(k&#39;\)</span>
，问题降阶为求区间 <span class="math inline">\(a\)</span> 中的每一个数
， 在区间 <span class="math inline">\(b\)</span> 中查询合法的个数 <span
class="math inline">\(cnt_a\)</span></p>
<p>其中 <span class="math inline">\(a,b\)</span> 区间可以认为对应相同的
<span class="math inline">\([0,L-1]\)</span> ，但是出现元素不同</p>
<p>此时，继续采用上面的方法进行分组，分组对象变为两组区间</p>
<p>令 <span
class="math inline">\(m&#39;=\min\{2^t|2^t&gt;k&#39;\},d&#39;=\frac{m}{2}\)</span>
，分组之后</p>
<p>对于 <span class="math inline">\([0,d&#39;-1],[d&#39;,m-1]\)</span>
，显然两段之内异或 <span class="math inline">\(\leq d\)</span>
，一定合法，加入答案 <span class="math inline">\(cnt_a\)</span> 中</p>
<p>对于跨过区间的贡献，用下面的方法处理</p>
<p>左边区间对于右边区间继续递归进行查询，将得到的结果加上左边区间中数的个数</p>
<p>右边区间继续对于左边区间递归进行查询，将得到的结果加上右边区间中数的个数</p>
<p>问题不断降阶为子问题，会有 <span class="math inline">\(\log
k\)</span> 层子问题</p>
<p>每层子问题所有的区间可以分为 <span
class="math inline">\(O(n)\)</span> 段 <strong>特殊</strong> 的段</p>
<p>其他的部分要么完全覆盖要么为空，这些部分可以快速求出</p>
<p>发现答案如果用 <span class="math inline">\((num,cnt)\)</span>
表示当前查询结果为 <span class="math inline">\(num\)</span> 的个数为
<span class="math inline">\(cnt\)</span></p>
<p>每层可以用 <span class="math inline">\(O(n)\)</span>
个不同的二元对表示结果</p>
<p>如此求得后，再自底向上合并得到答案</p>
<p><span class="math display">\[ \ \]</span></p>
<p><span class="math display">\[ \ \]</span></p>
<h3 id="关于实现">关于实现</h3>
<p>如果真的按照上面的方法，一层层向下分裂区间，会面临着常数大，难以实现的问题</p>
<p>考虑将每个区间 <span class="math inline">\([L_i,R_i]\)</span>
插入线段树 <span class="math inline">\([0,2^{30}-1]\)</span></p>
<p>显然得到 <span class="math inline">\(O(n\log k)\)</span>
个节点，在底层完全覆盖的节点打上标记</p>
<p>先递归进行第一层的分裂区间操作，对于打上标记的节点可以分成 <span
class="math inline">\(\frac{r-l+1}{m}\)</span> 个完全覆盖区间</p>
<p>这些完全覆盖区间的答案可以 <span class="math inline">\(O(1)\)</span>
求出</p>
<p><span class="math display">\[ \ \]</span></p>
<p>分裂完成后，每次查询的区间对用 <span
class="math inline">\((a,b,L,k,f1,f2)\)</span> 表示</p>
<p>其中 <span class="math inline">\(a\)</span> 表示查询区间对应节点，
<span class="math inline">\(b\)</span> 表示被查询区间对应节点</p>
<p><span class="math inline">\(L\)</span> 表示区间长度， <span
class="math inline">\(f1,f2\)</span> 表示 <span
class="math inline">\(a,b\)</span> 是否继承到上层的完全覆盖标记</p>
<p>如此每次合并 <span
class="math inline">\((ls_a,rs_b),(rs_a,ls_b)\)</span>
的查询结果，加上另一边的贡献 即可</p>
<p>当 <span class="math inline">\(b\)</span>
为空或者为完全覆盖时，答案可以 <span class="math inline">\(O(1)\)</span>
得到</p>
<p>当 <span class="math inline">\(a\)</span> 为空时，可以得到空答案</p>
<p>从这样的底层向上合并，每个元素被合并次数 <span
class="math inline">\(O(\log k)\)</span></p>
<p><span class="math display">\[ \ \]</span></p>
<p>没有仔细分析复杂度，应该就是 <span class="math inline">\(O(n\log
k-n\log ^2 k)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">    <span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2e4</span>+<span class="number">10</span>,P=<span class="number">1e9</span>+<span class="number">7</span>,I2=(P+<span class="number">1</span>)/<span class="number">2</span>,I3=(P+<span class="number">1</span>)/<span class="number">3</span>,U=<span class="number">1</span>&lt;&lt;<span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,k;</span><br><span class="line"><span class="type">int</span> L[N],R[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=k;i;i&gt;&gt;=<span class="number">1</span>) <span class="keyword">if</span>(~i&amp;<span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">D3</span><span class="params">(<span class="type">int</span> n)</span></span>&#123; <span class="keyword">return</span> <span class="number">1ll</span>*n*(n<span class="number">-1</span>)/<span class="number">2</span>%P*(n<span class="number">-2</span>)%P*I3%P; &#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">D2</span><span class="params">(<span class="type">int</span> n)</span></span>&#123; <span class="keyword">return</span> <span class="number">1ll</span>*n*(n<span class="number">-1</span>)/<span class="number">2</span>%P; &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M=N*<span class="number">60</span>;</span><br><span class="line"><span class="type">int</span> s[M],ls[M],rs[M],t[M],cnt,rt;</span><br><span class="line"><span class="comment">//在线段树上插入节点，打上标记，同时处理出size便于下面计算</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Ins</span><span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!p) p=++cnt;</span><br><span class="line">    s[p]+=<span class="built_in">min</span>(qr,r)-<span class="built_in">max</span>(ql,l)+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=l &amp;&amp; r&lt;=qr) &#123; t[p]=<span class="number">1</span>; <span class="keyword">return</span>; &#125;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=mid) <span class="built_in">Ins</span>(ls[p],l,mid,ql,qr);</span><br><span class="line">    <span class="keyword">if</span>(qr&gt;mid) <span class="built_in">Ins</span>(rs[p],mid+<span class="number">1</span>,r,ql,qr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ans;</span><br><span class="line"><span class="comment">// O(1)求出m</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Up</span><span class="params">(<span class="type">int</span> k)</span></span>&#123; <span class="keyword">return</span> <span class="number">1</span>&lt;&lt;(<span class="number">32</span>-__builtin_clz(k)); &#125;</span><br><span class="line"><span class="keyword">typedef</span> vector &lt;Pii&gt; V;</span><br><span class="line"><span class="function">V <span class="title">Union</span><span class="params">(<span class="type">const</span> V &amp;A,<span class="type">const</span> V &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> p1=<span class="number">0</span>,p2=<span class="number">0</span>,s1=A.<span class="built_in">size</span>(),s2=B.<span class="built_in">size</span>();</span><br><span class="line">    V R;</span><br><span class="line">    <span class="comment">// 这里是否归并并不影响复杂度</span></span><br><span class="line">    <span class="keyword">while</span>(p1&lt;s1 || p2&lt;s2) &#123;</span><br><span class="line">        <span class="keyword">if</span>(p1&lt;s1 &amp;&amp; (p2==s2||A[p1]&lt;B[p2])) &#123;</span><br><span class="line">            <span class="keyword">if</span>(R.<span class="built_in">size</span>() &amp;&amp; R.<span class="built_in">back</span>().first==A[p1].first) R.<span class="built_in">back</span>().second+=A[p1].second;</span><br><span class="line">            <span class="keyword">else</span> R.<span class="built_in">pb</span>(A[p1]);</span><br><span class="line">            p1++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(R.<span class="built_in">size</span>() &amp;&amp; R.<span class="built_in">back</span>().first==B[p2].first) R.<span class="built_in">back</span>().second+=B[p2].second;</span><br><span class="line">            <span class="keyword">else</span> R.<span class="built_in">pb</span>(B[p2]);</span><br><span class="line">            p2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">V <span class="title">Calc</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> L,<span class="type">int</span> k,<span class="type">int</span> f1,<span class="type">int</span> f2)</span></span>&#123;</span><br><span class="line">    f1|=t[a],f2|=t[b];</span><br><span class="line">    V Res;</span><br><span class="line">    <span class="comment">// 底层情况O(1)解决</span></span><br><span class="line">    <span class="keyword">if</span>(!f1 &amp;&amp; !a) <span class="keyword">return</span> Res;</span><br><span class="line">    <span class="keyword">if</span>(f2) <span class="keyword">return</span> Res.<span class="built_in">pb</span>(<span class="built_in">mp</span>(k+<span class="number">1</span>,f1?L:s[a])),Res;</span><br><span class="line">    <span class="keyword">if</span>(!b) <span class="keyword">return</span> Res.<span class="built_in">pb</span>(<span class="built_in">mp</span>(<span class="number">0</span>,f1?L:s[a])),Res;</span><br><span class="line">    <span class="type">int</span> m=<span class="built_in">Up</span>(k);</span><br><span class="line">    <span class="comment">// L&gt;m说明还要继续进行分裂</span></span><br><span class="line">    <span class="keyword">if</span>(L&gt;m) <span class="keyword">return</span> <span class="built_in">Union</span>(<span class="built_in">Calc</span>(ls[a],ls[b],L/<span class="number">2</span>,k,f1,f2),<span class="built_in">Calc</span>(rs[a],rs[b],L/<span class="number">2</span>,k,f1,f2));</span><br><span class="line">    <span class="comment">// 进入降阶子问题，左查右，右查左</span></span><br><span class="line">    k-=m/<span class="number">2</span>;</span><br><span class="line">    V A=<span class="built_in">Calc</span>(ls[a],rs[b],L/<span class="number">2</span>,k,f1,f2);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;i:A) i.first+=f2?L/<span class="number">2</span>:s[ls[b]];</span><br><span class="line">    V B=<span class="built_in">Calc</span>(rs[a],ls[b],L/<span class="number">2</span>,k,f1,f2);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;i:B) i.first+=f2?L/<span class="number">2</span>:s[rs[b]];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Union</span>(A,B);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cm;</span><br><span class="line"><span class="comment">// 第一次分裂</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Solve</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> L)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!p) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 完全覆盖的部分答案可以快速求出</span></span><br><span class="line">    <span class="keyword">if</span>(t[p]) &#123; cm+=L/m; <span class="keyword">return</span>; &#125;</span><br><span class="line">    <span class="comment">// 已经完成分裂，此时进入第一层子问题</span></span><br><span class="line">    <span class="keyword">if</span>(L==m) &#123;</span><br><span class="line">        <span class="comment">// 贡献分为 </span></span><br><span class="line">        <span class="comment">// 左选3 ， 右选 3</span></span><br><span class="line">        ans=(ans+<span class="built_in">D3</span>(s[ls[p]]))%P,ans=(ans+<span class="built_in">D3</span>(s[rs[p]]))%P;</span><br><span class="line">        <span class="comment">// 左1，右2</span></span><br><span class="line">        V A=<span class="built_in">Calc</span>(ls[p],rs[p],m/<span class="number">2</span>,k-m/<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 左2，右1</span></span><br><span class="line">        V B=<span class="built_in">Calc</span>(rs[p],ls[p],m/<span class="number">2</span>,k-m/<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i:A) ans=(ans+<span class="number">1ll</span>*<span class="built_in">D2</span>(i.first)*i.second)%P;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i:B) ans=(ans+<span class="number">1ll</span>*<span class="built_in">D2</span>(i.first)*i.second)%P;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Solve</span>(ls[p],L/<span class="number">2</span>),<span class="built_in">Solve</span>(rs[p],L/<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    n=<span class="built_in">rd</span>(),k=<span class="built_in">rd</span>();</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123; <span class="type">int</span> l=<span class="built_in">rd</span>(),r=<span class="built_in">rd</span>(); <span class="built_in">Ins</span>(rt,<span class="number">0</span>,U<span class="number">-1</span>,l,r); &#125;</span><br><span class="line">    m=<span class="built_in">Up</span>(k),<span class="built_in">Solve</span>(rt,U);</span><br><span class="line">    <span class="comment">// O(1)求得完全覆盖部分的答案</span></span><br><span class="line">    <span class="type">int</span> t=(<span class="number">2ll</span>*<span class="built_in">D3</span>(m/<span class="number">2</span>)+<span class="number">1ll</span>*<span class="built_in">D2</span>(k-m/<span class="number">2</span>+<span class="number">1</span>)*m)%P;</span><br><span class="line">    ans=(ans+<span class="number">1ll</span>*cm*t)%P;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021%20US%20Open%20Platinum%E3%80%8DUnited%20Cows%20of%20Farmer%20John/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021%20US%20Open%20Platinum%E3%80%8DUnited%20Cows%20of%20Farmer%20John/" class="post-title-link" itemprop="url">「USACO 2021 US Open Platinum」United Cows of Farmer John</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="usaco-2021-us-open-platinumunited-cows-of-farmer-john">「USACO
2021 US Open Platinum」United Cows of Farmer John</h1>
<p>考虑依次枚举右端点 <span class="math inline">\(i\)</span>
，计算左边合法的方案数，设一个数 <span class="math inline">\(x\)</span>
上次出现的位置为 <span class="math inline">\(lst_x\)</span></p>
<p>则 <span class="math inline">\(i\)</span> 能够作为右端点的区间就是
<span class="math inline">\([lst_{a_i}+1,i-2]\)</span></p>
<p>考虑什么样的位置可以作为左端点，显然这个点在 <span
class="math inline">\([1,i]\)</span> 中是最后一次出现</p>
<p>我们将不妨这样的点权值设为 <span
class="math inline">\(w_i=1\)</span></p>
<p>考虑一个点作为中间点贡献怎样的区间，同样的，这个点在 <span
class="math inline">\([1,i]\)</span> 中是最后一次出现</p>
<p>并且，能够贡献的区间 <span class="math inline">\(&gt;\)</span>
上一次出现的位置 <span class="math inline">\(lst_x\)</span></p>
<p>这个中间点能够匹配的左端点个数就是 <span
class="math inline">\(\displaystyle \sum_{k=lst_{a_j}+1}^{j-1}
w_k\)</span></p>
<p>现在我们要用数据结构动态修改某一个位置的 <span
class="math inline">\(w_i\)</span> ，增减 <span
class="math inline">\([lst_{a_j}+1,j-1]\)</span> 的区间，查询 <span
class="math inline">\([lst_{a_i}+1,i-2]\)</span></p>
<p>不妨再为一个点增加点权 <span class="math inline">\(t_i\)</span>
，此时我们要维护的操作</p>
<p>1.单点修改 <span class="math inline">\(w_i\)</span></p>
<p>2.区间修改 <span class="math inline">\(t_i\)</span></p>
<p>3.求 <span class="math inline">\(w_it_i\)</span> 区间和</p>
<p>在线段树上每个节点维护 <span class="math inline">\(w_i\)</span>
之和， <span class="math inline">\(w_it_i\)</span> 之和，可以标记永久化
<span class="math inline">\(t_i\)</span></p>
<p>具体实现参考代码<del>（实际写得很丑）</del></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> lst[N],lst2[N],cnt;</span><br><span class="line">ll s1[N&lt;&lt;<span class="number">2</span>],s2[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> t[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="comment">// s1表示w之和，s2表示区间内部t[i]*w[i]之和，t[i]现在是永久化的标记</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Up</span><span class="params">(<span class="type">int</span> p)</span></span>&#123;</span><br><span class="line">	s2[p]=s2[p&lt;&lt;<span class="number">1</span>]+s2[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">	s1[p]=s1[p&lt;&lt;<span class="number">1</span>]+s1[p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+s2[p]*t[p];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Upd</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l==r) &#123;</span><br><span class="line">		s2[p]^=<span class="number">1</span>,s1[p]=t[p]*s2[p];</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	x&lt;=mid?<span class="built_in">Upd</span>(p&lt;&lt;<span class="number">1</span>,l,mid,x):<span class="built_in">Upd</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,x);</span><br><span class="line">	<span class="built_in">Up</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Upd</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr,<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(ql&gt;qr) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span>(ql&lt;=l &amp;&amp; r&lt;=qr) &#123;</span><br><span class="line">		t[p]+=x,s1[p]+=x*s2[p];</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(ql&lt;=mid) <span class="built_in">Upd</span>(p&lt;&lt;<span class="number">1</span>,l,mid,ql,qr,x);</span><br><span class="line">	<span class="keyword">if</span>(qr&gt;mid) <span class="built_in">Upd</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,ql,qr,x);</span><br><span class="line">	<span class="built_in">Up</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">	ll x,y;</span><br><span class="line">	<span class="built_in">Node</span>(ll x=<span class="number">0</span>,ll y=<span class="number">0</span>):<span class="built_in">x</span>(x),<span class="built_in">y</span>(y)&#123;  &#125;</span><br><span class="line">	Node <span class="keyword">operator</span> + (<span class="type">const</span> Node __) &#123; <span class="keyword">return</span> <span class="built_in">Node</span>(x+__.x,y+__.y); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">Node <span class="title">Que</span><span class="params">(<span class="type">int</span> p,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(ql&gt;qr) <span class="keyword">return</span> <span class="built_in">Node</span>();</span><br><span class="line">	<span class="keyword">if</span>(ql&lt;=l &amp;&amp; r&lt;=qr) <span class="keyword">return</span> <span class="built_in">Node</span>(s1[p],s2[p]);</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>; Node res;</span><br><span class="line">	<span class="keyword">if</span>(ql&lt;=mid) res=res+<span class="built_in">Que</span>(p&lt;&lt;<span class="number">1</span>,l,mid,ql,qr);</span><br><span class="line">	<span class="keyword">if</span>(qr&gt;mid) res=res+<span class="built_in">Que</span>(p&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,ql,qr);</span><br><span class="line">	res.x+=res.y*t[p];</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	n=<span class="built_in">rd</span>();</span><br><span class="line">	ll ans=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="type">int</span> x=<span class="built_in">rd</span>();</span><br><span class="line">		<span class="keyword">if</span>(lst[x]) &#123;</span><br><span class="line">			<span class="built_in">Upd</span>(<span class="number">1</span>,<span class="number">1</span>,n,lst[x]),cnt--;</span><br><span class="line">			<span class="built_in">Upd</span>(<span class="number">1</span>,<span class="number">1</span>,n,lst2[x]+<span class="number">1</span>,lst[x],<span class="number">-1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		Node t=<span class="built_in">Que</span>(<span class="number">1</span>,<span class="number">1</span>,n,lst[x]+<span class="number">1</span>,i<span class="number">-2</span>);</span><br><span class="line">		ans+=t.x;</span><br><span class="line">		<span class="built_in">Upd</span>(<span class="number">1</span>,<span class="number">1</span>,n,i),cnt++,<span class="built_in">Upd</span>(<span class="number">1</span>,<span class="number">1</span>,n,lst[x]+<span class="number">1</span>,i<span class="number">-1</span>,<span class="number">1</span>);</span><br><span class="line">		lst2[x]=lst[x],lst[x]=i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/UOJ/%E3%80%90UER%20#9%E3%80%91%E7%9F%A5%E8%AF%86%E7%BD%91%E7%BB%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/UOJ/%E3%80%90UER%20#9%E3%80%91%E7%9F%A5%E8%AF%86%E7%BD%91%E7%BB%9C/" class="post-title-link" itemprop="url">【UER #9】知识网络</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-17 21:15:25" itemprop="dateModified" datetime="2023-08-17T21:15:25+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="uer-9知识网络">【UER #9】知识网络</h1>
<p>bitset写错没调出来。。。</p>
<hr />
<h3 id="onnm"><span class="math inline">\(O(n(n+m))\)</span></h3>
<p>暴力枚举起点，建立转移虚点，得到一个边权为 <span
class="math inline">\(0/1\)</span> ，点数 <span
class="math inline">\(n+k\)</span> ，边数为 <span
class="math inline">\(O(n+m)\)</span> 的图</p>
<p>然后广搜双端队列维护即可</p>
<p><span class="math display">\[ \ \]</span></p>
<h3 id="oknmfracnnmw"><span
class="math inline">\(O(k(n+m)+\frac{n(n+m)}{w})\)</span></h3>
<p>考虑枚举颜色 <span class="math inline">\(k\)</span>
，对于所有这种颜色的点，假设一开始 <span
class="math inline">\(dis_u\)</span> 均为 <span
class="math inline">\(2\)</span></p>
<p>并由此广搜预处理一个最短路图，复杂度为 <span
class="math inline">\(O(k(n+m))\)</span></p>
<p>由于图上有0边无0环，因此最短路图是拓扑图</p>
<p>那么选定其中一个点为起点，会将这个点的 <span
class="math inline">\(dis\rightarrow dis-1\)</span> ，其他同色点 <span
class="math inline">\(dis\)</span> 不变</p>
<p>同时，这个点在最短路图上的所有后记节点 <span
class="math inline">\(dis\rightarrow dis-1\)</span></p>
<p>那么对于最短路图上所有点，统计有多少个起点能够到达它，就能够知道以这种颜色点为起点时，这个点不同的
<span class="math inline">\(dis\)</span> 出现次数</p>
<p>这是一个拓扑图 <span class="math inline">\(dp\)</span>
问题，不好处理，因此考虑用 <span
class="math inline">\(\text{bitset}\)</span>
暴力存储所有能够转移的状态</p>
<p>由于需要维护的起点总数为 <span class="math inline">\(n\)</span>
，单次只维护一个集合，因此无法直接用 <span
class="math inline">\(\text{std::bitset}\)</span></p>
<p>复杂度为 <span class="math inline">\(O(\frac{nm}{w})\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ull;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> db;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>=<span class="type">int</span>&gt; T <span class="built_in">rd</span>()&#123;</span><br><span class="line">	T s=<span class="number">0</span>; <span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) f|=IO==<span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">51000</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,k;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> to,nxt,w;</span><br><span class="line">&#125; e[N*<span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> head[N],ecnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w=<span class="number">1</span>)</span></span>&#123;</span><br><span class="line">	e[++ecnt]=(Edge)&#123;v,head[u],w&#125;;</span><br><span class="line">	head[u]=ecnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> Q[N*<span class="number">4</span>],D[N*<span class="number">4</span>],L,R,dis[N];</span><br><span class="line"><span class="type">unsigned</span> Ans[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; G[<span class="number">200</span>];</span><br><span class="line"><span class="type">int</span> len;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BITSET</span>&#123;</span><br><span class="line">	ull a[N/<span class="number">128</span>];</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">count</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">int</span> c=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,len) c+=__builtin_popcountll(a[i]);</span><br><span class="line">		<span class="keyword">return</span> c;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">int</span> x)</span></span>&#123; a[x&gt;&gt;<span class="number">6</span>]|=<span class="number">1ull</span>&lt;&lt;x; &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123; <span class="built_in">memset</span>(a,<span class="number">0</span>,(len+<span class="number">1</span>)&lt;&lt;<span class="number">3</span>); &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">copy</span><span class="params">(<span class="type">const</span> BITSET &amp;t)</span></span>&#123; <span class="built_in">memcpy</span>(a,t.a,(len+<span class="number">1</span>)&lt;&lt;<span class="number">3</span>); &#125;</span><br><span class="line">	<span class="type">void</span> <span class="keyword">operator</span> |= (<span class="type">const</span> BITSET &amp;t) &#123; <span class="built_in">rep</span>(i,<span class="number">0</span>,len) a[i]|=t.a[i]; &#125;</span><br><span class="line">&#125; BS[N];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt,vis[N],ind[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Topo</span><span class="params">(<span class="type">int</span> sz)</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n+k) ind[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(u,<span class="number">1</span>,n+k) <span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=e[i].nxt) <span class="keyword">if</span>(dis[e[i].to]==dis[u]+e[i].w) ind[e[i].to]++;</span><br><span class="line">	L=<span class="number">1</span>,R=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n+k) <span class="keyword">if</span>(dis[i]&lt;<span class="number">1e6</span> &amp;&amp; !ind[i]) Q[++R]=i;</span><br><span class="line">	<span class="keyword">while</span>(L&lt;=R)&#123;</span><br><span class="line">		<span class="type">int</span> u=Q[L++];</span><br><span class="line">		<span class="keyword">if</span>(u&lt;=n) &#123;</span><br><span class="line">			<span class="type">int</span> t=BS[u].<span class="built_in">count</span>();</span><br><span class="line">			Ans[dis[u]]+=sz-t;</span><br><span class="line">			Ans[dis[u]<span class="number">-1</span>]+=t;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=e[i].nxt) <span class="keyword">if</span>(dis[e[i].to]==dis[u]+e[i].w) &#123;</span><br><span class="line">			BS[e[i].to]|=BS[u];</span><br><span class="line">			<span class="keyword">if</span>(--ind[e[i].to]==<span class="number">0</span>) Q[++R]=e[i].to;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Bfs</span><span class="params">(<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!G[c].<span class="built_in">size</span>()) <span class="keyword">return</span>;</span><br><span class="line">	<span class="built_in">memset</span>(dis,<span class="number">63</span>,(n+k+<span class="number">2</span>)&lt;&lt;<span class="number">2</span>);</span><br><span class="line">	L=<span class="number">2</span>*(n+k),R=<span class="number">2</span>*(n+k)<span class="number">-1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,G[c].<span class="built_in">size</span>()<span class="number">-1</span>) Q[++R]=G[c][i],D[R]=dis[G[c][i]]=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">while</span>(L&lt;=R)&#123;</span><br><span class="line">		<span class="type">int</span> u=Q[L++];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(reg <span class="type">int</span> i=head[u];i;i=e[i].nxt)&#123;</span><br><span class="line">			reg <span class="type">int</span> v=e[i].to,w=e[i].w;</span><br><span class="line">			<span class="keyword">if</span>(dis[v]&lt;=dis[u]+w) <span class="keyword">continue</span>;</span><br><span class="line">			dis[v]=dis[u]+w;</span><br><span class="line">			<span class="keyword">if</span>(!w) Q[--L]=v,D[L]=dis[v];</span><br><span class="line">			<span class="keyword">else</span> Q[++R]=v,D[R]=dis[v];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	len=G[c].<span class="built_in">size</span>()/<span class="number">64</span>;</span><br><span class="line">	<span class="keyword">if</span>(len&gt;=N/<span class="number">128</span>)&#123;</span><br><span class="line">		len=N/<span class="number">128</span><span class="number">-1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n+k) BS[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,G[c].<span class="built_in">size</span>()<span class="number">-1</span>) <span class="keyword">if</span>(i&lt;len*<span class="number">64</span>) BS[G[c][i]].<span class="built_in">set</span>(i);</span><br><span class="line">		<span class="built_in">Topo</span>(len*<span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">		<span class="type">int</span> tmp=len*<span class="number">64</span>;</span><br><span class="line">		len=(G[c].<span class="built_in">size</span>()-tmp)/<span class="number">64</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n+k) BS[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,G[c].<span class="built_in">size</span>()<span class="number">-1</span>) <span class="keyword">if</span>(i&gt;=tmp) BS[G[c][i]].<span class="built_in">set</span>(i-tmp);</span><br><span class="line">		<span class="built_in">Topo</span>(G[c].<span class="built_in">size</span>()-tmp);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n+k) BS[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,G[c].<span class="built_in">size</span>()<span class="number">-1</span>) BS[G[c][i]].<span class="built_in">set</span>(i);</span><br><span class="line">		<span class="built_in">Topo</span>(G[c].<span class="built_in">size</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> col[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	n=<span class="built_in">rd</span>(),m=<span class="built_in">rd</span>(),k=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="type">int</span> x=col[i]=<span class="built_in">rd</span>();</span><br><span class="line">		<span class="built_in">AddEdge</span>(n+x,i,<span class="number">0</span>),<span class="built_in">AddEdge</span>(i,n+x);</span><br><span class="line">		G[x].<span class="built_in">pb</span>(i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">		<span class="type">int</span> u=<span class="built_in">rd</span>(),v=<span class="built_in">rd</span>();</span><br><span class="line">		<span class="keyword">if</span>(col[u]==col[v]) <span class="keyword">continue</span>;</span><br><span class="line">		ind[u]++,ind[v]++;</span><br><span class="line">		<span class="built_in">AddEdge</span>(u,v),<span class="built_in">AddEdge</span>(v,u);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,k) <span class="built_in">Bfs</span>(i);</span><br><span class="line">	Ans[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">2</span>,k*<span class="number">2</span>) Ans[i]/=<span class="number">2</span>;</span><br><span class="line">	Ans[k*<span class="number">2</span>+<span class="number">1</span>]=<span class="number">1ll</span>*n*(n<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,k*<span class="number">2</span>+<span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">&quot;%u &quot;</span>,Ans[i]),Ans[k*<span class="number">2</span>+<span class="number">1</span>]-=Ans[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/17/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><span class="page-number current">18</span><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/19/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">orangejuice</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
