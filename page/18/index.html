<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"compilationfail.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="orangejuice&#39;s blog">
<meta property="og:url" content="https://compilationfail.github.io/page/18/index.html">
<meta property="og:site_name" content="orangejuice&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="orangejuice">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://compilationfail.github.io/page/18/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/18/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>orangejuice's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
  <script type="text/javascript">
    const bgc = 15;
    const bgu = "/images/bg";
    function getcookie() {
      // console.log("get", document.cookie);
      const s = document.cookie;
      return s.split('; ').find((row)=>row.startsWith("bgid="))?.split("=")[1];
    }
    function set_bg(index) {
      console.log("set", index);
      document.cookie = `bgid=${index}; path=/`;
      // console.log(document.cookie);
      url = `/images/bg${index}.jpg`;
      document.body.style=`background-image:url(${url});background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:fixed;`;
    }
    var index = parseInt(getcookie());
    if(isNaN(index) || index < 0 || index >= bgc) index = -1;
    window.onload = () => { set_bg(index) };
  </script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">orangejuice's blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">挂了请务必叫我</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="orangejuice"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">orangejuice</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">270</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://twitter.com/ChenJerson" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;ChenJerson" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/3950662532/profile?rightmod=1&wvr=6&mod=personinfo" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;3950662532&#x2F;profile?rightmod&#x3D;1&amp;wvr&#x3D;6&amp;mod&#x3D;personinfo" rel="noopener me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/CompilationFail" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CompilationFail" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/profiles/76561198969516062/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198969516062&#x2F;" rel="noopener me" target="_blank"><i class="fab fa-steam fa-fw"></i>Steam</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.last.fm/user/chasedeath" title="Lastfm → https:&#x2F;&#x2F;www.last.fm&#x2F;user&#x2F;chasedeath" rel="noopener me" target="_blank"><i class="fab fa-lastfm-square fa-fw"></i>Lastfm</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://open.spotify.com/user/mgxnlznf9dli6bm4k3sp0iuwz" title="Spotify → https:&#x2F;&#x2F;open.spotify.com&#x2F;user&#x2F;mgxnlznf9dli6bm4k3sp0iuwz" rel="noopener me" target="_blank"><i class="fab fa-spotify fa-fw"></i>Spotify</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202020.12%20Platinum%E3%80%8DSpaceship/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202020.12%20Platinum%E3%80%8DSpaceship/" class="post-title-link" itemprop="url">「USACO 2020.12 Platinum」Spaceship</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-06 15:36:48" itemprop="dateModified" datetime="2024-03-06T15:36:48+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="usaco-2020.12-platinumspaceship">「USACO 2020.12
Platinum」Spaceship</h1>
<p>看到题目第一个想到的是：按照路径长度可以确定按钮次数和路径次数</p>
<p>然而路径长度是 <span class="math inline">\(2^k\)</span>
级别的。。</p>
<p>下文认为 <span class="math inline">\(n,q,k\)</span> 同阶</p>
<p>既然无法考虑长度，那么就直接在 <span
class="math inline">\(dp\)</span> 时将路径作为状态压入</p>
<p>令 <span class="math inline">\(dp_{i,s,t}\)</span> 表示前面 <span
class="math inline">\(i\)</span> 个按钮未按过，从 <span
class="math inline">\(s\)</span> 走到 <span
class="math inline">\(t\)</span> 的路径数</p>
<p>显然 <span class="math inline">\(dp_{i}\)</span>
可以看做一个类似矩阵的转移，设邻接矩阵为 <span
class="math inline">\(E\)</span></p>
<p>那么得到 <span class="math inline">\(dp_{i}=dp_{i-1}+dp_{i-1}\cdot
E\cdot dp_{i-1}\)</span></p>
<p>( <span class="math inline">\(dp_i\)</span> 不一定按了 <span
class="math inline">\(i\)</span> 这个按钮，所以考虑按或者不按)</p>
<p>那么对于 <span class="math inline">\(b_s,b_t\)</span>
的情况，考虑把操作序列分成两段</p>
<p>显然操作序列有唯一一个按过恰好一次的最大的按钮 <span
class="math inline">\(max\)</span> ，可以在这里将操作序列分成两段</p>
<p>处理出 <span class="math inline">\(b_s\)</span> 到 <span
class="math inline">\(max\)</span> 和 <span
class="math inline">\(max\)</span> 到 <span
class="math inline">\(b_t\)</span> 的两部分方案数合并即可</p>
<p>以处理 <span class="math inline">\(b_s\rightarrow max\)</span>
为例</p>
<p>类似上面的操作，令 <span class="math inline">\(F_{i,j}\)</span>
表示最大按钮为 <span class="math inline">\(i\)</span> ，且按过 <span
class="math inline">\(i\)</span> 之后没有按过其他按钮，停留在 <span
class="math inline">\(j\)</span> 的方案数 ( <span
class="math inline">\(F_i\)</span> 是一个向量)</p>
<p>初始显然有 <span class="math inline">\(F_{b_s,s}=1\)</span></p>
<p><span class="math inline">\(\displaystyle
i&gt;b_s,F_{i}=\sum_{j&lt;i} F_{j}\cdot dp_{j-1}\cdot E\)</span> (按过
<span class="math inline">\(j\)</span> 之后可以继续按 <span
class="math inline">\([1,j-1]\)</span> )</p>
<p>前缀和即可，复杂度为 <span class="math inline">\(O(n^3)\)</span></p>
<p>同理处理出 <span class="math inline">\(max\rightarrow b_t\)</span>
的权值合并即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">62</span>,P=<span class="number">1e9</span>+<span class="number">7</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,q;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Mat</span>&#123;</span><br><span class="line">	<span class="type">int</span> a[N][N];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123; <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span> a); &#125;</span><br><span class="line">	Mat <span class="keyword">operator</span> * (<span class="type">const</span> Mat &amp;x) <span class="type">const</span> &#123;</span><br><span class="line">		Mat res; res.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,n) <span class="keyword">if</span>(a[i][j]) <span class="built_in">rep</span>(k,<span class="number">1</span>,n) res.a[i][k]=(res.a[i][k]+<span class="number">1ll</span>*a[i][j]*x.a[j][k])%P;</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">	Mat <span class="keyword">operator</span> + (<span class="type">const</span> Mat &amp;x) <span class="type">const</span> &#123;</span><br><span class="line">		Mat res;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,n) res.a[i][j]=a[i][j]+x.a[i][j],<span class="built_in">Mod1</span>(res.a[i][j]);</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; I,E,dp[N];</span><br><span class="line"><span class="type">int</span> F[N][N],G[N][N];</span><br><span class="line"><span class="type">int</span> S[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;spaceship.in&quot;</span>,<span class="string">&quot;r&quot;</span>,stdin),<span class="built_in">freopen</span>(<span class="string">&quot;spaceship.out&quot;</span>,<span class="string">&quot;w&quot;</span>,stdout);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;q);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) I.a[i][i]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,n) <span class="built_in">scanf</span>(<span class="string">&quot;%1d&quot;</span>,&amp;E.a[i][j]);</span><br><span class="line">	dp[<span class="number">0</span>]=I;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,m) dp[i]=dp[i<span class="number">-1</span>]+dp[i<span class="number">-1</span>]*E*dp[i<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">while</span>(q--) &#123;</span><br><span class="line">		<span class="type">int</span> bs,s,bt,t; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>,&amp;bs,&amp;s,&amp;bt,&amp;t);</span><br><span class="line">		<span class="built_in">memset</span>(F,<span class="number">0</span>,<span class="keyword">sizeof</span> F),<span class="built_in">memset</span>(G,<span class="number">0</span>,<span class="keyword">sizeof</span> G);</span><br><span class="line">		<span class="built_in">memset</span>(S,<span class="number">0</span>,<span class="keyword">sizeof</span> S);</span><br><span class="line">		F[bs][s]=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) S[bs][i]=dp[bs<span class="number">-1</span>].a[s][i];</span><br><span class="line">		<span class="built_in">rep</span>(i,bs+<span class="number">1</span>,m) &#123;</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) <span class="keyword">if</span>(S[i<span class="number">-1</span>][a]) <span class="built_in">rep</span>(b,<span class="number">1</span>,n) F[i][b]=(F[i][b]+<span class="number">1ll</span>*S[i<span class="number">-1</span>][a]*E.a[a][b])%P;</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) S[i][a]=S[i<span class="number">-1</span>][a];</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) <span class="keyword">if</span>(F[i][a]) <span class="built_in">rep</span>(b,<span class="number">1</span>,n) S[i][b]=(S[i][b]+<span class="number">1ll</span>*F[i][a]*dp[i<span class="number">-1</span>].a[a][b])%P;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">memset</span>(S,<span class="number">0</span>,<span class="keyword">sizeof</span> S);</span><br><span class="line">		G[bt][t]=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) S[bt][i]=dp[bt<span class="number">-1</span>].a[i][t];</span><br><span class="line">		<span class="built_in">rep</span>(i,bt+<span class="number">1</span>,m) &#123;</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) <span class="built_in">rep</span>(b,<span class="number">1</span>,n) G[i][a]=(G[i][a]+<span class="number">1ll</span>*S[i<span class="number">-1</span>][b]*E.a[a][b])%P;</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) S[i][a]=S[i<span class="number">-1</span>][a];</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">1</span>,n) <span class="built_in">rep</span>(b,<span class="number">1</span>,n) S[i][a]=(S[i][a]+<span class="number">1ll</span>*G[i][b]*dp[i<span class="number">-1</span>].a[a][b])%P;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">rep</span>(j,<span class="number">1</span>,n) ans=(ans+<span class="number">1ll</span>*F[i][j]*G[i][j])%P;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/BoundedOptimization%20TopCoder%20-%2012294/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/BoundedOptimization%20TopCoder%20-%2012294/" class="post-title-link" itemprop="url">[BoundedOptimization TopCoder - 12294](https://vjudge.net/problem/TopCoder-12294)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-06 15:36:48" itemprop="dateModified" datetime="2024-03-06T15:36:48+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="boundedoptimization-topcoder---12294"><a
target="_blank" rel="noopener" href="https://vjudge.net/problem/TopCoder-12294">BoundedOptimization
TopCoder - 12294</a></h1>
<p>考虑在最优情况下，某一些数在 <span
class="math inline">\(\text{lowerbound}\)</span> ,某一些在 <span
class="math inline">\(\text{upperbound}\)</span></p>
<p>确定了这些数之后，对于那些处于 <span
class="math inline">\((\text{lowerbound,upperbound})\)</span>
之间的数，它们的值其实是在<strong>忽略了上下界的情况下能取到的最优情况</strong></p>
<p>否则只要上下移动一点就可能达到一个更优的情况</p>
<p>那么考虑枚举每个数的状态在 <span
class="math inline">\(\text{lowerbound,upperbound,(lowerbound,uppperbound)}\)</span></p>
<p>推论：在中间的数之间必然存在互相关系</p>
<p>假设存在两个数 <span class="math inline">\(x_i,x_j\)</span>
之间没有互相关系，令其他数不变，</p>
<p>则答案式子可以表示为 <span class="math inline">\(ax_i+bx_j+c\)</span>
的形式，改变两个数的值总能得到更优的情况</p>
<p><span class="math display">\[ \ \]</span></p>
<p>设处在中间位置的数为 <span
class="math inline">\(x_1,\cdots,x_m\)</span> ，其他数为 <span
class="math inline">\(y_1,\cdots ,y_k\)</span>
，每个数连到外面的权值总和为 <span
class="math inline">\(s_i\)</span></p>
<p>发现在最优情况下， <span class="math inline">\(\sum x_i+\sum y_i
=MaxSum\)</span> ，那么就确定了 <span class="math inline">\(\sum
x_i\)</span> 的值，设为 <span class="math inline">\(Sum\)</span></p>
<p>那么答案就可以表示为 <span
class="math inline">\(\begin{aligned}\frac{\sum_ix_i\cdot(Sum-x_i+2\cdot
s_i)}{2}\end{aligned}+c\)</span></p>
<p>其中常数 <span class="math inline">\(c\)</span>
是外面的数之间的总和</p>
<p>不考虑限制的情况下，最优情况是 <span
class="math inline">\(x_i=\frac{Sum+s_i}{2}\)</span></p>
<p>此时，若 <span class="math inline">\(\sum x_i\ne Sum\)</span>
，是不合法的，需要调整</p>
<p>而让每个数改变 <span class="math inline">\(d\)</span>
，减少的答案都是 <span class="math inline">\(d^2\)</span>
(因为原来是在二次函数的最高点)</p>
<p>所以每个数都改变 <span
class="math inline">\(\begin{aligned}\frac{\sum
\frac{Sum+x_i}{2}-Sum}{m}\end{aligned}\)</span> 是最优的</p>
<p>注意这里计算时都是<strong>忽略了</strong> <span
class="math inline">\(x_1,\cdots,x_m\)</span> 的 <span
class="math inline">\(\text{lowerbound,upperbound}\)</span>
，求出的值不一定合法</p>
<p>如果不合法说明至少有某个值该到上下界之后答案会更优，所以这次的答案不用考虑</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> db;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">30</span>;</span><br><span class="line"><span class="type">const</span> db eps=<span class="number">1e-7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> G[N][N];</span><br><span class="line"><span class="type">int</span> A[N],w[N];</span><br><span class="line">db val[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BoundedOptimization</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">maxValue</span><span class="params">(vector &lt;string&gt; Expr, vector &lt;<span class="type">int</span>&gt; L, vector &lt;<span class="type">int</span>&gt; R, <span class="type">int</span> Max)</span> </span>&#123;</span><br><span class="line">		string E=<span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="keyword">for</span>(string t:Expr) E+=t;</span><br><span class="line">		<span class="built_in">memset</span>(G,<span class="number">0</span>,<span class="keyword">sizeof</span> G);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,E.<span class="built_in">size</span>()<span class="number">-1</span>) <span class="keyword">if</span>(<span class="built_in">isalpha</span>(E[i])) &#123;</span><br><span class="line">			G[E[i]-<span class="string">&#x27;a&#x27;</span>][E[i+<span class="number">1</span>]-<span class="string">&#x27;a&#x27;</span>]=G[E[i+<span class="number">1</span>]-<span class="string">&#x27;a&#x27;</span>][E[i]-<span class="string">&#x27;a&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> n=L.<span class="built_in">size</span>();</span><br><span class="line">		db ans=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(S,<span class="number">0</span>,<span class="built_in">pow</span>(<span class="number">3</span>,n)<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> T=S,m=<span class="number">0</span>;</span><br><span class="line">			db res=<span class="number">0</span>,sum=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">				w[i]=T%<span class="number">3</span>;</span><br><span class="line">				<span class="keyword">if</span>(!w[i]) A[++m]=i;</span><br><span class="line">				<span class="keyword">else</span> val[i]=(w[i]==<span class="number">1</span>?L[i]:R[i]),sum+=val[i];</span><br><span class="line">				T/=<span class="number">3</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="type">int</span> fl=sum&lt;=Max;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,m) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,m) <span class="keyword">if</span>(!G[A[i]][A[j]]) fl=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">			db left=Max-sum; </span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,m) &#123;</span><br><span class="line">				db c=left;</span><br><span class="line">				<span class="built_in">rep</span>(j,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(w[j] &amp;&amp; G[A[i]][j]) c+=val[j]*<span class="number">2</span>;</span><br><span class="line">				val[A[i]]=c/<span class="number">2</span>;</span><br><span class="line">				sum+=val[A[i]];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(m)&#123;</span><br><span class="line">				db t=(sum-Max)/m;</span><br><span class="line">				<span class="built_in">rep</span>(i,<span class="number">1</span>,m) val[A[i]]-=t;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(val[i]&lt;L[i]-eps || val[i]&gt;R[i]+eps) fl=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(G[i][j]) res+=val[i]*val[j];</span><br><span class="line">			<span class="built_in">cmax</span>(ans,res);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ans;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021.1%20Platinum%E3%80%8DPaint%20by%20Letters/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021.1%20Platinum%E3%80%8DPaint%20by%20Letters/" class="post-title-link" itemprop="url">「USACO 2021.1 Platinum」Paint by Letters</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-06 15:36:48" itemprop="dateModified" datetime="2024-03-06T15:36:48+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="usaco-2021.1-platinumpaint-by-letters">「USACO 2021.1
Platinum」Paint by Letters</h1>
<p>统计连通块问题，暴力是 <span class="math inline">\(O(qn^2)\)</span>
，而且常数大</p>
<p>容易想到 <a
target="_blank" rel="noopener" href="https://www.cnblogs.com/chasedeath/p/14246463.html">平面图的欧拉定理</a>
优化</p>
<p>下文和代码中， <span class="math inline">\(V,E,F\)</span>
分别为点集，边集，区域集合</p>
<p>其中 <span class="math inline">\(|V|\)</span> 可以直接得到， <span
class="math inline">\(|E|\)</span> 可以 <span
class="math inline">\(O(n^2)\)</span> 前缀和预处理出来， <span
class="math inline">\(O(1)\)</span> 查询</p>
<p>下面处理区域个数</p>
<h3 id="solution1">Solution1</h3>
<p>前缀和所有大小为1（即被四个点包住的）区域，暴力预处理所有大小 <span
class="math inline">\(&gt;1\)</span> 的区域，个数为 <span
class="math inline">\(O(\frac{nm}{4})\)</span></p>
<p>然后可以转化为一个对于给定矩形查询包含的 矩形个数 的问题</p>
<p>实际上这个题目 <span class="math inline">\(q\)</span>
小直接枚举就是了。。</p>
<p>复杂度为 <span class="math inline">\(O(nm+q\frac{nm}{4})\)</span>
，足够通过时限</p>
<p>写的够丑可以得到这个<a target="_blank" rel="noopener" href="https://loj.ac/s/1080403">代码</a></p>
<p>矩形区间查询问题 ，不知道有没有什么更好的方法</p>
<p>ps:垃圾数据没有卡，因此实际上数据中的空白块数量非常少，预处理写得稍微好一点可能还比下面的做法常数小</p>
<p><span class="math display">\[ \ \]</span></p>
<h3 id="solution2">Solution2</h3>
<p>用 <span class="math inline">\((x,y)\)</span> 表示 <span
class="math inline">\((x,y),(x+1,y),(x,y+1),(x+1,y+1)\)</span>
中间的一个空白区域</p>
<p>这些空白块会被染色块之间的边隔开，但是依然可以形成四联通块</p>
<p>预处理出所有空白区域的连通块，每个连通块选取一个代表点 <span
class="math inline">\(S_i\)</span></p>
<p>我们要统计一个区域中的空白连通块个数，注意到</p>
<p>跨出区域范围的空白点，并不是断开了，而是和最外层的无穷空白区合并在一起</p>
<p>因此可以先求出在区域中存在的连通块个数，然后将连通到区域外的部分去掉</p>
<p>具体实现上：</p>
<p>前缀和预处理出 <span class="math inline">\(S_i\)</span>
的位置，每次查询区域中的 <span class="math inline">\(S_i\)</span>
个数（这样的统计不完全）</p>
<p>然后将 <span class="math inline">\(S_i\)</span>
在区域中，且跨出区域的白色连通块删掉即可</p>
<p>跨出部分枚举四条边界即可</p>
<p>每次查询枚举边界，因此复杂度为 <span
class="math inline">\(O(nm+q(n+m))\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e3</span>+<span class="number">10</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> dx[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;,dy[]=&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,q;</span><br><span class="line"><span class="type">char</span> A[N][N];</span><br><span class="line"><span class="type">int</span> vis[N*N],I[N][N],E[<span class="number">4</span>][N][N],S[N][N];</span><br><span class="line"><span class="comment">// B,C预处理上/左边个数</span></span><br><span class="line"><span class="type">int</span> B[N][N],C[N][N];</span><br><span class="line"><span class="type">int</span> X[N*N],Y[N*N],cnt;</span><br><span class="line"><span class="comment">// 搜索空白连通块</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>&#123;</span><br><span class="line">	I[x][y]=cnt;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">3</span>) <span class="keyword">if</span>(E[x][y][i]) &#123;</span><br><span class="line">		<span class="type">int</span> x1=x+dx[i],y1=y+dy[i];</span><br><span class="line">		<span class="keyword">if</span>(!x1 || !y1||x1&gt;=n || y1&gt;=m || I[x1][y1]) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="built_in">dfs</span>(x1,y1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Sum</span><span class="params">(<span class="type">const</span> <span class="type">int</span> A[N][N],<span class="type">int</span> x1,<span class="type">int</span> y1,<span class="type">int</span> x2,<span class="type">int</span> y2)</span></span>&#123;</span><br><span class="line">	x1--,y1--;</span><br><span class="line">	<span class="keyword">return</span> A[x2][y2]-A[x1][y2]-A[x2][y1]+A[x1][y1];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;q);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,A[i]+<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,m) &#123;</span><br><span class="line">		E[<span class="number">0</span>][i][j<span class="number">-1</span>]=E[<span class="number">1</span>][i][j]=A[i][j]!=A[i+<span class="number">1</span>][j];</span><br><span class="line">		E[<span class="number">2</span>][i<span class="number">-1</span>][j]=E[<span class="number">3</span>][i][j]=A[i][j]!=A[i][j+<span class="number">1</span>];</span><br><span class="line">        <span class="comment">// 处理一下空白点之间的边</span></span><br><span class="line">		<span class="keyword">if</span>(A[i<span class="number">-1</span>][j]==A[i][j]) B[i][j]++;</span><br><span class="line">		<span class="keyword">if</span>(A[i][j]==A[i][j<span class="number">-1</span>]) C[i][j]++;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// 预处理空白点之间的集合</span></span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n<span class="number">-1</span>) <span class="built_in">rep</span>(j,<span class="number">1</span>,m<span class="number">-1</span>) <span class="keyword">if</span>(!I[i][j]) &#123;</span><br><span class="line">		X[++cnt]=i,Y[cnt]=j,vis[cnt]=q+<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">dfs</span>(i,j),S[i][j]++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,m) &#123;</span><br><span class="line">		B[i][j]+=B[i<span class="number">-1</span>][j]+B[i][j<span class="number">-1</span>]-B[i<span class="number">-1</span>][j<span class="number">-1</span>];</span><br><span class="line">		C[i][j]+=C[i<span class="number">-1</span>][j]+C[i][j<span class="number">-1</span>]-C[i<span class="number">-1</span>][j<span class="number">-1</span>];</span><br><span class="line">		S[i][j]+=S[i<span class="number">-1</span>][j]+S[i][j<span class="number">-1</span>]-S[i<span class="number">-1</span>][j<span class="number">-1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(q--) &#123;</span><br><span class="line">		<span class="type">int</span> lx,ly,rx,ry; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>,&amp;lx,&amp;ly,&amp;rx,&amp;ry);</span><br><span class="line">		<span class="type">int</span> V=(rx-lx+<span class="number">1</span>)*(ry-ly+<span class="number">1</span>);</span><br><span class="line">		<span class="type">int</span> E=<span class="built_in">Sum</span>(B,lx+<span class="number">1</span>,ly,rx,ry)+<span class="built_in">Sum</span>(C,lx,ly+<span class="number">1</span>,rx,ry);</span><br><span class="line">		<span class="type">int</span> F=<span class="built_in">Sum</span>(S,lx,ly,rx<span class="number">-1</span>,ry<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">auto</span> Check=[&amp;](<span class="type">int</span> i)&#123; <span class="keyword">if</span>(vis[i]!=q &amp;&amp; lx&lt;=X[i] &amp;&amp; X[i]&lt;rx &amp;&amp; ly&lt;=Y[i] &amp;&amp; Y[i]&lt;ry) vis[i]=q,F--; &#125;;</span><br><span class="line">		<span class="built_in">rep</span>(i,lx,rx<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(::E[<span class="number">0</span>][i][ry<span class="number">-1</span>]) <span class="built_in">Check</span>(I[i][ry<span class="number">-1</span>]);</span><br><span class="line">			<span class="keyword">if</span>(::E[<span class="number">1</span>][i][ly]) <span class="built_in">Check</span>(I[i][ly]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(i,ly,ry<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(::E[<span class="number">2</span>][rx<span class="number">-1</span>][i]) <span class="built_in">Check</span>(I[rx<span class="number">-1</span>][i]);</span><br><span class="line">			<span class="keyword">if</span>(::E[<span class="number">3</span>][lx][i]) <span class="built_in">Check</span>(I[lx][i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,V-E+F);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/CurvyonRails%20TopCoder%20-%2012432/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/CurvyonRails%20TopCoder%20-%2012432/" class="post-title-link" itemprop="url">TopCoder SRM 570 Div1 CurvyonRails</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-06 15:36:48" itemprop="dateModified" datetime="2024-03-06T15:36:48+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="topcoder-srm-570-div1-curvyonrails">TopCoder SRM 570 Div1
CurvyonRails</h1>
<p>题意: 一个 <span class="math inline">\(n\times m\)</span>
的网格图，其中有一些点需要建铁路，有一些点为关键点，在关键点上修直铁路会产生1的代价，求最小的代价</p>
<p>由于 <span class="math inline">\(n,m\leq 25\)</span> 显然不可以插头
<span class="math inline">\(\text{dp}\)</span> 。。。</p>
<p>考虑轨道联通实际上类似网络流的形式</p>
<p>考虑一个常见的思路: 网格图可以简化为二分图 然后 跑网络流</p>
<p>先不考虑代价的问题，判断是否存在合法方案</p>
<p>每个格子要有两条出边，因此可以让 <span
class="math inline">\(S\)</span> 向左侧点连边权为2的边，右侧点向 <span
class="math inline">\(T\)</span> 连边权为2的边</p>
<p>然后可以让每个左侧点向相邻的右侧点连边，即考虑了联通关系</p>
<p>下面考虑代价的计算，加入边的代价，即为费用流</p>
<p>连同向边会产生代价，因此考虑为每个节点新增两个节点，表示向上下/左右连边</p>
<p>对于让原节点对于新增的上下和左右节点 分别连两条代价为0和1的边</p>
<p>这样如果流了同向边，就会产生代价</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">25</span>*<span class="number">30</span>*<span class="number">3</span>,M=N&lt;&lt;<span class="number">3</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,m,k;</span><br><span class="line"><span class="type">int</span> a[<span class="number">30</span>][<span class="number">30</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Max Flow Min Cost</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> id[<span class="number">30</span>][<span class="number">30</span>][<span class="number">2</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> to,nxt,w,c;</span><br><span class="line">&#125;e[M];</span><br><span class="line"><span class="type">int</span> head[N],ecnt,S,T,V;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,V) head[i]=<span class="number">0</span>;</span><br><span class="line">	ecnt=<span class="number">1</span>,V=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">	e[++ecnt]=(Edge)&#123;v,head[u],w,c&#125;;</span><br><span class="line">	head[u]=ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w,<span class="type">int</span> c=<span class="number">0</span>)</span></span>&#123; <span class="built_in">AddEdge</span>(u,v,w,c),<span class="built_in">AddEdge</span>(v,u,<span class="number">0</span>,-c); &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> erep(u,i) for(int i=head[u],v=e[i].to,w=e[i].w,c=e[i].c;i;i=e[i].nxt,v=e[i].to,w=e[i].w,c=e[i].c)</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dis[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">SPFA</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> inq[N];</span><br><span class="line">	<span class="type">static</span> queue &lt;<span class="type">int</span>&gt; que;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,V) dis[i]=INF;</span><br><span class="line">	que.<span class="built_in">push</span>(S),dis[S]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> u=que.<span class="built_in">front</span>(); que.<span class="built_in">pop</span>();</span><br><span class="line">		inq[u]=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">erep</span>(u,i) <span class="keyword">if</span>(w &amp;&amp; dis[v]&gt;dis[u]+c) &#123;</span><br><span class="line">			dis[v]=dis[u]+c;</span><br><span class="line">			<span class="keyword">if</span>(!inq[v]) inq[v]=<span class="number">1</span>,que.<span class="built_in">push</span>(v);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dis[T]&lt;INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> in)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(u==T) <span class="keyword">return</span> in;</span><br><span class="line">	<span class="type">int</span> out=<span class="number">0</span>,t=dis[u]; dis[u]=INF;</span><br><span class="line">	<span class="built_in">erep</span>(u,i) <span class="keyword">if</span>(w &amp;&amp; dis[v]==t+c) &#123;</span><br><span class="line">		<span class="type">int</span> t=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(in-out,w));</span><br><span class="line">		e[i].w-=t,e[i^<span class="number">1</span>].w+=t,out+=t;</span><br><span class="line">		<span class="keyword">if</span>(in==out) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(out) dis[u]=t;</span><br><span class="line">	<span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Pii <span class="title">Dinic</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> flow=<span class="number">0</span>,cost=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">SPFA</span>()) </span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> t;(t=<span class="built_in">Dfs</span>(S,INF));) flow+=t,cost+=dis[T]*t;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">mp</span>(flow,cost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CurvyonRails</span> &#123;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		<span class="function"><span class="type">int</span> <span class="title">getmin</span><span class="params">(vector &lt;string&gt; field)</span> </span>&#123;</span><br><span class="line">			n=field.<span class="built_in">size</span>(),m=field[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="built_in">rep</span>(j,<span class="number">0</span>,m<span class="number">-1</span>) a[i+<span class="number">1</span>][j+<span class="number">1</span>]=field[i][j];</span><br><span class="line">			k=<span class="number">0</span>,<span class="built_in">Clear</span>();</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,m) <span class="keyword">if</span>(a[i][j]!=<span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">				k++;</span><br><span class="line">				<span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">1</span>) id[i][j][d]=++V;</span><br><span class="line">			&#125;</span><br><span class="line">			S=++V,T=++V;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">rep</span>(j,<span class="number">1</span>,m) <span class="keyword">if</span>(a[i][j]!=<span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>((i+j)&amp;<span class="number">1</span>)&#123;</span><br><span class="line">					<span class="built_in">Link</span>(S,++V,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">1</span>) &#123;</span><br><span class="line">						<span class="built_in">Link</span>(V,id[i][j][d],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">						<span class="built_in">Link</span>(V,id[i][j][d],<span class="number">1</span>,a[i][j]==<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">						<span class="comment">// 如果两条走了同向，就会产生1的代价</span></span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span>(i&lt;n &amp;&amp; a[i+<span class="number">1</span>][j]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i][j][<span class="number">0</span>],id[i+<span class="number">1</span>][j][<span class="number">0</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="keyword">if</span>(j&lt;m &amp;&amp; a[i][j+<span class="number">1</span>]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i][j][<span class="number">1</span>],id[i][j+<span class="number">1</span>][<span class="number">1</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="built_in">Link</span>(++V,T,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">1</span>) &#123;</span><br><span class="line">						<span class="built_in">Link</span>(id[i][j][d],V,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">						<span class="built_in">Link</span>(id[i][j][d],V,<span class="number">1</span>,a[i][j]==<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">						<span class="comment">// 如果两条走了同向，就会产生1的代价</span></span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span>(i&lt;n &amp;&amp; a[i+<span class="number">1</span>][j]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i+<span class="number">1</span>][j][<span class="number">0</span>],id[i][j][<span class="number">0</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">					<span class="keyword">if</span>(j&lt;m &amp;&amp; a[i][j+<span class="number">1</span>]!=<span class="string">&#x27;w&#x27;</span>) <span class="built_in">Link</span>(id[i][j+<span class="number">1</span>][<span class="number">1</span>],id[i][j][<span class="number">1</span>],<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			Pii ans=<span class="built_in">Dinic</span>();</span><br><span class="line">			<span class="keyword">if</span>(ans.first!=k) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">			<span class="keyword">return</span> ans.second;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//Powered by KawigiEdit 2.1.4 (beta) modified by pivanof!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021.1%20Platinum%E3%80%8DSum%20of%20Distances/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/ROI%20-%20CEOI%20-%20CCO%20-%20APIO%20-%20Baltic%20OI%20-%20USACO/%E3%80%8CUSACO%202021.1%20Platinum%E3%80%8DSum%20of%20Distances/" class="post-title-link" itemprop="url">「USACO 2021.1 Platinum」Sum of Distances</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-06 15:36:48" itemprop="dateModified" datetime="2024-03-06T15:36:48+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="usaco-2021.1-platinumsum-of-distances">「USACO 2021.1
Platinum」Sum of Distances</h1>
<p>设在 <span class="math inline">\(G_i\)</span> 中 <span
class="math inline">\(j_i\)</span> 点可行的距离集合为 <span
class="math inline">\(D_{j_i}\)</span></p>
<p>注意到一个点的 <span
class="math inline">\((j_1,j_2,\ldots,j_k)\)</span> 的 <span
class="math inline">\(dis\)</span> 可以用如下方式确定</p>
<p><span class="math inline">\(\displaystyle
dis(j_1,j_2,\ldots,j_k)=\min\{\bigcap D_{j_i}\}\)</span></p>
<p>而 <span class="math inline">\(D_{j_i}\)</span>
有一个简单的描述方法：</p>
<p>求出奇数和偶数的最小值，然后再最小值往上+ <span
class="math inline">\(2k\)</span> 的部分均存在（不停来回）</p>
<p>这样我们用两个值 <span
class="math inline">\(odd_{j_i},even_{j_i}\)</span> 描述了 <span
class="math inline">\(D_{j_i}\)</span></p>
<p>同时也容易得到 <span class="math inline">\(\displaystyle
dis(j_1,j_2,\ldots,j_k)=\min\{\max\{odd_{j_i}\},\max\{even_{j_i}\}\}\)</span></p>
<p>也就是说要在奇偶的 <span class="math inline">\(\max\)</span> 之间取
<span class="math inline">\(\min\)</span></p>
<p>考虑 <span class="math inline">\(odd_{j_i},even_{j_i}\)</span> 是
<span class="math inline">\(O(N_i)\)</span>
级别的，可以暴力合并，但是无法处理外层的 <span
class="math inline">\(\min\)</span> ，因此考虑用一个简单的 <span
class="math inline">\(\text{minmax}\)</span> 容斥解决</p>
<p><span class="math inline">\(\min\{a,b\}=a+b-\max\{a,b\}\)</span></p>
<p>这样就只有 <span class="math inline">\(\max\)</span>
要计算了，用简单的前缀和优化取 <span class="math inline">\(\max\)</span>
操作</p>
<p>注意要按照 <span class="math inline">\(N_i\)</span>
排序之后依次合并每一个 <span class="math inline">\(G_i\)</span>
保证复杂度</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> pair &lt;<span class="type">int</span>,<span class="type">int</span>&gt; Pii;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>,P=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> C[N],R[N],D[N][<span class="number">2</span>],I[N],M[N],S[N*<span class="number">2</span>];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; G[N];</span><br><span class="line"><span class="type">int</span> dis[N][<span class="number">2</span>],U,F[N],H[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Solve</span><span class="params">(<span class="type">int</span> S)</span></span>&#123;</span><br><span class="line">	F[U=<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(k,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="type">int</span> i=I[k];</span><br><span class="line">		<span class="built_in">rep</span>(j,U+<span class="number">1</span>,M[i]) F[j]=F[j<span class="number">-1</span>];</span><br><span class="line">		<span class="built_in">cmax</span>(U,M[i]);</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">0</span>,U) H[j]=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(j,R[i<span class="number">-1</span>]+<span class="number">1</span>,R[i]) &#123;</span><br><span class="line">			<span class="type">int</span> d=<span class="number">-1</span>;</span><br><span class="line">			<span class="keyword">if</span>(S&amp;<span class="number">1</span>) <span class="built_in">cmax</span>(d,D[j][<span class="number">0</span>]);</span><br><span class="line">			<span class="keyword">if</span>(S&amp;<span class="number">2</span>) <span class="built_in">cmax</span>(d,D[j][<span class="number">1</span>]);</span><br><span class="line">			<span class="keyword">if</span>(d==P) <span class="keyword">continue</span>;</span><br><span class="line">			H[d]++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,U) H[j]+=H[j<span class="number">-1</span>];</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">0</span>,U) F[j]=<span class="number">1ll</span>*F[j]*H[j]%P;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">drep</span>(j,U,<span class="number">1</span>) F[j]-=F[j<span class="number">-1</span>],<span class="built_in">Mod2</span>(F[j]);</span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(j,<span class="number">0</span>,U) ans=(ans+<span class="number">1ll</span>*j*F[j])%P;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	n=<span class="built_in">rd</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		I[i]=i,C[i]=<span class="built_in">rd</span>(),R[i]=R[i<span class="number">-1</span>]+C[i];</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,C[i]) G[j].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,<span class="built_in">rd</span>())&#123;</span><br><span class="line">			<span class="type">int</span> u=<span class="built_in">rd</span>(),v=<span class="built_in">rd</span>();</span><br><span class="line">			G[u].<span class="built_in">pb</span>(v),G[v].<span class="built_in">pb</span>(u);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,C[i]) dis[j][<span class="number">0</span>]=dis[j][<span class="number">1</span>]=P;</span><br><span class="line">		dis[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">		<span class="type">static</span> queue &lt;Pii&gt; que; que.<span class="built_in">push</span>(<span class="built_in">mp</span>(<span class="number">1</span>,<span class="number">0</span>));</span><br><span class="line">		<span class="keyword">while</span>(!que.<span class="built_in">empty</span>())&#123;</span><br><span class="line">			<span class="type">int</span> u=que.<span class="built_in">front</span>().first,d=que.<span class="built_in">front</span>().second; que.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="built_in">cmax</span>(M[i],dis[u][d]);</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> v:G[u]) <span class="keyword">if</span>(dis[v][!d]&gt;dis[u][d]+<span class="number">1</span>) dis[v][!d]=dis[u][d]+<span class="number">1</span>,que.<span class="built_in">push</span>(<span class="built_in">mp</span>(v,!d));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,C[i]) &#123;</span><br><span class="line">			<span class="built_in">rep</span>(k,<span class="number">0</span>,<span class="number">1</span>) &#123;</span><br><span class="line">				D[R[i<span class="number">-1</span>]+j][k]=dis[j][k];</span><br><span class="line">				<span class="keyword">if</span>(dis[j][k]!=P) <span class="built_in">cmax</span>(M[i],dis[j][k]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(I+<span class="number">1</span>,I+n+<span class="number">1</span>,[&amp;](<span class="type">int</span> x,<span class="type">int</span> y)&#123; <span class="keyword">return</span> C[x]&lt;C[y]; &#125;);</span><br><span class="line">	<span class="type">int</span> ans=((<span class="built_in">Solve</span>(<span class="number">1</span>)+<span class="built_in">Solve</span>(<span class="number">2</span>)-<span class="built_in">Solve</span>(<span class="number">3</span>))%P+P)%P;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/CosmicBlocks%20TopCoder%20-%2012034/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/CosmicBlocks%20TopCoder%20-%2012034/" class="post-title-link" itemprop="url">[CosmicBlocks - TopCoder- 12034](https://vjudge.net/problem/TopCoder-12034) (网络流)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-06 15:36:48" itemprop="dateModified" datetime="2024-03-06T15:36:48+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="cosmicblocks---topcoder--12034-网络流"><a
target="_blank" rel="noopener" href="https://vjudge.net/problem/TopCoder-12034">CosmicBlocks -
TopCoder- 12034</a> (网络流)</h1>
<p>注意题目定义的同构是存在不同的颜色覆盖关系，而不是存在不同的排列顺序</p>
<p>所以先枚举每一层放了那些颜色，再枚举那些颜色之间有覆盖</p>
<p>每一层的颜色划分数很少，最多可能同时存在的覆盖关系是 <span
class="math inline">\(9\)</span> 种，枚举复杂度最多是 <span
class="math inline">\(2^9\)</span> ，然后可以 <span
class="math inline">\(2^n\cdot n\ \text{dp}\)</span>
出拓扑序列的个数</p>
<p>问题在于如何快速又方便地判断对于<strong>当前情况是否存在方案</strong></p>
<p>一种方法是<strong>上下界网络流</strong></p>
<p>按照层之间的关系，覆盖关系就连 <span
class="math inline">\([1,+\infty)\)</span> 的边，同时源点向 <span
class="math inline">\(1\)</span> 层的点连 <span
class="math inline">\([0,+\infty)\)</span> 的边，每个点都向汇点连 <span
class="math inline">\([0,\infty)\)</span> 的边</p>
<p>注意由于要限制流过每个点的流量，每个点要拆成两个点中间连 <span
class="math inline">\([num_i,num_i]\)</span> 的边</p>
<p>最后判断一下<strong>有源汇可行流</strong>即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod1(x) ((x&gt;=P)&amp;&amp;(x-=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Mod2(x) ((x&lt;0)&amp;&amp;(x+=P))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> reg register</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pb push_back</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> IO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rd</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> s=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>())) <span class="keyword">if</span>(IO==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">do</span> s=(s&lt;&lt;<span class="number">1</span>)+(s&lt;&lt;<span class="number">3</span>)+(IO^<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(IO=<span class="built_in">getchar</span>()));</span><br><span class="line">	<span class="keyword">return</span> f?-s:s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> N=<span class="number">20</span>,INF=<span class="number">1e8</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> n,m,ans,L,R;</span><br><span class="line"><span class="type">int</span> cnt[N],id[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; G[N];</span><br><span class="line"><span class="type">int</span> GS[N];</span><br><span class="line">vector &lt;<span class="type">int</span>&gt; Layer[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Calc_DAG</span><span class="params">()</span> </span>&#123; <span class="comment">// 计算拓扑序列的个数</span></span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> dp[<span class="number">1</span>&lt;&lt;<span class="number">6</span>];</span><br><span class="line">	<span class="type">int</span> A=(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,A) dp[i]=<span class="number">0</span>;</span><br><span class="line">	dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">rep</span>(S,<span class="number">0</span>,A<span class="number">-1</span>) <span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>((~S&amp;(<span class="number">1</span>&lt;&lt;i)) &amp;&amp; (S&amp;GS[i+<span class="number">1</span>])==GS[i+<span class="number">1</span>]) dp[S|(<span class="number">1</span>&lt;&lt;i)]+=dp[S];</span><br><span class="line">	<span class="keyword">return</span> dp[A];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ind[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Limited_Flow</span>&#123; <span class="comment">// 有源汇可行流</span></span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> M=<span class="number">300</span>;</span><br><span class="line">	<span class="type">int</span> S,T;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">		<span class="type">int</span> to,nxt,w;</span><br><span class="line">	&#125; e[M];</span><br><span class="line">	<span class="type">int</span> head[N],ecnt;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>+<span class="number">4</span>) head[i]=<span class="number">0</span>;</span><br><span class="line">		ecnt=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> erep(u,i) for(int i=head[u];i;i=e[i].nxt)</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span> </span>&#123; e[ecnt]=(Edge)&#123;v,head[u],w&#125;,head[u]=ecnt++; &#125; </span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> w)</span></span>&#123; <span class="built_in">AddEdge</span>(u,v,w),<span class="built_in">AddEdge</span>(v,u,<span class="number">0</span>); &#125;</span><br><span class="line">	<span class="type">int</span> dis[N];</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">static</span> queue &lt;<span class="type">int</span>&gt; que;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,T) dis[i]=INF; dis[S]=<span class="number">0</span>,que.<span class="built_in">push</span>(S);</span><br><span class="line">		<span class="keyword">while</span>(!que.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">			<span class="type">int</span> u=que.<span class="built_in">front</span>(); que.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="built_in">erep</span>(u,i) &#123;</span><br><span class="line">				<span class="type">int</span> v=e[i].to,w=e[i].w;</span><br><span class="line">				<span class="keyword">if</span>(!w || dis[v]&lt;=dis[u]+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">				dis[v]=dis[u]+<span class="number">1</span>,que.<span class="built_in">push</span>(v);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> dis[T]&lt;INF;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> flowin)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(u==T) <span class="keyword">return</span> flowin;</span><br><span class="line">		<span class="type">int</span> flowout=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">erep</span>(u,i) &#123;</span><br><span class="line">			<span class="type">int</span> v=e[i].to,w=e[i].w;</span><br><span class="line">			<span class="keyword">if</span>(!w || dis[v]!=dis[u]+<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="type">int</span> t=<span class="built_in">Dfs</span>(v,<span class="built_in">min</span>(flowin-flowout,w));</span><br><span class="line">			e[i].w-=t,e[i^<span class="number">1</span>].w+=t,flowout+=t;</span><br><span class="line">			<span class="keyword">if</span>(flowin==flowout) <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!flowout) dis[u]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> flowout;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Dinic</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">Bfs</span>()) ans+=<span class="built_in">Dfs</span>(S,INF);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">erep</span>(S,i) <span class="keyword">if</span>(e[i].w) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">erep</span>(T,i) <span class="keyword">if</span>(e[i^<span class="number">1</span>].w) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; Flow;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Extend_Edge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,<span class="type">int</span> L,<span class="type">int</span> R)</span></span>&#123;</span><br><span class="line">	ind[u]-=L,ind[v]+=L;</span><br><span class="line">	Flow.<span class="built_in">Link</span>(u,v,R-L);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Check</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>+<span class="number">4</span>) ind[i]=<span class="number">0</span>;</span><br><span class="line">	Flow.<span class="built_in">clear</span>();</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">Extend_Edge</span>(i*<span class="number">2</span><span class="number">-1</span>,i*<span class="number">2</span>,cnt[i],cnt[i]);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(id[i]==<span class="number">1</span>) <span class="built_in">Extend_Edge</span>(n*<span class="number">2</span>+<span class="number">1</span>,i*<span class="number">2</span><span class="number">-1</span>,cnt[i],cnt[i]);</span><br><span class="line">	<span class="built_in">rep</span>(u,<span class="number">1</span>,n) <span class="keyword">for</span>(<span class="type">int</span> v:G[u]) <span class="built_in">Extend_Edge</span>(u*<span class="number">2</span>,v*<span class="number">2</span><span class="number">-1</span>,<span class="number">1</span>,INF);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">Extend_Edge</span>(i*<span class="number">2</span>,n*<span class="number">2</span>+<span class="number">2</span>,<span class="number">0</span>,INF);</span><br><span class="line">	<span class="built_in">Extend_Edge</span>(n*<span class="number">2</span>+<span class="number">2</span>,n*<span class="number">2</span>+<span class="number">1</span>,<span class="number">0</span>,INF);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>+<span class="number">2</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(ind[i]&gt;<span class="number">0</span>) Flow.<span class="built_in">Link</span>(n*<span class="number">2</span>+<span class="number">3</span>,i,ind[i]);</span><br><span class="line">		<span class="keyword">if</span>(ind[i]&lt;<span class="number">0</span>) Flow.<span class="built_in">Link</span>(i,n*<span class="number">2</span>+<span class="number">4</span>,-ind[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	Flow.S=n*<span class="number">2</span>+<span class="number">3</span>,Flow.T=n*<span class="number">2</span>+<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">	Flow.<span class="built_in">Dinic</span>();</span><br><span class="line">	<span class="keyword">return</span> Flow.<span class="built_in">Check</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dfs_GetDAG</span><span class="params">(<span class="type">int</span> p)</span> </span>&#123; <span class="comment">// dfs枚举覆盖关系</span></span><br><span class="line">	<span class="keyword">if</span>(p==n+<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> Ways=<span class="built_in">Calc_DAG</span>();</span><br><span class="line">		<span class="keyword">if</span>(Ways&lt;L || Ways&gt;R) <span class="keyword">return</span>;</span><br><span class="line">		ans+=<span class="built_in">Check</span>();</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(id[p]==m) <span class="keyword">return</span> <span class="built_in">Dfs_GetDAG</span>(p+<span class="number">1</span>);</span><br><span class="line">	<span class="type">int</span> n=Layer[id[p]+<span class="number">1</span>].<span class="built_in">size</span>();</span><br><span class="line">	<span class="built_in">rep</span>(S,<span class="number">0</span>,(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) <span class="keyword">if</span>(S&amp;(<span class="number">1</span>&lt;&lt;i)) G[p].<span class="built_in">pb</span>(Layer[id[p]+<span class="number">1</span>][i]),GS[p]|=<span class="number">1</span>&lt;&lt;(Layer[id[p]+<span class="number">1</span>][i]<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">Dfs_GetDAG</span>(p+<span class="number">1</span>);</span><br><span class="line">		G[p].<span class="built_in">clear</span>(),GS[p]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dfs_Getlayer</span><span class="params">(<span class="type">int</span> num,<span class="type">int</span> fir,<span class="type">int</span> chosennumber)</span></span>&#123; <span class="comment">// dfs枚举层的情况</span></span><br><span class="line">	<span class="keyword">if</span>(chosennumber==n) &#123;</span><br><span class="line">		m=num;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,m) Layer[i].<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) Layer[id[i]].<span class="built_in">pb</span>(i);</span><br><span class="line">		<span class="built_in">Dfs_GetDAG</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,fir,n) <span class="keyword">if</span>(!id[i]) &#123;</span><br><span class="line">		id[i]=num;</span><br><span class="line">		<span class="built_in">Dfs_Getlayer</span>(num,i+<span class="number">1</span>,chosennumber+<span class="number">1</span>);</span><br><span class="line">		id[i]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(fir!=<span class="number">1</span>) <span class="built_in">Dfs_Getlayer</span>(num+<span class="number">1</span>,<span class="number">1</span>,chosennumber);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CosmicBlocks</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">getNumOrders</span><span class="params">(vector &lt;<span class="type">int</span>&gt; a, <span class="type">int</span> Min, <span class="type">int</span> Max)</span> </span>&#123;</span><br><span class="line">		L=Min,R=Max;</span><br><span class="line">		n=a.<span class="built_in">size</span>(),ans=<span class="number">0</span>; <span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) cnt[i+<span class="number">1</span>]=a[i];</span><br><span class="line">		<span class="built_in">Dfs_Getlayer</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Powered by KawigiEdit 2.1.4 (beta) modified by pivanof!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/Equilateral%20Triangles/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/Equilateral%20Triangles/" class="post-title-link" itemprop="url">Equilateral Triangles</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-06 15:36:48" itemprop="dateModified" datetime="2024-03-06T15:36:48+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="equilateral-triangles">Equilateral Triangles</h1>
<p>题意: 求所有三个点哈密顿距离相等的无序三元点对个数</p>
<p>推论1: 到平面中一点 <span class="math inline">\((x,y)\)</span>
哈密顿距离为 <span class="math inline">\(d\)</span> 的点，构成一个以
<span class="math inline">\((x,y)\)</span> 为中心， <span
class="math inline">\(d\)</span> 为半对角线长的菱形</p>
<p>菱形不好搞，转一下，令旋转后的点 <span
class="math inline">\(x&#39;=x+y,y&#39;=x-y\)</span>
，(也就是曼哈顿距离转切比雪夫距离)</p>
<p>这样得到的就是一个正方形了</p>
<p>推论2: 选出的三点中，一定存在两个点 <span
class="math inline">\(x\)</span> 或者 <span
class="math inline">\(y\)</span> 坐标相同</p>
<p>如果选出点 <span class="math inline">\(A,B\)</span>
不满足，由下图可以看到，可行的部分(就是相交部分 <span
class="math inline">\(C1,C2\)</span> )也必然满足</p>
<figure>
<img src="https://i.loli.net/2020/09/25/QgiP6kuB8JaH9to.png"
alt="te1.png" />
<figcaption aria-hidden="true">te1.png</figcaption>
</figure>
<p>接下来以 <span class="math inline">\(x\)</span> 相同为例，枚举点
<span class="math inline">\(A,B\)</span> ，设其距离为 <span
class="math inline">\(d\)</span></p>
<figure>
<img src="https://i.loli.net/2020/09/25/zAwO29WRSK5sXnL.png"
alt="te2.png" />
<figcaption aria-hidden="true">te2.png</figcaption>
</figure>
<p>可以看到比较显然就是两条红色的相交线段， <span
class="math inline">\(O(n^3)\)</span> 枚举 <span
class="math inline">\(A,B\)</span> 两点后，直接用前缀和维护即可</p>
<p>对于 <span class="math inline">\(x\)</span> 相同，对于 <span
class="math inline">\(y\)</span>
相同分别做一次即可，注意考虑的时候不要把 <span
class="math inline">\(x,y\)</span> 都有相同的算两次</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC optimize(2)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">610</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">char</span> A[N][N],B[N][N];</span><br><span class="line"><span class="type">int</span> S[N][N];</span><br><span class="line"><span class="type">int</span> D[N],C;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,A[i]+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,n) <span class="keyword">if</span>(A[i][j]==<span class="string">&#x27;*&#x27;</span>) B[i+j][i-j+n]=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) <span class="built_in">rep</span>(j,<span class="number">1</span>,n*<span class="number">2</span>) S[i][j]=S[i][j<span class="number">-1</span>]+B[i][j];</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) &#123;</span><br><span class="line">		C=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(x,<span class="number">1</span>,n*<span class="number">2</span>) <span class="keyword">if</span>(B[i][x]) D[++C]=x;</span><br><span class="line">		<span class="built_in">rep</span>(a,<span class="number">1</span>,C) <span class="built_in">rep</span>(b,a+<span class="number">1</span>,C) &#123;</span><br><span class="line">			<span class="type">int</span> d=D[b]-D[a];</span><br><span class="line">			i-d&gt;=<span class="number">1</span> &amp;&amp; (ans+=S[i-d][D[b]]-S[i-d][D[a]<span class="number">-1</span>]);</span><br><span class="line">			i+d&lt;=n*<span class="number">2</span> &amp;&amp; (ans+=S[i+d][D[b]]-S[i+d][D[a]<span class="number">-1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) <span class="built_in">rep</span>(j,<span class="number">1</span>,n*<span class="number">2</span>) S[i][j]=S[i][j<span class="number">-1</span>]+B[j][i];</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">1</span>,n*<span class="number">2</span>) &#123;</span><br><span class="line">		C=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(x,<span class="number">1</span>,n*<span class="number">2</span>) <span class="keyword">if</span>(B[x][i]) D[++C]=x;</span><br><span class="line">		<span class="built_in">rep</span>(a,<span class="number">1</span>,C) <span class="built_in">rep</span>(b,a+<span class="number">1</span>,C) &#123;</span><br><span class="line">			<span class="type">int</span> d=D[b]-D[a];</span><br><span class="line">			i-d&gt;=<span class="number">1</span> &amp;&amp; (ans+=S[i-d][D[b]<span class="number">-1</span>]-S[i-d][D[a]]);</span><br><span class="line">			i+d&lt;=n*<span class="number">2</span> &amp;&amp; (ans+=S[i+d][D[b]<span class="number">-1</span>]-S[i+d][D[a]]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/DisjointSemicircles%20TopCoder%20-%2012365/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/DisjointSemicircles%20TopCoder%20-%2012365/" class="post-title-link" itemprop="url">Topcoder SRM568 Div1 DisjointSemicircles (二分图染色)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-06 15:36:48" itemprop="dateModified" datetime="2024-03-06T15:36:48+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="topcoder-srm568-div1-disjointsemicircles-二分图染色">Topcoder
SRM568 Div1 DisjointSemicircles (二分图染色)</h1>
<p>题意: 给定数轴上排列的 <span class="math inline">\(2n\)</span>
个点，每个点需要找到另一个点和它匹配，并且以他们为直径两端，向上或者向下作一个半圆</p>
<p>有一些点已经匹配好了，要求判断是否存在一个合法的方案，满足所有的半圆不相交</p>
<p>###思路:</p>
<p>枚举已经确定的匹配半圆的方向(设有 <span
class="math inline">\(m\)</span> 对已匹配)，然后 <span
class="math inline">\(O(n)\)</span> 判断自由点是否存在合法方案</p>
<h3 id="判断合法方案的核心性质">判断合法方案的核心性质:</h3>
<p>定义一个<strong>点的方向</strong>为其所连接的<strong>半圆的方向</strong>(上为0，下为1)</p>
<p>则自由点存在合法方案的充要条件是:</p>
<p>整个序列上每种方向的点数为偶数，且所有已匹配的半圆所覆盖的区间下，和<strong>半圆同向的点</strong>个数为<strong>偶数</strong></p>
<p>必要性:</p>
<p>如果某个半圆下同向点个数为奇数，则必然有一个点与其同向并且不得不连到区间外，这显然不合法</p>
<p>充分性:</p>
<p>一种合法的构造方法是:</p>
<p>按照 <span class="math inline">\(L\)</span>
从左到右，遍历每个已匹配的半圆，如果包含同向子半圆优先解决同向的子半圆</p>
<p>剩下的点依然是偶数个，从左到右依次和上一个匹配即可</p>
<p><span class="math display">\[\  \]</span></p>
<h3 id="判断是否存在合法方案">判断是否存在合法方案</h3>
<p>那么问题转化为判断是否存在一种合法的定向方案，使得某一些区间里0/1的个数为偶数</p>
<p>考虑构建二分图染色，令点集 <span
class="math inline">\(V=\{0,1,\cdots,n,0&#39;,1&#39;,\cdots,n&#39;\}\)</span>
，则 <span class="math inline">\((u,v)\in E\)</span> 表示 <span
class="math inline">\(col(u)\ne col(v)\)</span></p>
<p>其中 <span class="math inline">\(i\)</span> 号节点表示 <span
class="math inline">\(1-i\)</span> 中所有未匹配节点方向的异或和， <span
class="math inline">\(i&#39;\)</span> 表示 <span
class="math inline">\(i\)</span> 的反点 <span
class="math inline">\((i,i&#39;)\in E\)</span></p>
<p>(到这里可以自己想一下怎么连边)</p>
<p>对于已匹配圆 <span class="math inline">\([L,R]\)</span> (注意不要忘了
<span class="math inline">\([1,n]\)</span> )</p>
<p>如果它方向为 <span class="math inline">\(1\)</span> ，显然只需要
<span class="math inline">\(col(L-1)=col(R)\)</span></p>
<p>如果方向为0，设 <span class="math inline">\([L,R]\)</span>
未染色个数为 <span class="math inline">\(k\)</span> ，则显然有 <span
class="math inline">\(col(L-1)=col(R)\oplus (k\mod 2)\)</span>
，即考虑反向的个数</p>
<p>同时对于已匹配点 <span class="math inline">\(i\)</span> ，显然有
<span class="math inline">\(col(i)=col(i-1)\)</span></p>
<p>由此，得到一个 <span class="math inline">\(O(n)\)</span>
点数边数的图</p>
<p>如果在 <span class="math inline">\(\text{dfs}\)</span>
枚举时同步加边和回撤，总复杂度就为 <span
class="math inline">\(O(2^m\cdot n)\)</span></p>
<p>由于不可能所有方案都合法，实际应该是一个比较松的上界</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">110</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"><span class="type">int</span> cnt[N];</span><br><span class="line"><span class="type">int</span> L[N],R[N],m,Cross[N][N];</span><br><span class="line"><span class="type">int</span> vec[<span class="number">2</span>][N],c[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>&#123;</span><br><span class="line">	<span class="type">int</span> u,v,nxt;</span><br><span class="line">&#125;e[N*<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> head[N],ecnt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AddEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	e[++ecnt]=(Edge)&#123;u,v,head[u]&#125;;</span><br><span class="line">	head[u]=ecnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span>&#123; </span><br><span class="line">	<span class="built_in">AddEdge</span>(u,v),<span class="built_in">AddEdge</span>(v,u); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Back</span><span class="params">()</span></span>&#123;</span><br><span class="line">	head[e[ecnt].u]=e[ecnt].nxt,ecnt--;</span><br><span class="line">	head[e[ecnt].u]=e[ecnt].nxt,ecnt--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ans,fl;</span><br><span class="line"><span class="type">int</span> vis[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs_col</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">	vis[u]=c;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=head[u];i;i=e[i].nxt)&#123;</span><br><span class="line">		<span class="type">int</span> v=e[i].v;</span><br><span class="line">		<span class="keyword">if</span>(!vis[v]) <span class="built_in">dfs_col</span>(v,<span class="number">3</span>-c);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(vis[v]==vis[u]) fl=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(ans) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span>(p&gt;m)&#123;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n*<span class="number">2</span>+<span class="number">1</span>) vis[i]=<span class="number">0</span>;</span><br><span class="line">		fl=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n*<span class="number">2</span>+<span class="number">1</span>) <span class="keyword">if</span>(!vis[i]) <span class="built_in">dfs_col</span>(i,<span class="number">1</span>);</span><br><span class="line">		ans|=fl;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">rep</span>(i,<span class="number">0</span>,<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="type">int</span> fl=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(j,<span class="number">1</span>,c[i]) <span class="keyword">if</span>(R[vec[i][j]]&gt;L[p] &amp;&amp; R[vec[i][j]]&lt;R[p]) fl=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">		vec[i][++c[i]]=p;</span><br><span class="line">		<span class="keyword">if</span>(i || ~(cnt[R[p]]-cnt[L[p]])&amp;<span class="number">1</span>) <span class="built_in">Link</span>(L[p]+n+<span class="number">1</span>,R[p]<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">Link</span>(L[p],R[p]<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">dfs</span>(p+<span class="number">1</span>);</span><br><span class="line">		c[i]--,<span class="built_in">Back</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DisjointSemicircles</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">string <span class="title">getPossibility</span><span class="params">(vector &lt;<span class="type">int</span>&gt; labels)</span> </span>&#123;</span><br><span class="line">		n=labels.<span class="built_in">size</span>(),m=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) a[i]=labels[i<span class="number">-1</span>];</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">			cnt[i]=cnt[i<span class="number">-1</span>]+(a[i]==<span class="number">-1</span>);</span><br><span class="line">			<span class="keyword">if</span>(~a[i]) <span class="built_in">rep</span>(j,i+<span class="number">1</span>,n) <span class="keyword">if</span>(a[j]==a[i]) L[++m]=i,R[m]=j;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(!m) <span class="keyword">return</span> <span class="string">&quot;POSSIBLE&quot;</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,(n+<span class="number">1</span>)*<span class="number">2</span>) head[i]=ecnt=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="keyword">if</span>(~a[i]) <span class="built_in">Link</span>(i+n+<span class="number">1</span>,i<span class="number">-1</span>);</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n) <span class="built_in">Link</span>(i,i+n+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">Link</span>(n+<span class="number">1</span>,n);</span><br><span class="line">		ans=<span class="number">0</span>,<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> ans?<span class="string">&quot;POSSIBLE&quot;</span>:<span class="string">&quot;IMPOSSIBLE&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/MapGuessing%20TopCoder%20-%2012152/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/MapGuessing%20TopCoder%20-%2012152/" class="post-title-link" itemprop="url"># [MapGuessing TopCoder - 12152](https://vjudge.net/problem/TopCoder-12152)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-06 15:36:48" itemprop="dateModified" datetime="2024-03-06T15:36:48+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="mapguessing-topcoder---12152"><a
target="_blank" rel="noopener" href="https://vjudge.net/problem/TopCoder-12152">MapGuessing TopCoder -
12152</a></h2>
<p>做得我很迷</p>
<p>首先是可以把问题转化为，每次操作之后会让原序列的限制条件变为：不考虑某一些位置时合法</p>
<p>枚举每个开始位置，依次考虑每一个操作，如果有一个位置被改为不同，就是不合法的</p>
<p>对于每一个开始位置，能得到的的<strong>最优限制条件</strong>都是唯一的，因为只要是合法的，一定取最后一个合法的位置，才能尽可能多地覆盖一些位置</p>
<p>那么我们得到了 <span class="math inline">\(|goal|\)</span>
个这样的限制条件 <span class="math inline">\(S_i\)</span> ，设 <span
class="math inline">\(n=|goal|\)</span></p>
<p>直接计算肯定会算重，考虑一个简单的容斥</p>
<p><span class="math inline">\(\begin{aligned}Answer=\sum_{T\ne
\empty}(-1)^{|T|+1}2^{|S_{T_1}\cap \cdots \cap
S_{T_{|T|}}|}\end{aligned}\)</span></p>
<p>就是枚举选择一个限制的集合，求出他们的并集</p>
<p>直接枚举复杂度当然是 <span class="math inline">\(O(2^{|n|})\)</span>
，如果 <span class="math inline">\(\text{dfs}\)</span> 枚举，当前状态为
<span class="math inline">\(0\)</span> 时，可以直接返回答案</p>
<p>估计一下这个 <span class="math inline">\(\text{dfs}\)</span>
的复杂度</p>
<p>设操作过程中指针左右移动的距离是 <span
class="math inline">\(L\)</span> ，那么最多存在 <span
class="math inline">\(n-L\)</span> 个合法的开始位置，每个状态最多包含
<span class="math inline">\(L\)</span> 个 <span
class="math inline">\(1\)</span></p>
<p>很显然枚举的上限是 <span
class="math inline">\(\min\{2^{n-L},2^{L}\}\)</span>
，即受到<strong>开始位置的个数</strong>和<strong>可能出现的1个数</strong>的限制</p>
<p>当 <span class="math inline">\(n-L=L\)</span> 时，复杂度达到上限是
<span class="math inline">\(O(2^{\frac{n}{2}})\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"></span><br><span class="line">set &lt;ll&gt; st;</span><br><span class="line">ll S[<span class="number">40</span>];</span><br><span class="line"><span class="type">int</span> now[<span class="number">40</span>],cnt;</span><br><span class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="type">int</span> p,ll State)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(p==cnt+<span class="number">1</span>) <span class="keyword">return</span> (<span class="number">1ll</span>&lt;&lt;__builtin_popcountll(State)); <span class="comment">// 枚举完毕</span></span><br><span class="line">	<span class="keyword">if</span>(State==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// 剪枝，注意因为是后面的所有1,-1相加，所以是return 0而不是1</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">dfs</span>(p+<span class="number">1</span>,State)-<span class="built_in">dfs</span>(p+<span class="number">1</span>,State&amp;S[p]);  <span class="comment">// 直接处理容斥系数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MapGuessing</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">countPatterns</span><span class="params">(string S, vector &lt;string&gt; code)</span> </span>&#123;</span><br><span class="line">		string C=<span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="keyword">for</span>(string t:code) C+=t;</span><br><span class="line">		<span class="type">int</span> n=S.<span class="built_in">size</span>();</span><br><span class="line">		st.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> p=i,f=<span class="number">1</span>;</span><br><span class="line">			ll lst=<span class="number">0</span>; <span class="comment">// 记录最后一个合法的即可</span></span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) now[i]=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">char</span> c:C) &#123;</span><br><span class="line">				<span class="keyword">if</span>(c==<span class="string">&#x27;&lt;&#x27;</span>) p--;</span><br><span class="line">				<span class="keyword">if</span>(c==<span class="string">&#x27;&gt;&#x27;</span>) p++;</span><br><span class="line">				<span class="keyword">if</span>(c==<span class="string">&#x27;0&#x27;</span>) now[p]=<span class="number">1</span>;</span><br><span class="line">				<span class="keyword">if</span>(c==<span class="string">&#x27;1&#x27;</span>) now[p]=<span class="number">2</span>;</span><br><span class="line">				<span class="keyword">if</span>(p&lt;<span class="number">0</span> || p&gt;=n)&#123; f=<span class="number">0</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">				<span class="type">int</span> fl=<span class="number">1</span>;</span><br><span class="line">				ll T=<span class="number">0</span>;</span><br><span class="line">				<span class="built_in">rep</span>(i,<span class="number">0</span>,n<span class="number">-1</span>) &#123;</span><br><span class="line">					<span class="keyword">if</span>(!now[i]) <span class="keyword">continue</span>;</span><br><span class="line">					<span class="keyword">if</span>(now[i]<span class="number">-1</span>!=S[i]-<span class="string">&#x27;0&#x27;</span>)&#123; fl=<span class="number">0</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">					<span class="keyword">else</span> T|=<span class="number">1ll</span>&lt;&lt;i;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(!fl) <span class="keyword">continue</span>;</span><br><span class="line">				lst=T;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(!f) <span class="keyword">continue</span>;</span><br><span class="line">			st.<span class="built_in">insert</span>(-lst);</span><br><span class="line">		&#125;</span><br><span class="line">		cnt=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(ll x:st) &#123;</span><br><span class="line">			ll y=-x;</span><br><span class="line">			<span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">rep</span>(i,<span class="number">1</span>,cnt) <span class="keyword">if</span>((::S[i]&amp;y)==y)&#123; f=<span class="number">0</span>; <span class="keyword">break</span>; &#125;</span><br><span class="line">			<span class="keyword">if</span>(f) ::S[++cnt]=y;</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">//初始系数是-1</span></span><br><span class="line">		ll ans=(<span class="number">1ll</span>&lt;&lt;n)-<span class="built_in">dfs</span>(<span class="number">1</span>,(<span class="number">1ll</span>&lt;&lt;n)<span class="number">-1</span>); <span class="comment">// 注意枚举出来会把T=emptyset的情况算进去，要去掉</span></span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://compilationfail.github.io/oi-solutions/Topcoder/RockPaperScissors/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="orangejuice">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="orangejuice's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | orangejuice's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/oi-solutions/Topcoder/RockPaperScissors/" class="post-title-link" itemprop="url">TopCoder - 12349 SRM579 Round1 Div1 RockPaperScissors (概率dp)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-12 00:11:59" itemprop="dateCreated datePublished" datetime="2023-08-12T00:11:59+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-06 15:36:48" itemprop="dateModified" datetime="2024-03-06T15:36:48+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CP-%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">CP 题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1
id="topcoder---12349-srm579-round1-div1-rockpaperscissors-概率dp">TopCoder
- 12349 SRM579 Round1 Div1 RockPaperScissors (概率dp)</h1>
<h3 id="题目大意">题目大意：</h3>
<p>有 <span class="math inline">\(n\)</span>
个骰子，每个骰子有300个面，其中有 <span
class="math inline">\(a_i,b_i,c_i\)</span> 分别为石头/布/剪刀</p>
<p>每轮你选择出石头/剪刀/布，然后会从剩下的骰子中随机取一个再随机结果，但是你不知道取的是什么骰子</p>
<p>赢一局的权值为3，平局为1</p>
<p>求最优情况下最大的权值期望</p>
<p><span class="math display">\[ \ \]</span></p>
<h3 id="题目分析">题目分析：</h3>
<p>显然当前的局面只和已经抽出的石头/布/剪刀的数量有关（因为这是你唯一的决策依据，也是唯一影响局面的）</p>
<p>乍一看非常抽象的决策过程，实在无法通过分析得到每一种局面下应该作出的决策</p>
<p>于是考虑能否直接把每一种局面出现的概率求出，决策后将期望线性相加</p>
<p>不妨把随机取出的骰子放在一个序列上，一个局面是由已经出现的骰子和当前第
<span class="math inline">\(i\)</span> 次决策的骰子组成的</p>
<p>令 <span class="math inline">\(dp_{i,j,k,typ}\)</span>
表示已经出现的骰子中出现 <span class="math inline">\(i,j,k\)</span>
个石头/布/剪刀，当前决策时骰子结果为 <span
class="math inline">\(typ\)</span> 的概率</p>
<p>实际在 <span class="math inline">\(dp\)</span> 时， <span
class="math inline">\(typ\)</span>
一维需要额外加入一个值表示未确定下一个是什么</p>
<p>考虑对于每个骰子，枚举它是已经出现/正在决策/在第 <span
class="math inline">\(i\)</span> 次决策之后出现，将其概率累和</p>
<p><span class="math inline">\(dp\)</span> 状态为 <span
class="math inline">\(O(n^3)\)</span> ，转移次数为 <span
class="math inline">\(O(n)\)</span> ,复杂度为 <span
class="math inline">\(O(n^4)\)</span></p>
<p>最后对于每种局面计算最优的决策即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;++i)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> drep(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;--i)</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmin</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&gt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cmax</span><span class="params">(T &amp;a,T b)</span></span>&#123; ((a&lt;b)&amp;&amp;(a=b)); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RockPaperScissors</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> N=<span class="number">53</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> eps=<span class="number">1e-9</span>;</span><br><span class="line">	<span class="type">double</span> F[N][N][N][<span class="number">4</span>],G[N][N][N][<span class="number">4</span>],w[<span class="number">3</span>];</span><br><span class="line">	<span class="type">double</span> C[N][N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">bestScore</span><span class="params">(vector &lt;<span class="type">int</span>&gt; w1, vector &lt;<span class="type">int</span>&gt; w2, vector &lt;<span class="type">int</span>&gt; w3)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> n=w1.<span class="built_in">size</span>();</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">0</span>,n) <span class="built_in">rep</span>(j,C[i][<span class="number">0</span>]=<span class="number">1</span>,i) C[i][j]=C[i<span class="number">-1</span>][j<span class="number">-1</span>]+C[i<span class="number">-1</span>][j];</span><br><span class="line">		<span class="built_in">memset</span>(F,<span class="number">0</span>,<span class="keyword">sizeof</span> F),F[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">3</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="built_in">rep</span>(i,<span class="number">1</span>,n) &#123;</span><br><span class="line">			w[<span class="number">0</span>]=w1[i<span class="number">-1</span>]/<span class="number">300.0</span>; w[<span class="number">1</span>]=w2[i<span class="number">-1</span>]/<span class="number">300.0</span>; w[<span class="number">2</span>]=w3[i<span class="number">-1</span>]/<span class="number">300.0</span>;</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">0</span>,i) <span class="built_in">rep</span>(b,<span class="number">0</span>,i-a) <span class="built_in">rep</span>(c,<span class="number">0</span>,i-a-b) <span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">3</span>) G[a][b][c][d]=F[a][b][c][d];</span><br><span class="line">			<span class="built_in">rep</span>(a,<span class="number">0</span>,i) <span class="built_in">rep</span>(b,<span class="number">0</span>,i-a) <span class="built_in">rep</span>(c,<span class="number">0</span>,i-a-b) <span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">3</span>) <span class="keyword">if</span>(G[a][b][c][d]&gt;eps) &#123;</span><br><span class="line">				<span class="comment">// 枚举这个骰子在之前出现过了</span></span><br><span class="line">				F[a+<span class="number">1</span>][b][c][d]+=G[a][b][c][d]*w[<span class="number">0</span>];</span><br><span class="line">				F[a][b+<span class="number">1</span>][c][d]+=G[a][b][c][d]*w[<span class="number">1</span>];</span><br><span class="line">				F[a][b][c+<span class="number">1</span>][d]+=G[a][b][c][d]*w[<span class="number">2</span>];</span><br><span class="line">				<span class="comment">// 枚举这个骰子为下一个出现的</span></span><br><span class="line">				<span class="keyword">if</span>(d==<span class="number">3</span>) <span class="built_in">rep</span>(e,<span class="number">0</span>,<span class="number">2</span>) F[a][b][c][e]+=G[a][b][c][d]*w[e];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">double</span> ans=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">rep</span>(a,<span class="number">0</span>,n<span class="number">-1</span>) <span class="built_in">rep</span>(b,<span class="number">0</span>,n<span class="number">-1</span>-a) <span class="built_in">rep</span>(c,<span class="number">0</span>,n<span class="number">-1</span>-a-b) &#123;</span><br><span class="line">			<span class="comment">// 决策这一轮出什么</span></span><br><span class="line">			<span class="type">double</span> ma=<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">rep</span>(d,<span class="number">0</span>,<span class="number">2</span>) <span class="built_in">cmax</span>(ma,F[a][b][c][d]+F[a][b][c][(d+<span class="number">2</span>)%<span class="number">3</span>]*<span class="number">3</span>);</span><br><span class="line">			ans+=ma/C[n][a+b+c]/(n-a-b-c);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/17/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><span class="page-number current">18</span><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/19/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">orangejuice</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
